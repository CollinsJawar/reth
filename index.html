<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">

    <title>scroll-reth - reth fork diff overview</title>

    <link rel="icon" type="image/x-icon" href="">

    <style>
        .line-stat {
            width: 14rem;
            float: right;
        }
        .line-stat div {
            width: 50%;
        }
        .text-add-ignored {
            color: #93ad93;
            font-style: italic;
        }
        .text-delete-ignored {
            color: #c47777;
            font-style: italic;
        }
        .toplevelstat {
            margin-left: 0 !important;
            width: 15rem;
        }
    </style>

    
<style>
    .term-container {
        background: #171717;
        border-radius: 5px;
        color: white;
        word-break: break-word;
        overflow-wrap: break-word;
        font-family: "SFMono-Regular", Monaco, Menlo, Consolas, "Liberation Mono", Courier, monospace;
        font-size: 12px;
        line-height: 20px;
        padding: 14px 18px;
        white-space: pre-wrap;
    }

    .term-container img { max-width: 100%; }

    .term a { color: inherit; text-decoration: underline; text-decoration-style: dashed; }
    .term a:hover { color: #2882F9 }

    @keyframes blink-animation {
        to {
            visibility: hidden;
        }
    }

    .term-fg1 { } /* don't bold beccause it looks weird */
    .term-fg2 { color: #838887; } /* faint (decreased intensity) - same as gray really */
    .term-fg3 { font-style: italic; } /* italic */
    .term-fg4 { text-decoration: underline; } /* underline */
    .term-fg5 { animation: blink-animation 1s steps(3, start) infinite; } /* blink */
    .term-fg9 { text-decoration: line-through; } /* crossed-out */

    .term-fg30 { color: #666666; } /* black (but we can't use black, so a diff color) */
    .term-fg31 { color: #ff7070; } /* red */
    .term-fg32 { color: #b0f986; } /* green */
    .term-fg33 { color: #c6c502; } /* yellow */
    .term-fg34 { color: #8db7e0; } /* blue */
    .term-fg35 { color: #f271fb; } /* magenta */
    .term-fg36 { color: #6bf7ff; } /* cyan */

    /* high intense colors */
    .term-fgi1 { color: #5ef765; }
    .term-fgi90 { color: #838887; } /* grey */
    .term-fgi91 { color: #ff3333; } /* red */
    .term-fgi92 { color: #00FF00; } /* green */
    .term-fgi93 { color: #fffc67; } /* yellow */
    .term-fgi94 { color: #6871ff; } /* blue */
    .term-fgi95 { color: #ff76ff; } /* magenta */
    .term-fgi96 { color: #60fcff; } /* cyan */

    /* background colors */
    .term-bg40 { background: #676767; } /* grey */
    .term-bg41 { background: #ff4343; } /* red */
    .term-bg42 { background: #99ff5f; } /* green */

    /* custom foreground/background combos for readability */
    .term-fg31.term-bg40 { color: #F8A39F; }

    /* xterm colors */
    .term-fgx16 { color: #000000; }
    .term-fgx17 { color: #00005f; }
    .term-fgx18 { color: #000087; }
    .term-fgx19 { color: #0000af; }
    .term-fgx20 { color: #0000d7; }
    .term-fgx21 { color: #0000ff; }
    .term-fgx22 { color: #005f00; }
    .term-fgx23 { color: #005f5f; }
    .term-fgx24 { color: #005f87; }
    .term-fgx25 { color: #005faf; }
    .term-fgx26 { color: #005fd7; }
    .term-fgx27 { color: #005fff; }
    .term-fgx28 { color: #008700; }
    .term-fgx29 { color: #00875f; }
    .term-fgx30 { color: #008787; }
    .term-fgx31 { color: #0087af; }
    .term-fgx32 { color: #0087d7; }
    .term-fgx33 { color: #0087ff; }
    .term-fgx34 { color: #00af00; }
    .term-fgx35 { color: #00af5f; }
    .term-fgx36 { color: #00af87; }
    .term-fgx37 { color: #00afaf; }
    .term-fgx38 { color: #00afd7; }
    .term-fgx39 { color: #00afff; }
    .term-fgx40 { color: #00d700; }
    .term-fgx41 { color: #00d75f; }
    .term-fgx42 { color: #00d787; }
    .term-fgx43 { color: #00d7af; }
    .term-fgx44 { color: #00d7d7; }
    .term-fgx45 { color: #00d7ff; }
    .term-fgx46 { color: #00ff00; }
    .term-fgx47 { color: #00ff5f; }
    .term-fgx48 { color: #00ff87; }
    .term-fgx49 { color: #00ffaf; }
    .term-fgx50 { color: #00ffd7; }
    .term-fgx51 { color: #00ffff; }
    .term-fgx52 { color: #5f0000; }
    .term-fgx53 { color: #5f005f; }
    .term-fgx54 { color: #5f0087; }
    .term-fgx55 { color: #5f00af; }
    .term-fgx56 { color: #5f00d7; }
    .term-fgx57 { color: #5f00ff; }
    .term-fgx58 { color: #5f5f00; }
    .term-fgx59 { color: #5f5f5f; }
    .term-fgx60 { color: #5f5f87; }
    .term-fgx61 { color: #5f5faf; }
    .term-fgx62 { color: #5f5fd7; }
    .term-fgx63 { color: #5f5fff; }
    .term-fgx64 { color: #5f8700; }
    .term-fgx65 { color: #5f875f; }
    .term-fgx66 { color: #5f8787; }
    .term-fgx67 { color: #5f87af; }
    .term-fgx68 { color: #5f87d7; }
    .term-fgx69 { color: #5f87ff; }
    .term-fgx70 { color: #5faf00; }
    .term-fgx71 { color: #5faf5f; }
    .term-fgx72 { color: #5faf87; }
    .term-fgx73 { color: #5fafaf; }
    .term-fgx74 { color: #5fafd7; }
    .term-fgx75 { color: #5fafff; }
    .term-fgx76 { color: #5fd700; }
    .term-fgx77 { color: #5fd75f; }
    .term-fgx78 { color: #5fd787; }
    .term-fgx79 { color: #5fd7af; }
    .term-fgx80 { color: #5fd7d7; }
    .term-fgx81 { color: #5fd7ff; }
    .term-fgx82 { color: #5fff00; }
    .term-fgx83 { color: #5fff5f; }
    .term-fgx84 { color: #5fff87; }
    .term-fgx85 { color: #5fffaf; }
    .term-fgx86 { color: #5fffd7; }
    .term-fgx87 { color: #5fffff; }
    .term-fgx88 { color: #870000; }
    .term-fgx89 { color: #87005f; }
    .term-fgx90 { color: #870087; }
    .term-fgx91 { color: #8700af; }
    .term-fgx92 { color: #8700d7; }
    .term-fgx93 { color: #8700ff; }
    .term-fgx94 { color: #875f00; }
    .term-fgx95 { color: #875f5f; }
    .term-fgx96 { color: #875f87; }
    .term-fgx97 { color: #875faf; }
    .term-fgx98 { color: #875fd7; }
    .term-fgx99 { color: #875fff; }
    .term-fgx100 { color: #878700; }
    .term-fgx101 { color: #87875f; }
    .term-fgx102 { color: #878787; }
    .term-fgx103 { color: #8787af; }
    .term-fgx104 { color: #8787d7; }
    .term-fgx105 { color: #8787ff; }
    .term-fgx106 { color: #87af00; }
    .term-fgx107 { color: #87af5f; }
    .term-fgx108 { color: #87af87; }
    .term-fgx109 { color: #87afaf; }
    .term-fgx110 { color: #87afd7; }
    .term-fgx111 { color: #87afff; }
    .term-fgx112 { color: #87d700; }
    .term-fgx113 { color: #87d75f; }
    .term-fgx114 { color: #87d787; }
    .term-fgx115 { color: #87d7af; }
    .term-fgx116 { color: #87d7d7; }
    .term-fgx117 { color: #87d7ff; }
    .term-fgx118 { color: #87ff00; }
    .term-fgx119 { color: #87ff5f; }
    .term-fgx120 { color: #87ff87; }
    .term-fgx121 { color: #87ffaf; }
    .term-fgx122 { color: #87ffd7; }
    .term-fgx123 { color: #87ffff; }
    .term-fgx124 { color: #af0000; }
    .term-fgx125 { color: #af005f; }
    .term-fgx126 { color: #af0087; }
    .term-fgx127 { color: #af00af; }
    .term-fgx128 { color: #af00d7; }
    .term-fgx129 { color: #af00ff; }
    .term-fgx130 { color: #af5f00; }
    .term-fgx131 { color: #af5f5f; }
    .term-fgx132 { color: #af5f87; }
    .term-fgx133 { color: #af5faf; }
    .term-fgx134 { color: #af5fd7; }
    .term-fgx135 { color: #af5fff; }
    .term-fgx136 { color: #af8700; }
    .term-fgx137 { color: #af875f; }
    .term-fgx138 { color: #af8787; }
    .term-fgx139 { color: #af87af; }
    .term-fgx140 { color: #af87d7; }
    .term-fgx141 { color: #af87ff; }
    .term-fgx142 { color: #afaf00; }
    .term-fgx143 { color: #afaf5f; }
    .term-fgx144 { color: #afaf87; }
    .term-fgx145 { color: #afafaf; }
    .term-fgx146 { color: #afafd7; }
    .term-fgx147 { color: #afafff; }
    .term-fgx148 { color: #afd700; }
    .term-fgx149 { color: #afd75f; }
    .term-fgx150 { color: #afd787; }
    .term-fgx151 { color: #afd7af; }
    .term-fgx152 { color: #afd7d7; }
    .term-fgx153 { color: #afd7ff; }
    .term-fgx154 { color: #afff00; }
    .term-fgx155 { color: #afff5f; }
    .term-fgx156 { color: #afff87; }
    .term-fgx157 { color: #afffaf; }
    .term-fgx158 { color: #afffd7; }
    .term-fgx159 { color: #afffff; }
    .term-fgx160 { color: #d70000; }
    .term-fgx161 { color: #d7005f; }
    .term-fgx162 { color: #d70087; }
    .term-fgx163 { color: #d700af; }
    .term-fgx164 { color: #d700d7; }
    .term-fgx165 { color: #d700ff; }
    .term-fgx166 { color: #d75f00; }
    .term-fgx167 { color: #d75f5f; }
    .term-fgx168 { color: #d75f87; }
    .term-fgx169 { color: #d75faf; }
    .term-fgx170 { color: #d75fd7; }
    .term-fgx171 { color: #d75fff; }
    .term-fgx172 { color: #d78700; }
    .term-fgx173 { color: #d7875f; }
    .term-fgx174 { color: #d78787; }
    .term-fgx175 { color: #d787af; }
    .term-fgx176 { color: #d787d7; }
    .term-fgx177 { color: #d787ff; }
    .term-fgx178 { color: #d7af00; }
    .term-fgx179 { color: #d7af5f; }
    .term-fgx180 { color: #d7af87; }
    .term-fgx181 { color: #d7afaf; }
    .term-fgx182 { color: #d7afd7; }
    .term-fgx183 { color: #d7afff; }
    .term-fgx184 { color: #d7d700; }
    .term-fgx185 { color: #d7d75f; }
    .term-fgx186 { color: #d7d787; }
    .term-fgx187 { color: #d7d7af; }
    .term-fgx188 { color: #d7d7d7; }
    .term-fgx189 { color: #d7d7ff; }
    .term-fgx190 { color: #d7ff00; }
    .term-fgx191 { color: #d7ff5f; }
    .term-fgx192 { color: #d7ff87; }
    .term-fgx193 { color: #d7ffaf; }
    .term-fgx194 { color: #d7ffd7; }
    .term-fgx195 { color: #d7ffff; }
    .term-fgx196 { color: #ff0000; }
    .term-fgx197 { color: #ff005f; }
    .term-fgx198 { color: #ff0087; }
    .term-fgx199 { color: #ff00af; }
    .term-fgx200 { color: #ff00d7; }
    .term-fgx201 { color: #ff00ff; }
    .term-fgx202 { color: #ff5f00; }
    .term-fgx203 { color: #ff5f5f; }
    .term-fgx204 { color: #ff5f87; }
    .term-fgx205 { color: #ff5faf; }
    .term-fgx206 { color: #ff5fd7; }
    .term-fgx207 { color: #ff5fff; }
    .term-fgx208 { color: #ff8700; }
    .term-fgx209 { color: #ff875f; }
    .term-fgx210 { color: #ff8787; }
    .term-fgx211 { color: #ff87af; }
    .term-fgx212 { color: #ff87d7; }
    .term-fgx213 { color: #ff87ff; }
    .term-fgx214 { color: #ffaf00; }
    .term-fgx215 { color: #ffaf5f; }
    .term-fgx216 { color: #ffaf87; }
    .term-fgx217 { color: #ffafaf; }
    .term-fgx218 { color: #ffafd7; }
    .term-fgx219 { color: #ffafff; }
    .term-fgx220 { color: #ffd700; }
    .term-fgx221 { color: #ffd75f; }
    .term-fgx222 { color: #ffd787; }
    .term-fgx223 { color: #ffd7af; }
    .term-fgx224 { color: #ffd7d7; }
    .term-fgx225 { color: #ffd7ff; }
    .term-fgx226 { color: #ffff00; }
    .term-fgx227 { color: #ffff5f; }
    .term-fgx228 { color: #ffff87; }
    .term-fgx229 { color: #ffffaf; }
    .term-fgx230 { color: #ffffd7; }
    .term-fgx231 { color: #ffffff; }
    .term-fgx232 { color: #080808; }
    .term-fgx233 { color: #121212; }
    .term-fgx234 { color: #1c1c1c; }
    .term-fgx235 { color: #262626; }
    .term-fgx236 { color: #303030; }
    .term-fgx237 { color: #3a3a3a; }
    .term-fgx238 { color: #444444; }
    .term-fgx239 { color: #4e4e4e; }
    .term-fgx240 { color: #585858; }
    .term-fgx241 { color: #626262; }
    .term-fgx242 { color: #6c6c6c; }
    .term-fgx243 { color: #767676; }
    .term-fgx244 { color: #808080; }
    .term-fgx245 { color: #8a8a8a; }
    .term-fgx246 { color: #949494; }
    .term-fgx247 { color: #9e9e9e; }
    .term-fgx248 { color: #a8a8a8; }
    .term-fgx249 { color: #b2b2b2; }
    .term-fgx250 { color: #bcbcbc; }
    .term-fgx251 { color: #c6c6c6; }
    .term-fgx252 { color: #d0d0d0; }
    .term-fgx253 { color: #dadada; }
    .term-fgx254 { color: #e4e4e4; }
    .term-fgx255 { color: #eeeeee; }
</style>

</head>
<body>
    <div class="col-xl-10 col-xxl-8 mx-auto px-3 py-1 py-md-3">
        <main class="container-fluid">
            <div class="row">
                <div>
                    <div class="float-end">
                        <div class="form-check form-switch">
                            <i class="bi bi-brightness-low" id="dark-mode-icon"></i>
                            <input class="form-check-input" type="checkbox" role="switch" id="dark-mode-toggle" data-bs-toggle="tooltip"
                                   data-bs-placement="bottom" data-bs-title="Toggle Dark Mode"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"role="button" aria-expanded="true" aria-controls="id-9aba44a2e1202a9501c52d78">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h1>scroll-reth</h1></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                    <span class="text-end">diff:</span>
                
                
                    <span class="text-end">ignored:</span>
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 toplevelstat">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+2466</span></div>
                    <div class="text-start"><span class="text-danger">-91</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse show border-1 ps-3 my-3" id="id-9aba44a2e1202a9501c52d78">
        <div><p>This is an overview of the changes in <a href="https://github.com/scroll-tech/reth"><code>scroll-reth</code></a>,
a fork of <a href="https://github.com/paradigmxyz/reth"><code>reth</code></a>.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5424ed79acebb9102e4122e2" role="button"
                       aria-expanded="false" aria-controls="id-5424ed79acebb9102e4122e2">
                        <code>Cargo.lock</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/Cargo.lock" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/Cargo.lock" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+89</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5424ed79acebb9102e4122e2"><span class="term-fg1">diff --git reth&#47;Cargo.lock scroll-reth&#47;Cargo.lock</span>
<span class="term-fg1">index 6463fd11a016bea6198300a25cd7337f37e34530..60321029b7397ce998647ca2e1eaeea37af14dbe 100644</span>
<span class="term-fg1">--- reth&#47;Cargo.lock</span>
<span class="term-fg1">+++ scroll-reth&#47;Cargo.lock</span>
<span class="term-fg36">@@ -1346,6 +1346,19 @@</span>  &quot;zeroize&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;bn254&quot;</span>
<span class="term-fg32">+version = &quot;0.1.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254#81e1dcc92ee9a2798b13b84b24de182e9c42256e&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;ff&quot;,</span>
<span class="term-fg32">+ &quot;getrandom 0.2.15&quot;,</span>
<span class="term-fg32">+ &quot;rand 0.8.5&quot;,</span>
<span class="term-fg32">+ &quot;rand_core 0.6.4&quot;,</span>
<span class="term-fg32">+ &quot;sp1-intrinsics&quot;,</span>
<span class="term-fg32">+ &quot;subtle&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;boa_ast&quot;
 version = &quot;0.19.1&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -2620,6 +2633,7 @@</span>  &quot;reth-evm-ethereum&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-stages&quot;,
  &quot;revm&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -3148,6 +3162,7 @@</span> version = &quot;0.13.0&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;ded41244b729663b1e574f1b4fb731469f69f79c17667b5d776b16cda0479449&quot;
 dependencies = [
<span class="term-fg32">+ &quot;bitvec&quot;,</span>
  &quot;rand_core 0.6.4&quot;,
  &quot;subtle&quot;,
 ]
<span class="term-fg36">@@ -5742,6 +5757,15 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;280dc24453071f1b63954171985a0b0d30058d287960968b9b2aca264c8d4ee6&quot;
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;poseidon-bn254&quot;</span>
<span class="term-fg32">+version = &quot;0.1.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254?rev=526a64a#526a64a81419bcab6bd8280a8a3f9808189e0373&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;bn254&quot;,</span>
<span class="term-fg32">+ &quot;itertools 0.13.0&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;powerfmt&quot;
 version = &quot;0.2.0&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -6942,6 +6966,7 @@</span>  &quot;reth-node-types&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-trie&quot;,
  &quot;reth-trie-db&quot;,
<span class="term-fg36">@@ -7536,6 +7561,7 @@</span>  &quot;reth-evm&quot;,
  &quot;reth-execution-types&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-testing-utils&quot;,
  &quot;revm-primitives&quot;,
  &quot;secp256k1&quot;,
<span class="term-fg36">@@ -8573,10 +8599,10 @@</span>  &quot;reth-chainspec&quot;,
  &quot;reth-codecs&quot;,
  &quot;reth-ethereum-forks&quot;,
  &quot;reth-primitives-traits&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-static-file-types&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;revm-primitives&quot;,</span>
  &quot;rstest&quot;,
  &quot;secp256k1&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -8606,7 +8632,8 @@</span>  &quot;proptest&quot;,
  &quot;proptest-arbitrary-interop&quot;,
  &quot;rand 0.8.5&quot;,
  &quot;reth-codecs&quot;,
<span class="term-fg31">- &quot;revm-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;roaring&quot;,
  &quot;serde&quot;,
  &quot;serde_json&quot;,
<span class="term-fg36">@@ -8651,6 +8678,7 @@</span>  &quot;reth-optimism-primitives&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-storage-api&quot;,
  &quot;reth-storage-errors&quot;,
<span class="term-fg36">@@ -9073,6 +9101,54 @@</span>  &quot;serde_json&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;reth-scroll-execution&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;auto_impl&quot;,</span>
<span class="term-fg32">+ &quot;reth-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-primitives&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-primitives&quot;,</span>
<span class="term-fg32">+ &quot;arbitrary&quot;,</span>
<span class="term-fg32">+ &quot;bytes&quot;,</span>
<span class="term-fg32">+ &quot;modular-bitfield&quot;,</span>
<span class="term-fg32">+ &quot;poseidon-bn254&quot;,</span>
<span class="term-fg32">+ &quot;reth-codecs&quot;,</span>
<span class="term-fg32">+ &quot;serde&quot;,</span>
<span class="term-fg32">+ &quot;test-fuzz&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-revm&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;revm&quot;,</span>
<span class="term-fg32">+ &quot;serde&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-storage&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-primitives&quot;,</span>
<span class="term-fg32">+ &quot;eyre&quot;,</span>
<span class="term-fg32">+ &quot;reth-codecs&quot;,</span>
<span class="term-fg32">+ &quot;reth-primitives-traits&quot;,</span>
<span class="term-fg32">+ &quot;reth-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-storage-errors&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;reth-stages&quot;
 version = &quot;1.1.2&quot;
 dependencies = [
<span class="term-fg36">@@ -9111,6 +9187,7 @@</span>  &quot;reth-provider&quot;,
  &quot;reth-prune&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-stages-api&quot;,
  &quot;reth-static-file&quot;,
  &quot;reth-storage-errors&quot;,
<span class="term-fg36">@@ -9387,6 +9464,7 @@</span>  &quot;proptest&quot;,
  &quot;proptest-arbitrary-interop&quot;,
  &quot;reth-codecs&quot;,
  &quot;reth-primitives-traits&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;revm-primitives&quot;,
  &quot;serde&quot;,
 ]
<span class="term-fg36">@@ -9409,6 +9487,7 @@</span>  &quot;reth-execution-errors&quot;,
  &quot;reth-metrics&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-storage-errors&quot;,
  &quot;reth-trie&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg36">@@ -10422,6 +10501,14 @@</span>  &quot;httparse&quot;,
  &quot;log&quot;,
  &quot;rand 0.8.5&quot;,
  &quot;sha1&quot;,
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;sp1-intrinsics&quot;</span>
<span class="term-fg32">+version = &quot;0.0.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;sp1-intrinsics.git?branch=master#7e038e60db0b2e847f6d8f49e148ccac8c6fc394&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;cfg-if&quot;,</span>
 ]
&nbsp;
 [[package]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3adc1816833bf1dfb429abc6" role="button"
                       aria-expanded="false" aria-controls="id-3adc1816833bf1dfb429abc6">
                        <code>Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3adc1816833bf1dfb429abc6"><span class="term-fg1">diff --git reth&#47;Cargo.toml scroll-reth&#47;Cargo.toml</span>
<span class="term-fg1">index ad17ea4ad0ca8e062712093262336d87522d8936..74762824cbee5cac75513ebc0ba7a3299500cc6f 100644</span>
<span class="term-fg1">--- reth&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;Cargo.toml</span>
<span class="term-fg36">@@ -100,6 +100,10 @@</span>     &quot;crates&#47;rpc&#47;rpc-server-types&#47;&quot;,
     &quot;crates&#47;rpc&#47;rpc-testing-util&#47;&quot;,
     &quot;crates&#47;rpc&#47;rpc-types-compat&#47;&quot;,
     &quot;crates&#47;rpc&#47;rpc&#47;&quot;,
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;execution&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;primitives&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;revm&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;storage&quot;,</span>
     &quot;crates&#47;stages&#47;api&#47;&quot;,
     &quot;crates&#47;stages&#47;stages&#47;&quot;,
     &quot;crates&#47;stages&#47;types&#47;&quot;,
<span class="term-fg36">@@ -403,6 +407,10 @@</span> reth-rpc-eth-types = { path = &quot;crates&#47;rpc&#47;rpc-eth-types&quot;, default-features = false }
 reth-rpc-layer = { path = &quot;crates&#47;rpc&#47;rpc-layer&quot; }
 reth-rpc-server-types = { path = &quot;crates&#47;rpc&#47;rpc-server-types&quot; }
 reth-rpc-types-compat = { path = &quot;crates&#47;rpc&#47;rpc-types-compat&quot; }
<span class="term-fg32">+reth-scroll-execution = { path = &quot;crates&#47;scroll&#47;execution&quot; }</span>
<span class="term-fg32">+reth-scroll-primitives = { path = &quot;crates&#47;scroll&#47;primitives&quot; }</span>
<span class="term-fg32">+reth-scroll-revm = { path = &quot;crates&#47;scroll&#47;revm&quot; }</span>
<span class="term-fg32">+reth-scroll-storage = { path = &quot;crates&#47;scroll&#47;storage&quot; }</span>
 reth-stages = { path = &quot;crates&#47;stages&#47;stages&quot; }
 reth-stages-api = { path = &quot;crates&#47;stages&#47;api&quot; }
 reth-stages-types = { path = &quot;crates&#47;stages&#47;types&quot; }
<span class="term-fg36">@@ -469,6 +477,10 @@</span>     &quot;reqwest-rustls-tls&quot;,
 ], default-features = false }
 alloy-transport-ipc = { version = &quot;0.6.4&quot;, default-features = false }
 alloy-transport-ws = { version = &quot;0.6.4&quot;, default-features = false }
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+# TODO (scroll): point to crates.io&#47;tag once the crate is published&#47;a tag is created.</span>
<span class="term-fg32">+poseidon-bn254 = { git = &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254&quot;, rev = &quot;526a64a&quot;, features = [&quot;bn254&quot;] }</span>
&nbsp;
 # op
 op-alloy-rpc-types = &quot;0.6.7&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-72fce3e6e56cf3168b24bfae" role="button"
                       aria-expanded="false" aria-controls="id-72fce3e6e56cf3168b24bfae">
                        <code>deny.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/deny.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/deny.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-72fce3e6e56cf3168b24bfae"><span class="term-fg1">diff --git reth&#47;deny.toml scroll-reth&#47;deny.toml</span>
<span class="term-fg1">index 8d0807f9de5c63618c5ca26f05ae75a198d95715..6dc51dba0a93737b29ee37c6d76549120dd504d3 100644</span>
<span class="term-fg1">--- reth&#47;deny.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;deny.toml</span>
<span class="term-fg36">@@ -67,6 +67,11 @@</span>     { allow = [&quot;MPL-2.0&quot;], name = &quot;option-ext&quot; },
     { allow = [&quot;MPL-2.0&quot;], name = &quot;webpki-roots&quot; },
 ]
&nbsp;
<span class="term-fg32">+# Skip the poseidon-bn254 and bn254 crates for license verification. We should at some point publish a license for them.</span>
<span class="term-fg32">+[licenses.private]</span>
<span class="term-fg32">+ignore = true</span>
<span class="term-fg32">+ignore-sources = [&quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254&quot;, &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254&quot;]</span>
<span class="term-fg32">+</span>
 [[licenses.clarify]]
 name = &quot;ring&quot;
 expression = &quot;LicenseRef-ring&quot;
<span class="term-fg36">@@ -93,4 +98,7 @@</span>     &quot;https:&#47;&#47;github.com&#47;alloy-rs&#47;alloy&quot;,
     &quot;https:&#47;&#47;github.com&#47;foundry-rs&#47;block-explorers&quot;,
     &quot;https:&#47;&#47;github.com&#47;bluealloy&#47;revm&quot;,
     &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;revm-inspectors&quot;,
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;sp1-intrinsics&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-77d1dfcd51eaab9b94df08f2" role="button"
                       aria-expanded="false" aria-controls="id-77d1dfcd51eaab9b94df08f2">
                        <code>fork.yaml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/fork.yaml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+18</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-77d1dfcd51eaab9b94df08f2"><span class="term-fg1">diff --git reth&#47;fork.yaml scroll-reth&#47;fork.yaml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..37935a42410bc3d4d56542e1fd2c1222fb0eac01</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;fork.yaml</span>
<span class="term-fg36">@@ -0,0 +1,18 @@</span>
<span class="term-fg32">+title: &quot;scroll-reth - reth fork diff overview&quot;</span>
<span class="term-fg32">+footer: |</span>
<span class="term-fg32">+  Fork-diff overview of [`scroll-reth`](https:&#47;&#47;github.com&#47;scroll-tech&#47;reth), a fork of [`reth`](https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth).</span>
<span class="term-fg32">+base:</span>
<span class="term-fg32">+  name: reth</span>
<span class="term-fg32">+  url: https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth</span>
<span class="term-fg32">+  hash: 02824da4fcd0794d45442adbdbf6b953be04d4f3</span>
<span class="term-fg32">+fork:</span>
<span class="term-fg32">+  name: scroll-reth</span>
<span class="term-fg32">+  url: https:&#47;&#47;github.com&#47;scroll-tech&#47;reth</span>
<span class="term-fg32">+  ref: refs&#47;heads&#47;scroll</span>
<span class="term-fg32">+def:</span>
<span class="term-fg32">+  title: &quot;scroll-reth&quot;</span>
<span class="term-fg32">+  description: |</span>
<span class="term-fg32">+    This is an overview of the changes in [`scroll-reth`](https:&#47;&#47;github.com&#47;scroll-tech&#47;reth),</span>
<span class="term-fg32">+    a fork of [`reth`](https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth).</span>
<span class="term-fg32">+  globs:</span>
<span class="term-fg32">+    - &quot;*&quot;</span></div>
    </div>

            
            
        </div>
        <div>
            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-c4908228892bfe60cd069b32"role="button" aria-expanded="false" aria-controls="id-c4908228892bfe60cd069b32">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>Other changes</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+2339</span></div>
                    <div class="text-start"><span class="text-danger">-89</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-c4908228892bfe60cd069b32">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9b165ff5d6b83a71fc5cec12" role="button"
                       aria-expanded="false" aria-controls="id-9b165ff5d6b83a71fc5cec12">
                        <code>.github/workflows/bench.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/bench.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/.github/workflows/bench.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9b165ff5d6b83a71fc5cec12"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;bench.yml scroll-reth&#47;.github&#47;workflows&#47;bench.yml</span>
<span class="term-fg1">index 8ddc97441c2a843ca168ac54ddc180fda913838d..b647a81a2267eb91e49317db91a1cce2a1aa4465 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;bench.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;bench.yml</span>
<span class="term-fg36">@@ -18,8 +18,7 @@</span>
 name: bench
 jobs:
   iai:
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     # Only run benchmarks in merge groups and on main
     if: github.event_name != &#39;pull_request&#39;
     steps:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0c0d9b0a489954855f13c4cf" role="button"
                       aria-expanded="false" aria-controls="id-0c0d9b0a489954855f13c4cf">
                        <code>.github/workflows/book.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/book.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/.github/workflows/book.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0c0d9b0a489954855f13c4cf"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;book.yml scroll-reth&#47;.github&#47;workflows&#47;book.yml</span>
<span class="term-fg1">index 56d5c427466e0ef9eefe65daab422e86026b205d..d7f9fe34826e2b0010a0b15b496af508f58ab94c 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;book.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;book.yml</span>
<span class="term-fg36">@@ -4,9 +4,9 @@</span> name: book
&nbsp;
 on:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
   pull_request:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
   merge_group:
&nbsp;
 jobs:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2588cbab835f008e78447bf0" role="button"
                       aria-expanded="false" aria-controls="id-2588cbab835f008e78447bf0">
                        <code>.github/workflows/compact.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/compact.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/.github/workflows/compact.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2588cbab835f008e78447bf0"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;compact.yml scroll-reth&#47;.github&#47;workflows&#47;compact.yml</span>
<span class="term-fg1">index 484b27c820d003caff9b8abdf50e9ce2f9fe3155..44939e4b447c1d33a4d61671b3bce9244bee7417 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;compact.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;compact.yml</span>
<span class="term-fg36">@@ -10,7 +10,7 @@</span>
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -18,8 +18,7 @@</span>
 name: compact-codec
 jobs:
   compact-codec:
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     strategy:
       matrix:
         bin:
<span class="term-fg36">@@ -33,8 +32,8 @@</span>           cache-on-failure: true
       - name: Checkout base
         uses: actions&#47;checkout@v4
         with:
<span class="term-fg31">-          ref: ${{ github.base_ref || &#39;main&#39; }}</span>
<span class="term-fg31">-      # On `main` branch, generates test vectors and serializes them to disk using `Compact`.</span>
<span class="term-fg32">+          ref: ${{ github.base_ref || &#39;scroll&#39; }}</span>
<span class="term-fg32">+      # On `scroll` branch, generates test vectors and serializes them to disk using `Compact`.</span>
       - name: Generate compact vectors
         run: |
           ${{ matrix.bin }} -- test-vectors compact --write</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7f06e38426a834be0b71e5f3" role="button"
                       aria-expanded="false" aria-controls="id-7f06e38426a834be0b71e5f3">
                        <code>.github/workflows/deny.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/deny.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/.github/workflows/deny.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7f06e38426a834be0b71e5f3"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;deny.yml scroll-reth&#47;.github&#47;workflows&#47;deny.yml</span>
<span class="term-fg1">index f85484ca2ec21833a6942fdea82eaf6d15d4ebc4..6908a3d5a56117cac1a581d25953fa4670ba45cd 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;deny.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;deny.yml</span>
<span class="term-fg36">@@ -4,10 +4,10 @@</span> name: deny
&nbsp;
 on:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
     paths: [Cargo.lock]
   pull_request:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
     paths: [Cargo.lock]
   merge_group:
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cba5eba06f6a22a711559d9a" role="button"
                       aria-expanded="false" aria-controls="id-cba5eba06f6a22a711559d9a">
                        <code>.github/workflows/hive.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/hive.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/.github/workflows/hive.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-8</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cba5eba06f6a22a711559d9a"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;hive.yml scroll-reth&#47;.github&#47;workflows&#47;hive.yml</span>
<span class="term-fg1">index b8d3f378fca40be3a094856b6205b3139350ee4b..0d8ba91a00c53e7a5b01cb286343dca992ccee56 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;hive.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;hive.yml</span>
<span class="term-fg36">@@ -19,8 +19,7 @@</span> jobs:
   prepare-reth:
     if: github.repository == &#39;paradigmxyz&#47;reth&#39;
     timeout-minutes: 45
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     steps:
       - uses: actions&#47;checkout@v4
       - run: mkdir artifacts
<span class="term-fg36">@@ -53,8 +52,7 @@</span>
   prepare-hive:
     if: github.repository == &#39;paradigmxyz&#47;reth&#39;
     timeout-minutes: 45
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     steps:
       - uses: actions&#47;checkout@v4
       - name: Checkout hive tests
<span class="term-fg36">@@ -181,8 +179,7 @@</span>     needs:
       - prepare-reth
       - prepare-hive
     name: run ${{ matrix.scenario.sim }}${{ matrix.scenario.limit &amp;&amp; format(&#39; - {0}&#39;, matrix.scenario.limit) }}
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     permissions:
       issues: write
     steps:
<span class="term-fg36">@@ -249,8 +246,7 @@</span>           cat hivetests&#47;workspace&#47;logs&#47;reth&#47;client-*.log
   notify-on-error:
     needs: test
     if: failure()
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     steps:
       - name: Slack Webhook Action
         uses: rtCamp&#47;action-slack-notify@v2</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9061055a0ef232f433976d3c" role="button"
                       aria-expanded="false" aria-controls="id-9061055a0ef232f433976d3c">
                        <code>.github/workflows/integration.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/integration.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/.github/workflows/integration.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9061055a0ef232f433976d3c"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;integration.yml scroll-reth&#47;.github&#47;workflows&#47;integration.yml</span>
<span class="term-fg1">index 82bd5705a32001b5e309a55df19974211618ee6e..7ba3395cce84576d6b304c4945f751e1bdc24080 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;integration.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;integration.yml</span>
<span class="term-fg36">@@ -6,7 +6,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -19,8 +19,7 @@</span>
 jobs:
   test:
     name: test &#47; ${{ matrix.network }}
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_BACKTRACE: 1
     strategy:
<span class="term-fg36">@@ -28,6 +27,8 @@</span>       matrix:
         network: [&quot;ethereum&quot;, &quot;optimism&quot;]
     timeout-minutes: 60
     steps:
<span class="term-fg32">+      - name: Free up disk space</span>
<span class="term-fg32">+        run: rm -rf &#47;opt&#47;hostedtoolcache</span>
       - uses: actions&#47;checkout@v4
       - uses: dtolnay&#47;rust-toolchain@stable
       - name: Install Geth</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a9402c1ccb000cd38542e075" role="button"
                       aria-expanded="false" aria-controls="id-a9402c1ccb000cd38542e075">
                        <code>.github/workflows/lint.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/lint.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/.github/workflows/lint.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a9402c1ccb000cd38542e075"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;lint.yml scroll-reth&#47;.github&#47;workflows&#47;lint.yml</span>
<span class="term-fg1">index 7e6b8747fff5971fdd71848d8051a2aa4c7b4bb2..118dcf777fb46e2a6a83a83e09428650833aed58 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;lint.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;lint.yml</span>
<span class="term-fg36">@@ -4,7 +4,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -152,7 +152,7 @@</span>       - uses: Swatinem&#47;rust-cache@v2
         with:
           cache-on-failure: true
       - uses: taiki-e&#47;install-action@cargo-udeps
<span class="term-fg31">-      - run: cargo udeps --workspace --lib --examples --tests --benches --all-features --locked</span>
<span class="term-fg32">+      - run: cargo udeps --workspace --lib --examples --tests --benches --all-features --locked --exclude &quot;reth-optimism-*&quot; --exclude op-reth</span>
&nbsp;
   book:
     name: book</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e75014944581c3c3f4d4e420" role="button"
                       aria-expanded="false" aria-controls="id-e75014944581c3c3f4d4e420">
                        <code>.github/workflows/pages.yaml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/.github/workflows/pages.yaml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+32</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e75014944581c3c3f4d4e420"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;pages.yaml scroll-reth&#47;.github&#47;workflows&#47;pages.yaml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5717d4c95543c09d59a7d51803826ead2641a5c5</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;pages.yaml</span>
<span class="term-fg36">@@ -0,0 +1,33 @@</span>
<span class="term-fg32">+name: Build and publish forkdiff github-pages</span>
<span class="term-fg32">+permissions:</span>
<span class="term-fg32">+  contents: write</span>
<span class="term-fg32">+on:</span>
<span class="term-fg32">+  push:</span>
<span class="term-fg32">+    branches:</span>
<span class="term-fg32">+      - scroll</span>
<span class="term-fg32">+jobs:</span>
<span class="term-fg32">+  deploy:</span>
<span class="term-fg32">+    concurrency: ci-${{ github.ref }}</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - name: Checkout</span>
<span class="term-fg32">+        uses: actions&#47;checkout@v4</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          fetch-depth: 1000  # make sure to fetch the old commit we diff against</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Build forkdiff</span>
<span class="term-fg32">+        uses: &quot;docker:&#47;&#47;protolambda&#47;forkdiff:0.1.0&quot;</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          args: -repo=&#47;github&#47;workspace -fork=&#47;github&#47;workspace&#47;fork.yaml -out=&#47;github&#47;workspace&#47;index.html</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Build pages</span>
<span class="term-fg32">+        run: |</span>
<span class="term-fg32">+          mkdir -p tmp&#47;pages</span>
<span class="term-fg32">+          mv index.html tmp&#47;pages&#47;index.html</span>
<span class="term-fg32">+          touch tmp&#47;pages&#47;.nojekyll</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Deploy</span>
<span class="term-fg32">+        uses: JamesIves&#47;github-pages-deploy-action@v4</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          folder: tmp&#47;pages</span>
<span class="term-fg32">+          clean: true</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c72aa02a71daadf581f041f2" role="button"
                       aria-expanded="false" aria-controls="id-c72aa02a71daadf581f041f2">
                        <code>.github/workflows/stage.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/stage.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/.github/workflows/stage.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c72aa02a71daadf581f041f2"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;stage.yml scroll-reth&#47;.github&#47;workflows&#47;stage.yml</span>
<span class="term-fg1">index 60ffa8f73d728311d53e26e0005d5a2723437cce..b3988a0a0ef35b1d219eb76e2bea0226957ba46c 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;stage.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;stage.yml</span>
<span class="term-fg36">@@ -6,7 +6,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [ main ]</span>
<span class="term-fg32">+    branches: [ main, scroll ]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -22,8 +22,7 @@</span>   stage:
     name: stage-run-test
     # Only run stage commands test in merge groups
     if: github.event_name == &#39;merge_group&#39;
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_LOG: info,sync=error
       RUST_BACKTRACE: 1</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-52c2c70fa2e5349aec60d3b8" role="button"
                       aria-expanded="false" aria-controls="id-52c2c70fa2e5349aec60d3b8">
                        <code>.github/workflows/stale.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/stale.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/.github/workflows/stale.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+0</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-52c2c70fa2e5349aec60d3b8"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;stale.yml scroll-reth&#47;.github&#47;workflows&#47;stale.yml</span>
<span class="term-fg1">index 38cca2fb1a9b895f2c548d9db60678c3d6bea241..0d51a0e4eae60c0a8e5a7383eb134b85966b638a 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;stale.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;stale.yml</span>
<span class="term-fg36">@@ -4,8 +4,6 @@</span> name: stale issues
&nbsp;
 on:
   workflow_dispatch: {}
<span class="term-fg31">-  schedule:</span>
<span class="term-fg31">-    - cron: &quot;30 1 * * *&quot;</span>
&nbsp;
 jobs:
   close-issues:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-433b42d8ba8199ed3ce64ce0" role="button"
                       aria-expanded="false" aria-controls="id-433b42d8ba8199ed3ce64ce0">
                        <code>.github/workflows/sync.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/sync.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/.github/workflows/sync.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-433b42d8ba8199ed3ce64ce0"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;sync.yml scroll-reth&#47;.github&#47;workflows&#47;sync.yml</span>
<span class="term-fg1">index 531d04b2e48918fc3b39e39b94402efc1c052346..1f7d592a0405a673803a2fc1ebe0176cef775bf2 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;sync.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;sync.yml</span>
<span class="term-fg36">@@ -15,8 +15,7 @@</span>
 jobs:
   sync:
     name: sync (${{ matrix.chain.bin }})
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_LOG: info,sync=error
       RUST_BACKTRACE: 1</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8db6efd25efe188b3b265fba" role="button"
                       aria-expanded="false" aria-controls="id-8db6efd25efe188b3b265fba">
                        <code>.github/workflows/unit.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/unit.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/.github/workflows/unit.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-7</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8db6efd25efe188b3b265fba"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;unit.yml scroll-reth&#47;.github&#47;workflows&#47;unit.yml</span>
<span class="term-fg1">index e89ad903d80213a4aa586a10b41dda9d419571c1..f9f925c686fc1e65134c45d85783ebedbe1f57d4 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;unit.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;unit.yml</span>
<span class="term-fg36">@@ -6,7 +6,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -19,8 +19,7 @@</span>
 jobs:
   test:
     name: test &#47; ${{ matrix.type }} (${{ matrix.partition }}&#47;${{ matrix.total_partitions }})
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_BACKTRACE: 1
     strategy:
<span class="term-fg36">@@ -48,6 +47,8 @@</span>             partition: 1
             total_partitions: 1
     timeout-minutes: 30
     steps:
<span class="term-fg32">+      - name: Free up disk space</span>
<span class="term-fg32">+        run: rm -rf &#47;opt&#47;hostedtoolcache</span>
       - uses: actions&#47;checkout@v4
       - uses: dtolnay&#47;rust-toolchain@stable
       - uses: Swatinem&#47;rust-cache@v2
<span class="term-fg36">@@ -67,13 +68,14 @@</span>             -E &quot;!kind(test)&quot;
&nbsp;
   state:
     name: Ethereum state tests
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_LOG: info,sync=error
       RUST_BACKTRACE: 1
     timeout-minutes: 30
     steps:
<span class="term-fg32">+      - name: Free up disk space</span>
<span class="term-fg32">+        run: rm -rf &#47;opt&#47;hostedtoolcache</span>
       - uses: actions&#47;checkout@v4
       - name: Checkout ethereum&#47;tests
         uses: actions&#47;checkout@v4
<span class="term-fg36">@@ -92,8 +94,7 @@</span>       - run: cargo nextest run --release -p ef-tests --features &quot;asm-keccak ef-tests&quot;
&nbsp;
   doc:
     name: doc tests (${{ matrix.network }})
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_BACKTRACE: 1
     timeout-minutes: 30</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-06304e4602365518403c89b7" role="button"
                       aria-expanded="false" aria-controls="id-06304e4602365518403c89b7">
                        <code>crates/ethereum/evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/ethereum/evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/ethereum/evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-06304e4602365518403c89b7"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">index 17e870e61113458c1bc459d7e306e85cbe39aafa..0dd0ab5a02ab2de56a78b11b86f43826e21c84df 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -39,6 +39,8 @@</span> secp256k1.workspace = true
 serde_json.workspace = true
 alloy-genesis.workspace = true
&nbsp;
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
 [features]
 default = [&quot;std&quot;]
 std = [
<span class="term-fg36">@@ -52,3 +54,4 @@</span> 	&quot;alloy-primitives&#47;std&quot;,
 	&quot;revm-primitives&#47;std&quot;,
 	&quot;secp256k1&#47;std&quot;
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4e2ecc1545c33354409aac53" role="button"
                       aria-expanded="false" aria-controls="id-4e2ecc1545c33354409aac53">
                        <code>crates/ethereum/evm/src/execute.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/ethereum/evm/src/execute.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/ethereum/evm/src/execute.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+26</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4e2ecc1545c33354409aac53"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">index e339268a99a7b81a15cb7f570ca93e20c6459057..6aa7b2ccca6ab4f3b53075cf5ef3ff7e3a82387f 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg36">@@ -335,6 +335,10 @@</span>         let beacon_root_contract_account = Account {
             balance: U256::ZERO,
             bytecode_hash: Some(keccak256(BEACON_ROOTS_CODE.clone())),
             nonce: 1,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;BEACON_ROOTS_CODE,</span>
<span class="term-fg32">+            )),</span>
         };
&nbsp;
         db.insert_account(
<span class="term-fg36">@@ -354,6 +358,10 @@</span>         let withdrawal_requests_contract_account = Account {
             nonce: 1,
             balance: U256::ZERO,
             bytecode_hash: Some(keccak256(WITHDRAWAL_REQUEST_PREDEPLOY_CODE.clone())),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;WITHDRAWAL_REQUEST_PREDEPLOY_CODE,</span>
<span class="term-fg32">+            )),</span>
         };
&nbsp;
         db.insert_account(
<span class="term-fg36">@@ -717,6 +725,10 @@</span>         let blockhashes_contract_account = Account {
             balance: U256::ZERO,
             bytecode_hash: Some(keccak256(HISTORY_STORAGE_CODE.clone())),
             nonce: 1,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;HISTORY_STORAGE_CODE,</span>
<span class="term-fg32">+            )),</span>
         };
&nbsp;
         db.insert_account(
<span class="term-fg36">@@ -1069,7 +1081,13 @@</span>         let sender_address = public_key_to_address(sender_key_pair.public_key());
&nbsp;
         db.insert_account(
             sender_address,
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(ETH_TO_WEI), bytecode_hash: None },</span>
<span class="term-fg32">+            Account {</span>
<span class="term-fg32">+                nonce: 1,</span>
<span class="term-fg32">+                balance: U256::from(ETH_TO_WEI),</span>
<span class="term-fg32">+                bytecode_hash: None,</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            },</span>
             None,
             HashMap::default(),
         );
<span class="term-fg36">@@ -1151,7 +1169,13 @@</span>
         &#47;&#47; Insert the sender account into the state with a nonce of 1 and a balance of 1 ETH in Wei
         db.insert_account(
             sender_address,
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(ETH_TO_WEI), bytecode_hash: None },</span>
<span class="term-fg32">+            Account {</span>
<span class="term-fg32">+                nonce: 1,</span>
<span class="term-fg32">+                balance: U256::from(ETH_TO_WEI),</span>
<span class="term-fg32">+                bytecode_hash: None,</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            },</span>
             None,
             HashMap::default(),
         );</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6dd2036e228fa05b8a83abb7" role="button"
                       aria-expanded="false" aria-controls="id-6dd2036e228fa05b8a83abb7">
                        <code>crates/optimism/bin/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/bin/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/bin/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6dd2036e228fa05b8a83abb7"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml</span>
<span class="term-fg1">index 45f4492e82b60cf492ff5ff5223a2fe3e0d13fe9..efbea77454cca22287f6a2f83a225e606f75e2d4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml</span>
<span class="term-fg36">@@ -46,6 +46,7 @@</span> 	&quot;reth-optimism-payload-builder&#47;optimism&quot;,
 	&quot;reth-optimism-rpc&#47;optimism&quot;,
 	&quot;reth-provider&#47;optimism&quot;
 ]
<span class="term-fg32">+scroll = []</span>
&nbsp;
 dev = [
 	&quot;reth-optimism-cli&#47;dev&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1976d31bf93ecadb3ec57ad4" role="button"
                       aria-expanded="false" aria-controls="id-1976d31bf93ecadb3ec57ad4">
                        <code>crates/optimism/bin/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/bin/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/bin/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1976d31bf93ecadb3ec57ad4"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 21c28f7c5470f38893c52fa10198a0feed2323f7..3e9550949c1de79479a4bdb628b1bb2d84114410 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -26,6 +26,9 @@</span> )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 &#47;&#47;&#47; Re-exported from `reth_optimism_cli`.
 pub mod cli {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b8cc4a7e5ee6e7cb98a7e858" role="button"
                       aria-expanded="false" aria-controls="id-b8cc4a7e5ee6e7cb98a7e858">
                        <code>crates/optimism/bin/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/bin/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/bin/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b8cc4a7e5ee6e7cb98a7e858"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg1">index 6494298ba393b461323b9430d440a640cb1e0e61..7ba70272f77d5f697a094910f2eee518cbb44619 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 #![allow(missing_docs, rustdoc::missing_crate_level_docs)]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use clap::Parser;
 use reth_node_builder::{engine_tree_config::TreeConfig, EngineNodeLauncher};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7d6b95f105ed8615cce632f5" role="button"
                       aria-expanded="false" aria-controls="id-7d6b95f105ed8615cce632f5">
                        <code>crates/optimism/cli/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/cli/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/cli/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7d6b95f105ed8615cce632f5"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml</span>
<span class="term-fg1">index d090075927aa843b1d54bb17516525b73940065e..5eb0f0e99e039872a69a60dd4fbee490adecace3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml</span>
<span class="term-fg36">@@ -122,3 +122,4 @@</span> 	&quot;reth-execution-types&#47;serde&quot;,
 	&quot;reth-provider&#47;serde&quot;,
 	&quot;reth-optimism-primitives&#47;serde&quot;,
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0b235605586c9a0c044e3525" role="button"
                       aria-expanded="false" aria-controls="id-0b235605586c9a0c044e3525">
                        <code>crates/optimism/cli/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/cli/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/cli/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0b235605586c9a0c044e3525"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 23eaa99b521330609777f97db7bdd0bab92857ee..b02c128cbf334f4da48b418e1cf2f9ce76f4d080 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -9,6 +9,9 @@</span> #![cfg_attr(all(not(test), feature = &quot;optimism&quot;), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 &#47;&#47;&#47; Optimism chain specification parser.
 pub mod chainspec;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d78345c744a58fda5cbd6220" role="button"
                       aria-expanded="false" aria-controls="id-d78345c744a58fda5cbd6220">
                        <code>crates/optimism/evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d78345c744a58fda5cbd6220"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">index 807f224ca4b8ea23d95fe5334014ee9262822c70..987b3d3ac4ed456de7f815fcebb27312332fc06d 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -70,3 +70,4 @@</span> 	&quot;reth-optimism-consensus&#47;optimism&quot;,
 	&quot;revm&#47;optimism&quot;,
 	&quot;revm-primitives&#47;optimism&quot;
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8cb7b569b7436af759a25221" role="button"
                       aria-expanded="false" aria-controls="id-8cb7b569b7436af759a25221">
                        <code>crates/optimism/evm/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/evm/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/evm/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8cb7b569b7436af759a25221"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 3107462751039a80d0b33ea57a6cb056c30274fe..78aa706eaf6ffe5433641f98cf9774be93b9a59c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -9,6 +9,9 @@</span> #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(feature = &quot;std&quot;), no_std)]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 extern crate alloc;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6782d85ff4e52db6e1110be4" role="button"
                       aria-expanded="false" aria-controls="id-6782d85ff4e52db6e1110be4">
                        <code>crates/optimism/node/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/node/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/node/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6782d85ff4e52db6e1110be4"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">index fbc055a82e9843d990d2b64b28ff18d58e74b42e..303787559735e1070ddb53d30e48db118ebf504c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml</span>
<span class="term-fg36">@@ -124,4 +124,5 @@</span> ]
 reth-codec = [
     &quot;reth-primitives&#47;reth-codec&quot;,
     &quot;reth-optimism-primitives&#47;reth-codec&quot;,
<span class="term-fg31">-]</span>
<span class="term-fg31">\ No newline at end of file</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b8e52490f16867f0df4b09e0" role="button"
                       aria-expanded="false" aria-controls="id-b8e52490f16867f0df4b09e0">
                        <code>crates/optimism/node/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/node/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/node/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b8e52490f16867f0df4b09e0"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 7af0f3b8a722f3be89f2441ced4248d4587ea825..8bf8225bdef70a7c54127ae92bcc82529893d4f3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -8,6 +8,9 @@</span> )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 &#47;&#47;&#47; CLI argument parsing for the optimism node.
 pub mod args;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-081574b4d976cdc29e818651" role="button"
                       aria-expanded="false" aria-controls="id-081574b4d976cdc29e818651">
                        <code>crates/optimism/node/tests/e2e/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/node/tests/e2e/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/node/tests/e2e/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-081574b4d976cdc29e818651"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">index 7f4b22ba7e04eb795bc6286c44f1464f5c9f6c1c..b3143d7c40ba494ac49fb61938086984c7d53ae8 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg36">@@ -1,4 +1,7 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 #[cfg(feature = &quot;optimism&quot;)]
 mod p2p;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-39e43665888af0e01d0a151f" role="button"
                       aria-expanded="false" aria-controls="id-39e43665888af0e01d0a151f">
                        <code>crates/optimism/node/tests/it/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/node/tests/it/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/node/tests/it/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-39e43665888af0e01d0a151f"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">index d0533fc4541ca1543d060df932dad643f9e3ab5c..2bfdeffc1c4abfc357e8f1a1bc7c8b8f3ebea05b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg36">@@ -1,4 +1,7 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 #[cfg(feature = &quot;optimism&quot;)]
 mod builder;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1c8ad83b4a8f1c72b8821674" role="button"
                       aria-expanded="false" aria-controls="id-1c8ad83b4a8f1c72b8821674">
                        <code>crates/optimism/payload/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/payload/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/payload/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1c8ad83b4a8f1c72b8821674"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">index 7f47da7e23606048ab1af463c18f61894dd55f0b..8873da14605e299b4de0b970b2b8f52c3be0d171 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml</span>
<span class="term-fg36">@@ -59,4 +59,5 @@</span> 	&quot;reth-optimism-evm&#47;optimism&quot;,
 	&quot;revm&#47;optimism&quot;,
 	&quot;reth-execution-types&#47;optimism&quot;,
 	&quot;reth-optimism-consensus&#47;optimism&quot;
<span class="term-fg31">-]</span>
<span class="term-fg31">\ No newline at end of file</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = []</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0ac65ed13e9afe5425a86ac9" role="button"
                       aria-expanded="false" aria-controls="id-0ac65ed13e9afe5425a86ac9">
                        <code>crates/optimism/payload/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/payload/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/payload/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0ac65ed13e9afe5425a86ac9"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 8447026d783a3fd65a755da88e20b9b75f5734e8..ee1f0a81dcee23ec40a3befa61d7cc22d02e62a3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -10,6 +10,9 @@</span> #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![allow(clippy::useless_let_if_seq)]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 pub mod builder;
 pub use builder::OpPayloadBuilder;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e6b9b138e55d2cec688e8bd0" role="button"
                       aria-expanded="false" aria-controls="id-e6b9b138e55d2cec688e8bd0">
                        <code>crates/optimism/rpc/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/rpc/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/rpc/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e6b9b138e55d2cec688e8bd0"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">index 17fafef70965a2de2ea565a1228ea1a1e0356d31..dfa5ddb0a7850d4a844310fbe26a9a417540d1b7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg36">@@ -74,3 +74,4 @@</span> 	&quot;revm&#47;optimism&quot;,
 	&quot;reth-optimism-consensus&#47;optimism&quot;,
 	&quot;reth-optimism-payload-builder&#47;optimism&quot;
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bd7140a60b9c21dc1a419524" role="button"
                       aria-expanded="false" aria-controls="id-bd7140a60b9c21dc1a419524">
                        <code>crates/optimism/rpc/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/rpc/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/optimism/rpc/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bd7140a60b9c21dc1a419524"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 0fa0debdf33dbb4dbc78f71a53d0f84c27f331be..d8ee748783b032ef90edcd49984c09a48487dc13 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -9,6 +9,9 @@</span> #![cfg_attr(all(not(test), feature = &quot;optimism&quot;), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 pub mod error;
 pub mod eth;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f3cecd04e36f3697a8449b9e" role="button"
                       aria-expanded="false" aria-controls="id-f3cecd04e36f3697a8449b9e">
                        <code>crates/primitives-traits/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/primitives-traits/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/primitives-traits/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f3cecd04e36f3697a8449b9e"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives-traits&#47;Cargo.toml scroll-reth&#47;crates&#47;primitives-traits&#47;Cargo.toml</span>
<span class="term-fg1">index df4491b2d126f719746ed52a8bf1d933491d3dce..27aa92f4edbbfdb3b3be45025f721a5044936b06 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives-traits&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives-traits&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,7 +21,10 @@</span> alloy-eips.workspace = true
 alloy-genesis.workspace = true
 alloy-primitives.workspace = true
 alloy-rlp.workspace = true
<span class="term-fg31">-revm-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# revm-primitives scroll re-export</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;scroll&#47;revm&quot;, features = [&quot;serde&quot;] }</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
&nbsp;
 # misc
 byteorder = { workspace = true, optional = true }
<span class="term-fg36">@@ -65,7 +68,8 @@</span> 	&quot;serde?&#47;std&quot;
 ]
 test-utils = [
 	&quot;arbitrary&quot;,
<span class="term-fg31">-	&quot;reth-codecs?&#47;test-utils&quot;</span>
<span class="term-fg32">+	&quot;reth-codecs?&#47;test-utils&quot;,</span>
<span class="term-fg32">+	&quot;revm-primitives&#47;test-utils&quot;</span>
 ]
 arbitrary = [
 	&quot;std&quot;,
<span class="term-fg36">@@ -76,7 +80,8 @@</span> 	&quot;dep:proptest&quot;,
 	&quot;dep:proptest-arbitrary-interop&quot;,
 	&quot;alloy-eips&#47;arbitrary&quot;,
 	&quot;revm-primitives&#47;arbitrary&quot;,
<span class="term-fg31">-	&quot;reth-codecs?&#47;arbitrary&quot;</span>
<span class="term-fg32">+	&quot;reth-codecs?&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;arbitrary&quot;</span>
 ]
 serde-bincode-compat = [
 	&quot;serde&quot;,
<span class="term-fg36">@@ -101,3 +106,8 @@</span> 	&quot;dep:reth-codecs&quot;,
 	&quot;dep:modular-bitfield&quot;,
 	&quot;dep:byteorder&quot;,
 ]
<span class="term-fg32">+</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+	&quot;revm-primitives&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8dbef4f29ad3f6384fb20540" role="button"
                       aria-expanded="false" aria-controls="id-8dbef4f29ad3f6384fb20540">
                        <code>crates/primitives-traits/src/account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/primitives-traits/src/account.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/primitives-traits/src/account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+96</span></div>
                            <div class="text-start"><span class="text-danger">-9</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8dbef4f29ad3f6384fb20540"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs scroll-reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs</span>
<span class="term-fg1">index c8504f3b63cba932923146ca3960e189d565a1c1..900d77fb976983646dc04e65a2a769d2af7caf08 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs</span>
<span class="term-fg36">@@ -36,6 +36,15 @@</span>     &#47;&#47;&#47; Account balance.
     pub balance: U256,
     &#47;&#47;&#47; Hash of the account&#39;s bytecode.
     pub bytecode_hash: Option&lt;B256&gt;,
<span class="term-fg32">+    &#47;&#47;&#47; The extension for a Scroll account. This `Option` should always be `Some` and is used</span>
<span class="term-fg32">+    &#47;&#47;&#47; in order to maintain backward compatibility in case additional fields are added on the</span>
<span class="term-fg32">+    &#47;&#47;&#47; `Account` due to the way storage compaction is performed.</span>
<span class="term-fg32">+    &#47;&#47;&#47; Adding the `code_size` and the `poseidon_code_hash` fields on the `Account` without the</span>
<span class="term-fg32">+    &#47;&#47;&#47; extension caused the used bits of the bitflag struct to reach 16 bits, meaning no</span>
<span class="term-fg32">+    &#47;&#47;&#47; additional bitflag was available. See [reth codecs](reth_codecs::test_utils) for more</span>
<span class="term-fg32">+    &#47;&#47;&#47; details.</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    pub account_extension: Option&lt;reth_scroll_primitives::AccountExtension&gt;,</span>
 }
&nbsp;
 impl Account {
<span class="term-fg36">@@ -172,6 +181,10 @@</span>         Self {
             nonce: value.nonce.unwrap_or_default(),
             balance: value.balance,
             bytecode_hash: value.code.as_ref().map(keccak256),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                value.code.as_ref().unwrap_or_default(),</span>
<span class="term-fg32">+            )),</span>
         }
     }
 }
<span class="term-fg36">@@ -183,6 +196,8 @@</span>         Self {
             balance: revm_acc.balance,
             nonce: revm_acc.nonce,
             bytecode_hash: (code_hash != KECCAK_EMPTY).then_some(code_hash),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some((revm_acc.code_size, revm_acc.poseidon_code_hash).into()),</span>
         }
     }
 }
<span class="term-fg36">@@ -194,6 +209,39 @@</span>             balance: reth_acc.balance,
             nonce: reth_acc.nonce,
             code_hash: reth_acc.bytecode_hash.unwrap_or(KECCAK_EMPTY),
             code: None,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: reth_acc.account_extension.unwrap_or_default().code_size,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: reth_acc</span>
<span class="term-fg32">+                .account_extension</span>
<span class="term-fg32">+                .unwrap_or_default()</span>
<span class="term-fg32">+                .poseidon_code_hash</span>
<span class="term-fg32">+                .unwrap_or(reth_scroll_primitives::POSEIDON_EMPTY),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+impl From&lt;Account&gt; for revm_primitives::shared::AccountInfo {</span>
<span class="term-fg32">+    fn from(reth_acc: Account) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: reth_acc.balance,</span>
<span class="term-fg32">+            nonce: reth_acc.nonce,</span>
<span class="term-fg32">+            code_hash: reth_acc.bytecode_hash.unwrap_or(KECCAK_EMPTY),</span>
<span class="term-fg32">+            code: None,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; TODO (scroll): remove at last Scroll `Account` related PR.</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+impl From&lt;revm_primitives::shared::AccountInfo&gt; for Account {</span>
<span class="term-fg32">+    fn from(revm_acc: revm_primitives::shared::AccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: revm_acc.balance,</span>
<span class="term-fg32">+            nonce: revm_acc.nonce,</span>
<span class="term-fg32">+            bytecode_hash: (revm_acc.code_hash != KECCAK_EMPTY).then_some(revm_acc.code_hash),</span>
<span class="term-fg32">+            account_extension: None,</span>
         }
     }
 }
<span class="term-fg36">@@ -224,7 +272,13 @@</span>     }
&nbsp;
     #[test]
     fn test_empty_account() {
<span class="term-fg31">-        let mut acc = Account { nonce: 0, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let mut acc = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         &#47;&#47; Nonce 0, balance 0, and bytecode hash set to None is considered empty.
         assert!(acc.is_empty());
&nbsp;
<span class="term-fg36">@@ -276,12 +330,23 @@</span>
     #[test]
     fn test_account_has_bytecode() {
         &#47;&#47; Account with no bytecode (None)
<span class="term-fg31">-        let acc_no_bytecode = Account { nonce: 1, balance: U256::from(1000), bytecode_hash: None };</span>
<span class="term-fg32">+        let acc_no_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert!(!acc_no_bytecode.has_bytecode(), &quot;Account should not have bytecode&quot;);
&nbsp;
         &#47;&#47; Account with bytecode hash set to KECCAK_EMPTY (should have bytecode)
<span class="term-fg31">-        let acc_empty_bytecode =</span>
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(1000), bytecode_hash: Some(KECCAK_EMPTY) };</span>
<span class="term-fg32">+        let acc_empty_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: Some(KECCAK_EMPTY),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert!(acc_empty_bytecode.has_bytecode(), &quot;Account should have bytecode&quot;);
&nbsp;
         &#47;&#47; Account with a non-empty bytecode hash
<span class="term-fg36">@@ -289,6 +354,10 @@</span>         let acc_with_bytecode = Account {
             nonce: 1,
             balance: U256::from(1000),
             bytecode_hash: Some(B256::from_slice(&amp;[0x11u8; 32])),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;[0x11u8; 32],</span>
<span class="term-fg32">+            )),</span>
         };
         assert!(acc_with_bytecode.has_bytecode(), &quot;Account should have bytecode&quot;);
     }
<span class="term-fg36">@@ -296,12 +365,23 @@</span>
     #[test]
     fn test_account_get_bytecode_hash() {
         &#47;&#47; Account with no bytecode (should return KECCAK_EMPTY)
<span class="term-fg31">-        let acc_no_bytecode = Account { nonce: 0, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let acc_no_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert_eq!(acc_no_bytecode.get_bytecode_hash(), KECCAK_EMPTY, &quot;Should return KECCAK_EMPTY&quot;);
&nbsp;
         &#47;&#47; Account with bytecode hash set to KECCAK_EMPTY
<span class="term-fg31">-        let acc_empty_bytecode =</span>
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(1000), bytecode_hash: Some(KECCAK_EMPTY) };</span>
<span class="term-fg32">+        let acc_empty_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: Some(KECCAK_EMPTY),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert_eq!(
             acc_empty_bytecode.get_bytecode_hash(),
             KECCAK_EMPTY,
<span class="term-fg36">@@ -310,8 +390,15 @@</span>         );
&nbsp;
         &#47;&#47; Account with a valid bytecode hash
         let bytecode_hash = B256::from_slice(&amp;[0x11u8; 32]);
<span class="term-fg31">-        let acc_with_bytecode =</span>
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(1000), bytecode_hash: Some(bytecode_hash) };</span>
<span class="term-fg32">+        let acc_with_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: Some(bytecode_hash),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;[0x11u8; 32],</span>
<span class="term-fg32">+            )),</span>
<span class="term-fg32">+        };</span>
         assert_eq!(
             acc_with_bytecode.get_bytecode_hash(),
             bytecode_hash,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-318f516cecb9d4a58deb3ea3" role="button"
                       aria-expanded="false" aria-controls="id-318f516cecb9d4a58deb3ea3">
                        <code>crates/primitives/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/primitives/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/primitives/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-318f516cecb9d4a58deb3ea3"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;Cargo.toml scroll-reth&#47;crates&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">index ebfa26aef0a4fbbeaab3bc5c0c83d29f712de689..7e187c6fb00fdcd72810f293038e968a37ecdbe2 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg36">@@ -16,7 +16,6 @@</span> # reth
 reth-primitives-traits = { workspace = true, features = [&quot;serde&quot;] }
 reth-ethereum-forks.workspace = true
 reth-static-file-types.workspace = true
<span class="term-fg31">-revm-primitives = { workspace = true, features = [&quot;serde&quot;] }</span>
 reth-codecs = { workspace = true, optional = true }
&nbsp;
 # ethereum
<span class="term-fg36">@@ -28,6 +27,9 @@</span> alloy-rpc-types = { workspace = true, optional = true }
 alloy-serde = { workspace = true, optional = true }
 alloy-eips = { workspace = true, features = [&quot;serde&quot;] }
 alloy-trie = { workspace = true, features = [&quot;serde&quot;] }
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;scroll&#47;revm&quot;, features = [&quot;serde&quot;] }</span>
&nbsp;
 # optimism
 op-alloy-rpc-types = { workspace = true, optional = true }
<span class="term-fg36">@@ -67,7 +69,7 @@</span> reth-codecs = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-primitives-traits = { workspace = true, features = [&quot;arbitrary&quot;] }
 reth-testing-utils.workspace = true
 reth-trie-common = { workspace = true, features = [&quot;arbitrary&quot;] }
<span class="term-fg31">-revm-primitives = { workspace = true, features = [&quot;arbitrary&quot;] }</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;scroll&#47;revm&quot;, features = [&quot;arbitrary&quot;] }</span>
&nbsp;
 alloy-eips = { workspace = true, features = [&quot;arbitrary&quot;] }
 alloy-genesis.workspace = true
<span class="term-fg36">@@ -148,7 +150,7 @@</span> alloy-compat = [
 	&quot;dep:alloy-rpc-types&quot;,
 	&quot;dep:alloy-serde&quot;,
 	&quot;dep:op-alloy-rpc-types&quot;,
<span class="term-fg31">-    &quot;dep:alloy-network&quot;,</span>
<span class="term-fg32">+	&quot;dep:alloy-network&quot;,</span>
 ]
 test-utils = [
 	&quot;reth-primitives-traits&#47;test-utils&quot;,
<span class="term-fg36">@@ -156,6 +158,7 @@</span> 	&quot;reth-chainspec&#47;test-utils&quot;,
 	&quot;reth-codecs?&#47;test-utils&quot;,
 	&quot;reth-trie-common&#47;test-utils&quot;,
 	&quot;arbitrary&quot;,
<span class="term-fg32">+	&quot;revm-primitives&#47;test-utils&quot;</span>
 ]
 serde-bincode-compat = [
 	&quot;alloy-consensus&#47;serde-bincode-compat&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fc3f3aecb78c3f115f0d4396" role="button"
                       aria-expanded="false" aria-controls="id-fc3f3aecb78c3f115f0d4396">
                        <code>crates/scroll/execution/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/execution/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+34</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fc3f3aecb78c3f115f0d4396"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;execution&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;execution&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..6abb7d1cd7f63c23bab03fecd1ff96001735f898</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;execution&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,35 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-execution&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-revm.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+reth-scroll-revm.workspace = true</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+auto_impl.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-storage&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+test-utils = [</span>
<span class="term-fg32">+	&quot;reth-scroll-revm&#47;test-utils&quot;,</span>
<span class="term-fg32">+	&quot;reth-revm&#47;test-utils&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1b549f0ca9a3a76542c53957" role="button"
                       aria-expanded="false" aria-controls="id-1b549f0ca9a3a76542c53957">
                        <code>crates/scroll/execution/src/context.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/execution/src/context.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+68</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1b549f0ca9a3a76542c53957"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;context.rs scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;context.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..6ddd47dc531ff49b8ee28d2342b17be315acf247</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;context.rs</span>
<span class="term-fg36">@@ -0,0 +1,68 @@</span>
<span class="term-fg32">+#[cfg(feature = &quot;test-utils&quot;)]</span>
<span class="term-fg32">+use reth_revm::{database::StateProviderDatabase, db::CacheDB};</span>
<span class="term-fg32">+use reth_revm::{Database, State};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Finalize the execution of the type and return the output</span>
<span class="term-fg32">+pub trait FinalizeExecution&lt;Output&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Finalize the state and return the output.</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Output;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB: Database + ContextFul&gt; FinalizeExecution&lt;reth_scroll_revm::states::ScrollBundleState&gt;</span>
<span class="term-fg32">+    for State&lt;DB&gt;</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; reth_scroll_revm::states::ScrollBundleState {</span>
<span class="term-fg32">+        let bundle = self.take_bundle();</span>
<span class="term-fg32">+        (bundle, self.database.context()).into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A type that returns additional execution context.</span>
<span class="term-fg32">+pub trait ContextFul: WithContext&lt;Context = ExecutionContext&gt; {}</span>
<span class="term-fg32">+impl&lt;T&gt; ContextFul for T where T: WithContext&lt;Context = ExecutionContext&gt; {}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Types that can provide a context.</span>
<span class="term-fg32">+#[auto_impl::auto_impl(&amp;, &amp;mut)]</span>
<span class="term-fg32">+pub trait WithContext {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The context returned.</span>
<span class="term-fg32">+    type Context;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the context from the type.</span>
<span class="term-fg32">+    fn context(&amp;self) -&gt; &amp;Self::Context;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+type ExecutionContext = ();</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+type ExecutionContext = reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+impl&lt;DB&gt; WithContext for reth_scroll_storage::ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Context = ExecutionContext;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn context(&amp;self) -&gt; &amp;Self::Context {</span>
<span class="term-fg32">+        &amp;self.post_execution_context</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;test-utils&quot;)]</span>
<span class="term-fg32">+static DEFAULT_CONTEXT: std::sync::LazyLock&lt;ExecutionContext&gt; =</span>
<span class="term-fg32">+    std::sync::LazyLock::new(Default::default);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;test-utils&quot;)]</span>
<span class="term-fg32">+impl&lt;DB&gt; WithContext for StateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Context = ExecutionContext;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn context(&amp;self) -&gt; &amp;Self::Context {</span>
<span class="term-fg32">+        &amp;DEFAULT_CONTEXT</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;test-utils&quot;)]</span>
<span class="term-fg32">+impl&lt;DB&gt; WithContext for CacheDB&lt;DB&gt; {</span>
<span class="term-fg32">+    type Context = ExecutionContext;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn context(&amp;self) -&gt; &amp;Self::Context {</span>
<span class="term-fg32">+        &amp;DEFAULT_CONTEXT</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6cedf65833ad1acbc704d74b" role="button"
                       aria-expanded="false" aria-controls="id-6cedf65833ad1acbc704d74b">
                        <code>crates/scroll/execution/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/execution/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6cedf65833ad1acbc704d74b"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..3a7b2353563f92c319350a464e4c895119a0c6d3</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,6 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll execution related implementations.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![warn(unused_crate_dependencies)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use context::{ContextFul, FinalizeExecution, WithContext};</span>
<span class="term-fg32">+mod context;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8fa1a6cae4009d1acddfeac9" role="button"
                       aria-expanded="false" aria-controls="id-8fa1a6cae4009d1acddfeac9">
                        <code>crates/scroll/primitives/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/primitives/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+47</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8fa1a6cae4009d1acddfeac9"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..a8c17e0ff514ef84d6d876c1d02170c9679adf26</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,47 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-primitives&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# alloy</span>
<span class="term-fg32">+alloy-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-codecs.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+poseidon-bn254 = { workspace = true, features = [&quot;bn254&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+arbitrary = { workspace = true, features = [&quot;derive&quot;], optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# required by reth-codecs</span>
<span class="term-fg32">+bytes.workspace = true</span>
<span class="term-fg32">+modular-bitfield.workspace = true</span>
<span class="term-fg32">+serde.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dev-dependencies]</span>
<span class="term-fg32">+alloy-primitives = { workspace = true, features = [&quot;arbitrary&quot;] }</span>
<span class="term-fg32">+arbitrary = { workspace = true, features = [&quot;derive&quot;] }</span>
<span class="term-fg32">+test-fuzz.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+default = [&quot;std&quot;]</span>
<span class="term-fg32">+std = [</span>
<span class="term-fg32">+	&quot;serde&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;alloy-primitives&#47;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+arbitrary = [</span>
<span class="term-fg32">+	&quot;dep:arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;alloy-primitives&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-codecs&#47;arbitrary&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-015dd649c95c7cb7bc2ce0dd" role="button"
                       aria-expanded="false" aria-controls="id-015dd649c95c7cb7bc2ce0dd">
                        <code>crates/scroll/primitives/src/account_extension.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/primitives/src/account_extension.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+43</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-015dd649c95c7cb7bc2ce0dd"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;account_extension.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;account_extension.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..c48181f9ea215fa0487b075af8eef46edf7d7cd6</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;account_extension.rs</span>
<span class="term-fg36">@@ -0,0 +1,43 @@</span>
<span class="term-fg32">+use crate::{hash_code, POSEIDON_EMPTY};</span>
<span class="term-fg32">+use alloy_primitives::B256;</span>
<span class="term-fg32">+use reth_codecs::Compact;</span>
<span class="term-fg32">+use serde::{Deserialize, Serialize};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The extension for a Scroll account&#39;s representation in storage.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; The extension is used in order to maintain backwards compatibility if more fields need to be</span>
<span class="term-fg32">+&#47;&#47;&#47; added to the account (see [reth codecs](reth_codecs::test_utils) for details).</span>
<span class="term-fg32">+#[derive(Clone, Copy, Debug, Default, PartialEq, Eq, Serialize, Deserialize, Compact)]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;arbitrary&quot;), derive(arbitrary::Arbitrary))]</span>
<span class="term-fg32">+pub struct AccountExtension {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Size in bytes of the account&#39;s bytecode.</span>
<span class="term-fg32">+    pub code_size: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Poseidon hash of the account&#39;s bytecode. `None` means there is no</span>
<span class="term-fg32">+    &#47;&#47;&#47; bytecode for the account.</span>
<span class="term-fg32">+    pub poseidon_code_hash: Option&lt;B256&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl AccountExtension {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates an empty [`AccountExtension`].</span>
<span class="term-fg32">+    pub const fn empty() -&gt; Self {</span>
<span class="term-fg32">+        Self { code_size: 0, poseidon_code_hash: None }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates an [`AccountExtension`] from the provided bytecode.</span>
<span class="term-fg32">+    pub fn from_bytecode&lt;T: AsRef&lt;[u8]&gt;&gt;(code: &amp;T) -&gt; Self {</span>
<span class="term-fg32">+        let code = code.as_ref();</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            code_size: code.len() as u64,</span>
<span class="term-fg32">+            poseidon_code_hash: (!code.is_empty()).then_some(hash_code(code)),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(u64, B256)&gt; for AccountExtension {</span>
<span class="term-fg32">+    fn from(value: (u64, B256)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            code_size: value.0,</span>
<span class="term-fg32">+            poseidon_code_hash: (value.1 != POSEIDON_EMPTY).then_some(value.1),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-253a82ace8b9ad52bbe553ff" role="button"
                       aria-expanded="false" aria-controls="id-253a82ace8b9ad52bbe553ff">
                        <code>crates/scroll/primitives/src/execution_context.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/primitives/src/execution_context.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-253a82ace8b9ad52bbe553ff"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;execution_context.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;execution_context.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..0175e70cb1a2f4c55557cad40996b3a89ee2b8a6</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;execution_context.rs</span>
<span class="term-fg36">@@ -0,0 +1,12 @@</span>
<span class="term-fg32">+use alloy_primitives::{map::HashMap, B256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A Keccak code hash.</span>
<span class="term-fg32">+type KeccakHash = B256;</span>
<span class="term-fg32">+&#47;&#47;&#47; A Poseidon code hash.</span>
<span class="term-fg32">+type PoseidonHash = B256;</span>
<span class="term-fg32">+&#47;&#47;&#47; Size of a contract&#39;s code in bytes.</span>
<span class="term-fg32">+type CodeSize = u64;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Scroll post execution context maps a Keccak code hash of a contract&#39;s bytecode to its code size</span>
<span class="term-fg32">+&#47;&#47;&#47; and Poseidon code hash.</span>
<span class="term-fg32">+pub type ScrollPostExecutionContext = HashMap&lt;KeccakHash, (CodeSize, PoseidonHash)&gt;;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f2224fd113027874f469338c" role="button"
                       aria-expanded="false" aria-controls="id-f2224fd113027874f469338c">
                        <code>crates/scroll/primitives/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/primitives/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f2224fd113027874f469338c"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..2a18616b307d7e63747a2260729dbac38469ef89</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,12 @@</span>
<span class="term-fg32">+&#47;&#47;! Primitive types for the Scroll extension of `Reth`.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![warn(unused_crate_dependencies)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use execution_context::ScrollPostExecutionContext;</span>
<span class="term-fg32">+mod execution_context;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use account_extension::AccountExtension;</span>
<span class="term-fg32">+mod account_extension;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use poseidon::{hash_code, POSEIDON_EMPTY};</span>
<span class="term-fg32">+mod poseidon;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-690627b3a328c9578b1f5426" role="button"
                       aria-expanded="false" aria-controls="id-690627b3a328c9578b1f5426">
                        <code>crates/scroll/primitives/src/poseidon.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/primitives/src/poseidon.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-690627b3a328c9578b1f5426"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;poseidon.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;poseidon.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..4a5010167f51be151250d9169f04889d31334cea</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;poseidon.rs</span>
<span class="term-fg36">@@ -0,0 +1,10 @@</span>
<span class="term-fg32">+use alloy_primitives::{b256, B256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The Poseidon hash of the empty string `&quot;&quot;`.</span>
<span class="term-fg32">+pub const POSEIDON_EMPTY: B256 =</span>
<span class="term-fg32">+    b256!(&quot;2098f5fb9e239eab3ceac3f27b81e481dc3124d55ffed523a839ee8446b64864&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Poseidon code hash</span>
<span class="term-fg32">+pub fn hash_code(code: &amp;[u8]) -&gt; B256 {</span>
<span class="term-fg32">+    poseidon_bn254::hash_code(code).into()</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-49a7d423904fbc31009a3258" role="button"
                       aria-expanded="false" aria-controls="id-49a7d423904fbc31009a3258">
                        <code>crates/scroll/revm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/revm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+42</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-49a7d423904fbc31009a3258"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;revm&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..44956d812b1e75251a380b8a75efdb32225fe385</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,42 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-revm&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# revm</span>
<span class="term-fg32">+revm.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+serde = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+default = [&quot;std&quot;]</span>
<span class="term-fg32">+arbitrary = [</span>
<span class="term-fg32">+	&quot;revm&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives&#47;arbitrary&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+asm-keccak = [&quot;revm&#47;asm-keccak&quot;]</span>
<span class="term-fg32">+c-kzg = [&quot;revm&#47;c-kzg&quot;]</span>
<span class="term-fg32">+optimism = [&quot;revm&#47;optimism&quot;]</span>
<span class="term-fg32">+serde = [</span>
<span class="term-fg32">+	&quot;revm&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;serde&#47;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = []</span>
<span class="term-fg32">+test-utils = [&quot;revm&#47;test-utils&quot;]</span>
<span class="term-fg32">+std = [</span>
<span class="term-fg32">+	&quot;revm&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;serde&#47;std&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6c7a434f4a87d900c0287426" role="button"
                       aria-expanded="false" aria-controls="id-6c7a434f4a87d900c0287426">
                        <code>crates/scroll/revm/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/revm/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+65</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6c7a434f4a87d900c0287426"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..3ace4cd19bdc7e728e574a4b713feb98fa1c18f8</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,65 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll `revm` types redefinitions. Account types are redefined with two additional fields</span>
<span class="term-fg32">+&#47;&#47;! `code_size` and `poseidon_code_hash`, which are used during computation of the state root.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![warn(unused_crate_dependencies)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub mod states;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+pub use revm::primitives::OptimismFields;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use revm::{</span>
<span class="term-fg32">+    db::*,</span>
<span class="term-fg32">+    inspector_handle_register,</span>
<span class="term-fg32">+    primitives::{</span>
<span class="term-fg32">+        keccak256, AuthorizationList, Bytecode, BytecodeDecodeError, JumpTable,</span>
<span class="term-fg32">+        LegacyAnalyzedBytecode, TxEnv, TxKind,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    Evm, EvmBuilder, GetInspector,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+pub use crate::states::ScrollAccountInfo as AccountInfo;</span>
<span class="term-fg32">+#[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+pub use revm::primitives::AccountInfo;</span>
<span class="term-fg32">+pub use states::ScrollAccountInfo;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Shared module, available for all feature flags.</span>
<span class="term-fg32">+pub mod shared {</span>
<span class="term-fg32">+    pub use revm::primitives::AccountInfo;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod interpreter {</span>
<span class="term-fg32">+    pub use revm::interpreter::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod precompile {</span>
<span class="term-fg32">+    pub use revm::precompile::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm-primitives` module structure</span>
<span class="term-fg32">+pub mod primitives {</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    pub use crate::states::ScrollAccountInfo as AccountInfo;</span>
<span class="term-fg32">+    pub use revm::primitives::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod db {</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    pub use crate::states::{</span>
<span class="term-fg32">+        ScrollBundleAccount as BundleAccount, ScrollBundleState as BundleState,</span>
<span class="term-fg32">+    };</span>
<span class="term-fg32">+    pub use revm::db::*;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+    pub mod states {</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        pub use crate::states::{</span>
<span class="term-fg32">+            ScrollBundleBuilder as BundleBuilder, ScrollBundleState as BundleState,</span>
<span class="term-fg32">+            ScrollPlainStateReverts as PlainStateReverts, ScrollStateChangeset as StateChangeset,</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        pub use revm::db::states::*;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9b7d391b17ba6cf60adc01b9" role="button"
                       aria-expanded="false" aria-controls="id-9b7d391b17ba6cf60adc01b9">
                        <code>crates/scroll/revm/src/states/account_info.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/revm/src/states/account_info.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+156</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9b7d391b17ba6cf60adc01b9"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;account_info.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;account_info.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..e9464470be4b19dac27dfefd2cd64367356d23be</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;account_info.rs</span>
<span class="term-fg36">@@ -0,0 +1,156 @@</span>
<span class="term-fg32">+use reth_scroll_primitives::{hash_code, ScrollPostExecutionContext, POSEIDON_EMPTY};</span>
<span class="term-fg32">+use revm::primitives::{AccountInfo, Bytecode, B256, KECCAK_EMPTY, U256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The Scroll account information. Code copy of [`AccountInfo`]. Provides additional `code_size`</span>
<span class="term-fg32">+&#47;&#47;&#47; and `poseidon_code_hash` fields needed in the state root computation.</span>
<span class="term-fg32">+#[derive(Clone, Debug, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollAccountInfo {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account balance.</span>
<span class="term-fg32">+    pub balance: U256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account nonce.</span>
<span class="term-fg32">+    pub nonce: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account code keccak hash.</span>
<span class="term-fg32">+    pub code_hash: B256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; code: if None, `code_by_hash` will be used to fetch it if code needs to be loaded from</span>
<span class="term-fg32">+    &#47;&#47;&#47; inside `revm`.</span>
<span class="term-fg32">+    pub code: Option&lt;Bytecode&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account code size.</span>
<span class="term-fg32">+    pub code_size: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account code Poseidon hash. [`POSEIDON_EMPTY`] if code is None or empty.</span>
<span class="term-fg32">+    pub poseidon_code_hash: B256,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(AccountInfo, &amp;ScrollPostExecutionContext)&gt; for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn from((info, context): (AccountInfo, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        let context = context.get(&amp;info.code_hash).copied();</span>
<span class="term-fg32">+        let (code_size, poseidon_code_hash) = context</span>
<span class="term-fg32">+            .or_else(|| {</span>
<span class="term-fg32">+                info.code</span>
<span class="term-fg32">+                    .as_ref()</span>
<span class="term-fg32">+                    .map(|code| (code.len() as u64, hash_code(code.original_byte_slice())))</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .unwrap_or((0, POSEIDON_EMPTY));</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            code_hash: info.code_hash,</span>
<span class="term-fg32">+            code: info.code,</span>
<span class="term-fg32">+            code_size,</span>
<span class="term-fg32">+            poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion causes a loss of information.</span>
<span class="term-fg32">+impl From&lt;ScrollAccountInfo&gt; for AccountInfo {</span>
<span class="term-fg32">+    fn from(info: ScrollAccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            code_hash: info.code_hash,</span>
<span class="term-fg32">+            code: info.code,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Default for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn default() -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            code_hash: KECCAK_EMPTY,</span>
<span class="term-fg32">+            code: Some(Bytecode::default()),</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            code_size: 0,</span>
<span class="term-fg32">+            poseidon_code_hash: POSEIDON_EMPTY,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl PartialEq for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn eq(&amp;self, other: &amp;Self) -&gt; bool {</span>
<span class="term-fg32">+        self.balance == other.balance &amp;&amp;</span>
<span class="term-fg32">+            self.nonce == other.nonce &amp;&amp;</span>
<span class="term-fg32">+            self.code_hash == other.code_hash</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollAccountInfo {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a new [`ScrollAccountInfo`] with the given fields.</span>
<span class="term-fg32">+    pub fn new(</span>
<span class="term-fg32">+        balance: U256,</span>
<span class="term-fg32">+        nonce: u64,</span>
<span class="term-fg32">+        code_hash: B256,</span>
<span class="term-fg32">+        code: Bytecode,</span>
<span class="term-fg32">+        poseidon_code_hash: B256,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        let code_size = code.len() as u64;</span>
<span class="term-fg32">+        Self { balance, nonce, code: Some(code), code_hash, code_size, poseidon_code_hash }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns account info without the code.</span>
<span class="term-fg32">+    pub fn without_code(mut self) -&gt; Self {</span>
<span class="term-fg32">+        self.take_bytecode();</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns if an account is empty.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; An account is empty if the following conditions are met.</span>
<span class="term-fg32">+    &#47;&#47;&#47; - code hash is zero or set to the Keccak256 hash of the empty string `&quot;&quot;`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - balance is zero</span>
<span class="term-fg32">+    &#47;&#47;&#47; - nonce is zero</span>
<span class="term-fg32">+    pub fn is_empty(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        let code_empty = self.is_empty_code_hash() || self.code_hash.is_zero();</span>
<span class="term-fg32">+        code_empty &amp;&amp; self.balance.is_zero() &amp;&amp; self.nonce == 0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if the account is not empty.</span>
<span class="term-fg32">+    pub fn exists(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        !self.is_empty()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if account has no nonce and code.</span>
<span class="term-fg32">+    pub fn has_no_code_and_nonce(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.is_empty_code_hash() &amp;&amp; self.nonce == 0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return bytecode hash associated with this account.</span>
<span class="term-fg32">+    &#47;&#47;&#47; If account does not have code, it returns `KECCAK_EMPTY` hash.</span>
<span class="term-fg32">+    pub const fn code_hash(&amp;self) -&gt; B256 {</span>
<span class="term-fg32">+        self.code_hash</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns true if the code hash is the Keccak256 hash of the empty string `&quot;&quot;`.</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    pub fn is_empty_code_hash(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.code_hash == KECCAK_EMPTY</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Take bytecode from account. Code will be set to None.</span>
<span class="term-fg32">+    pub fn take_bytecode(&amp;mut self) -&gt; Option&lt;Bytecode&gt; {</span>
<span class="term-fg32">+        self.code.take()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns a [`ScrollAccountInfo`] with only balance.</span>
<span class="term-fg32">+    pub fn from_balance(balance: U256) -&gt; Self {</span>
<span class="term-fg32">+        Self { balance, ..Default::default() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns a [`ScrollAccountInfo`] with defaults for balance and nonce.</span>
<span class="term-fg32">+    &#47;&#47;&#47; Computes the Keccak and Poseidon hash of the provided bytecode.</span>
<span class="term-fg32">+    pub fn from_bytecode(bytecode: Bytecode) -&gt; Self {</span>
<span class="term-fg32">+        let hash = bytecode.hash_slow();</span>
<span class="term-fg32">+        let code_size = bytecode.len() as u64;</span>
<span class="term-fg32">+        let poseidon_code_hash = hash_code(bytecode.bytecode());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            code: Some(bytecode),</span>
<span class="term-fg32">+            code_hash: hash,</span>
<span class="term-fg32">+            code_size,</span>
<span class="term-fg32">+            poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c0f3b5977740bd99ec66b66f" role="button"
                       aria-expanded="false" aria-controls="id-c0f3b5977740bd99ec66b66f">
                        <code>crates/scroll/revm/src/states/bundle.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/revm/src/states/bundle.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+750</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c0f3b5977740bd99ec66b66f"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..f3f6f2f2b6304f1041717a8205461cc1eda6dbea</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle.rs</span>
<span class="term-fg36">@@ -0,0 +1,750 @@</span>
<span class="term-fg32">+use super::bundle_account::ScrollBundleAccount;</span>
<span class="term-fg32">+use crate::states::{</span>
<span class="term-fg32">+    changes::{ScrollPlainStateReverts, ScrollStateChangeset},</span>
<span class="term-fg32">+    reverts::ScrollReverts,</span>
<span class="term-fg32">+    ScrollAccountInfo, ScrollAccountInfoRevert, ScrollAccountRevert,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::{</span>
<span class="term-fg32">+        states::{PlainStorageChangeset, StorageSlot},</span>
<span class="term-fg32">+        AccountStatus, BundleState, OriginalValuesKnown, RevertToSlot,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    primitives::{</span>
<span class="term-fg32">+        map::{Entry, HashMap, HashSet},</span>
<span class="term-fg32">+        Address, Bytecode, B256, KECCAK_EMPTY, U256,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use std::{</span>
<span class="term-fg32">+    collections::{hash_map, BTreeMap, BTreeSet},</span>
<span class="term-fg32">+    ops::RangeInclusive,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; An code copy of the [`BundleState`] modified with Scroll compatible fields.</span>
<span class="term-fg32">+#[derive(Default, Debug, Clone, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollBundleState {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account state.</span>
<span class="term-fg32">+    pub state: HashMap&lt;Address, ScrollBundleAccount&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; All created contracts in this block.</span>
<span class="term-fg32">+    pub contracts: HashMap&lt;B256, Bytecode&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Changes to revert.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note: Inside vector is *not* sorted by address.</span>
<span class="term-fg32">+    &#47;&#47;&#47; But it is unique by address.</span>
<span class="term-fg32">+    pub reverts: ScrollReverts,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The size of the plain state in the bundle state.</span>
<span class="term-fg32">+    pub state_size: usize,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The size of reverts in the bundle state.</span>
<span class="term-fg32">+    pub reverts_size: usize,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(BundleState, &amp;ScrollPostExecutionContext)&gt; for ScrollBundleState {</span>
<span class="term-fg32">+    fn from((bundle, context): (BundleState, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        &#47;&#47; we need to clone the reverts because there is no way to take ownership of</span>
<span class="term-fg32">+        &#47;&#47; the inner Vec from the `Reverts` wrapper.</span>
<span class="term-fg32">+        let reverts = bundle</span>
<span class="term-fg32">+            .reverts</span>
<span class="term-fg32">+            .iter()</span>
<span class="term-fg32">+            .map(|reverts| {</span>
<span class="term-fg32">+                reverts</span>
<span class="term-fg32">+                    .iter()</span>
<span class="term-fg32">+                    .map(|(add, revert)| (*add, (revert.clone(), context).into()))</span>
<span class="term-fg32">+                    .collect()</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let state = bundle</span>
<span class="term-fg32">+            .state</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|(add, account)| (add, (account, context).into()))</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            contracts: bundle.contracts,</span>
<span class="term-fg32">+            reverts: ScrollReverts::new(reverts),</span>
<span class="term-fg32">+            state_size: bundle.state_size,</span>
<span class="term-fg32">+            reverts_size: bundle.reverts_size,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(BundleState, &amp;())&gt; for ScrollBundleState {</span>
<span class="term-fg32">+    fn from((bundle, _): (BundleState, &amp;())) -&gt; Self {</span>
<span class="term-fg32">+        (bundle, &amp;ScrollPostExecutionContext::default()).into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollBundleState {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return builder instance for further manipulation</span>
<span class="term-fg32">+    pub fn builder(revert_range: RangeInclusive&lt;u64&gt;) -&gt; ScrollBundleBuilder {</span>
<span class="term-fg32">+        ScrollBundleBuilder::new(revert_range)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create it with new and old values of both Storage and [`ScrollAccountInfo`].</span>
<span class="term-fg32">+    pub fn new(</span>
<span class="term-fg32">+        state: impl IntoIterator&lt;</span>
<span class="term-fg32">+            Item = (</span>
<span class="term-fg32">+                Address,</span>
<span class="term-fg32">+                Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+                Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+                HashMap&lt;U256, (U256, U256)&gt;,</span>
<span class="term-fg32">+            ),</span>
<span class="term-fg32">+        &gt;,</span>
<span class="term-fg32">+        reverts: impl IntoIterator&lt;</span>
<span class="term-fg32">+            Item = impl IntoIterator&lt;</span>
<span class="term-fg32">+                Item = (</span>
<span class="term-fg32">+                    Address,</span>
<span class="term-fg32">+                    Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;,</span>
<span class="term-fg32">+                    impl IntoIterator&lt;Item = (U256, U256)&gt;,</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+            &gt;,</span>
<span class="term-fg32">+        &gt;,</span>
<span class="term-fg32">+        contracts: impl IntoIterator&lt;Item = (B256, Bytecode)&gt;,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        &#47;&#47; Create state from iterator.</span>
<span class="term-fg32">+        let mut state_size = 0;</span>
<span class="term-fg32">+        let state = state</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|(address, original, present, storage)| {</span>
<span class="term-fg32">+                let account = ScrollBundleAccount::new(</span>
<span class="term-fg32">+                    original,</span>
<span class="term-fg32">+                    present,</span>
<span class="term-fg32">+                    storage</span>
<span class="term-fg32">+                        .into_iter()</span>
<span class="term-fg32">+                        .map(|(k, (o_val, p_val))| (k, StorageSlot::new_changed(o_val, p_val)))</span>
<span class="term-fg32">+                        .collect(),</span>
<span class="term-fg32">+                    AccountStatus::Changed,</span>
<span class="term-fg32">+                );</span>
<span class="term-fg32">+                state_size += account.size_hint();</span>
<span class="term-fg32">+                (address, account)</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; Create reverts from iterator.</span>
<span class="term-fg32">+        let mut reverts_size = 0;</span>
<span class="term-fg32">+        let reverts = reverts</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|block_reverts| {</span>
<span class="term-fg32">+                block_reverts</span>
<span class="term-fg32">+                    .into_iter()</span>
<span class="term-fg32">+                    .map(|(address, account, storage)| {</span>
<span class="term-fg32">+                        let account = match account {</span>
<span class="term-fg32">+                            Some(Some(account)) =&gt; ScrollAccountInfoRevert::RevertTo(account),</span>
<span class="term-fg32">+                            Some(None) =&gt; ScrollAccountInfoRevert::DeleteIt,</span>
<span class="term-fg32">+                            None =&gt; ScrollAccountInfoRevert::DoNothing,</span>
<span class="term-fg32">+                        };</span>
<span class="term-fg32">+                        let revert = ScrollAccountRevert {</span>
<span class="term-fg32">+                            account,</span>
<span class="term-fg32">+                            storage: storage</span>
<span class="term-fg32">+                                .into_iter()</span>
<span class="term-fg32">+                                .map(|(k, v)| (k, RevertToSlot::Some(v)))</span>
<span class="term-fg32">+                                .collect(),</span>
<span class="term-fg32">+                            previous_status: AccountStatus::Changed,</span>
<span class="term-fg32">+                            wipe_storage: false,</span>
<span class="term-fg32">+                        };</span>
<span class="term-fg32">+                        reverts_size += revert.size_hint();</span>
<span class="term-fg32">+                        (address, revert)</span>
<span class="term-fg32">+                    })</span>
<span class="term-fg32">+                    .collect::&lt;Vec&lt;_&gt;&gt;()</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect::&lt;Vec&lt;_&gt;&gt;();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            contracts: contracts.into_iter().collect(),</span>
<span class="term-fg32">+            reverts: ScrollReverts::new(reverts),</span>
<span class="term-fg32">+            state_size,</span>
<span class="term-fg32">+            reverts_size,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the approximate size of changes in the bundle state.</span>
<span class="term-fg32">+    &#47;&#47;&#47; The estimation is not precise, because the information about the number of</span>
<span class="term-fg32">+    &#47;&#47;&#47; destroyed entries that need to be removed is not accessible to the bundle state.</span>
<span class="term-fg32">+    pub fn size_hint(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.state_size + self.reverts_size + self.contracts.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return reference to the state.</span>
<span class="term-fg32">+    pub const fn state(&amp;self) -&gt; &amp;HashMap&lt;Address, ScrollBundleAccount&gt; {</span>
<span class="term-fg32">+        &amp;self.state</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Is bundle state empty.</span>
<span class="term-fg32">+    pub fn is_empty(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.len() == 0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return number of changed accounts.</span>
<span class="term-fg32">+    pub fn len(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.state.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Get account from state</span>
<span class="term-fg32">+    pub fn account(&amp;self, address: &amp;Address) -&gt; Option&lt;&amp;ScrollBundleAccount&gt; {</span>
<span class="term-fg32">+        self.state.get(address)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Get bytecode from state</span>
<span class="term-fg32">+    pub fn bytecode(&amp;self, hash: &amp;B256) -&gt; Option&lt;Bytecode&gt; {</span>
<span class="term-fg32">+        self.contracts.get(hash).cloned()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extend the bundle with other state</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Update the `other` state only if `other` is not flagged as destroyed.</span>
<span class="term-fg32">+    pub fn extend_state(&amp;mut self, other_state: HashMap&lt;Address, ScrollBundleAccount&gt;) {</span>
<span class="term-fg32">+        for (address, other_account) in other_state {</span>
<span class="term-fg32">+            match self.state.entry(address) {</span>
<span class="term-fg32">+                Entry::Occupied(mut entry) =&gt; {</span>
<span class="term-fg32">+                    let this = entry.get_mut();</span>
<span class="term-fg32">+                    self.state_size -= this.size_hint();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; if other was destroyed. replace `this` storage with</span>
<span class="term-fg32">+                    &#47;&#47; the `other one.</span>
<span class="term-fg32">+                    if other_account.was_destroyed() {</span>
<span class="term-fg32">+                        this.storage = other_account.storage;</span>
<span class="term-fg32">+                    } else {</span>
<span class="term-fg32">+                        &#47;&#47; otherwise extend this storage with other</span>
<span class="term-fg32">+                        for (key, storage_slot) in other_account.storage {</span>
<span class="term-fg32">+                            &#47;&#47; update present value or insert storage slot.</span>
<span class="term-fg32">+                            this.storage.entry(key).or_insert(storage_slot).present_value =</span>
<span class="term-fg32">+                                storage_slot.present_value;</span>
<span class="term-fg32">+                        }</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    this.info = other_account.info;</span>
<span class="term-fg32">+                    this.status.transition(other_account.status);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; Update the state size</span>
<span class="term-fg32">+                    self.state_size += this.size_hint();</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                hash_map::Entry::Vacant(entry) =&gt; {</span>
<span class="term-fg32">+                    &#47;&#47; just insert if empty</span>
<span class="term-fg32">+                    self.state_size += other_account.size_hint();</span>
<span class="term-fg32">+                    entry.insert(other_account);</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extend the state with state that is build on top of it.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If storage was wiped in `other` state, copy `this` plain state</span>
<span class="term-fg32">+    &#47;&#47;&#47; and put it inside `other` revert (if there is no duplicates of course).</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If `this` and `other` accounts were both destroyed invalidate second</span>
<span class="term-fg32">+    &#47;&#47;&#47; wipe flag (from `other`). As wiping from database should be done only once</span>
<span class="term-fg32">+    &#47;&#47;&#47; and we already transferred all potentially missing storages to the `other` revert.</span>
<span class="term-fg32">+    pub fn extend(&amp;mut self, mut other: Self) {</span>
<span class="term-fg32">+        &#47;&#47; iterate over reverts and if its storage is wiped try to add previous bundle</span>
<span class="term-fg32">+        &#47;&#47; state as there is potential missing slots.</span>
<span class="term-fg32">+        for (address, revert) in other.reverts.iter_mut().flatten() {</span>
<span class="term-fg32">+            if revert.wipe_storage {</span>
<span class="term-fg32">+                &#47;&#47; If there is wipe storage in `other` revert</span>
<span class="term-fg32">+                &#47;&#47; we need to move storage from present state.</span>
<span class="term-fg32">+                if let Some(this_account) = self.state.get_mut(address) {</span>
<span class="term-fg32">+                    &#47;&#47; As this account was destroyed inside `other` bundle.</span>
<span class="term-fg32">+                    &#47;&#47; we are fine to wipe&#47;drain this storage and put it inside revert.</span>
<span class="term-fg32">+                    for (key, value) in this_account.storage.drain() {</span>
<span class="term-fg32">+                        revert</span>
<span class="term-fg32">+                            .storage</span>
<span class="term-fg32">+                            .entry(key)</span>
<span class="term-fg32">+                            .or_insert(RevertToSlot::Some(value.present_value));</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; nullify `other` wipe as primary database wipe is done in `this`.</span>
<span class="term-fg32">+                    if this_account.was_destroyed() {</span>
<span class="term-fg32">+                        revert.wipe_storage = false;</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; Increment reverts size for each of the updated reverts.</span>
<span class="term-fg32">+            self.reverts_size += revert.size_hint();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        &#47;&#47; Extension of state</span>
<span class="term-fg32">+        self.extend_state(other.state);</span>
<span class="term-fg32">+        &#47;&#47; Contract can be just extended, when counter is introduced we will take into account that.</span>
<span class="term-fg32">+        self.contracts.extend(other.contracts);</span>
<span class="term-fg32">+        &#47;&#47; Reverts can be just extended</span>
<span class="term-fg32">+        self.reverts.extend(other.reverts);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Consume the bundle state and return plain state.</span>
<span class="term-fg32">+    pub fn into_plain_state(self, is_value_known: OriginalValuesKnown) -&gt; ScrollStateChangeset {</span>
<span class="term-fg32">+        &#47;&#47; pessimistically pre-allocate assuming _all_ accounts changed.</span>
<span class="term-fg32">+        let state_len = self.state.len();</span>
<span class="term-fg32">+        let mut accounts = Vec::with_capacity(state_len);</span>
<span class="term-fg32">+        let mut storage = Vec::with_capacity(state_len);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        for (address, account) in self.state {</span>
<span class="term-fg32">+            &#47;&#47; append account info if it is changed.</span>
<span class="term-fg32">+            let was_destroyed = account.was_destroyed();</span>
<span class="term-fg32">+            if is_value_known.is_not_known() || account.is_info_changed() {</span>
<span class="term-fg32">+                let info = account.info.map(ScrollAccountInfo::without_code);</span>
<span class="term-fg32">+                accounts.push((address, info));</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; append storage changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; NOTE: Assumption is that revert is going to remove whole plain storage from</span>
<span class="term-fg32">+            &#47;&#47; database so we can check if plain state was wiped or not.</span>
<span class="term-fg32">+            let mut account_storage_changed = Vec::with_capacity(account.storage.len());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            for (key, slot) in account.storage {</span>
<span class="term-fg32">+                &#47;&#47; If storage was destroyed that means that storage was wiped.</span>
<span class="term-fg32">+                &#47;&#47; In that case we need to check if present storage value is different then ZERO.</span>
<span class="term-fg32">+                let destroyed_and_not_zero = was_destroyed &amp;&amp; !slot.present_value.is_zero();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                &#47;&#47; If account is not destroyed check if original values was changed,</span>
<span class="term-fg32">+                &#47;&#47; so we can update it.</span>
<span class="term-fg32">+                let not_destroyed_and_changed = !was_destroyed &amp;&amp; slot.is_changed();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                if is_value_known.is_not_known() ||</span>
<span class="term-fg32">+                    destroyed_and_not_zero ||</span>
<span class="term-fg32">+                    not_destroyed_and_changed</span>
<span class="term-fg32">+                {</span>
<span class="term-fg32">+                    account_storage_changed.push((key, slot.present_value));</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            if !account_storage_changed.is_empty() || was_destroyed {</span>
<span class="term-fg32">+                &#47;&#47; append storage changes to account.</span>
<span class="term-fg32">+                storage.push(PlainStorageChangeset {</span>
<span class="term-fg32">+                    address,</span>
<span class="term-fg32">+                    wipe_storage: was_destroyed,</span>
<span class="term-fg32">+                    storage: account_storage_changed,</span>
<span class="term-fg32">+                });</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        let contracts = self</span>
<span class="term-fg32">+            .contracts</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            &#47;&#47; remove empty bytecodes</span>
<span class="term-fg32">+            .filter(|(b, _)| *b != KECCAK_EMPTY)</span>
<span class="term-fg32">+            .collect::&lt;Vec&lt;_&gt;&gt;();</span>
<span class="term-fg32">+        ScrollStateChangeset { accounts, storage, contracts }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Consume the bundle state and split it into reverts and plain state.</span>
<span class="term-fg32">+    pub fn into_plain_state_and_reverts(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        is_value_known: OriginalValuesKnown,</span>
<span class="term-fg32">+    ) -&gt; (ScrollStateChangeset, ScrollPlainStateReverts) {</span>
<span class="term-fg32">+        let reverts = self.take_all_reverts();</span>
<span class="term-fg32">+        let plain_state = self.into_plain_state(is_value_known);</span>
<span class="term-fg32">+        (plain_state, reverts.into_plain_state_reverts())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Take first N raw reverts from the [`ScrollBundleState`].</span>
<span class="term-fg32">+    pub fn take_n_reverts(&amp;mut self, reverts_to_take: usize) -&gt; ScrollReverts {</span>
<span class="term-fg32">+        &#47;&#47; split is done as [0, num) and [num, len].</span>
<span class="term-fg32">+        if reverts_to_take &gt; self.reverts.len() {</span>
<span class="term-fg32">+            return self.take_all_reverts();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        let (detach, this) = self.reverts.split_at(reverts_to_take);</span>
<span class="term-fg32">+        let detached_reverts = ScrollReverts::new(detach.to_vec());</span>
<span class="term-fg32">+        self.reverts_size =</span>
<span class="term-fg32">+            this.iter().flatten().fold(0, |acc, (_, revert)| acc + revert.size_hint());</span>
<span class="term-fg32">+        self.reverts = ScrollReverts::new(this.to_vec());</span>
<span class="term-fg32">+        detached_reverts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return and clear all reverts from [`ScrollBundleState`]</span>
<span class="term-fg32">+    pub fn take_all_reverts(&amp;mut self) -&gt; ScrollReverts {</span>
<span class="term-fg32">+        self.reverts_size = 0;</span>
<span class="term-fg32">+        core::mem::take(&amp;mut self.reverts)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Reverts the state changes by N transitions back.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; See also [`Self::revert_latest`]</span>
<span class="term-fg32">+    pub fn revert(&amp;mut self, mut num_transitions: usize) {</span>
<span class="term-fg32">+        if num_transitions == 0 {</span>
<span class="term-fg32">+            return;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        while self.revert_latest() {</span>
<span class="term-fg32">+            num_transitions -= 1;</span>
<span class="term-fg32">+            if num_transitions == 0 {</span>
<span class="term-fg32">+                &#47;&#47; break the loop.</span>
<span class="term-fg32">+                break;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Reverts the state changes of the latest transition</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note: This is the same as `BundleState::revert(1)`</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns true if the state was reverted.</span>
<span class="term-fg32">+    pub fn revert_latest(&amp;mut self) -&gt; bool {</span>
<span class="term-fg32">+        &#47;&#47; revert the latest recorded state</span>
<span class="term-fg32">+        if let Some(reverts) = self.reverts.pop() {</span>
<span class="term-fg32">+            for (address, revert_account) in reverts {</span>
<span class="term-fg32">+                self.reverts_size -= revert_account.size_hint();</span>
<span class="term-fg32">+                match self.state.entry(address) {</span>
<span class="term-fg32">+                    Entry::Occupied(mut entry) =&gt; {</span>
<span class="term-fg32">+                        let account = entry.get_mut();</span>
<span class="term-fg32">+                        self.state_size -= account.size_hint();</span>
<span class="term-fg32">+                        if account.revert(revert_account) {</span>
<span class="term-fg32">+                            entry.remove();</span>
<span class="term-fg32">+                        } else {</span>
<span class="term-fg32">+                            self.state_size += account.size_hint();</span>
<span class="term-fg32">+                        }</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    Entry::Vacant(entry) =&gt; {</span>
<span class="term-fg32">+                        &#47;&#47; create empty account that we will revert on.</span>
<span class="term-fg32">+                        &#47;&#47; Only place where this account is not existing is if revert is DeleteIt.</span>
<span class="term-fg32">+                        let mut account = ScrollBundleAccount::new(</span>
<span class="term-fg32">+                            None,</span>
<span class="term-fg32">+                            None,</span>
<span class="term-fg32">+                            HashMap::default(),</span>
<span class="term-fg32">+                            AccountStatus::LoadedNotExisting,</span>
<span class="term-fg32">+                        );</span>
<span class="term-fg32">+                        if !account.revert(revert_account) {</span>
<span class="term-fg32">+                            self.state_size += account.size_hint();</span>
<span class="term-fg32">+                            entry.insert(account);</span>
<span class="term-fg32">+                        }</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            return true;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        false</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; This builder is used to help to facilitate the initialization of [`ScrollBundleState`] struct.</span>
<span class="term-fg32">+&#47;&#47;&#47; This is a code copy of the [`revm::db::states::BundleBuilder`] to accommodate the</span>
<span class="term-fg32">+&#47;&#47;&#47; [`ScrollBundleState`].</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollBundleBuilder {</span>
<span class="term-fg32">+    states: HashSet&lt;Address&gt;,</span>
<span class="term-fg32">+    state_original: HashMap&lt;Address, ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    state_present: HashMap&lt;Address, ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    state_storage: HashMap&lt;Address, HashMap&lt;U256, (U256, U256)&gt;&gt;,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    reverts: BTreeSet&lt;(u64, Address)&gt;,</span>
<span class="term-fg32">+    revert_range: RangeInclusive&lt;u64&gt;,</span>
<span class="term-fg32">+    revert_account: HashMap&lt;(u64, Address), Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;&gt;,</span>
<span class="term-fg32">+    revert_storage: HashMap&lt;(u64, Address), Vec&lt;(U256, U256)&gt;&gt;,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    contracts: HashMap&lt;B256, Bytecode&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Default for ScrollBundleBuilder {</span>
<span class="term-fg32">+    fn default() -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            states: HashSet::default(),</span>
<span class="term-fg32">+            state_original: HashMap::default(),</span>
<span class="term-fg32">+            state_present: HashMap::default(),</span>
<span class="term-fg32">+            state_storage: HashMap::default(),</span>
<span class="term-fg32">+            reverts: BTreeSet::new(),</span>
<span class="term-fg32">+            revert_range: 0..=0,</span>
<span class="term-fg32">+            revert_account: HashMap::default(),</span>
<span class="term-fg32">+            revert_storage: HashMap::default(),</span>
<span class="term-fg32">+            contracts: HashMap::default(),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollBundleBuilder {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create builder instance</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `revert_range` indicates the size of [`ScrollBundleState`] `reverts` field</span>
<span class="term-fg32">+    pub fn new(revert_range: RangeInclusive&lt;u64&gt;) -&gt; Self {</span>
<span class="term-fg32">+        Self { revert_range, ..Default::default() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Apply a transformation to the builder.</span>
<span class="term-fg32">+    pub fn apply&lt;F&gt;(self, f: F) -&gt; Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        F: FnOnce(Self) -&gt; Self,</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        f(self)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Apply a mutable transformation to the builder.</span>
<span class="term-fg32">+    pub fn apply_mut&lt;F&gt;(&amp;mut self, f: F) -&gt; &amp;mut Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        F: FnOnce(&amp;mut Self),</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        f(self);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect address info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_address(mut self, address: Address) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_address(address);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect account info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_original_account_info(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        original: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_original_account_info(address, original);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect account info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_present_account_info(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        present: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_present_account_info(address, present);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect storage info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_storage(mut self, address: Address, storage: HashMap&lt;U256, (U256, U256)&gt;) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_storage(address, storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect address info of [`ScrollBundleState`] reverts</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `block_number` must respect `revert_range`, or the input</span>
<span class="term-fg32">+    &#47;&#47;&#47; will be ignored during the final build process</span>
<span class="term-fg32">+    pub fn revert_address(mut self, block_number: u64, address: Address) -&gt; Self {</span>
<span class="term-fg32">+        self.set_revert_address(block_number, address);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect account info of [`ScrollBundleState`] reverts</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `block_number` must respect `revert_range`, or the input</span>
<span class="term-fg32">+    &#47;&#47;&#47; will be ignored during the final build process</span>
<span class="term-fg32">+    pub fn revert_account_info(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        account: Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_revert_account_info(block_number, address, account);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect storage info of [`ScrollBundleState`] reverts</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `block_number` must respect `revert_range`, or the input</span>
<span class="term-fg32">+    &#47;&#47;&#47; will be ignored during the final build process</span>
<span class="term-fg32">+    pub fn revert_storage(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        storage: Vec&lt;(U256, U256)&gt;,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_revert_storage(block_number, address, storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect contracts info</span>
<span class="term-fg32">+    pub fn contract(mut self, address: B256, bytecode: Bytecode) -&gt; Self {</span>
<span class="term-fg32">+        self.set_contract(address, bytecode);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set address info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_address(&amp;mut self, address: Address) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set original account info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_original_account_info(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        original: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self.state_original.insert(address, original);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set present account info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_present_account_info(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        present: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self.state_present.insert(address, present);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set storage info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_storage(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        storage: HashMap&lt;U256, (U256, U256)&gt;,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self.state_storage.insert(address, storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set address info of [`ScrollBundleState`] reverts.</span>
<span class="term-fg32">+    pub fn set_revert_address(&amp;mut self, block_number: u64, address: Address) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.reverts.insert((block_number, address));</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set account info of [`ScrollBundleState`] reverts.</span>
<span class="term-fg32">+    pub fn set_revert_account_info(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        account: Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.reverts.insert((block_number, address));</span>
<span class="term-fg32">+        self.revert_account.insert((block_number, address), account);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set storage info of [`ScrollBundleState`] reverts.</span>
<span class="term-fg32">+    pub fn set_revert_storage(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        storage: Vec&lt;(U256, U256)&gt;,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.reverts.insert((block_number, address));</span>
<span class="term-fg32">+        self.revert_storage.insert((block_number, address), storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set contracts info.</span>
<span class="term-fg32">+    pub fn set_contract(&amp;mut self, address: B256, bytecode: Bytecode) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.contracts.insert(address, bytecode);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create [`ScrollBundleState`] instance based on collected information</span>
<span class="term-fg32">+    pub fn build(mut self) -&gt; ScrollBundleState {</span>
<span class="term-fg32">+        let mut state_size = 0;</span>
<span class="term-fg32">+        let state = self</span>
<span class="term-fg32">+            .states</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|address| {</span>
<span class="term-fg32">+                let storage = self</span>
<span class="term-fg32">+                    .state_storage</span>
<span class="term-fg32">+                    .remove(&amp;address)</span>
<span class="term-fg32">+                    .map(|s| {</span>
<span class="term-fg32">+                        s.into_iter()</span>
<span class="term-fg32">+                            .map(|(k, (o_val, p_val))| (k, StorageSlot::new_changed(o_val, p_val)))</span>
<span class="term-fg32">+                            .collect()</span>
<span class="term-fg32">+                    })</span>
<span class="term-fg32">+                    .unwrap_or_default();</span>
<span class="term-fg32">+                let bundle_account = ScrollBundleAccount::new(</span>
<span class="term-fg32">+                    self.state_original.remove(&amp;address),</span>
<span class="term-fg32">+                    self.state_present.remove(&amp;address),</span>
<span class="term-fg32">+                    storage,</span>
<span class="term-fg32">+                    AccountStatus::Changed,</span>
<span class="term-fg32">+                );</span>
<span class="term-fg32">+                state_size += bundle_account.size_hint();</span>
<span class="term-fg32">+                (address, bundle_account)</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut reverts_size = 0;</span>
<span class="term-fg32">+        let mut reverts_map = BTreeMap::new();</span>
<span class="term-fg32">+        for block_number in self.revert_range {</span>
<span class="term-fg32">+            reverts_map.insert(block_number, Vec::new());</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        self.reverts.into_iter().for_each(|(block_number, address)| {</span>
<span class="term-fg32">+            let account =</span>
<span class="term-fg32">+                match self.revert_account.remove(&amp;(block_number, address)).unwrap_or_default() {</span>
<span class="term-fg32">+                    Some(Some(account)) =&gt; ScrollAccountInfoRevert::RevertTo(account),</span>
<span class="term-fg32">+                    Some(None) =&gt; ScrollAccountInfoRevert::DeleteIt,</span>
<span class="term-fg32">+                    None =&gt; ScrollAccountInfoRevert::DoNothing,</span>
<span class="term-fg32">+                };</span>
<span class="term-fg32">+            let storage = self</span>
<span class="term-fg32">+                .revert_storage</span>
<span class="term-fg32">+                .remove(&amp;(block_number, address))</span>
<span class="term-fg32">+                .map(|s| s.into_iter().map(|(k, v)| (k, RevertToSlot::Some(v))).collect())</span>
<span class="term-fg32">+                .unwrap_or_default();</span>
<span class="term-fg32">+            let account_revert = ScrollAccountRevert {</span>
<span class="term-fg32">+                account,</span>
<span class="term-fg32">+                storage,</span>
<span class="term-fg32">+                previous_status: AccountStatus::Changed,</span>
<span class="term-fg32">+                wipe_storage: false,</span>
<span class="term-fg32">+            };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            if reverts_map.contains_key(&amp;block_number) {</span>
<span class="term-fg32">+                reverts_size += account_revert.size_hint();</span>
<span class="term-fg32">+                reverts_map</span>
<span class="term-fg32">+                    .entry(block_number)</span>
<span class="term-fg32">+                    .or_insert(Vec::new())</span>
<span class="term-fg32">+                    .push((address, account_revert));</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        });</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        ScrollBundleState {</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            contracts: self.contracts,</span>
<span class="term-fg32">+            reverts: ScrollReverts::new(reverts_map.into_values().collect()),</span>
<span class="term-fg32">+            state_size,</span>
<span class="term-fg32">+            reverts_size,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Getter for `states` field</span>
<span class="term-fg32">+    pub const fn get_states(&amp;self) -&gt; &amp;HashSet&lt;Address&gt; {</span>
<span class="term-fg32">+        &amp;self.states</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `states` field</span>
<span class="term-fg32">+    pub fn get_states_mut(&amp;mut self) -&gt; &amp;mut HashSet&lt;Address&gt; {</span>
<span class="term-fg32">+        &amp;mut self.states</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `state_original` field</span>
<span class="term-fg32">+    pub fn get_state_original_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;Address, ScrollAccountInfo&gt; {</span>
<span class="term-fg32">+        &amp;mut self.state_original</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `state_present` field</span>
<span class="term-fg32">+    pub fn get_state_present_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;Address, ScrollAccountInfo&gt; {</span>
<span class="term-fg32">+        &amp;mut self.state_present</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `state_storage` field</span>
<span class="term-fg32">+    pub fn get_state_storage_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;Address, HashMap&lt;U256, (U256, U256)&gt;&gt; {</span>
<span class="term-fg32">+        &amp;mut self.state_storage</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `reverts` field</span>
<span class="term-fg32">+    pub fn get_reverts_mut(&amp;mut self) -&gt; &amp;mut BTreeSet&lt;(u64, Address)&gt; {</span>
<span class="term-fg32">+        &amp;mut self.reverts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `revert_range` field</span>
<span class="term-fg32">+    pub fn get_revert_range_mut(&amp;mut self) -&gt; &amp;mut RangeInclusive&lt;u64&gt; {</span>
<span class="term-fg32">+        &amp;mut self.revert_range</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `revert_account` field</span>
<span class="term-fg32">+    pub fn get_revert_account_mut(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut HashMap&lt;(u64, Address), Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;&gt; {</span>
<span class="term-fg32">+        &amp;mut self.revert_account</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `revert_storage` field</span>
<span class="term-fg32">+    pub fn get_revert_storage_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;(u64, Address), Vec&lt;(U256, U256)&gt;&gt; {</span>
<span class="term-fg32">+        &amp;mut self.revert_storage</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `contracts` field</span>
<span class="term-fg32">+    pub fn get_contracts_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;B256, Bytecode&gt; {</span>
<span class="term-fg32">+        &amp;mut self.contracts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-95076a1f99d77016857faf4e" role="button"
                       aria-expanded="false" aria-controls="id-95076a1f99d77016857faf4e">
                        <code>crates/scroll/revm/src/states/bundle_account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/revm/src/states/bundle_account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+130</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-95076a1f99d77016857faf4e"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle_account.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle_account.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..29be890314d719b72b67dcb41e3375334d2777ce</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle_account.rs</span>
<span class="term-fg36">@@ -0,0 +1,130 @@</span>
<span class="term-fg32">+use crate::states::{ScrollAccountInfo, ScrollAccountInfoRevert, ScrollAccountRevert};</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::{</span>
<span class="term-fg32">+        states::StorageSlot, AccountStatus, BundleAccount, RevertToSlot, StorageWithOriginalValues,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    interpreter::primitives::U256,</span>
<span class="term-fg32">+    primitives::map::HashMap,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The scroll account bundle. Originally defined in [`BundleAccount`], a</span>
<span class="term-fg32">+&#47;&#47;&#47; scroll version of the bundle is needed for the [`crate::states::ScrollBundleState`].</span>
<span class="term-fg32">+#[derive(Debug, Clone, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollBundleAccount {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The current account&#39;s information</span>
<span class="term-fg32">+    pub info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The original account&#39;s information</span>
<span class="term-fg32">+    pub original_info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Contains both original and present state.</span>
<span class="term-fg32">+    &#47;&#47;&#47; When extracting changeset we compare if original value is different from present value.</span>
<span class="term-fg32">+    &#47;&#47;&#47; If it is different we add it to changeset.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If Account was destroyed we ignore original value and compare present state with</span>
<span class="term-fg32">+    &#47;&#47;&#47; [`U256::ZERO`].</span>
<span class="term-fg32">+    pub storage: StorageWithOriginalValues,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account status.</span>
<span class="term-fg32">+    pub status: AccountStatus,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(BundleAccount, &amp;ScrollPostExecutionContext)&gt; for ScrollBundleAccount {</span>
<span class="term-fg32">+    fn from((account, context): (BundleAccount, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        let info = account.info.map(|info| (info, context).into());</span>
<span class="term-fg32">+        let original_info = account.original_info.map(|info| (info, context).into());</span>
<span class="term-fg32">+        Self { info, original_info, storage: account.storage, status: account.status }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollBundleAccount {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a [`ScrollBundleAccount`].</span>
<span class="term-fg32">+    pub const fn new(</span>
<span class="term-fg32">+        original_info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+        present_info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+        storage: StorageWithOriginalValues,</span>
<span class="term-fg32">+        status: AccountStatus,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        Self { info: present_info, original_info, storage, status }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; The approximate size of changes needed to store this account.</span>
<span class="term-fg32">+    &#47;&#47;&#47; `1 + storage_len`</span>
<span class="term-fg32">+    pub fn size_hint(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        1 + self.storage.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return storage slot if it exists.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; In case we know that account is newly created or destroyed, return `Some(U256::ZERO)`</span>
<span class="term-fg32">+    pub fn storage_slot(&amp;self, slot: U256) -&gt; Option&lt;U256&gt; {</span>
<span class="term-fg32">+        let slot = self.storage.get(&amp;slot).map(|s| s.present_value);</span>
<span class="term-fg32">+        if slot.is_some() {</span>
<span class="term-fg32">+            slot</span>
<span class="term-fg32">+        } else if self.status.is_storage_known() {</span>
<span class="term-fg32">+            Some(U256::ZERO)</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            None</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Fetch account info if it exists.</span>
<span class="term-fg32">+    pub fn account_info(&amp;self) -&gt; Option&lt;ScrollAccountInfo&gt; {</span>
<span class="term-fg32">+        self.info.clone()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Was this account destroyed.</span>
<span class="term-fg32">+    pub fn was_destroyed(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.status.was_destroyed()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return true of account info was changed.</span>
<span class="term-fg32">+    pub fn is_info_changed(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.info != self.original_info</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return true if contract was changed</span>
<span class="term-fg32">+    pub fn is_contract_changed(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.info.as_ref().map(|a| a.code_hash) != self.original_info.as_ref().map(|a| a.code_hash)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Revert account to previous state and return true if account can be removed.</span>
<span class="term-fg32">+    pub fn revert(&amp;mut self, revert: ScrollAccountRevert) -&gt; bool {</span>
<span class="term-fg32">+        self.status = revert.previous_status;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        match revert.account {</span>
<span class="term-fg32">+            ScrollAccountInfoRevert::DoNothing =&gt; (),</span>
<span class="term-fg32">+            ScrollAccountInfoRevert::DeleteIt =&gt; {</span>
<span class="term-fg32">+                self.info = None;</span>
<span class="term-fg32">+                if self.original_info.is_none() {</span>
<span class="term-fg32">+                    self.storage = HashMap::default();</span>
<span class="term-fg32">+                    return true;</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                &#47;&#47; set all storage to zero but preserve original values.</span>
<span class="term-fg32">+                self.storage.iter_mut().for_each(|(_, v)| {</span>
<span class="term-fg32">+                    v.present_value = U256::ZERO;</span>
<span class="term-fg32">+                });</span>
<span class="term-fg32">+                return false;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            ScrollAccountInfoRevert::RevertTo(info) =&gt; self.info = Some(info),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        &#47;&#47; revert storage</span>
<span class="term-fg32">+        for (key, slot) in revert.storage {</span>
<span class="term-fg32">+            match slot {</span>
<span class="term-fg32">+                RevertToSlot::Some(value) =&gt; {</span>
<span class="term-fg32">+                    &#47;&#47; Don&#39;t overwrite original values if present</span>
<span class="term-fg32">+                    &#47;&#47; if storage is not present set original value as current value.</span>
<span class="term-fg32">+                    self.storage</span>
<span class="term-fg32">+                        .entry(key)</span>
<span class="term-fg32">+                        .or_insert_with(|| StorageSlot::new(value))</span>
<span class="term-fg32">+                        .present_value = value;</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                RevertToSlot::Destroyed =&gt; {</span>
<span class="term-fg32">+                    &#47;&#47; if it was destroyed this means that storage was created and we need to remove</span>
<span class="term-fg32">+                    &#47;&#47; it.</span>
<span class="term-fg32">+                    self.storage.remove(&amp;key);</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        false</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1856c0dcde129836d7c1f3a5" role="button"
                       aria-expanded="false" aria-controls="id-1856c0dcde129836d7c1f3a5">
                        <code>crates/scroll/revm/src/states/changes.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/revm/src/states/changes.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+67</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1856c0dcde129836d7c1f3a5"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;changes.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;changes.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5343d47c9e03b1be347c872d2cc38ea67a1c5972</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;changes.rs</span>
<span class="term-fg36">@@ -0,0 +1,67 @@</span>
<span class="term-fg32">+use crate::states::ScrollAccountInfo;</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::states::{PlainStateReverts, PlainStorageChangeset, PlainStorageRevert, StateChangeset},</span>
<span class="term-fg32">+    primitives::{Address, Bytecode, B256},</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy equivalent of the [`StateChangeset`] to accommodate for the [`ScrollAccountInfo`].</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollStateChangeset {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of **not** sorted accounts information.</span>
<span class="term-fg32">+    pub accounts: Vec&lt;(Address, Option&lt;ScrollAccountInfo&gt;)&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of **not** sorted storage.</span>
<span class="term-fg32">+    pub storage: Vec&lt;PlainStorageChangeset&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of contracts by bytecode hash. **not** sorted.</span>
<span class="term-fg32">+    pub contracts: Vec&lt;(B256, Bytecode)&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(StateChangeset, &amp;ScrollPostExecutionContext)&gt; for ScrollStateChangeset {</span>
<span class="term-fg32">+    fn from((changeset, context): (StateChangeset, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: changeset</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|(add, acc)| (add, acc.map(|a| (a, context).into())))</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: changeset.storage,</span>
<span class="term-fg32">+            contracts: changeset.contracts,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of the [`PlainStateReverts`] to accommodate for [`ScrollAccountInfo`].</span>
<span class="term-fg32">+#[derive(Clone, Debug, Default)]</span>
<span class="term-fg32">+pub struct ScrollPlainStateReverts {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of account with removed contracts bytecode</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note: If [`ScrollAccountInfo`] is None means that account needs to be removed.</span>
<span class="term-fg32">+    pub accounts: Vec&lt;Vec&lt;(Address, Option&lt;ScrollAccountInfo&gt;)&gt;&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of storage with its address.</span>
<span class="term-fg32">+    pub storage: Vec&lt;Vec&lt;PlainStorageRevert&gt;&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(PlainStateReverts, &amp;ScrollPostExecutionContext)&gt; for ScrollPlainStateReverts {</span>
<span class="term-fg32">+    fn from((reverts, context): (PlainStateReverts, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: reverts</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|accounts| {</span>
<span class="term-fg32">+                    accounts</span>
<span class="term-fg32">+                        .into_iter()</span>
<span class="term-fg32">+                        .map(|(add, acc)| (add, acc.map(|a| (a, context).into())))</span>
<span class="term-fg32">+                        .collect()</span>
<span class="term-fg32">+                })</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: reverts.storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollPlainStateReverts {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Constructs new [`ScrollPlainStateReverts`] with pre-allocated capacity.</span>
<span class="term-fg32">+    pub fn with_capacity(capacity: usize) -&gt; Self {</span>
<span class="term-fg32">+        Self { accounts: Vec::with_capacity(capacity), storage: Vec::with_capacity(capacity) }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-deaf3dab22bae269cfe5daa7" role="button"
                       aria-expanded="false" aria-controls="id-deaf3dab22bae269cfe5daa7">
                        <code>crates/scroll/revm/src/states/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/revm/src/states/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-deaf3dab22bae269cfe5daa7"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;mod.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;mod.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..c6f9e969f8052c7920530aa1a2babd1aead61a63</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;mod.rs</span>
<span class="term-fg36">@@ -0,0 +1,16 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll `revm` states types redefinitions.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use account_info::ScrollAccountInfo;</span>
<span class="term-fg32">+mod account_info;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use bundle::{ScrollBundleBuilder, ScrollBundleState};</span>
<span class="term-fg32">+mod bundle;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use bundle_account::ScrollBundleAccount;</span>
<span class="term-fg32">+mod bundle_account;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use changes::{ScrollPlainStateReverts, ScrollStateChangeset};</span>
<span class="term-fg32">+mod changes;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use reverts::{ScrollAccountInfoRevert, ScrollAccountRevert, ScrollReverts};</span>
<span class="term-fg32">+mod reverts;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2c632857d64ce7b999e94458" role="button"
                       aria-expanded="false" aria-controls="id-2c632857d64ce7b999e94458">
                        <code>crates/scroll/revm/src/states/reverts.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/revm/src/states/reverts.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+145</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2c632857d64ce7b999e94458"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;reverts.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;reverts.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..750796eb9f3b314a96917893363169deeed45173</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;reverts.rs</span>
<span class="term-fg36">@@ -0,0 +1,145 @@</span>
<span class="term-fg32">+use crate::states::{changes::ScrollPlainStateReverts, ScrollAccountInfo};</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::{</span>
<span class="term-fg32">+        states::{reverts::AccountInfoRevert, PlainStorageRevert},</span>
<span class="term-fg32">+        AccountRevert, AccountStatus, RevertToSlot,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    primitives::{map::HashMap, Address, U256},</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use std::ops::{Deref, DerefMut};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of a [`revm::db::states::reverts::Reverts`] compatible with the</span>
<span class="term-fg32">+&#47;&#47;&#47; [`crate::states::ScrollBundleState`].</span>
<span class="term-fg32">+#[derive(Clone, Debug, Default, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollReverts(Vec&lt;Vec&lt;(Address, ScrollAccountRevert)&gt;&gt;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Deref for ScrollReverts {</span>
<span class="term-fg32">+    type Target = Vec&lt;Vec&lt;(Address, ScrollAccountRevert)&gt;&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn deref(&amp;self) -&gt; &amp;Self::Target {</span>
<span class="term-fg32">+        &amp;self.0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl DerefMut for ScrollReverts {</span>
<span class="term-fg32">+    fn deref_mut(&amp;mut self) -&gt; &amp;mut Self::Target {</span>
<span class="term-fg32">+        &amp;mut self.0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollReverts {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create new reverts</span>
<span class="term-fg32">+    pub const fn new(reverts: Vec&lt;Vec&lt;(Address, ScrollAccountRevert)&gt;&gt;) -&gt; Self {</span>
<span class="term-fg32">+        Self(reverts)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extend reverts with other reverts.</span>
<span class="term-fg32">+    pub fn extend(&amp;mut self, other: Self) {</span>
<span class="term-fg32">+        self.0.extend(other.0);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Sort account inside transition by their address.</span>
<span class="term-fg32">+    pub fn sort(&amp;mut self) {</span>
<span class="term-fg32">+        for revert in &amp;mut self.0 {</span>
<span class="term-fg32">+            revert.sort_by_key(|(address, _)| *address);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Consume reverts and create plain state reverts.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note that account are sorted by address.</span>
<span class="term-fg32">+    pub fn into_plain_state_reverts(mut self) -&gt; ScrollPlainStateReverts {</span>
<span class="term-fg32">+        let mut state_reverts = ScrollPlainStateReverts::with_capacity(self.0.len());</span>
<span class="term-fg32">+        for reverts in self.0.drain(..) {</span>
<span class="term-fg32">+            &#47;&#47; pessimistically pre-allocate assuming _all_ accounts changed.</span>
<span class="term-fg32">+            let mut accounts = Vec::with_capacity(reverts.len());</span>
<span class="term-fg32">+            let mut storage = Vec::with_capacity(reverts.len());</span>
<span class="term-fg32">+            for (address, revert_account) in reverts {</span>
<span class="term-fg32">+                match revert_account.account {</span>
<span class="term-fg32">+                    ScrollAccountInfoRevert::RevertTo(acc) =&gt; accounts.push((address, Some(acc))),</span>
<span class="term-fg32">+                    ScrollAccountInfoRevert::DeleteIt =&gt; accounts.push((address, None)),</span>
<span class="term-fg32">+                    ScrollAccountInfoRevert::DoNothing =&gt; (),</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                if revert_account.wipe_storage || !revert_account.storage.is_empty() {</span>
<span class="term-fg32">+                    storage.push(PlainStorageRevert {</span>
<span class="term-fg32">+                        address,</span>
<span class="term-fg32">+                        wiped: revert_account.wipe_storage,</span>
<span class="term-fg32">+                        storage_revert: revert_account.storage.into_iter().collect::&lt;Vec&lt;_&gt;&gt;(),</span>
<span class="term-fg32">+                    });</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            state_reverts.accounts.push(accounts);</span>
<span class="term-fg32">+            state_reverts.storage.push(storage);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        state_reverts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of a [`AccountRevert`] compatible with  [`ScrollReverts`].</span>
<span class="term-fg32">+#[derive(Clone, Default, Debug, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollAccountRevert {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account info revert</span>
<span class="term-fg32">+    pub account: ScrollAccountInfoRevert,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Storage revert</span>
<span class="term-fg32">+    pub storage: HashMap&lt;U256, RevertToSlot&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Previous status</span>
<span class="term-fg32">+    pub previous_status: AccountStatus,</span>
<span class="term-fg32">+    &#47;&#47;&#47; If true wipes storage</span>
<span class="term-fg32">+    pub wipe_storage: bool,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(AccountRevert, &amp;ScrollPostExecutionContext)&gt; for ScrollAccountRevert {</span>
<span class="term-fg32">+    fn from((account, context): (AccountRevert, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            account: (account.account, context).into(),</span>
<span class="term-fg32">+            storage: account.storage,</span>
<span class="term-fg32">+            previous_status: account.previous_status,</span>
<span class="term-fg32">+            wipe_storage: account.wipe_storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollAccountRevert {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The approximate size of changes needed to store this account revert.</span>
<span class="term-fg32">+    &#47;&#47;&#47; `1 + storage_reverts_len`</span>
<span class="term-fg32">+    pub fn size_hint(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        1 + self.storage.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if there is nothing to revert,</span>
<span class="term-fg32">+    &#47;&#47;&#47; by checking that:</span>
<span class="term-fg32">+    &#47;&#47;&#47; * both account info and storage have been left untouched</span>
<span class="term-fg32">+    &#47;&#47;&#47; * we don&#39;t need to wipe storage</span>
<span class="term-fg32">+    pub fn is_empty(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.account == ScrollAccountInfoRevert::DoNothing &amp;&amp;</span>
<span class="term-fg32">+            self.storage.is_empty() &amp;&amp;</span>
<span class="term-fg32">+            !self.wipe_storage</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of a [`AccountInfoRevert`] compatible with the</span>
<span class="term-fg32">+&#47;&#47;&#47; [`ScrollAccountInfo`].</span>
<span class="term-fg32">+#[derive(Clone, Default, Debug, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub enum ScrollAccountInfoRevert {</span>
<span class="term-fg32">+    #[default]</span>
<span class="term-fg32">+    &#47;&#47;&#47; Nothing changed</span>
<span class="term-fg32">+    DoNothing,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account was created and on revert we need to remove it with all storage.</span>
<span class="term-fg32">+    DeleteIt,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account was changed and on revert we need to put old state.</span>
<span class="term-fg32">+    RevertTo(ScrollAccountInfo),</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(AccountInfoRevert, &amp;ScrollPostExecutionContext)&gt; for ScrollAccountInfoRevert {</span>
<span class="term-fg32">+    fn from((account, context): (AccountInfoRevert, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        match account {</span>
<span class="term-fg32">+            AccountInfoRevert::DoNothing =&gt; Self::DoNothing,</span>
<span class="term-fg32">+            AccountInfoRevert::DeleteIt =&gt; Self::DeleteIt,</span>
<span class="term-fg32">+            AccountInfoRevert::RevertTo(account) =&gt; Self::RevertTo((account, context).into()),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-67671e43c0f9b65a794b0dd8" role="button"
                       aria-expanded="false" aria-controls="id-67671e43c0f9b65a794b0dd8">
                        <code>crates/scroll/storage/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/storage/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+36</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-67671e43c0f9b65a794b0dd8"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;storage&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;storage&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..9c5cc3744d5578ac6211f386bc896d0d1ddc6405</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;storage&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,36 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-storage&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# alloy</span>
<span class="term-fg32">+alloy-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-revm.workspace = true</span>
<span class="term-fg32">+reth-storage-errors.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+reth-scroll-revm.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dev-dependencies]</span>
<span class="term-fg32">+eyre.workspace = true</span>
<span class="term-fg32">+reth-codecs = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+reth-primitives-traits.workspace = true</span>
<span class="term-fg32">+reth-revm = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b88b0b8fae90d6a9a914fac0" role="button"
                       aria-expanded="false" aria-controls="id-b88b0b8fae90d6a9a914fac0">
                        <code>crates/scroll/storage/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/scroll/storage/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+185</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b88b0b8fae90d6a9a914fac0"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;storage&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;storage&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..1810369a8096676f8920c7b6ac00660477ace047</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;storage&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,185 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll storage implementation.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![cfg_attr(all(not(test), feature = &quot;scroll&quot;), warn(unused_crate_dependencies))]</span>
<span class="term-fg32">+&#47;&#47; The `scroll` feature must be enabled to use this crate.</span>
<span class="term-fg32">+#![cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloy_primitives::{Address, B256, U256};</span>
<span class="term-fg32">+use reth_revm::{database::EvmStateProvider, primitives::Bytecode, Database, DatabaseRef};</span>
<span class="term-fg32">+use reth_scroll_primitives::{AccountExtension, ScrollPostExecutionContext};</span>
<span class="term-fg32">+use reth_scroll_revm::shared::AccountInfo;</span>
<span class="term-fg32">+use reth_storage_errors::provider::ProviderError;</span>
<span class="term-fg32">+use std::ops::{Deref, DerefMut};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A similar construct as `StateProviderDatabase` which captures additional Scroll context for</span>
<span class="term-fg32">+&#47;&#47;&#47; touched accounts during execution.</span>
<span class="term-fg32">+#[derive(Clone, Debug)]</span>
<span class="term-fg32">+pub struct ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Scroll post execution context.</span>
<span class="term-fg32">+    pub post_execution_context: ScrollPostExecutionContext,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The database.</span>
<span class="term-fg32">+    pub db: DB,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB&gt; Deref for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Target = DB;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn deref(&amp;self) -&gt; &amp;Self::Target {</span>
<span class="term-fg32">+        &amp;self.db</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB&gt; DerefMut for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    fn deref_mut(&amp;mut self) -&gt; &amp;mut Self::Target {</span>
<span class="term-fg32">+        &amp;mut self.db</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB&gt; ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a [`ScrollStateProviderDatabase`] from the provided DB.</span>
<span class="term-fg32">+    pub fn new(db: DB) -&gt; Self {</span>
<span class="term-fg32">+        Self { db, post_execution_context: Default::default() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Consume [`ScrollStateProviderDatabase`] and return inner [`EvmStateProvider`].</span>
<span class="term-fg32">+    pub fn into_inner(self) -&gt; DB {</span>
<span class="term-fg32">+        self.db</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; Database for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Error = ProviderError;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Retrieves basic account information for a given address. Caches the Scroll account extension</span>
<span class="term-fg32">+    &#47;&#47;&#47; for the touched account if it has bytecode.</span>
<span class="term-fg32">+    fn basic(&amp;mut self, address: Address) -&gt; Result&lt;Option&lt;AccountInfo&gt;, Self::Error&gt; {</span>
<span class="term-fg32">+        let Some(account) = self.db.basic_account(address)? else { return Ok(None) };</span>
<span class="term-fg32">+        let Some(code_hash) = account.bytecode_hash else { return Ok(Some(account.into())) };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        if let Some(AccountExtension { code_size, poseidon_code_hash: Some(hash) }) =</span>
<span class="term-fg32">+            account.account_extension</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+            self.post_execution_context.entry(code_hash).or_insert((code_size, hash));</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(Some(account.into()))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn code_by_hash(&amp;mut self, code_hash: B256) -&gt; Result&lt;Bytecode, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.bytecode_by_hash(code_hash)?.unwrap_or_default().0)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn storage(&amp;mut self, address: Address, index: U256) -&gt; Result&lt;U256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.storage(address, B256::new(index.to_be_bytes()))?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn block_hash(&amp;mut self, number: u64) -&gt; Result&lt;B256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.block_hash(number)?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; DatabaseRef for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Error = ProviderError;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn basic_ref(&amp;self, address: Address) -&gt; Result&lt;Option&lt;AccountInfo&gt;, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.basic_account(address)?.map(Into::into))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn code_by_hash_ref(&amp;self, code_hash: B256) -&gt; Result&lt;Bytecode, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.bytecode_by_hash(code_hash)?.unwrap_or_default().0)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn storage_ref(&amp;self, address: Address, index: U256) -&gt; Result&lt;U256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.storage(address, B256::new(index.to_be_bytes()))?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn block_hash_ref(&amp;self, number: u64) -&gt; Result&lt;B256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.block_hash(number)?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use crate::ScrollStateProviderDatabase;</span>
<span class="term-fg32">+    use alloy_primitives::{keccak256, Address, Bytes, U256};</span>
<span class="term-fg32">+    use reth_codecs::{test_utils::UnusedBits, validate_bitflag_backwards_compat};</span>
<span class="term-fg32">+    use reth_primitives_traits::Account;</span>
<span class="term-fg32">+    use reth_revm::{test_utils::StateProviderTest, Database};</span>
<span class="term-fg32">+    use reth_scroll_primitives::{hash_code, AccountExtension};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_ensure_account_backwards_compatibility() {</span>
<span class="term-fg32">+        &#47;&#47; See `reth-codecs&#47;src&#47;test-utils` for details.</span>
<span class="term-fg32">+        assert_eq!(Account::bitflag_encoded_bytes(), 2);</span>
<span class="term-fg32">+        assert_eq!(AccountExtension::bitflag_encoded_bytes(), 1);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; In case of failure, refer to the documentation of the</span>
<span class="term-fg32">+        &#47;&#47; [`validate_bitflag_backwards_compat`] macro for detailed instructions on handling</span>
<span class="term-fg32">+        &#47;&#47; it.</span>
<span class="term-fg32">+        validate_bitflag_backwards_compat!(Account, UnusedBits::NotZero);</span>
<span class="term-fg32">+        validate_bitflag_backwards_compat!(AccountExtension, UnusedBits::NotZero);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_scroll_post_execution_context() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        let mut db = StateProviderTest::default();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; insert an eoa in the db</span>
<span class="term-fg32">+        let eoa_address = Address::random();</span>
<span class="term-fg32">+        let eoa = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::MAX,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            account_extension: Some(AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        db.insert_account(eoa_address, eoa, None, Default::default());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; insert a contract account in the db</span>
<span class="term-fg32">+        let contract_address = Address::random();</span>
<span class="term-fg32">+        let bytecode = Bytes::copy_from_slice(&amp;[0x0, 0x1, 0x2, 0x3, 0x4, 0x5]);</span>
<span class="term-fg32">+        let bytecode_hash = keccak256(&amp;bytecode);</span>
<span class="term-fg32">+        let contract = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::MAX,</span>
<span class="term-fg32">+            bytecode_hash: Some(bytecode_hash),</span>
<span class="term-fg32">+            account_extension: Some(AccountExtension::from_bytecode(&amp;bytecode)),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        db.insert_account(contract_address, contract, Some(bytecode.clone()), Default::default());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; insert an empty contract account in the db</span>
<span class="term-fg32">+        let empty_contract_address = Address::random();</span>
<span class="term-fg32">+        let empty_bytecode = Bytes::copy_from_slice(&amp;[]);</span>
<span class="term-fg32">+        let empty_contract = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::MAX,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            account_extension: Some(AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        db.insert_account(</span>
<span class="term-fg32">+            empty_contract_address,</span>
<span class="term-fg32">+            empty_contract,</span>
<span class="term-fg32">+            Some(empty_bytecode),</span>
<span class="term-fg32">+            Default::default(),</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut provider = ScrollStateProviderDatabase::new(db);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check eoa is in db</span>
<span class="term-fg32">+        let _ = provider.basic(eoa_address)?.unwrap();</span>
<span class="term-fg32">+        &#47;&#47; check contract is in db</span>
<span class="term-fg32">+        let _ = provider.basic(contract_address)?.unwrap();</span>
<span class="term-fg32">+        &#47;&#47; check empty contract is in db</span>
<span class="term-fg32">+        let _ = provider.basic(empty_contract_address)?.unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check provider context only contains contract</span>
<span class="term-fg32">+        let post_execution_context = provider.post_execution_context;</span>
<span class="term-fg32">+        assert_eq!(post_execution_context.len(), 1);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check post execution context is correct for contract</span>
<span class="term-fg32">+        let (code_size, poseidon_code_hash) = post_execution_context.get(&amp;bytecode_hash).unwrap();</span>
<span class="term-fg32">+        assert_eq!(*code_size, 6);</span>
<span class="term-fg32">+        assert_eq!(*poseidon_code_hash, hash_code(&amp;bytecode));</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c344d1c9641207fe5d53f6f5" role="button"
                       aria-expanded="false" aria-controls="id-c344d1c9641207fe5d53f6f5">
                        <code>crates/stages/stages/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/stages/stages/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/stages/stages/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c344d1c9641207fe5d53f6f5"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml scroll-reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml</span>
<span class="term-fg1">index f97214f4643329336c9b061504d22960f9d6d869..432af6f8a7287b2315ff17611671abada7a858e4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml</span>
<span class="term-fg36">@@ -39,6 +39,9 @@</span> reth-trie-db = { workspace = true, features = [&quot;metrics&quot;] }
&nbsp;
 reth-testing-utils = { workspace = true, optional = true }
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 alloy-eips.workspace = true
 alloy-primitives.workspace = true
 alloy-consensus.workspace = true
<span class="term-fg36">@@ -74,6 +77,8 @@</span> reth-testing-utils.workspace = true
 reth-trie = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-provider = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-network-peers.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
&nbsp;
 alloy-rlp.workspace = true
 itertools.workspace = true
<span class="term-fg36">@@ -115,6 +120,7 @@</span>     &quot;reth-trie-db&#47;test-utils&quot;,
     &quot;reth-trie&#47;test-utils&quot;,
     &quot;reth-prune-types&#47;test-utils&quot;,
 ]
<span class="term-fg32">+scroll = [&quot;reth-scroll-primitives&quot;]</span>
&nbsp;
 [[bench]]
 name = &quot;criterion&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ffb05e5e815c3b8e517ba2d9" role="button"
                       aria-expanded="false" aria-controls="id-ffb05e5e815c3b8e517ba2d9">
                        <code>crates/stages/stages/src/stages/execution.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/stages/stages/src/stages/execution.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/stages/stages/src/stages/execution.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+63</span></div>
                            <div class="text-start"><span class="text-danger">-11</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ffb05e5e815c3b8e517ba2d9"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs</span>
<span class="term-fg1">index 16234ad483f799f31352f443a32a52865fc48f0e..a62d947e722be2901dfa9b0c1de8f714c004696b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs</span>
<span class="term-fg36">@@ -880,13 +880,26 @@</span>         let code_hash = keccak256(code);
         db_tx
             .put::&lt;tables::PlainAccountState&gt;(
                 acc1,
<span class="term-fg31">-                Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::ZERO,</span>
<span class="term-fg32">+                    bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+                    &#47;&#47; TODO (scroll): use `from_bytecode`</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
             )
             .unwrap();
         db_tx
             .put::&lt;tables::PlainAccountState&gt;(
                 acc2,
<span class="term-fg31">-                Account { nonce: 0, balance, bytecode_hash: None },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance,</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
             )
             .unwrap();
         db_tx.put::&lt;tables::Bytecodes&gt;(code_hash, Bytecode::new_raw(code.to_vec().into())).unwrap();
<span class="term-fg36">@@ -936,19 +949,29 @@</span>             let provider = factory.provider().unwrap();
&nbsp;
             &#47;&#47; check post state
             let account1 = address!(&quot;1000000000000000000000000000000000000000&quot;);
<span class="term-fg31">-            let account1_info =</span>
<span class="term-fg31">-                Account { balance: U256::ZERO, nonce: 0x00, bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+            let account1_info = Account {</span>
<span class="term-fg32">+                balance: U256::ZERO,</span>
<span class="term-fg32">+                nonce: 0x00,</span>
<span class="term-fg32">+                bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+                &#47;&#47; TODO (scroll): use `from_bytecode`.</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            };</span>
             let account2 = address!(&quot;2adc25665018aa1fe0e6bc666dac8fc2697ff9ba&quot;);
             let account2_info = Account {
                 balance: U256::from(0x1bc16d674ece94bau128),
                 nonce: 0x00,
                 bytecode_hash: None,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
             };
             let account3 = address!(&quot;a94f5374fce5edbc8e2a8697c15331677e6ebf0b&quot;);
             let account3_info = Account {
                 balance: U256::from(0x3635c9adc5de996b46u128),
                 nonce: 0x01,
                 bytecode_hash: None,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
             };
&nbsp;
             &#47;&#47; assert accounts
<span class="term-fg36">@@ -1024,9 +1047,22 @@</span>         let provider = factory.provider_rw().unwrap();
&nbsp;
         let db_tx = provider.tx_ref();
         let acc1 = address!(&quot;1000000000000000000000000000000000000000&quot;);
<span class="term-fg31">-        let acc1_info = Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+        let acc1_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+            &#47;&#47; TODO (scroll): use `from_bytecode`.</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
         let acc2 = address!(&quot;a94f5374fce5edbc8e2a8697c15331677e6ebf0b&quot;);
<span class="term-fg31">-        let acc2_info = Account { nonce: 0, balance, bytecode_hash: None };</span>
<span class="term-fg32">+        let acc2_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
&nbsp;
         db_tx.put::&lt;tables::PlainAccountState&gt;(acc1, acc1_info).unwrap();
         db_tx.put::&lt;tables::PlainAccountState&gt;(acc2, acc2_info).unwrap();
<span class="term-fg36">@@ -1143,9 +1179,21 @@</span>         let balance = U256::from(0x0de0b6b3a7640000u64);
         let code_hash = keccak256(code);
&nbsp;
         &#47;&#47; pre state
<span class="term-fg31">-        let caller_info = Account { nonce: 0, balance, bytecode_hash: None };</span>
<span class="term-fg31">-        let destroyed_info =</span>
<span class="term-fg31">-            Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+        let caller_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let destroyed_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+            &#47;&#47; TODO (scroll): use `from_bytecode`.</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
&nbsp;
         &#47;&#47; set account
         let provider = test_db.factory.provider_rw().unwrap();
<span class="term-fg36">@@ -1204,7 +1252,9 @@</span>                     beneficiary_address,
                     Account {
                         nonce: 0,
                         balance: U256::from(0x1bc16d674eca30a0u64),
<span class="term-fg31">-                        bytecode_hash: None</span>
<span class="term-fg32">+                        bytecode_hash: None,</span>
<span class="term-fg32">+                        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                     }
                 ),
                 (
<span class="term-fg36">@@ -1212,7 +1262,9 @@</span>                     caller_address,
                     Account {
                         nonce: 1,
                         balance: U256::from(0xde0b6b3a761cf60u64),
<span class="term-fg31">-                        bytecode_hash: None</span>
<span class="term-fg32">+                        bytecode_hash: None,</span>
<span class="term-fg32">+                        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                     }
                 )
             ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-333063d9335bd3b1a37d4177" role="button"
                       aria-expanded="false" aria-controls="id-333063d9335bd3b1a37d4177">
                        <code>crates/stages/stages/src/stages/hashing_account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/stages/stages/src/stages/hashing_account.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/stages/stages/src/stages/hashing_account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-333063d9335bd3b1a37d4177"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs</span>
<span class="term-fg1">index e6b1e548455fa8d42a6ab23d99c893d9ebe6800e..895943b83a9296a5fa1a65b94d183e5fd4839656 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs</span>
<span class="term-fg36">@@ -109,6 +109,8 @@</span>                 let prev_acc = Account {
                     nonce: nonce - 1,
                     balance: balance - U256::from(1),
                     bytecode_hash: None,
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                 };
                 let acc_before_tx = AccountBeforeTx { address: *addr, info: Some(prev_acc) };
                 acc_changeset_cursor.append(t, acc_before_tx)?;
<span class="term-fg36">@@ -403,6 +405,10 @@</span>                         let old_acc = Account {
                             nonce: nonce - 1,
                             balance: balance - U256::from(1),
                             bytecode_hash: None,
<span class="term-fg32">+                            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                            account_extension: Some(</span>
<span class="term-fg32">+                                reth_scroll_primitives::AccountExtension::empty(),</span>
<span class="term-fg32">+                            ),</span>
                         };
                         let hashed_addr = keccak256(address);
                         if let Some((_, acc)) = hashed_acc_cursor.seek_exact(hashed_addr)? {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-561954b5e2e413ee886dbb7c" role="button"
                       aria-expanded="false" aria-controls="id-561954b5e2e413ee886dbb7c">
                        <code>crates/stages/stages/src/stages/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/stages/stages/src/stages/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/stages/stages/src/stages/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-561954b5e2e413ee886dbb7c"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs</span>
<span class="term-fg1">index 9d7cc685a7ef7875fef1d39fa5557cebe8f06271..7f351efc60e14c313d8e5dff30c298cdd7504e0a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs</span>
<span class="term-fg36">@@ -117,7 +117,14 @@</span>         provider_rw
             .tx_ref()
             .put::&lt;tables::PlainAccountState&gt;(
                 address!(&quot;1000000000000000000000000000000000000000&quot;),
<span class="term-fg31">-                Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::ZERO,</span>
<span class="term-fg32">+                    bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+                    &#47;&#47; TODO (scroll): use `from_bytecode`.</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
             )
             .unwrap();
         provider_rw
<span class="term-fg36">@@ -128,6 +135,8 @@</span>                 Account {
                     nonce: 0,
                     balance: U256::from(0x3635c9adc5dea00000u128),
                     bytecode_hash: None,
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                 },
             )
             .unwrap();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d2fcdd1a3d7379a2c32ed01f" role="button"
                       aria-expanded="false" aria-controls="id-d2fcdd1a3d7379a2c32ed01f">
                        <code>crates/storage/db-common/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/db-common/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/storage/db-common/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d2fcdd1a3d7379a2c32ed01f"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml</span>
<span class="term-fg1">index 9e4954357f84e7a05ab071bed9931a25a38e6780..662d1fdb0295b25b2bd830549f52c2517692a8fb 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml</span>
<span class="term-fg36">@@ -27,6 +27,9 @@</span> # eth
 alloy-genesis.workspace = true
 alloy-primitives.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # misc
 eyre.workspace = true
 thiserror.workspace = true
<span class="term-fg36">@@ -46,3 +49,6 @@</span> alloy-consensus.workspace = true
&nbsp;
 [lints]
 workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [&quot;reth-scroll-primitives&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b217bd0d0f880167583173cd" role="button"
                       aria-expanded="false" aria-controls="id-b217bd0d0f880167583173cd">
                        <code>crates/storage/db-common/src/init.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/db-common/src/init.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/storage/db-common/src/init.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b217bd0d0f880167583173cd"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs scroll-reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs</span>
<span class="term-fg1">index e14796d268617389d0cf3b6e578b1bf4cdd8ef5b..48fb946a111c0eab4da2c06e71b8d38da9e6959d 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs</span>
<span class="term-fg36">@@ -214,6 +214,12 @@</span>                 Some(Account {
                     nonce: account.nonce.unwrap_or_default(),
                     balance: account.balance,
                     bytecode_hash,
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                            account.code.as_ref().unwrap_or_default(),</span>
<span class="term-fg32">+                        ),</span>
<span class="term-fg32">+                    ),</span>
                 }),
                 storage,
             ),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e51348362c457527ea2f244a" role="button"
                       aria-expanded="false" aria-controls="id-e51348362c457527ea2f244a">
                        <code>crates/storage/db/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/db/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/storage/db/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e51348362c457527ea2f244a"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">index 5ff9fb43a3d91cac486d18264bc1ff6bea128db8..21891bce1f6931ffa6a11d649d89f4c42923e3a4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml</span>
<span class="term-fg36">@@ -114,6 +114,7 @@</span>     &quot;alloy-consensus&#47;arbitrary&quot;,
 ]
 optimism = [&quot;reth-primitives&#47;optimism&quot;, &quot;reth-db-api&#47;optimism&quot;]
 disable-lock = []
<span class="term-fg32">+scroll = []</span>
&nbsp;
 [[bench]]
 name = &quot;hash_keys&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9d61210e6d71a6fc32f85196" role="button"
                       aria-expanded="false" aria-controls="id-9d61210e6d71a6fc32f85196">
                        <code>crates/storage/db/src/implementation/mdbx/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/db/src/implementation/mdbx/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/storage/db/src/implementation/mdbx/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9d61210e6d71a6fc32f85196"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs scroll-reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs</span>
<span class="term-fg1">index 006213e4cb916f4667172f5fffe3f2a5579c1ba5..e564a25e859809be06abc5c58f4be15d169668a1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs</span>
<span class="term-fg36">@@ -1178,6 +1178,8 @@</span>         let value = Account {
             nonce: 18446744073709551615,
             bytecode_hash: Some(B256::random()),
             balance: U256::MAX,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some((10u64, B256::random()).into()),</span>
         };
         let key = Address::from_str(&quot;0xa2c122be93b0074270ebee7f6b7292c7deb45047&quot;)
             .expect(ERROR_ETH_ADDRESS);</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-337b902bc8976cba80522db4" role="button"
                       aria-expanded="false" aria-controls="id-337b902bc8976cba80522db4">
                        <code>crates/storage/provider/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/provider/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/storage/provider/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-337b902bc8976cba80522db4"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml</span>
<span class="term-fg1">index 86f2f3a51b9142cb6c1888a0fd6ce6515a510827..6f65d990dfd2ead68984945fc4dbd5206b157041 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml</span>
<span class="term-fg36">@@ -42,6 +42,9 @@</span> alloy-rpc-types-engine.workspace = true
 alloy-consensus.workspace = true
 revm.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # optimism
 reth-optimism-primitives = { workspace = true, optional = true }
&nbsp;
<span class="term-fg36">@@ -78,6 +81,8 @@</span> reth-chain-state = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-trie = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-testing-utils.workspace = true
 reth-ethereum-engine-primitives.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
&nbsp;
 parking_lot.workspace = true
 tempfile.workspace = true
<span class="term-fg36">@@ -133,3 +138,4 @@</span>     &quot;reth-prune-types&#47;test-utils&quot;,
     &quot;reth-stages-types&#47;test-utils&quot;,
     &quot;reth-optimism-primitives?&#47;arbitrary&quot;,
 ]
<span class="term-fg32">+scroll = [&quot;reth-scroll-primitives&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8530f1858af7401b75b85b56" role="button"
                       aria-expanded="false" aria-controls="id-8530f1858af7401b75b85b56">
                        <code>crates/storage/provider/src/providers/state/historical.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/provider/src/providers/state/historical.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/storage/provider/src/providers/state/historical.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+42</span></div>
                            <div class="text-start"><span class="text-danger">-6</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8530f1858af7401b75b85b56"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs</span>
<span class="term-fg1">index 29ba70e2049e4358389513af28caf0a8bd7ec6cb..39a71b924431f828a1898813df0bbbea7b1966f7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs</span>
<span class="term-fg36">@@ -542,13 +542,49 @@</span>             BlockNumberList::new([4]).unwrap(),
         )
         .unwrap();
&nbsp;
<span class="term-fg31">-        let acc_plain = Account { nonce: 100, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at15 = Account { nonce: 15, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at10 = Account { nonce: 10, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at7 = Account { nonce: 7, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at3 = Account { nonce: 3, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let acc_plain = Account {</span>
<span class="term-fg32">+            nonce: 100,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at15 = Account {</span>
<span class="term-fg32">+            nonce: 15,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at10 = Account {</span>
<span class="term-fg32">+            nonce: 10,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at7 = Account {</span>
<span class="term-fg32">+            nonce: 7,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at3 = Account {</span>
<span class="term-fg32">+            nonce: 3,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
&nbsp;
<span class="term-fg31">-        let higher_acc_plain = Account { nonce: 4, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let higher_acc_plain = Account {</span>
<span class="term-fg32">+            nonce: 4,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
&nbsp;
         &#47;&#47; setup
         tx.put::&lt;tables::AccountChangeSets&gt;(1, AccountBeforeTx { address: ADDRESS, info: None })</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-66eee61e94e05d20fc197c27" role="button"
                       aria-expanded="false" aria-controls="id-66eee61e94e05d20fc197c27">
                        <code>crates/storage/provider/src/test_utils/mock.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/provider/src/test_utils/mock.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/storage/provider/src/test_utils/mock.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-66eee61e94e05d20fc197c27"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs</span>
<span class="term-fg1">index a0ecb7256cb86791090cdccda6b46687ad0f86a3..8924ee55b5b273711c71e18330ba614af2c9acac 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs</span>
<span class="term-fg36">@@ -82,7 +82,13 @@</span> impl ExtendedAccount {
     &#47;&#47;&#47; Create new instance of extended account
     pub fn new(nonce: u64, balance: U256) -&gt; Self {
         Self {
<span class="term-fg31">-            account: Account { nonce, balance, bytecode_hash: None },</span>
<span class="term-fg32">+            account: Account {</span>
<span class="term-fg32">+                nonce,</span>
<span class="term-fg32">+                balance,</span>
<span class="term-fg32">+                bytecode_hash: None,</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            },</span>
             bytecode: None,
             storage: Default::default(),
         }
<span class="term-fg36">@@ -90,6 +96,11 @@</span>     }
&nbsp;
     &#47;&#47;&#47; Set bytecode and bytecode hash on the extended account
     pub fn with_bytecode(mut self, bytecode: Bytes) -&gt; Self {
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+            self.account.account_extension =</span>
<span class="term-fg32">+                Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;bytecode));</span>
<span class="term-fg32">+        }</span>
         let hash = keccak256(&amp;bytecode);
         self.account.bytecode_hash = Some(hash);
         self.bytecode = Some(Bytecode::new_raw(bytecode));</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bb8c24090f93347d05a18409" role="button"
                       aria-expanded="false" aria-controls="id-bb8c24090f93347d05a18409">
                        <code>crates/storage/provider/src/writer/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/provider/src/writer/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/storage/provider/src/writer/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bb8c24090f93347d05a18409"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs</span>
<span class="term-fg1">index 30c5f0d5291d5cfb763ad504c2fd6216a0b50651..c26623487f65526e2b89fcf29789b2743cfd3b47 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs</span>
<span class="term-fg36">@@ -1341,7 +1341,13 @@</span>     fn bundle_state_state_root() {
         type PreState = BTreeMap&lt;Address, (Account, BTreeMap&lt;B256, U256&gt;)&gt;;
         let mut prestate: PreState = (0..10)
             .map(|key| {
<span class="term-fg31">-                let account = Account { nonce: 1, balance: U256::from(key), bytecode_hash: None };</span>
<span class="term-fg32">+                let account = Account {</span>
<span class="term-fg32">+                    nonce: 1,</span>
<span class="term-fg32">+                    balance: U256::from(key),</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                };</span>
                 let storage =
                     (1..11).map(|key| (B256::with_last_byte(key), U256::from(key))).collect();
                 (Address::with_last_byte(key), (account, storage))
<span class="term-fg36">@@ -1472,8 +1478,13 @@</span>         state.merge_transitions(BundleRetention::PlainState);
         assert_state_root(&amp;state, &amp;prestate, &quot;changed nonce&quot;);
&nbsp;
         &#47;&#47; recreate account 1
<span class="term-fg31">-        let account1_new =</span>
<span class="term-fg31">-            Account { nonce: 56, balance: U256::from(123), bytecode_hash: Some(B256::random()) };</span>
<span class="term-fg32">+        let account1_new = Account {</span>
<span class="term-fg32">+            nonce: 56,</span>
<span class="term-fg32">+            balance: U256::from(123),</span>
<span class="term-fg32">+            bytecode_hash: Some(B256::random()),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some((10, B256::random()).into()),</span>
<span class="term-fg32">+        };</span>
         prestate.insert(address1, (account1_new, BTreeMap::default()));
         state.commit(HashMap::from_iter([(
             address1,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-521ff663355f8f62c4d3cc61" role="button"
                       aria-expanded="false" aria-controls="id-521ff663355f8f62c4d3cc61">
                        <code>crates/trie/common/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/common/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/trie/common/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-521ff663355f8f62c4d3cc61"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml scroll-reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml</span>
<span class="term-fg1">index 0161fc7ff3d9a63c355156dc161bc4b4aee75c75..0a3893beb20e7c6f7e6383c72d0cbf8aba07268c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml</span>
<span class="term-fg36">@@ -22,6 +22,8 @@</span> alloy-consensus.workspace = true
 alloy-genesis.workspace = true
 revm-primitives.workspace = true
&nbsp;
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 bytes.workspace = true
 derive_more.workspace = true
 serde.workspace = true
<span class="term-fg36">@@ -40,6 +42,8 @@</span> proptest.workspace = true
 proptest-arbitrary-interop.workspace = true
 hash-db = &quot;=0.15.2&quot;
 plain_hasher = &quot;0.2&quot;
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
&nbsp;
 [features]
 test-utils = [
<span class="term-fg36">@@ -57,5 +61,7 @@</span> 	&quot;alloy-consensus&#47;arbitrary&quot;,
 	&quot;alloy-primitives&#47;arbitrary&quot;,
 	&quot;nybbles&#47;arbitrary&quot;,
 	&quot;revm-primitives&#47;arbitrary&quot;,
<span class="term-fg31">-	&quot;reth-codecs&#47;arbitrary&quot;</span>
<span class="term-fg32">+	&quot;reth-codecs&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;arbitrary&quot;</span>
 ]
<span class="term-fg32">+scroll = [&quot;reth-scroll-primitives&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5c0f317d109cac9492d115c0" role="button"
                       aria-expanded="false" aria-controls="id-5c0f317d109cac9492d115c0">
                        <code>crates/trie/common/src/account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/common/src/account.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/trie/common/src/account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5c0f317d109cac9492d115c0"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs</span>
<span class="term-fg1">index 0808837063cfab1bf9de63de1677cd744de9b773..b6666cfb7d463e7d157c0eedff93d8c8cd0626f1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs</span>
<span class="term-fg36">@@ -135,7 +135,11 @@</span>             Into::&lt;TrieAccount&gt;::into((
                 Account {
                     nonce: 10,
                     balance: U256::from(1000),
<span class="term-fg31">-                    bytecode_hash: Some(keccak256([0x60, 0x61]))</span>
<span class="term-fg32">+                    bytecode_hash: Some(keccak256([0x60, 0x61])),</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(&amp;[0x60, 0x61])</span>
<span class="term-fg32">+                    )</span>
                 },
                 expected_storage_root
             )),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e0d95bc3c4b9a10553bfe82d" role="button"
                       aria-expanded="false" aria-controls="id-e0d95bc3c4b9a10553bfe82d">
                        <code>crates/trie/common/src/proofs.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/common/src/proofs.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/trie/common/src/proofs.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e0d95bc3c4b9a10553bfe82d"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs</span>
<span class="term-fg1">index d0a5cd220420859f08209025b22e8d69e30ffce3..e1bd85dde3da7bfed719089719282204b1b4b5e7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs</span>
<span class="term-fg36">@@ -55,6 +55,11 @@</span>                             balance: account.balance,
                             nonce: account.nonce,
                             bytecode_hash: (account.code_hash != KECCAK_EMPTY)
                                 .then_some(account.code_hash),
<span class="term-fg32">+                            &#47;&#47; TODO (scroll): set the extension to the correct value.</span>
<span class="term-fg32">+                            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                            account_extension: Some(</span>
<span class="term-fg32">+                                reth_scroll_primitives::AccountExtension::empty(),</span>
<span class="term-fg32">+                            ),</span>
                         })
                     }
                 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-858d843ebf54a42b899a259e" role="button"
                       aria-expanded="false" aria-controls="id-858d843ebf54a42b899a259e">
                        <code>crates/trie/db/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/db/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/trie/db/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-858d843ebf54a42b899a259e"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml scroll-reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">index 55fa9a851b17798c8b5e63c73c9571f392988c7f..370ee6a33ea266b6302ae3af9b56657865d12563 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml</span>
<span class="term-fg36">@@ -55,6 +55,8 @@</span> reth-trie = { workspace = true, features = [&quot;test-utils&quot;] }
&nbsp;
 alloy-consensus.workspace = true
&nbsp;
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
 # trie
 triehash = &quot;0.8&quot;
&nbsp;
<span class="term-fg36">@@ -86,3 +88,4 @@</span> 	&quot;reth-provider&#47;test-utils&quot;,
 	&quot;reth-trie&#47;test-utils&quot;,
 	&quot;revm&#47;test-utils&quot;
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-29dc1bef10b81de692db066f" role="button"
                       aria-expanded="false" aria-controls="id-29dc1bef10b81de692db066f">
                        <code>crates/trie/db/src/state.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/db/src/state.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/trie/db/src/state.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-29dc1bef10b81de692db066f"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs</span>
<span class="term-fg1">index 6e2cea5051d0f5f0af01b419e9cdf723c6435e6e..9b07a95f85a1ee999c9d57d4aac9c1fb7f19b143 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs</span>
<span class="term-fg36">@@ -87,7 +87,13 @@</span>     &#47;&#47;&#47; &#47;&#47; Initialize hashed post state
     &#47;&#47;&#47; let mut hashed_state = HashedPostState::default();
     &#47;&#47;&#47; hashed_state.accounts.insert(
     &#47;&#47;&#47;     [0x11; 32].into(),
<span class="term-fg31">-    &#47;&#47;&#47;     Some(Account { nonce: 1, balance: U256::from(10), bytecode_hash: None }),</span>
<span class="term-fg32">+    &#47;&#47;&#47;     Some(Account {</span>
<span class="term-fg32">+    &#47;&#47;&#47;         nonce: 1,</span>
<span class="term-fg32">+    &#47;&#47;&#47;         balance: U256::from(10),</span>
<span class="term-fg32">+    &#47;&#47;&#47;         bytecode_hash: None,</span>
<span class="term-fg32">+    &#47;&#47;&#47;         &#47;&#47; TODO (scroll): remove at last Scroll `Account` related PR.</span>
<span class="term-fg32">+    &#47;&#47;&#47;         ..Default::default()</span>
<span class="term-fg32">+    &#47;&#47;&#47;     }),</span>
     &#47;&#47;&#47; );
     &#47;&#47;&#47;
     &#47;&#47;&#47; &#47;&#47; Calculate the state root</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d564cbb8b14cdcbf255115c2" role="button"
                       aria-expanded="false" aria-controls="id-d564cbb8b14cdcbf255115c2">
                        <code>crates/trie/db/tests/proof.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/db/tests/proof.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/trie/db/tests/proof.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d564cbb8b14cdcbf255115c2"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs</span>
<span class="term-fg1">index 79a2ce96fced7cbcfbba667d9cfac09460f62907..e03be1167479eacdcf2dc3324ff8206195ad4509 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs</span>
<span class="term-fg36">@@ -199,7 +199,10 @@</span>         address: target,
         info:  Some(Account {
             balance: U256::ZERO,
             nonce: 0,
<span class="term-fg31">-            bytecode_hash: Some(B256::from_str(&quot;0x2034f79e0e33b0ae6bef948532021baceb116adf2616478703bec6b17329f1cc&quot;).unwrap())</span>
<span class="term-fg32">+            bytecode_hash: Some(B256::from_str(&quot;0x2034f79e0e33b0ae6bef948532021baceb116adf2616478703bec6b17329f1cc&quot;).unwrap()),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty())</span>
<span class="term-fg32">+</span>
         }),
         storage_root: B256::from_str(&quot;0x556a482068355939c95a3412bdb21213a301483edb1b64402fb66ac9f3583599&quot;).unwrap(),
         proof: convert_to_proof([</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e0eb0b1825ff1e673471499f" role="button"
                       aria-expanded="false" aria-controls="id-e0eb0b1825ff1e673471499f">
                        <code>crates/trie/db/tests/trie.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/db/tests/trie.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/crates/trie/db/tests/trie.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+50</span></div>
                            <div class="text-start"><span class="text-danger">-7</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e0eb0b1825ff1e673471499f"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs</span>
<span class="term-fg1">index aee264364798de64ce03dc8ec9149637011e173f..133dd4556a38deaa2d3b83ee3f4d9b96a79684e4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs</span>
<span class="term-fg36">@@ -146,14 +146,26 @@</span>     let state: State = BTreeMap::from([
         (
             Address::random(),
             (
<span class="term-fg31">-                Account { nonce: 0, balance: U256::from(0), bytecode_hash: None },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::from(0),</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
                 BTreeMap::from([(B256::with_last_byte(0x4), U256::from(12))]),
             ),
         ),
         (
             Address::random(),
             (
<span class="term-fg31">-                Account { nonce: 0, balance: U256::from(0), bytecode_hash: None },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::from(0),</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
                 BTreeMap::default(),
             ),
         ),
<span class="term-fg36">@@ -164,6 +176,10 @@</span>                 Account {
                     nonce: 155,
                     balance: U256::from(414241124u32),
                     bytecode_hash: Some(keccak256(&quot;test&quot;)),
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(b&quot;test&quot;),</span>
<span class="term-fg32">+                    ),</span>
                 },
                 BTreeMap::from([
                     (B256::ZERO, U256::from(3)),
<span class="term-fg36">@@ -187,6 +203,8 @@</span>     let account = Account {
         nonce: 155,
         balance: U256::from(414241124u32),
         bytecode_hash: Some(keccak256(code)),
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
     };
     insert_account(tx.tx_ref(), address, account, &amp;Default::default());
     tx.commit().unwrap();
<span class="term-fg36">@@ -211,6 +229,8 @@</span>     let account = Account {
         nonce: 155,
         balance: U256::from(414241124u32),
         bytecode_hash: Some(keccak256(code)),
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
     };
&nbsp;
     insert_account(tx.tx_ref(), address, account, &amp;storage);
<span class="term-fg36">@@ -357,7 +377,13 @@</span>
     &#47;&#47; Insert first account
     let key1 =
         B256::from_str(&quot;b000000000000000000000000000000000000000000000000000000000000000&quot;).unwrap();
<span class="term-fg31">-    let account1 = Account { nonce: 0, balance: U256::from(3).mul(ether), bytecode_hash: None };</span>
<span class="term-fg32">+    let account1 = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(3).mul(ether),</span>
<span class="term-fg32">+        bytecode_hash: None,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+    };</span>
     hashed_account_cursor.upsert(key1, account1).unwrap();
     hash_builder.add_leaf(Nibbles::unpack(key1), &amp;encode_account(account1, None));
&nbsp;
<span class="term-fg36">@@ -377,8 +403,13 @@</span>     assert_eq!(key3[0], 0xB0);
     assert_eq!(key3[1], 0x41);
     let code_hash =
         B256::from_str(&quot;5be74cad16203c4905c068b012a2e9fb6d19d036c410f16fd177f337541440dd&quot;).unwrap();
<span class="term-fg31">-    let account3 =</span>
<span class="term-fg31">-        Account { nonce: 0, balance: U256::from(2).mul(ether), bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+    let account3 = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(2).mul(ether),</span>
<span class="term-fg32">+        bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some((10, B256::random()).into()),</span>
<span class="term-fg32">+    };</span>
     hashed_account_cursor.upsert(key3, account3).unwrap();
     for (hashed_slot, value) in storage {
         if hashed_storage_cursor
<span class="term-fg36">@@ -460,7 +491,13 @@</span>     &#47;&#47; Some address whose hash starts with 0xB1
     let address4b = Address::from_str(&quot;4f61f2d5ebd991b85aa1677db97307caf5215c91&quot;).unwrap();
     let key4b = keccak256(address4b);
     assert_eq!(key4b.0[0], key4a.0[0]);
<span class="term-fg31">-    let account4b = Account { nonce: 0, balance: U256::from(5).mul(ether), bytecode_hash: None };</span>
<span class="term-fg32">+    let account4b = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(5).mul(ether),</span>
<span class="term-fg32">+        bytecode_hash: None,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+    };</span>
     hashed_account_cursor.upsert(key4b, account4b).unwrap();
&nbsp;
     let mut prefix_set = PrefixSetMut::default();
<span class="term-fg36">@@ -725,7 +762,13 @@</span>
 fn extension_node_trie&lt;N: ProviderNodeTypes&gt;(
     tx: &amp;DatabaseProviderRW&lt;Arc&lt;TempDatabase&lt;DatabaseEnv&gt;&gt;, N&gt;,
 ) -&gt; B256 {
<span class="term-fg31">-    let a = Account { nonce: 0, balance: U256::from(1u64), bytecode_hash: Some(B256::random()) };</span>
<span class="term-fg32">+    let a = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(1u64),</span>
<span class="term-fg32">+        bytecode_hash: Some(B256::random()),</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some((10, B256::random()).into()),</span>
<span class="term-fg32">+    };</span>
     let val = encode_account(a, None);
&nbsp;
     let mut hashed_accounts = tx.tx_ref().cursor_write::&lt;tables::HashedAccounts&gt;().unwrap();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1d752a05d38f2f9d45c72ae8" role="button"
                       aria-expanded="false" aria-controls="id-1d752a05d38f2f9d45c72ae8">
                        <code>testing/ef-tests/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/testing/ef-tests/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/testing/ef-tests/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1d752a05d38f2f9d45c72ae8"><span class="term-fg1">diff --git reth&#47;testing&#47;ef-tests&#47;Cargo.toml scroll-reth&#47;testing&#47;ef-tests&#47;Cargo.toml</span>
<span class="term-fg1">index 2fc0c7512441691ca58f9bd67b6d2cc4e7f00bbd..eb754cba779489a9117e4490bf852ea021288f1a 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;ef-tests&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;ef-tests&#47;Cargo.toml</span>
<span class="term-fg36">@@ -18,6 +18,7 @@</span>     &quot;reth-primitives&#47;asm-keccak&quot;,
     &quot;alloy-primitives&#47;asm-keccak&quot;,
     &quot;revm&#47;asm-keccak&quot;,
 ]
<span class="term-fg32">+scroll = []</span>
&nbsp;
 [dependencies]
 reth-chainspec.workspace = true
<span class="term-fg36">@@ -34,6 +35,8 @@</span> reth-evm-ethereum.workspace = true
 reth-revm = { workspace = true, features = [&quot;std&quot;] }
&nbsp;
 revm = { workspace = true, features = [&quot;secp256k1&quot;, &quot;blst&quot;, &quot;c-kzg&quot;] }
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
&nbsp;
 alloy-rlp.workspace = true
 alloy-primitives.workspace = true</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a1ba629d5ff1c16a24ab42bb" role="button"
                       aria-expanded="false" aria-controls="id-a1ba629d5ff1c16a24ab42bb">
                        <code>testing/ef-tests/src/models.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/testing/ef-tests/src/models.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/testing/ef-tests/src/models.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a1ba629d5ff1c16a24ab42bb"><span class="term-fg1">diff --git reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs scroll-reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs</span>
<span class="term-fg1">index 292b32e8ce0f4393ac21fd7b8bb6cd29f077e7ae..3e3a25e45a1676951193cbfc47e75297a4d2ed66 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs</span>
<span class="term-fg36">@@ -162,6 +162,10 @@</span>             let reth_account = RethAccount {
                 balance: account.balance,
                 nonce: account.nonce.to::&lt;u64&gt;(),
                 bytecode_hash: code_hash,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                    &amp;account.code,</span>
<span class="term-fg32">+                )),</span>
             };
             tx.put::&lt;tables::PlainAccountState&gt;(address, reth_account)?;
             tx.put::&lt;tables::HashedAccounts&gt;(hashed_address, reth_account)?;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0aaf734f2ed88d89722643ce" role="button"
                       aria-expanded="false" aria-controls="id-0aaf734f2ed88d89722643ce">
                        <code>testing/testing-utils/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/testing/testing-utils/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/testing/testing-utils/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0aaf734f2ed88d89722643ce"><span class="term-fg1">diff --git reth&#47;testing&#47;testing-utils&#47;Cargo.toml scroll-reth&#47;testing&#47;testing-utils&#47;Cargo.toml</span>
<span class="term-fg1">index d0de37bf77f1a15f41be704f8d96f4125fa76736..4278da97a95cff8a5dcf7aef388d1aa1656a93be 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;testing-utils&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;testing-utils&#47;Cargo.toml</span>
<span class="term-fg36">@@ -24,3 +24,6 @@</span> secp256k1 = { workspace = true, features = [&quot;rand&quot;] }
&nbsp;
 [dev-dependencies]
 alloy-eips.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fdbe88075653b063e6d3e0f0" role="button"
                       aria-expanded="false" aria-controls="id-fdbe88075653b063e6d3e0f0">
                        <code>testing/testing-utils/src/generators.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/testing/testing-utils/src/generators.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/6a9251262b6c534d6c0d4c6677abc30b61fdfbe6/testing/testing-utils/src/generators.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fdbe88075653b063e6d3e0f0"><span class="term-fg1">diff --git reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs scroll-reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs</span>
<span class="term-fg1">index d8f3a29790bb0cf83155b3ff89b894d11097727b..8cf67915335392a7b98f3db8e9b812d573eab84e 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs</span>
<span class="term-fg36">@@ -386,7 +386,16 @@</span>     let nonce: u64 = rng.gen();
     let balance = U256::from(rng.gen::&lt;u32&gt;());
     let addr = rng.gen();
&nbsp;
<span class="term-fg31">-    (addr, Account { nonce, balance, bytecode_hash: None })</span>
<span class="term-fg32">+    (</span>
<span class="term-fg32">+        addr,</span>
<span class="term-fg32">+        Account {</span>
<span class="term-fg32">+            nonce,</span>
<span class="term-fg32">+            balance,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+    )</span>
 }
&nbsp;
 &#47;&#47;&#47; Generate random Externally Owned Accounts</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

                
            </div>
        </main>
    </div>

    <footer class="col-xl-10 col-xxl-8 mx-auto px-3 pt-5 my-5 text-muted border-top">
        <p>Fork-diff overview of <a href="https://github.com/scroll-tech/reth"><code>scroll-reth</code></a>, a fork of <a href="https://github.com/paradigmxyz/reth"><code>reth</code></a>.</p>

    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>
    <script type="text/javascript">
        const storedTheme = localStorage.getItem('theme')

        // Get the preferred theme from the user's OS
        const getPreferredTheme = () => {
            if (storedTheme) {
                return storedTheme
            }

            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
        }

        // Set the bootstrap theme
        const setTheme = function (theme) {
            document.documentElement.setAttribute('data-bs-theme', theme)
            if (theme === 'dark') {
                document.getElementById('dark-mode-toggle').setAttribute('checked', true)
                document.getElementById('dark-mode-icon').classList.replace('bi-brightness-high-fill', 'bi-brightness-low')
            } else {
                document.getElementById('dark-mode-toggle').setAttribute('checked', false)
                document.getElementById('dark-mode-icon').classList.replace('bi-brightness-low', 'bi-brightness-high-fill')
            }
        }

        // Returns true if the current theme is dark
        const isDark = () => {
            return document.documentElement.getAttribute('data-bs-theme') === 'dark'
        }

        // Toggles dark mode
        const toggleDarkMode = () => {
            const newTheme = isDark() ? 'light' : 'dark'
            setTheme(newTheme)
            localStorage.setItem('theme', newTheme)
        }

        // Set the preferred theme on page load
        window.onload = () => {
            // Set preferred theme
            setTheme(getPreferredTheme());
            // Initialize tooltips
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
        }

        // Toggle dark mode when the toggle button is clicked
        addEventListener("click", (event) => {
            if (event.target.id === 'dark-mode-toggle') {
                toggleDarkMode();
                // De-focus the toggle
                document.activeElement.blur()
            }
        });
    </script>
</body>
</html>
