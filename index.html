<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">

    <title>scroll-reth - reth fork diff overview</title>

    <link rel="icon" type="image/x-icon" href="">

    <style>
        .line-stat {
            width: 14rem;
            float: right;
        }
        .line-stat div {
            width: 50%;
        }
        .text-add-ignored {
            color: #93ad93;
            font-style: italic;
        }
        .text-delete-ignored {
            color: #c47777;
            font-style: italic;
        }
        .toplevelstat {
            margin-left: 0 !important;
            width: 15rem;
        }
    </style>

    
<style>
    .term-container {
        background: #171717;
        border-radius: 5px;
        color: white;
        word-break: break-word;
        overflow-wrap: break-word;
        font-family: "SFMono-Regular", Monaco, Menlo, Consolas, "Liberation Mono", Courier, monospace;
        font-size: 12px;
        line-height: 20px;
        padding: 14px 18px;
        white-space: pre-wrap;
    }

    .term-container img { max-width: 100%; }

    .term a { color: inherit; text-decoration: underline; text-decoration-style: dashed; }
    .term a:hover { color: #2882F9 }

    @keyframes blink-animation {
        to {
            visibility: hidden;
        }
    }

    .term-fg1 { } /* don't bold beccause it looks weird */
    .term-fg2 { color: #838887; } /* faint (decreased intensity) - same as gray really */
    .term-fg3 { font-style: italic; } /* italic */
    .term-fg4 { text-decoration: underline; } /* underline */
    .term-fg5 { animation: blink-animation 1s steps(3, start) infinite; } /* blink */
    .term-fg9 { text-decoration: line-through; } /* crossed-out */

    .term-fg30 { color: #666666; } /* black (but we can't use black, so a diff color) */
    .term-fg31 { color: #ff7070; } /* red */
    .term-fg32 { color: #b0f986; } /* green */
    .term-fg33 { color: #c6c502; } /* yellow */
    .term-fg34 { color: #8db7e0; } /* blue */
    .term-fg35 { color: #f271fb; } /* magenta */
    .term-fg36 { color: #6bf7ff; } /* cyan */

    /* high intense colors */
    .term-fgi1 { color: #5ef765; }
    .term-fgi90 { color: #838887; } /* grey */
    .term-fgi91 { color: #ff3333; } /* red */
    .term-fgi92 { color: #00FF00; } /* green */
    .term-fgi93 { color: #fffc67; } /* yellow */
    .term-fgi94 { color: #6871ff; } /* blue */
    .term-fgi95 { color: #ff76ff; } /* magenta */
    .term-fgi96 { color: #60fcff; } /* cyan */

    /* background colors */
    .term-bg40 { background: #676767; } /* grey */
    .term-bg41 { background: #ff4343; } /* red */
    .term-bg42 { background: #99ff5f; } /* green */

    /* custom foreground/background combos for readability */
    .term-fg31.term-bg40 { color: #F8A39F; }

    /* xterm colors */
    .term-fgx16 { color: #000000; }
    .term-fgx17 { color: #00005f; }
    .term-fgx18 { color: #000087; }
    .term-fgx19 { color: #0000af; }
    .term-fgx20 { color: #0000d7; }
    .term-fgx21 { color: #0000ff; }
    .term-fgx22 { color: #005f00; }
    .term-fgx23 { color: #005f5f; }
    .term-fgx24 { color: #005f87; }
    .term-fgx25 { color: #005faf; }
    .term-fgx26 { color: #005fd7; }
    .term-fgx27 { color: #005fff; }
    .term-fgx28 { color: #008700; }
    .term-fgx29 { color: #00875f; }
    .term-fgx30 { color: #008787; }
    .term-fgx31 { color: #0087af; }
    .term-fgx32 { color: #0087d7; }
    .term-fgx33 { color: #0087ff; }
    .term-fgx34 { color: #00af00; }
    .term-fgx35 { color: #00af5f; }
    .term-fgx36 { color: #00af87; }
    .term-fgx37 { color: #00afaf; }
    .term-fgx38 { color: #00afd7; }
    .term-fgx39 { color: #00afff; }
    .term-fgx40 { color: #00d700; }
    .term-fgx41 { color: #00d75f; }
    .term-fgx42 { color: #00d787; }
    .term-fgx43 { color: #00d7af; }
    .term-fgx44 { color: #00d7d7; }
    .term-fgx45 { color: #00d7ff; }
    .term-fgx46 { color: #00ff00; }
    .term-fgx47 { color: #00ff5f; }
    .term-fgx48 { color: #00ff87; }
    .term-fgx49 { color: #00ffaf; }
    .term-fgx50 { color: #00ffd7; }
    .term-fgx51 { color: #00ffff; }
    .term-fgx52 { color: #5f0000; }
    .term-fgx53 { color: #5f005f; }
    .term-fgx54 { color: #5f0087; }
    .term-fgx55 { color: #5f00af; }
    .term-fgx56 { color: #5f00d7; }
    .term-fgx57 { color: #5f00ff; }
    .term-fgx58 { color: #5f5f00; }
    .term-fgx59 { color: #5f5f5f; }
    .term-fgx60 { color: #5f5f87; }
    .term-fgx61 { color: #5f5faf; }
    .term-fgx62 { color: #5f5fd7; }
    .term-fgx63 { color: #5f5fff; }
    .term-fgx64 { color: #5f8700; }
    .term-fgx65 { color: #5f875f; }
    .term-fgx66 { color: #5f8787; }
    .term-fgx67 { color: #5f87af; }
    .term-fgx68 { color: #5f87d7; }
    .term-fgx69 { color: #5f87ff; }
    .term-fgx70 { color: #5faf00; }
    .term-fgx71 { color: #5faf5f; }
    .term-fgx72 { color: #5faf87; }
    .term-fgx73 { color: #5fafaf; }
    .term-fgx74 { color: #5fafd7; }
    .term-fgx75 { color: #5fafff; }
    .term-fgx76 { color: #5fd700; }
    .term-fgx77 { color: #5fd75f; }
    .term-fgx78 { color: #5fd787; }
    .term-fgx79 { color: #5fd7af; }
    .term-fgx80 { color: #5fd7d7; }
    .term-fgx81 { color: #5fd7ff; }
    .term-fgx82 { color: #5fff00; }
    .term-fgx83 { color: #5fff5f; }
    .term-fgx84 { color: #5fff87; }
    .term-fgx85 { color: #5fffaf; }
    .term-fgx86 { color: #5fffd7; }
    .term-fgx87 { color: #5fffff; }
    .term-fgx88 { color: #870000; }
    .term-fgx89 { color: #87005f; }
    .term-fgx90 { color: #870087; }
    .term-fgx91 { color: #8700af; }
    .term-fgx92 { color: #8700d7; }
    .term-fgx93 { color: #8700ff; }
    .term-fgx94 { color: #875f00; }
    .term-fgx95 { color: #875f5f; }
    .term-fgx96 { color: #875f87; }
    .term-fgx97 { color: #875faf; }
    .term-fgx98 { color: #875fd7; }
    .term-fgx99 { color: #875fff; }
    .term-fgx100 { color: #878700; }
    .term-fgx101 { color: #87875f; }
    .term-fgx102 { color: #878787; }
    .term-fgx103 { color: #8787af; }
    .term-fgx104 { color: #8787d7; }
    .term-fgx105 { color: #8787ff; }
    .term-fgx106 { color: #87af00; }
    .term-fgx107 { color: #87af5f; }
    .term-fgx108 { color: #87af87; }
    .term-fgx109 { color: #87afaf; }
    .term-fgx110 { color: #87afd7; }
    .term-fgx111 { color: #87afff; }
    .term-fgx112 { color: #87d700; }
    .term-fgx113 { color: #87d75f; }
    .term-fgx114 { color: #87d787; }
    .term-fgx115 { color: #87d7af; }
    .term-fgx116 { color: #87d7d7; }
    .term-fgx117 { color: #87d7ff; }
    .term-fgx118 { color: #87ff00; }
    .term-fgx119 { color: #87ff5f; }
    .term-fgx120 { color: #87ff87; }
    .term-fgx121 { color: #87ffaf; }
    .term-fgx122 { color: #87ffd7; }
    .term-fgx123 { color: #87ffff; }
    .term-fgx124 { color: #af0000; }
    .term-fgx125 { color: #af005f; }
    .term-fgx126 { color: #af0087; }
    .term-fgx127 { color: #af00af; }
    .term-fgx128 { color: #af00d7; }
    .term-fgx129 { color: #af00ff; }
    .term-fgx130 { color: #af5f00; }
    .term-fgx131 { color: #af5f5f; }
    .term-fgx132 { color: #af5f87; }
    .term-fgx133 { color: #af5faf; }
    .term-fgx134 { color: #af5fd7; }
    .term-fgx135 { color: #af5fff; }
    .term-fgx136 { color: #af8700; }
    .term-fgx137 { color: #af875f; }
    .term-fgx138 { color: #af8787; }
    .term-fgx139 { color: #af87af; }
    .term-fgx140 { color: #af87d7; }
    .term-fgx141 { color: #af87ff; }
    .term-fgx142 { color: #afaf00; }
    .term-fgx143 { color: #afaf5f; }
    .term-fgx144 { color: #afaf87; }
    .term-fgx145 { color: #afafaf; }
    .term-fgx146 { color: #afafd7; }
    .term-fgx147 { color: #afafff; }
    .term-fgx148 { color: #afd700; }
    .term-fgx149 { color: #afd75f; }
    .term-fgx150 { color: #afd787; }
    .term-fgx151 { color: #afd7af; }
    .term-fgx152 { color: #afd7d7; }
    .term-fgx153 { color: #afd7ff; }
    .term-fgx154 { color: #afff00; }
    .term-fgx155 { color: #afff5f; }
    .term-fgx156 { color: #afff87; }
    .term-fgx157 { color: #afffaf; }
    .term-fgx158 { color: #afffd7; }
    .term-fgx159 { color: #afffff; }
    .term-fgx160 { color: #d70000; }
    .term-fgx161 { color: #d7005f; }
    .term-fgx162 { color: #d70087; }
    .term-fgx163 { color: #d700af; }
    .term-fgx164 { color: #d700d7; }
    .term-fgx165 { color: #d700ff; }
    .term-fgx166 { color: #d75f00; }
    .term-fgx167 { color: #d75f5f; }
    .term-fgx168 { color: #d75f87; }
    .term-fgx169 { color: #d75faf; }
    .term-fgx170 { color: #d75fd7; }
    .term-fgx171 { color: #d75fff; }
    .term-fgx172 { color: #d78700; }
    .term-fgx173 { color: #d7875f; }
    .term-fgx174 { color: #d78787; }
    .term-fgx175 { color: #d787af; }
    .term-fgx176 { color: #d787d7; }
    .term-fgx177 { color: #d787ff; }
    .term-fgx178 { color: #d7af00; }
    .term-fgx179 { color: #d7af5f; }
    .term-fgx180 { color: #d7af87; }
    .term-fgx181 { color: #d7afaf; }
    .term-fgx182 { color: #d7afd7; }
    .term-fgx183 { color: #d7afff; }
    .term-fgx184 { color: #d7d700; }
    .term-fgx185 { color: #d7d75f; }
    .term-fgx186 { color: #d7d787; }
    .term-fgx187 { color: #d7d7af; }
    .term-fgx188 { color: #d7d7d7; }
    .term-fgx189 { color: #d7d7ff; }
    .term-fgx190 { color: #d7ff00; }
    .term-fgx191 { color: #d7ff5f; }
    .term-fgx192 { color: #d7ff87; }
    .term-fgx193 { color: #d7ffaf; }
    .term-fgx194 { color: #d7ffd7; }
    .term-fgx195 { color: #d7ffff; }
    .term-fgx196 { color: #ff0000; }
    .term-fgx197 { color: #ff005f; }
    .term-fgx198 { color: #ff0087; }
    .term-fgx199 { color: #ff00af; }
    .term-fgx200 { color: #ff00d7; }
    .term-fgx201 { color: #ff00ff; }
    .term-fgx202 { color: #ff5f00; }
    .term-fgx203 { color: #ff5f5f; }
    .term-fgx204 { color: #ff5f87; }
    .term-fgx205 { color: #ff5faf; }
    .term-fgx206 { color: #ff5fd7; }
    .term-fgx207 { color: #ff5fff; }
    .term-fgx208 { color: #ff8700; }
    .term-fgx209 { color: #ff875f; }
    .term-fgx210 { color: #ff8787; }
    .term-fgx211 { color: #ff87af; }
    .term-fgx212 { color: #ff87d7; }
    .term-fgx213 { color: #ff87ff; }
    .term-fgx214 { color: #ffaf00; }
    .term-fgx215 { color: #ffaf5f; }
    .term-fgx216 { color: #ffaf87; }
    .term-fgx217 { color: #ffafaf; }
    .term-fgx218 { color: #ffafd7; }
    .term-fgx219 { color: #ffafff; }
    .term-fgx220 { color: #ffd700; }
    .term-fgx221 { color: #ffd75f; }
    .term-fgx222 { color: #ffd787; }
    .term-fgx223 { color: #ffd7af; }
    .term-fgx224 { color: #ffd7d7; }
    .term-fgx225 { color: #ffd7ff; }
    .term-fgx226 { color: #ffff00; }
    .term-fgx227 { color: #ffff5f; }
    .term-fgx228 { color: #ffff87; }
    .term-fgx229 { color: #ffffaf; }
    .term-fgx230 { color: #ffffd7; }
    .term-fgx231 { color: #ffffff; }
    .term-fgx232 { color: #080808; }
    .term-fgx233 { color: #121212; }
    .term-fgx234 { color: #1c1c1c; }
    .term-fgx235 { color: #262626; }
    .term-fgx236 { color: #303030; }
    .term-fgx237 { color: #3a3a3a; }
    .term-fgx238 { color: #444444; }
    .term-fgx239 { color: #4e4e4e; }
    .term-fgx240 { color: #585858; }
    .term-fgx241 { color: #626262; }
    .term-fgx242 { color: #6c6c6c; }
    .term-fgx243 { color: #767676; }
    .term-fgx244 { color: #808080; }
    .term-fgx245 { color: #8a8a8a; }
    .term-fgx246 { color: #949494; }
    .term-fgx247 { color: #9e9e9e; }
    .term-fgx248 { color: #a8a8a8; }
    .term-fgx249 { color: #b2b2b2; }
    .term-fgx250 { color: #bcbcbc; }
    .term-fgx251 { color: #c6c6c6; }
    .term-fgx252 { color: #d0d0d0; }
    .term-fgx253 { color: #dadada; }
    .term-fgx254 { color: #e4e4e4; }
    .term-fgx255 { color: #eeeeee; }
</style>

</head>
<body>
    <div class="col-xl-10 col-xxl-8 mx-auto px-3 py-1 py-md-3">
        <main class="container-fluid">
            <div class="row">
                <div>
                    <div class="float-end">
                        <div class="form-check form-switch">
                            <i class="bi bi-brightness-low" id="dark-mode-icon"></i>
                            <input class="form-check-input" type="checkbox" role="switch" id="dark-mode-toggle" data-bs-toggle="tooltip"
                                   data-bs-placement="bottom" data-bs-title="Toggle Dark Mode"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"role="button" aria-expanded="true" aria-controls="id-22b19dddfd5f9f6272011099">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h1>scroll-reth</h1></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                    <span class="text-end">diff:</span>
                
                
                    <span class="text-end">ignored:</span>
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 toplevelstat">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+3383</span></div>
                    <div class="text-start"><span class="text-danger">-233</span></div>
                
                
                    <div class="text-end"><span class="text-add-ignored">+112</span></div>
                    <div class="text-start"><span class="text-delete-ignored">-39</span></div>
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse show border-1 ps-3 my-3" id="id-22b19dddfd5f9f6272011099">
        <div><p>This is an overview of the changes in <a href="https://github.com/scroll-tech/reth"><code>scroll-reth</code></a>,
a fork of <a href="https://github.com/paradigmxyz/reth"><code>reth</code></a>.</p>
</div>
        <div>
            
            
        </div>
        <div>
            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-ff21c19d35cbd64e8e304fa5"role="button" aria-expanded="false" aria-controls="id-ff21c19d35cbd64e8e304fa5">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/scroll</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+1966</span></div>
                    <div class="text-start"><span class="text-danger">-0</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-ff21c19d35cbd64e8e304fa5">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d2cb6928ad07f9519177b155" role="button"
                       aria-expanded="false" aria-controls="id-d2cb6928ad07f9519177b155">
                        <code>crates/scroll/execution/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/execution/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+24</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d2cb6928ad07f9519177b155"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;execution&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;execution&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..7a6af2b39798d54f023cced578c14a11c0b6b2c3</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;execution&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,24 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-execution&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-revm.workspace = true</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-scroll-storage&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-revm&#47;scroll&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+test-utils = [&quot;reth-revm&#47;test-utils&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-575b9c72e3fc2b28d8a67132" role="button"
                       aria-expanded="false" aria-controls="id-575b9c72e3fc2b28d8a67132">
                        <code>crates/scroll/execution/src/context.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/execution/src/context.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+75</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-575b9c72e3fc2b28d8a67132"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;context.rs scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;context.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..020aa0a7e318bbf422a447fb310bc9384a12f756</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;context.rs</span>
<span class="term-fg36">@@ -0,0 +1,75 @@</span>
<span class="term-fg32">+#![allow(clippy::useless_conversion)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+use reth_revm::{cached::CachedReadsDbMut, revm::CacheDB, DatabaseRef};</span>
<span class="term-fg32">+use reth_revm::{</span>
<span class="term-fg32">+    database::{EvmStateProvider, StateProviderDatabase},</span>
<span class="term-fg32">+    revm::State,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+use reth_scroll_storage::ScrollStateProviderDatabase;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Finalize the execution of the type and return the output</span>
<span class="term-fg32">+pub trait FinalizeExecution {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The output of the finalization.</span>
<span class="term-fg32">+    type Output;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Finalize the state and return the output.</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; FinalizeExecution for State&lt;ScrollStateProviderDatabase&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::states::ScrollBundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        let bundle = self.take_bundle();</span>
<span class="term-fg32">+        (bundle, &amp;self.database.post_execution_context).into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; FinalizeExecution for State&lt;&amp;mut ScrollStateProviderDatabase&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::states::ScrollBundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        let bundle = self.take_bundle();</span>
<span class="term-fg32">+        (bundle, &amp;self.database.post_execution_context).into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; FinalizeExecution for State&lt;StateProviderDatabase&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        self.take_bundle().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; FinalizeExecution for State&lt;&amp;mut StateProviderDatabase&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        self.take_bundle().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl&lt;DB: DatabaseRef&gt; FinalizeExecution for State&lt;CacheDB&lt;DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        self.take_bundle().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl&lt;DB: DatabaseRef&gt; FinalizeExecution for State&lt;CachedReadsDbMut&lt;&#39;_, DB&gt;&gt; {</span>
<span class="term-fg32">+    type Output = reth_revm::db::BundleState;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn finalize(&amp;mut self) -&gt; Self::Output {</span>
<span class="term-fg32">+        self.take_bundle().into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4294348c6cfa542fe8a058f1" role="button"
                       aria-expanded="false" aria-controls="id-4294348c6cfa542fe8a058f1">
                        <code>crates/scroll/execution/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/execution/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4294348c6cfa542fe8a058f1"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..150a0e9700dacb86422e6fc878a7afceeed4f25f</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;execution&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,6 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll execution related implementations.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![warn(unused_crate_dependencies)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use context::FinalizeExecution;</span>
<span class="term-fg32">+mod context;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0b241e2bbcedb7e9656df43a" role="button"
                       aria-expanded="false" aria-controls="id-0b241e2bbcedb7e9656df43a">
                        <code>crates/scroll/primitives/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/primitives/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+47</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0b241e2bbcedb7e9656df43a"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..a8c17e0ff514ef84d6d876c1d02170c9679adf26</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,47 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-primitives&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# alloy</span>
<span class="term-fg32">+alloy-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-codecs.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+poseidon-bn254 = { workspace = true, features = [&quot;bn254&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+arbitrary = { workspace = true, features = [&quot;derive&quot;], optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# required by reth-codecs</span>
<span class="term-fg32">+bytes.workspace = true</span>
<span class="term-fg32">+modular-bitfield.workspace = true</span>
<span class="term-fg32">+serde.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dev-dependencies]</span>
<span class="term-fg32">+alloy-primitives = { workspace = true, features = [&quot;arbitrary&quot;] }</span>
<span class="term-fg32">+arbitrary = { workspace = true, features = [&quot;derive&quot;] }</span>
<span class="term-fg32">+test-fuzz.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+default = [&quot;std&quot;]</span>
<span class="term-fg32">+std = [</span>
<span class="term-fg32">+	&quot;serde&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;alloy-primitives&#47;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+arbitrary = [</span>
<span class="term-fg32">+	&quot;dep:arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;alloy-primitives&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-codecs&#47;arbitrary&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f0cd49e7c0e5c256e1876576" role="button"
                       aria-expanded="false" aria-controls="id-f0cd49e7c0e5c256e1876576">
                        <code>crates/scroll/primitives/src/account_extension.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/primitives/src/account_extension.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+43</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f0cd49e7c0e5c256e1876576"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;account_extension.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;account_extension.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..c48181f9ea215fa0487b075af8eef46edf7d7cd6</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;account_extension.rs</span>
<span class="term-fg36">@@ -0,0 +1,43 @@</span>
<span class="term-fg32">+use crate::{hash_code, POSEIDON_EMPTY};</span>
<span class="term-fg32">+use alloy_primitives::B256;</span>
<span class="term-fg32">+use reth_codecs::Compact;</span>
<span class="term-fg32">+use serde::{Deserialize, Serialize};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The extension for a Scroll account&#39;s representation in storage.</span>
<span class="term-fg32">+&#47;&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;&#47; The extension is used in order to maintain backwards compatibility if more fields need to be</span>
<span class="term-fg32">+&#47;&#47;&#47; added to the account (see [reth codecs](reth_codecs::test_utils) for details).</span>
<span class="term-fg32">+#[derive(Clone, Copy, Debug, Default, PartialEq, Eq, Serialize, Deserialize, Compact)]</span>
<span class="term-fg32">+#[cfg_attr(any(test, feature = &quot;arbitrary&quot;), derive(arbitrary::Arbitrary))]</span>
<span class="term-fg32">+pub struct AccountExtension {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Size in bytes of the account&#39;s bytecode.</span>
<span class="term-fg32">+    pub code_size: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Poseidon hash of the account&#39;s bytecode. `None` means there is no</span>
<span class="term-fg32">+    &#47;&#47;&#47; bytecode for the account.</span>
<span class="term-fg32">+    pub poseidon_code_hash: Option&lt;B256&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl AccountExtension {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates an empty [`AccountExtension`].</span>
<span class="term-fg32">+    pub const fn empty() -&gt; Self {</span>
<span class="term-fg32">+        Self { code_size: 0, poseidon_code_hash: None }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates an [`AccountExtension`] from the provided bytecode.</span>
<span class="term-fg32">+    pub fn from_bytecode&lt;T: AsRef&lt;[u8]&gt;&gt;(code: &amp;T) -&gt; Self {</span>
<span class="term-fg32">+        let code = code.as_ref();</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            code_size: code.len() as u64,</span>
<span class="term-fg32">+            poseidon_code_hash: (!code.is_empty()).then_some(hash_code(code)),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(u64, B256)&gt; for AccountExtension {</span>
<span class="term-fg32">+    fn from(value: (u64, B256)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            code_size: value.0,</span>
<span class="term-fg32">+            poseidon_code_hash: (value.1 != POSEIDON_EMPTY).then_some(value.1),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-489eb49f4f51c82686a00f9c" role="button"
                       aria-expanded="false" aria-controls="id-489eb49f4f51c82686a00f9c">
                        <code>crates/scroll/primitives/src/execution_context.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/primitives/src/execution_context.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-489eb49f4f51c82686a00f9c"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;execution_context.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;execution_context.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..0175e70cb1a2f4c55557cad40996b3a89ee2b8a6</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;execution_context.rs</span>
<span class="term-fg36">@@ -0,0 +1,12 @@</span>
<span class="term-fg32">+use alloy_primitives::{map::HashMap, B256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A Keccak code hash.</span>
<span class="term-fg32">+type KeccakHash = B256;</span>
<span class="term-fg32">+&#47;&#47;&#47; A Poseidon code hash.</span>
<span class="term-fg32">+type PoseidonHash = B256;</span>
<span class="term-fg32">+&#47;&#47;&#47; Size of a contract&#39;s code in bytes.</span>
<span class="term-fg32">+type CodeSize = u64;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Scroll post execution context maps a Keccak code hash of a contract&#39;s bytecode to its code size</span>
<span class="term-fg32">+&#47;&#47;&#47; and Poseidon code hash.</span>
<span class="term-fg32">+pub type ScrollPostExecutionContext = HashMap&lt;KeccakHash, (CodeSize, PoseidonHash)&gt;;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8d5d6eaa9eda52353bc74b2e" role="button"
                       aria-expanded="false" aria-controls="id-8d5d6eaa9eda52353bc74b2e">
                        <code>crates/scroll/primitives/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/primitives/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8d5d6eaa9eda52353bc74b2e"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..2a18616b307d7e63747a2260729dbac38469ef89</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,12 @@</span>
<span class="term-fg32">+&#47;&#47;! Primitive types for the Scroll extension of `Reth`.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![warn(unused_crate_dependencies)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use execution_context::ScrollPostExecutionContext;</span>
<span class="term-fg32">+mod execution_context;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use account_extension::AccountExtension;</span>
<span class="term-fg32">+mod account_extension;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use poseidon::{hash_code, POSEIDON_EMPTY};</span>
<span class="term-fg32">+mod poseidon;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1320aea52d5edd91e9665630" role="button"
                       aria-expanded="false" aria-controls="id-1320aea52d5edd91e9665630">
                        <code>crates/scroll/primitives/src/poseidon.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/primitives/src/poseidon.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1320aea52d5edd91e9665630"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;poseidon.rs scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;poseidon.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..4a5010167f51be151250d9169f04889d31334cea</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;primitives&#47;src&#47;poseidon.rs</span>
<span class="term-fg36">@@ -0,0 +1,10 @@</span>
<span class="term-fg32">+use alloy_primitives::{b256, B256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The Poseidon hash of the empty string `&quot;&quot;`.</span>
<span class="term-fg32">+pub const POSEIDON_EMPTY: B256 =</span>
<span class="term-fg32">+    b256!(&quot;2098f5fb9e239eab3ceac3f27b81e481dc3124d55ffed523a839ee8446b64864&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Poseidon code hash</span>
<span class="term-fg32">+pub fn hash_code(code: &amp;[u8]) -&gt; B256 {</span>
<span class="term-fg32">+    poseidon_bn254::hash_code(code).into()</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7c471e527d9e61e287a9be8d" role="button"
                       aria-expanded="false" aria-controls="id-7c471e527d9e61e287a9be8d">
                        <code>crates/scroll/revm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/revm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+49</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7c471e527d9e61e287a9be8d"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;revm&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..b432636677971dfed4bee45c695722b12a364b0a</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,49 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-revm&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# revm</span>
<span class="term-fg32">+revm = { version = &quot;18.0.0&quot;, features = [&quot;std&quot;], default-features = false }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# misc</span>
<span class="term-fg32">+serde = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+default = [&quot;std&quot;]</span>
<span class="term-fg32">+dev = [&quot;revm&#47;dev&quot;]</span>
<span class="term-fg32">+arbitrary = [</span>
<span class="term-fg32">+	&quot;revm&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives&#47;arbitrary&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+asm-keccak = [&quot;revm&#47;asm-keccak&quot;]</span>
<span class="term-fg32">+c-kzg = [&quot;revm&#47;c-kzg&quot;]</span>
<span class="term-fg32">+optimism = [&quot;revm&#47;optimism&quot;]</span>
<span class="term-fg32">+serde = [</span>
<span class="term-fg32">+	&quot;revm&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;serde&#47;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = []</span>
<span class="term-fg32">+test-utils = [&quot;revm&#47;test-utils&quot;]</span>
<span class="term-fg32">+std = [</span>
<span class="term-fg32">+	&quot;revm&#47;std&quot;,</span>
<span class="term-fg32">+	&quot;serde&#47;std&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+blst = [&quot;revm&#47;blst&quot;]</span>
<span class="term-fg32">+optional_block_gas_limit =  [&quot;revm&#47;optional_block_gas_limit&quot;]</span>
<span class="term-fg32">+optional_eip3607 = [&quot;revm&#47;optional_eip3607&quot;]</span>
<span class="term-fg32">+optional_no_base_fee = [&quot;revm&#47;optional_no_base_fee&quot;]</span>
<span class="term-fg32">+secp256k1 = [&quot;revm&#47;secp256k1&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9a0c60f269f5f1c2d8ef5ace" role="button"
                       aria-expanded="false" aria-controls="id-9a0c60f269f5f1c2d8ef5ace">
                        <code>crates/scroll/revm/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/revm/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+78</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9a0c60f269f5f1c2d8ef5ace"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..750d8fdd1decbd715bd960756c5c33fd5071ce40</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,78 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll `revm` types redefinitions. Account types are redefined with two additional fields</span>
<span class="term-fg32">+&#47;&#47;! `code_size` and `poseidon_code_hash`, which are used during computation of the state root.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![warn(unused_crate_dependencies)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub mod states;</span>
<span class="term-fg32">+#[cfg(feature = &quot;test-utils&quot;)]</span>
<span class="term-fg32">+mod test_utils;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;optimism&quot;)]</span>
<span class="term-fg32">+pub use revm::{primitives::OptimismFields, L1BlockInfo, L1_BLOCK_CONTRACT};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use revm::{</span>
<span class="term-fg32">+    db::*,</span>
<span class="term-fg32">+    inspector_handle_register,</span>
<span class="term-fg32">+    primitives::{</span>
<span class="term-fg32">+        keccak256, AuthorizationList, Bytecode, BytecodeDecodeError, JumpTable,</span>
<span class="term-fg32">+        LegacyAnalyzedBytecode, TxEnv, TxKind,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    ContextPrecompile, ContextPrecompiles, Evm, EvmBuilder, EvmContext, GetInspector, Inspector,</span>
<span class="term-fg32">+    JournaledState,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+pub use crate::states::ScrollAccountInfo as AccountInfo;</span>
<span class="term-fg32">+#[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+pub use revm::primitives::AccountInfo;</span>
<span class="term-fg32">+pub use states::ScrollAccountInfo;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Shared module, available for all feature flags.</span>
<span class="term-fg32">+pub mod shared {</span>
<span class="term-fg32">+    pub use revm::{db::states::BundleState, primitives::AccountInfo};</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod handler {</span>
<span class="term-fg32">+    pub use revm::handler::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod interpreter {</span>
<span class="term-fg32">+    pub use revm::interpreter::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod inspectors {</span>
<span class="term-fg32">+    pub use revm::inspectors::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod precompile {</span>
<span class="term-fg32">+    pub use revm::precompile::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm-primitives` module structure</span>
<span class="term-fg32">+pub mod primitives {</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    pub use crate::states::ScrollAccountInfo as AccountInfo;</span>
<span class="term-fg32">+    pub use revm::primitives::*;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+pub mod db {</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    pub use crate::states::{</span>
<span class="term-fg32">+        ScrollBundleAccount as BundleAccount, ScrollBundleState as BundleState,</span>
<span class="term-fg32">+    };</span>
<span class="term-fg32">+    pub use revm::db::*;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Match the `revm` module structure</span>
<span class="term-fg32">+    pub mod states {</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        pub use crate::states::{</span>
<span class="term-fg32">+            ScrollBundleBuilder as BundleBuilder, ScrollBundleState as BundleState,</span>
<span class="term-fg32">+            ScrollPlainStateReverts as PlainStateReverts, ScrollStateChangeset as StateChangeset,</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        pub use revm::db::states::*;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c89640e64999b8e158a6fdbf" role="button"
                       aria-expanded="false" aria-controls="id-c89640e64999b8e158a6fdbf">
                        <code>crates/scroll/revm/src/states/account_info.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/revm/src/states/account_info.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+164</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c89640e64999b8e158a6fdbf"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;account_info.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;account_info.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..ad21e46f14ce7016c533eb2f0350deef9018ad5c</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;account_info.rs</span>
<span class="term-fg36">@@ -0,0 +1,164 @@</span>
<span class="term-fg32">+use reth_scroll_primitives::{hash_code, ScrollPostExecutionContext, POSEIDON_EMPTY};</span>
<span class="term-fg32">+use revm::primitives::{AccountInfo, Bytecode, B256, KECCAK_EMPTY, U256};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The Scroll account information. Code copy of [`AccountInfo`]. Provides additional `code_size`</span>
<span class="term-fg32">+&#47;&#47;&#47; and `poseidon_code_hash` fields needed in the state root computation.</span>
<span class="term-fg32">+#[derive(Clone, Debug, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollAccountInfo {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account balance.</span>
<span class="term-fg32">+    pub balance: U256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account nonce.</span>
<span class="term-fg32">+    pub nonce: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account code keccak hash.</span>
<span class="term-fg32">+    pub code_hash: B256,</span>
<span class="term-fg32">+    &#47;&#47;&#47; code: if None, `code_by_hash` will be used to fetch it if code needs to be loaded from</span>
<span class="term-fg32">+    &#47;&#47;&#47; inside `revm`.</span>
<span class="term-fg32">+    pub code: Option&lt;Bytecode&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account code size.</span>
<span class="term-fg32">+    pub code_size: u64,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account code Poseidon hash. [`POSEIDON_EMPTY`] if code is None or empty.</span>
<span class="term-fg32">+    pub poseidon_code_hash: B256,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(AccountInfo, &amp;ScrollPostExecutionContext)&gt; for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn from((info, context): (AccountInfo, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        let context = context.get(&amp;info.code_hash).copied();</span>
<span class="term-fg32">+        let (code_size, poseidon_code_hash) = context</span>
<span class="term-fg32">+            .or_else(|| {</span>
<span class="term-fg32">+                info.code</span>
<span class="term-fg32">+                    .as_ref()</span>
<span class="term-fg32">+                    .map(|code| (code.len() as u64, hash_code(code.original_byte_slice())))</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .unwrap_or((0, POSEIDON_EMPTY));</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            code_hash: info.code_hash,</span>
<span class="term-fg32">+            code: info.code,</span>
<span class="term-fg32">+            code_size,</span>
<span class="term-fg32">+            poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Default for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn default() -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            code_hash: KECCAK_EMPTY,</span>
<span class="term-fg32">+            code: Some(Bytecode::default()),</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            code_size: 0,</span>
<span class="term-fg32">+            poseidon_code_hash: POSEIDON_EMPTY,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl PartialEq for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn eq(&amp;self, other: &amp;Self) -&gt; bool {</span>
<span class="term-fg32">+        self.balance == other.balance &amp;&amp;</span>
<span class="term-fg32">+            self.nonce == other.nonce &amp;&amp;</span>
<span class="term-fg32">+            self.code_hash == other.code_hash</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollAccountInfo {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a new [`ScrollAccountInfo`] with the given fields.</span>
<span class="term-fg32">+    pub fn new(</span>
<span class="term-fg32">+        balance: U256,</span>
<span class="term-fg32">+        nonce: u64,</span>
<span class="term-fg32">+        code_hash: B256,</span>
<span class="term-fg32">+        code: Bytecode,</span>
<span class="term-fg32">+        poseidon_code_hash: B256,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        let code_size = code.len() as u64;</span>
<span class="term-fg32">+        Self { balance, nonce, code: Some(code), code_hash, code_size, poseidon_code_hash }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns a copy of this account with the [`Bytecode`] removed. This is</span>
<span class="term-fg32">+    &#47;&#47;&#47; useful when creating journals or snapshots of the state, where it is</span>
<span class="term-fg32">+    &#47;&#47;&#47; desirable to store the code blobs elsewhere.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; ## Note</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; This is distinct from [`ScrollAccountInfo::without_code`] in that it returns</span>
<span class="term-fg32">+    &#47;&#47;&#47; a new `ScrollAccountInfo` instance with the code removed.</span>
<span class="term-fg32">+    &#47;&#47;&#47; [`ScrollAccountInfo::without_code`] will modify and return the same instance.</span>
<span class="term-fg32">+    pub const fn copy_without_code(&amp;self) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: self.balance,</span>
<span class="term-fg32">+            nonce: self.nonce,</span>
<span class="term-fg32">+            code_hash: self.code_hash,</span>
<span class="term-fg32">+            code: None,</span>
<span class="term-fg32">+            code_size: self.code_size,</span>
<span class="term-fg32">+            poseidon_code_hash: self.poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns account info without the code.</span>
<span class="term-fg32">+    pub fn without_code(mut self) -&gt; Self {</span>
<span class="term-fg32">+        self.take_bytecode();</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns if an account is empty.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; An account is empty if the following conditions are met.</span>
<span class="term-fg32">+    &#47;&#47;&#47; - code hash is zero or set to the Keccak256 hash of the empty string `&quot;&quot;`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - balance is zero</span>
<span class="term-fg32">+    &#47;&#47;&#47; - nonce is zero</span>
<span class="term-fg32">+    pub fn is_empty(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        let code_empty = self.is_empty_code_hash() || self.code_hash.is_zero();</span>
<span class="term-fg32">+        code_empty &amp;&amp; self.balance.is_zero() &amp;&amp; self.nonce == 0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if the account is not empty.</span>
<span class="term-fg32">+    pub fn exists(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        !self.is_empty()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if account has no nonce and code.</span>
<span class="term-fg32">+    pub fn has_no_code_and_nonce(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.is_empty_code_hash() &amp;&amp; self.nonce == 0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return bytecode hash associated with this account.</span>
<span class="term-fg32">+    &#47;&#47;&#47; If account does not have code, it returns `KECCAK_EMPTY` hash.</span>
<span class="term-fg32">+    pub const fn code_hash(&amp;self) -&gt; B256 {</span>
<span class="term-fg32">+        self.code_hash</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns true if the code hash is the Keccak256 hash of the empty string `&quot;&quot;`.</span>
<span class="term-fg32">+    #[inline]</span>
<span class="term-fg32">+    pub fn is_empty_code_hash(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.code_hash == KECCAK_EMPTY</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Take bytecode from account. Code will be set to None.</span>
<span class="term-fg32">+    pub fn take_bytecode(&amp;mut self) -&gt; Option&lt;Bytecode&gt; {</span>
<span class="term-fg32">+        self.code.take()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns a [`ScrollAccountInfo`] with only balance.</span>
<span class="term-fg32">+    pub fn from_balance(balance: U256) -&gt; Self {</span>
<span class="term-fg32">+        Self { balance, ..Default::default() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns a [`ScrollAccountInfo`] with defaults for balance and nonce.</span>
<span class="term-fg32">+    &#47;&#47;&#47; Computes the Keccak and Poseidon hash of the provided bytecode.</span>
<span class="term-fg32">+    pub fn from_bytecode(bytecode: Bytecode) -&gt; Self {</span>
<span class="term-fg32">+        let hash = bytecode.hash_slow();</span>
<span class="term-fg32">+        let code_size = bytecode.len() as u64;</span>
<span class="term-fg32">+        let poseidon_code_hash = hash_code(bytecode.bytecode());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            code: Some(bytecode),</span>
<span class="term-fg32">+            code_hash: hash,</span>
<span class="term-fg32">+            code_size,</span>
<span class="term-fg32">+            poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-724d1c50f7b2f605443721b0" role="button"
                       aria-expanded="false" aria-controls="id-724d1c50f7b2f605443721b0">
                        <code>crates/scroll/revm/src/states/bundle.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/revm/src/states/bundle.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+762</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-724d1c50f7b2f605443721b0"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..172e826fcab345d920eeba54edf1316531b97000</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle.rs</span>
<span class="term-fg36">@@ -0,0 +1,762 @@</span>
<span class="term-fg32">+use super::bundle_account::ScrollBundleAccount;</span>
<span class="term-fg32">+use crate::states::{</span>
<span class="term-fg32">+    changes::{ScrollPlainStateReverts, ScrollStateChangeset},</span>
<span class="term-fg32">+    reverts::ScrollReverts,</span>
<span class="term-fg32">+    ScrollAccountInfo, ScrollAccountInfoRevert, ScrollAccountRevert,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::{</span>
<span class="term-fg32">+        states::{PlainStorageChangeset, StorageSlot},</span>
<span class="term-fg32">+        AccountStatus, BundleState, OriginalValuesKnown, RevertToSlot,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    primitives::{</span>
<span class="term-fg32">+        map::{Entry, HashMap, HashSet},</span>
<span class="term-fg32">+        Address, Bytecode, B256, KECCAK_EMPTY, U256,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use std::{</span>
<span class="term-fg32">+    collections::{hash_map, BTreeMap, BTreeSet},</span>
<span class="term-fg32">+    ops::RangeInclusive,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A code copy of the [`BundleState`] modified with Scroll compatible fields.</span>
<span class="term-fg32">+#[derive(Default, Debug, Clone, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollBundleState {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account state.</span>
<span class="term-fg32">+    pub state: HashMap&lt;Address, ScrollBundleAccount&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; All created contracts in this block.</span>
<span class="term-fg32">+    pub contracts: HashMap&lt;B256, Bytecode&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Changes to revert.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note: Inside vector is *not* sorted by address.</span>
<span class="term-fg32">+    &#47;&#47;&#47; But it is unique by address.</span>
<span class="term-fg32">+    pub reverts: ScrollReverts,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The size of the plain state in the bundle state.</span>
<span class="term-fg32">+    pub state_size: usize,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The size of reverts in the bundle state.</span>
<span class="term-fg32">+    pub reverts_size: usize,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(BundleState, &amp;ScrollPostExecutionContext)&gt; for ScrollBundleState {</span>
<span class="term-fg32">+    fn from((bundle, context): (BundleState, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        &#47;&#47; we need to clone the reverts because there is no way to take ownership of</span>
<span class="term-fg32">+        &#47;&#47; the inner Vec from the `Reverts` wrapper.</span>
<span class="term-fg32">+        let reverts = bundle</span>
<span class="term-fg32">+            .reverts</span>
<span class="term-fg32">+            .iter()</span>
<span class="term-fg32">+            .map(|reverts| {</span>
<span class="term-fg32">+                reverts</span>
<span class="term-fg32">+                    .iter()</span>
<span class="term-fg32">+                    .map(|(add, revert)| (*add, (revert.clone(), context).into()))</span>
<span class="term-fg32">+                    .collect()</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let state = bundle</span>
<span class="term-fg32">+            .state</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|(add, account)| (add, (account, context).into()))</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            contracts: bundle.contracts,</span>
<span class="term-fg32">+            reverts: ScrollReverts::new(reverts),</span>
<span class="term-fg32">+            state_size: bundle.state_size,</span>
<span class="term-fg32">+            reverts_size: bundle.reverts_size,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl From&lt;BundleState&gt; for ScrollBundleState {</span>
<span class="term-fg32">+    fn from(bundle: BundleState) -&gt; Self {</span>
<span class="term-fg32">+        (bundle, &amp;ScrollPostExecutionContext::default()).into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+#[cfg(any(not(feature = &quot;scroll&quot;), feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl From&lt;(BundleState, &amp;())&gt; for ScrollBundleState {</span>
<span class="term-fg32">+    fn from((bundle, _): (BundleState, &amp;())) -&gt; Self {</span>
<span class="term-fg32">+        bundle.into()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollBundleState {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return builder instance for further manipulation</span>
<span class="term-fg32">+    pub fn builder(revert_range: RangeInclusive&lt;u64&gt;) -&gt; ScrollBundleBuilder {</span>
<span class="term-fg32">+        ScrollBundleBuilder::new(revert_range)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create it with new and old values of both Storage and [`ScrollAccountInfo`].</span>
<span class="term-fg32">+    pub fn new(</span>
<span class="term-fg32">+        state: impl IntoIterator&lt;</span>
<span class="term-fg32">+            Item = (</span>
<span class="term-fg32">+                Address,</span>
<span class="term-fg32">+                Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+                Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+                HashMap&lt;U256, (U256, U256)&gt;,</span>
<span class="term-fg32">+            ),</span>
<span class="term-fg32">+        &gt;,</span>
<span class="term-fg32">+        reverts: impl IntoIterator&lt;</span>
<span class="term-fg32">+            Item = impl IntoIterator&lt;</span>
<span class="term-fg32">+                Item = (</span>
<span class="term-fg32">+                    Address,</span>
<span class="term-fg32">+                    Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;,</span>
<span class="term-fg32">+                    impl IntoIterator&lt;Item = (U256, U256)&gt;,</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+            &gt;,</span>
<span class="term-fg32">+        &gt;,</span>
<span class="term-fg32">+        contracts: impl IntoIterator&lt;Item = (B256, Bytecode)&gt;,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        &#47;&#47; Create state from iterator.</span>
<span class="term-fg32">+        let mut state_size = 0;</span>
<span class="term-fg32">+        let state = state</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|(address, original, present, storage)| {</span>
<span class="term-fg32">+                let account = ScrollBundleAccount::new(</span>
<span class="term-fg32">+                    original,</span>
<span class="term-fg32">+                    present,</span>
<span class="term-fg32">+                    storage</span>
<span class="term-fg32">+                        .into_iter()</span>
<span class="term-fg32">+                        .map(|(k, (o_val, p_val))| (k, StorageSlot::new_changed(o_val, p_val)))</span>
<span class="term-fg32">+                        .collect(),</span>
<span class="term-fg32">+                    AccountStatus::Changed,</span>
<span class="term-fg32">+                );</span>
<span class="term-fg32">+                state_size += account.size_hint();</span>
<span class="term-fg32">+                (address, account)</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; Create reverts from iterator.</span>
<span class="term-fg32">+        let mut reverts_size = 0;</span>
<span class="term-fg32">+        let reverts = reverts</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|block_reverts| {</span>
<span class="term-fg32">+                block_reverts</span>
<span class="term-fg32">+                    .into_iter()</span>
<span class="term-fg32">+                    .map(|(address, account, storage)| {</span>
<span class="term-fg32">+                        let account = match account {</span>
<span class="term-fg32">+                            Some(Some(account)) =&gt; ScrollAccountInfoRevert::RevertTo(account),</span>
<span class="term-fg32">+                            Some(None) =&gt; ScrollAccountInfoRevert::DeleteIt,</span>
<span class="term-fg32">+                            None =&gt; ScrollAccountInfoRevert::DoNothing,</span>
<span class="term-fg32">+                        };</span>
<span class="term-fg32">+                        let revert = ScrollAccountRevert {</span>
<span class="term-fg32">+                            account,</span>
<span class="term-fg32">+                            storage: storage</span>
<span class="term-fg32">+                                .into_iter()</span>
<span class="term-fg32">+                                .map(|(k, v)| (k, RevertToSlot::Some(v)))</span>
<span class="term-fg32">+                                .collect(),</span>
<span class="term-fg32">+                            previous_status: AccountStatus::Changed,</span>
<span class="term-fg32">+                            wipe_storage: false,</span>
<span class="term-fg32">+                        };</span>
<span class="term-fg32">+                        reverts_size += revert.size_hint();</span>
<span class="term-fg32">+                        (address, revert)</span>
<span class="term-fg32">+                    })</span>
<span class="term-fg32">+                    .collect::&lt;Vec&lt;_&gt;&gt;()</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect::&lt;Vec&lt;_&gt;&gt;();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            contracts: contracts.into_iter().collect(),</span>
<span class="term-fg32">+            reverts: ScrollReverts::new(reverts),</span>
<span class="term-fg32">+            state_size,</span>
<span class="term-fg32">+            reverts_size,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns the approximate size of changes in the bundle state.</span>
<span class="term-fg32">+    &#47;&#47;&#47; The estimation is not precise, because the information about the number of</span>
<span class="term-fg32">+    &#47;&#47;&#47; destroyed entries that need to be removed is not accessible to the bundle state.</span>
<span class="term-fg32">+    pub fn size_hint(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.state_size + self.reverts_size + self.contracts.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return reference to the state.</span>
<span class="term-fg32">+    pub const fn state(&amp;self) -&gt; &amp;HashMap&lt;Address, ScrollBundleAccount&gt; {</span>
<span class="term-fg32">+        &amp;self.state</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Is bundle state empty.</span>
<span class="term-fg32">+    pub fn is_empty(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.len() == 0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return number of changed accounts.</span>
<span class="term-fg32">+    pub fn len(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        self.state.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Get account from state</span>
<span class="term-fg32">+    pub fn account(&amp;self, address: &amp;Address) -&gt; Option&lt;&amp;ScrollBundleAccount&gt; {</span>
<span class="term-fg32">+        self.state.get(address)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Get bytecode from state</span>
<span class="term-fg32">+    pub fn bytecode(&amp;self, hash: &amp;B256) -&gt; Option&lt;Bytecode&gt; {</span>
<span class="term-fg32">+        self.contracts.get(hash).cloned()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extend the bundle with other state</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Update the `other` state only if `other` is not flagged as destroyed.</span>
<span class="term-fg32">+    pub fn extend_state(&amp;mut self, other_state: HashMap&lt;Address, ScrollBundleAccount&gt;) {</span>
<span class="term-fg32">+        for (address, other_account) in other_state {</span>
<span class="term-fg32">+            match self.state.entry(address) {</span>
<span class="term-fg32">+                Entry::Occupied(mut entry) =&gt; {</span>
<span class="term-fg32">+                    let this = entry.get_mut();</span>
<span class="term-fg32">+                    self.state_size -= this.size_hint();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; if other was destroyed. replace `this` storage with</span>
<span class="term-fg32">+                    &#47;&#47; the `other one.</span>
<span class="term-fg32">+                    if other_account.was_destroyed() {</span>
<span class="term-fg32">+                        this.storage = other_account.storage;</span>
<span class="term-fg32">+                    } else {</span>
<span class="term-fg32">+                        &#47;&#47; otherwise extend this storage with other</span>
<span class="term-fg32">+                        for (key, storage_slot) in other_account.storage {</span>
<span class="term-fg32">+                            &#47;&#47; update present value or insert storage slot.</span>
<span class="term-fg32">+                            this.storage.entry(key).or_insert(storage_slot).present_value =</span>
<span class="term-fg32">+                                storage_slot.present_value;</span>
<span class="term-fg32">+                        }</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    this.info = other_account.info;</span>
<span class="term-fg32">+                    this.status.transition(other_account.status);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; Update the state size</span>
<span class="term-fg32">+                    self.state_size += this.size_hint();</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                hash_map::Entry::Vacant(entry) =&gt; {</span>
<span class="term-fg32">+                    &#47;&#47; just insert if empty</span>
<span class="term-fg32">+                    self.state_size += other_account.size_hint();</span>
<span class="term-fg32">+                    entry.insert(other_account);</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extend the state with state that is build on top of it.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If storage was wiped in `other` state, copy `this` plain state</span>
<span class="term-fg32">+    &#47;&#47;&#47; and put it inside `other` revert (if there is no duplicates of course).</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If `this` and `other` accounts were both destroyed invalidate second</span>
<span class="term-fg32">+    &#47;&#47;&#47; wipe flag (from `other`). As wiping from database should be done only once</span>
<span class="term-fg32">+    &#47;&#47;&#47; and we already transferred all potentially missing storages to the `other` revert.</span>
<span class="term-fg32">+    pub fn extend(&amp;mut self, mut other: Self) {</span>
<span class="term-fg32">+        &#47;&#47; iterate over reverts and if its storage is wiped try to add previous bundle</span>
<span class="term-fg32">+        &#47;&#47; state as there is potential missing slots.</span>
<span class="term-fg32">+        for (address, revert) in other.reverts.iter_mut().flatten() {</span>
<span class="term-fg32">+            if revert.wipe_storage {</span>
<span class="term-fg32">+                &#47;&#47; If there is wipe storage in `other` revert</span>
<span class="term-fg32">+                &#47;&#47; we need to move storage from present state.</span>
<span class="term-fg32">+                if let Some(this_account) = self.state.get_mut(address) {</span>
<span class="term-fg32">+                    &#47;&#47; As this account was destroyed inside `other` bundle.</span>
<span class="term-fg32">+                    &#47;&#47; we are fine to wipe&#47;drain this storage and put it inside revert.</span>
<span class="term-fg32">+                    for (key, value) in this_account.storage.drain() {</span>
<span class="term-fg32">+                        revert</span>
<span class="term-fg32">+                            .storage</span>
<span class="term-fg32">+                            .entry(key)</span>
<span class="term-fg32">+                            .or_insert(RevertToSlot::Some(value.present_value));</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                    &#47;&#47; nullify `other` wipe as primary database wipe is done in `this`.</span>
<span class="term-fg32">+                    if this_account.was_destroyed() {</span>
<span class="term-fg32">+                        revert.wipe_storage = false;</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; Increment reverts size for each of the updated reverts.</span>
<span class="term-fg32">+            self.reverts_size += revert.size_hint();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        &#47;&#47; Extension of state</span>
<span class="term-fg32">+        self.extend_state(other.state);</span>
<span class="term-fg32">+        &#47;&#47; Contract can be just extended, when counter is introduced we will take into account that.</span>
<span class="term-fg32">+        self.contracts.extend(other.contracts);</span>
<span class="term-fg32">+        &#47;&#47; Reverts can be just extended</span>
<span class="term-fg32">+        self.reverts.extend(other.reverts);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Generate a [`ScrollStateChangeset`] from the bundle state without consuming</span>
<span class="term-fg32">+    &#47;&#47;&#47; it.</span>
<span class="term-fg32">+    pub fn to_plain_state(&amp;self, is_value_known: OriginalValuesKnown) -&gt; ScrollStateChangeset {</span>
<span class="term-fg32">+        &#47;&#47; pessimistically pre-allocate assuming _all_ accounts changed.</span>
<span class="term-fg32">+        let state_len = self.state.len();</span>
<span class="term-fg32">+        let mut accounts = Vec::with_capacity(state_len);</span>
<span class="term-fg32">+        let mut storage = Vec::with_capacity(state_len);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        for (address, account) in &amp;self.state {</span>
<span class="term-fg32">+            &#47;&#47; append account info if it is changed.</span>
<span class="term-fg32">+            let was_destroyed = account.was_destroyed();</span>
<span class="term-fg32">+            if is_value_known.is_not_known() || account.is_info_changed() {</span>
<span class="term-fg32">+                let info = account.info.as_ref().map(ScrollAccountInfo::copy_without_code);</span>
<span class="term-fg32">+                accounts.push((*address, info));</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; append storage changes</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            &#47;&#47; NOTE: Assumption is that revert is going to remove whole plain storage from</span>
<span class="term-fg32">+            &#47;&#47; database so we can check if plain state was wiped or not.</span>
<span class="term-fg32">+            let mut account_storage_changed = Vec::with_capacity(account.storage.len());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            for (key, slot) in account.storage.iter().map(|(k, v)| (*k, *v)) {</span>
<span class="term-fg32">+                &#47;&#47; If storage was destroyed that means that storage was wiped.</span>
<span class="term-fg32">+                &#47;&#47; In that case we need to check if present storage value is different then ZERO.</span>
<span class="term-fg32">+                let destroyed_and_not_zero = was_destroyed &amp;&amp; !slot.present_value.is_zero();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                &#47;&#47; If account is not destroyed check if original values was changed,</span>
<span class="term-fg32">+                &#47;&#47; so we can update it.</span>
<span class="term-fg32">+                let not_destroyed_and_changed = !was_destroyed &amp;&amp; slot.is_changed();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+                if is_value_known.is_not_known() ||</span>
<span class="term-fg32">+                    destroyed_and_not_zero ||</span>
<span class="term-fg32">+                    not_destroyed_and_changed</span>
<span class="term-fg32">+                {</span>
<span class="term-fg32">+                    account_storage_changed.push((key, slot.present_value));</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            if !account_storage_changed.is_empty() || was_destroyed {</span>
<span class="term-fg32">+                &#47;&#47; append storage changes to account.</span>
<span class="term-fg32">+                storage.push(PlainStorageChangeset {</span>
<span class="term-fg32">+                    address: *address,</span>
<span class="term-fg32">+                    wipe_storage: was_destroyed,</span>
<span class="term-fg32">+                    storage: account_storage_changed,</span>
<span class="term-fg32">+                });</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let contracts = self</span>
<span class="term-fg32">+            .contracts</span>
<span class="term-fg32">+            .iter()</span>
<span class="term-fg32">+            &#47;&#47; remove empty bytecodes</span>
<span class="term-fg32">+            .filter(|(b, _)| **b != KECCAK_EMPTY)</span>
<span class="term-fg32">+            .map(|(b, code)| (*b, code.clone()))</span>
<span class="term-fg32">+            .collect::&lt;Vec&lt;_&gt;&gt;();</span>
<span class="term-fg32">+        ScrollStateChangeset { accounts, storage, contracts }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Generate a [`ScrollStateChangeset`] and [`ScrollPlainStateReverts`] from the bundle</span>
<span class="term-fg32">+    &#47;&#47;&#47; state.</span>
<span class="term-fg32">+    pub fn to_plain_state_and_reverts(</span>
<span class="term-fg32">+        &amp;self,</span>
<span class="term-fg32">+        is_value_known: OriginalValuesKnown,</span>
<span class="term-fg32">+    ) -&gt; (ScrollStateChangeset, ScrollPlainStateReverts) {</span>
<span class="term-fg32">+        (self.to_plain_state(is_value_known), self.reverts.to_plain_state_reverts())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Take first N raw reverts from the [`ScrollBundleState`].</span>
<span class="term-fg32">+    pub fn take_n_reverts(&amp;mut self, reverts_to_take: usize) -&gt; ScrollReverts {</span>
<span class="term-fg32">+        &#47;&#47; split is done as [0, num) and [num, len].</span>
<span class="term-fg32">+        if reverts_to_take &gt; self.reverts.len() {</span>
<span class="term-fg32">+            return self.take_all_reverts();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        let (detach, this) = self.reverts.split_at(reverts_to_take);</span>
<span class="term-fg32">+        let detached_reverts = ScrollReverts::new(detach.to_vec());</span>
<span class="term-fg32">+        self.reverts_size =</span>
<span class="term-fg32">+            this.iter().flatten().fold(0, |acc, (_, revert)| acc + revert.size_hint());</span>
<span class="term-fg32">+        self.reverts = ScrollReverts::new(this.to_vec());</span>
<span class="term-fg32">+        detached_reverts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return and clear all reverts from [`ScrollBundleState`]</span>
<span class="term-fg32">+    pub fn take_all_reverts(&amp;mut self) -&gt; ScrollReverts {</span>
<span class="term-fg32">+        self.reverts_size = 0;</span>
<span class="term-fg32">+        core::mem::take(&amp;mut self.reverts)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Reverts the state changes by N transitions back.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; See also [`Self::revert_latest`]</span>
<span class="term-fg32">+    pub fn revert(&amp;mut self, mut num_transitions: usize) {</span>
<span class="term-fg32">+        if num_transitions == 0 {</span>
<span class="term-fg32">+            return;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        while self.revert_latest() {</span>
<span class="term-fg32">+            num_transitions -= 1;</span>
<span class="term-fg32">+            if num_transitions == 0 {</span>
<span class="term-fg32">+                &#47;&#47; break the loop.</span>
<span class="term-fg32">+                break;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Reverts the state changes of the latest transition</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note: This is the same as `BundleState::revert(1)`</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns true if the state was reverted.</span>
<span class="term-fg32">+    pub fn revert_latest(&amp;mut self) -&gt; bool {</span>
<span class="term-fg32">+        &#47;&#47; revert the latest recorded state</span>
<span class="term-fg32">+        if let Some(reverts) = self.reverts.pop() {</span>
<span class="term-fg32">+            for (address, revert_account) in reverts {</span>
<span class="term-fg32">+                self.reverts_size -= revert_account.size_hint();</span>
<span class="term-fg32">+                match self.state.entry(address) {</span>
<span class="term-fg32">+                    Entry::Occupied(mut entry) =&gt; {</span>
<span class="term-fg32">+                        let account = entry.get_mut();</span>
<span class="term-fg32">+                        self.state_size -= account.size_hint();</span>
<span class="term-fg32">+                        if account.revert(revert_account) {</span>
<span class="term-fg32">+                            entry.remove();</span>
<span class="term-fg32">+                        } else {</span>
<span class="term-fg32">+                            self.state_size += account.size_hint();</span>
<span class="term-fg32">+                        }</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    Entry::Vacant(entry) =&gt; {</span>
<span class="term-fg32">+                        &#47;&#47; create empty account that we will revert on.</span>
<span class="term-fg32">+                        &#47;&#47; Only place where this account is not existing is if revert is DeleteIt.</span>
<span class="term-fg32">+                        let mut account = ScrollBundleAccount::new(</span>
<span class="term-fg32">+                            None,</span>
<span class="term-fg32">+                            None,</span>
<span class="term-fg32">+                            HashMap::default(),</span>
<span class="term-fg32">+                            AccountStatus::LoadedNotExisting,</span>
<span class="term-fg32">+                        );</span>
<span class="term-fg32">+                        if !account.revert(revert_account) {</span>
<span class="term-fg32">+                            self.state_size += account.size_hint();</span>
<span class="term-fg32">+                            entry.insert(account);</span>
<span class="term-fg32">+                        }</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            return true;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        false</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; This builder is used to help to facilitate the initialization of [`ScrollBundleState`] struct.</span>
<span class="term-fg32">+&#47;&#47;&#47; This is a code copy of the [`revm::db::states::BundleBuilder`] to accommodate the</span>
<span class="term-fg32">+&#47;&#47;&#47; [`ScrollBundleState`].</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollBundleBuilder {</span>
<span class="term-fg32">+    states: HashSet&lt;Address&gt;,</span>
<span class="term-fg32">+    state_original: HashMap&lt;Address, ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    state_present: HashMap&lt;Address, ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    state_storage: HashMap&lt;Address, HashMap&lt;U256, (U256, U256)&gt;&gt;,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    reverts: BTreeSet&lt;(u64, Address)&gt;,</span>
<span class="term-fg32">+    revert_range: RangeInclusive&lt;u64&gt;,</span>
<span class="term-fg32">+    revert_account: HashMap&lt;(u64, Address), Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;&gt;,</span>
<span class="term-fg32">+    revert_storage: HashMap&lt;(u64, Address), Vec&lt;(U256, U256)&gt;&gt;,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    contracts: HashMap&lt;B256, Bytecode&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Default for ScrollBundleBuilder {</span>
<span class="term-fg32">+    fn default() -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            states: HashSet::default(),</span>
<span class="term-fg32">+            state_original: HashMap::default(),</span>
<span class="term-fg32">+            state_present: HashMap::default(),</span>
<span class="term-fg32">+            state_storage: HashMap::default(),</span>
<span class="term-fg32">+            reverts: BTreeSet::new(),</span>
<span class="term-fg32">+            revert_range: 0..=0,</span>
<span class="term-fg32">+            revert_account: HashMap::default(),</span>
<span class="term-fg32">+            revert_storage: HashMap::default(),</span>
<span class="term-fg32">+            contracts: HashMap::default(),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollBundleBuilder {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create builder instance</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `revert_range` indicates the size of [`ScrollBundleState`] `reverts` field</span>
<span class="term-fg32">+    pub fn new(revert_range: RangeInclusive&lt;u64&gt;) -&gt; Self {</span>
<span class="term-fg32">+        Self { revert_range, ..Default::default() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Apply a transformation to the builder.</span>
<span class="term-fg32">+    pub fn apply&lt;F&gt;(self, f: F) -&gt; Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        F: FnOnce(Self) -&gt; Self,</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        f(self)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Apply a mutable transformation to the builder.</span>
<span class="term-fg32">+    pub fn apply_mut&lt;F&gt;(&amp;mut self, f: F) -&gt; &amp;mut Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        F: FnOnce(&amp;mut Self),</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+        f(self);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect address info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_address(mut self, address: Address) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_address(address);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect account info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_original_account_info(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        original: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_original_account_info(address, original);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect account info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_present_account_info(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        present: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_present_account_info(address, present);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect storage info of [`ScrollBundleState`] state</span>
<span class="term-fg32">+    pub fn state_storage(mut self, address: Address, storage: HashMap&lt;U256, (U256, U256)&gt;) -&gt; Self {</span>
<span class="term-fg32">+        self.set_state_storage(address, storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect address info of [`ScrollBundleState`] reverts</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `block_number` must respect `revert_range`, or the input</span>
<span class="term-fg32">+    &#47;&#47;&#47; will be ignored during the final build process</span>
<span class="term-fg32">+    pub fn revert_address(mut self, block_number: u64, address: Address) -&gt; Self {</span>
<span class="term-fg32">+        self.set_revert_address(block_number, address);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect account info of [`ScrollBundleState`] reverts</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `block_number` must respect `revert_range`, or the input</span>
<span class="term-fg32">+    &#47;&#47;&#47; will be ignored during the final build process</span>
<span class="term-fg32">+    pub fn revert_account_info(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        account: Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_revert_account_info(block_number, address, account);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect storage info of [`ScrollBundleState`] reverts</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; `block_number` must respect `revert_range`, or the input</span>
<span class="term-fg32">+    &#47;&#47;&#47; will be ignored during the final build process</span>
<span class="term-fg32">+    pub fn revert_storage(</span>
<span class="term-fg32">+        mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        storage: Vec&lt;(U256, U256)&gt;,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        self.set_revert_storage(block_number, address, storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Collect contracts info</span>
<span class="term-fg32">+    pub fn contract(mut self, address: B256, bytecode: Bytecode) -&gt; Self {</span>
<span class="term-fg32">+        self.set_contract(address, bytecode);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set address info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_address(&amp;mut self, address: Address) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set original account info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_original_account_info(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        original: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self.state_original.insert(address, original);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set present account info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_present_account_info(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        present: ScrollAccountInfo,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self.state_present.insert(address, present);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set storage info of [`ScrollBundleState`] state.</span>
<span class="term-fg32">+    pub fn set_state_storage(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        storage: HashMap&lt;U256, (U256, U256)&gt;,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.states.insert(address);</span>
<span class="term-fg32">+        self.state_storage.insert(address, storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set address info of [`ScrollBundleState`] reverts.</span>
<span class="term-fg32">+    pub fn set_revert_address(&amp;mut self, block_number: u64, address: Address) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.reverts.insert((block_number, address));</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set account info of [`ScrollBundleState`] reverts.</span>
<span class="term-fg32">+    pub fn set_revert_account_info(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        account: Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.reverts.insert((block_number, address));</span>
<span class="term-fg32">+        self.revert_account.insert((block_number, address), account);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set storage info of [`ScrollBundleState`] reverts.</span>
<span class="term-fg32">+    pub fn set_revert_storage(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        block_number: u64,</span>
<span class="term-fg32">+        address: Address,</span>
<span class="term-fg32">+        storage: Vec&lt;(U256, U256)&gt;,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.reverts.insert((block_number, address));</span>
<span class="term-fg32">+        self.revert_storage.insert((block_number, address), storage);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Set contracts info.</span>
<span class="term-fg32">+    pub fn set_contract(&amp;mut self, address: B256, bytecode: Bytecode) -&gt; &amp;mut Self {</span>
<span class="term-fg32">+        self.contracts.insert(address, bytecode);</span>
<span class="term-fg32">+        self</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create [`ScrollBundleState`] instance based on collected information</span>
<span class="term-fg32">+    pub fn build(mut self) -&gt; ScrollBundleState {</span>
<span class="term-fg32">+        let mut state_size = 0;</span>
<span class="term-fg32">+        let state = self</span>
<span class="term-fg32">+            .states</span>
<span class="term-fg32">+            .into_iter()</span>
<span class="term-fg32">+            .map(|address| {</span>
<span class="term-fg32">+                let storage = self</span>
<span class="term-fg32">+                    .state_storage</span>
<span class="term-fg32">+                    .remove(&amp;address)</span>
<span class="term-fg32">+                    .map(|s| {</span>
<span class="term-fg32">+                        s.into_iter()</span>
<span class="term-fg32">+                            .map(|(k, (o_val, p_val))| (k, StorageSlot::new_changed(o_val, p_val)))</span>
<span class="term-fg32">+                            .collect()</span>
<span class="term-fg32">+                    })</span>
<span class="term-fg32">+                    .unwrap_or_default();</span>
<span class="term-fg32">+                let bundle_account = ScrollBundleAccount::new(</span>
<span class="term-fg32">+                    self.state_original.remove(&amp;address),</span>
<span class="term-fg32">+                    self.state_present.remove(&amp;address),</span>
<span class="term-fg32">+                    storage,</span>
<span class="term-fg32">+                    AccountStatus::Changed,</span>
<span class="term-fg32">+                );</span>
<span class="term-fg32">+                state_size += bundle_account.size_hint();</span>
<span class="term-fg32">+                (address, bundle_account)</span>
<span class="term-fg32">+            })</span>
<span class="term-fg32">+            .collect();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut reverts_size = 0;</span>
<span class="term-fg32">+        let mut reverts_map = BTreeMap::new();</span>
<span class="term-fg32">+        for block_number in self.revert_range {</span>
<span class="term-fg32">+            reverts_map.insert(block_number, Vec::new());</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        self.reverts.into_iter().for_each(|(block_number, address)| {</span>
<span class="term-fg32">+            let account =</span>
<span class="term-fg32">+                match self.revert_account.remove(&amp;(block_number, address)).unwrap_or_default() {</span>
<span class="term-fg32">+                    Some(Some(account)) =&gt; ScrollAccountInfoRevert::RevertTo(account),</span>
<span class="term-fg32">+                    Some(None) =&gt; ScrollAccountInfoRevert::DeleteIt,</span>
<span class="term-fg32">+                    None =&gt; ScrollAccountInfoRevert::DoNothing,</span>
<span class="term-fg32">+                };</span>
<span class="term-fg32">+            let storage = self</span>
<span class="term-fg32">+                .revert_storage</span>
<span class="term-fg32">+                .remove(&amp;(block_number, address))</span>
<span class="term-fg32">+                .map(|s| s.into_iter().map(|(k, v)| (k, RevertToSlot::Some(v))).collect())</span>
<span class="term-fg32">+                .unwrap_or_default();</span>
<span class="term-fg32">+            let account_revert = ScrollAccountRevert {</span>
<span class="term-fg32">+                account,</span>
<span class="term-fg32">+                storage,</span>
<span class="term-fg32">+                previous_status: AccountStatus::Changed,</span>
<span class="term-fg32">+                wipe_storage: false,</span>
<span class="term-fg32">+            };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+            if reverts_map.contains_key(&amp;block_number) {</span>
<span class="term-fg32">+                reverts_size += account_revert.size_hint();</span>
<span class="term-fg32">+                reverts_map</span>
<span class="term-fg32">+                    .entry(block_number)</span>
<span class="term-fg32">+                    .or_insert(Vec::new())</span>
<span class="term-fg32">+                    .push((address, account_revert));</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        });</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        ScrollBundleState {</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            contracts: self.contracts,</span>
<span class="term-fg32">+            reverts: ScrollReverts::new(reverts_map.into_values().collect()),</span>
<span class="term-fg32">+            state_size,</span>
<span class="term-fg32">+            reverts_size,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Getter for `states` field</span>
<span class="term-fg32">+    pub const fn get_states(&amp;self) -&gt; &amp;HashSet&lt;Address&gt; {</span>
<span class="term-fg32">+        &amp;self.states</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `states` field</span>
<span class="term-fg32">+    pub fn get_states_mut(&amp;mut self) -&gt; &amp;mut HashSet&lt;Address&gt; {</span>
<span class="term-fg32">+        &amp;mut self.states</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `state_original` field</span>
<span class="term-fg32">+    pub fn get_state_original_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;Address, ScrollAccountInfo&gt; {</span>
<span class="term-fg32">+        &amp;mut self.state_original</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `state_present` field</span>
<span class="term-fg32">+    pub fn get_state_present_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;Address, ScrollAccountInfo&gt; {</span>
<span class="term-fg32">+        &amp;mut self.state_present</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `state_storage` field</span>
<span class="term-fg32">+    pub fn get_state_storage_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;Address, HashMap&lt;U256, (U256, U256)&gt;&gt; {</span>
<span class="term-fg32">+        &amp;mut self.state_storage</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `reverts` field</span>
<span class="term-fg32">+    pub fn get_reverts_mut(&amp;mut self) -&gt; &amp;mut BTreeSet&lt;(u64, Address)&gt; {</span>
<span class="term-fg32">+        &amp;mut self.reverts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `revert_range` field</span>
<span class="term-fg32">+    pub fn get_revert_range_mut(&amp;mut self) -&gt; &amp;mut RangeInclusive&lt;u64&gt; {</span>
<span class="term-fg32">+        &amp;mut self.revert_range</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `revert_account` field</span>
<span class="term-fg32">+    pub fn get_revert_account_mut(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+    ) -&gt; &amp;mut HashMap&lt;(u64, Address), Option&lt;Option&lt;ScrollAccountInfo&gt;&gt;&gt; {</span>
<span class="term-fg32">+        &amp;mut self.revert_account</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `revert_storage` field</span>
<span class="term-fg32">+    pub fn get_revert_storage_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;(u64, Address), Vec&lt;(U256, U256)&gt;&gt; {</span>
<span class="term-fg32">+        &amp;mut self.revert_storage</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Mutable getter for `contracts` field</span>
<span class="term-fg32">+    pub fn get_contracts_mut(&amp;mut self) -&gt; &amp;mut HashMap&lt;B256, Bytecode&gt; {</span>
<span class="term-fg32">+        &amp;mut self.contracts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c8e9e64df4b86fd907ec8540" role="button"
                       aria-expanded="false" aria-controls="id-c8e9e64df4b86fd907ec8540">
                        <code>crates/scroll/revm/src/states/bundle_account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/revm/src/states/bundle_account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+130</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c8e9e64df4b86fd907ec8540"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle_account.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle_account.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..29be890314d719b72b67dcb41e3375334d2777ce</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;bundle_account.rs</span>
<span class="term-fg36">@@ -0,0 +1,130 @@</span>
<span class="term-fg32">+use crate::states::{ScrollAccountInfo, ScrollAccountInfoRevert, ScrollAccountRevert};</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::{</span>
<span class="term-fg32">+        states::StorageSlot, AccountStatus, BundleAccount, RevertToSlot, StorageWithOriginalValues,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    interpreter::primitives::U256,</span>
<span class="term-fg32">+    primitives::map::HashMap,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; The scroll account bundle. Originally defined in [`BundleAccount`], a</span>
<span class="term-fg32">+&#47;&#47;&#47; scroll version of the bundle is needed for the [`crate::states::ScrollBundleState`].</span>
<span class="term-fg32">+#[derive(Debug, Clone, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollBundleAccount {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The current account&#39;s information</span>
<span class="term-fg32">+    pub info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The original account&#39;s information</span>
<span class="term-fg32">+    pub original_info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Contains both original and present state.</span>
<span class="term-fg32">+    &#47;&#47;&#47; When extracting changeset we compare if original value is different from present value.</span>
<span class="term-fg32">+    &#47;&#47;&#47; If it is different we add it to changeset.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; If Account was destroyed we ignore original value and compare present state with</span>
<span class="term-fg32">+    &#47;&#47;&#47; [`U256::ZERO`].</span>
<span class="term-fg32">+    pub storage: StorageWithOriginalValues,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account status.</span>
<span class="term-fg32">+    pub status: AccountStatus,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(BundleAccount, &amp;ScrollPostExecutionContext)&gt; for ScrollBundleAccount {</span>
<span class="term-fg32">+    fn from((account, context): (BundleAccount, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        let info = account.info.map(|info| (info, context).into());</span>
<span class="term-fg32">+        let original_info = account.original_info.map(|info| (info, context).into());</span>
<span class="term-fg32">+        Self { info, original_info, storage: account.storage, status: account.status }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollBundleAccount {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a [`ScrollBundleAccount`].</span>
<span class="term-fg32">+    pub const fn new(</span>
<span class="term-fg32">+        original_info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+        present_info: Option&lt;ScrollAccountInfo&gt;,</span>
<span class="term-fg32">+        storage: StorageWithOriginalValues,</span>
<span class="term-fg32">+        status: AccountStatus,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
<span class="term-fg32">+        Self { info: present_info, original_info, storage, status }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; The approximate size of changes needed to store this account.</span>
<span class="term-fg32">+    &#47;&#47;&#47; `1 + storage_len`</span>
<span class="term-fg32">+    pub fn size_hint(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        1 + self.storage.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return storage slot if it exists.</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; In case we know that account is newly created or destroyed, return `Some(U256::ZERO)`</span>
<span class="term-fg32">+    pub fn storage_slot(&amp;self, slot: U256) -&gt; Option&lt;U256&gt; {</span>
<span class="term-fg32">+        let slot = self.storage.get(&amp;slot).map(|s| s.present_value);</span>
<span class="term-fg32">+        if slot.is_some() {</span>
<span class="term-fg32">+            slot</span>
<span class="term-fg32">+        } else if self.status.is_storage_known() {</span>
<span class="term-fg32">+            Some(U256::ZERO)</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            None</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Fetch account info if it exists.</span>
<span class="term-fg32">+    pub fn account_info(&amp;self) -&gt; Option&lt;ScrollAccountInfo&gt; {</span>
<span class="term-fg32">+        self.info.clone()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Was this account destroyed.</span>
<span class="term-fg32">+    pub fn was_destroyed(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.status.was_destroyed()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return true of account info was changed.</span>
<span class="term-fg32">+    pub fn is_info_changed(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.info != self.original_info</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Return true if contract was changed</span>
<span class="term-fg32">+    pub fn is_contract_changed(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.info.as_ref().map(|a| a.code_hash) != self.original_info.as_ref().map(|a| a.code_hash)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Revert account to previous state and return true if account can be removed.</span>
<span class="term-fg32">+    pub fn revert(&amp;mut self, revert: ScrollAccountRevert) -&gt; bool {</span>
<span class="term-fg32">+        self.status = revert.previous_status;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        match revert.account {</span>
<span class="term-fg32">+            ScrollAccountInfoRevert::DoNothing =&gt; (),</span>
<span class="term-fg32">+            ScrollAccountInfoRevert::DeleteIt =&gt; {</span>
<span class="term-fg32">+                self.info = None;</span>
<span class="term-fg32">+                if self.original_info.is_none() {</span>
<span class="term-fg32">+                    self.storage = HashMap::default();</span>
<span class="term-fg32">+                    return true;</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                &#47;&#47; set all storage to zero but preserve original values.</span>
<span class="term-fg32">+                self.storage.iter_mut().for_each(|(_, v)| {</span>
<span class="term-fg32">+                    v.present_value = U256::ZERO;</span>
<span class="term-fg32">+                });</span>
<span class="term-fg32">+                return false;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            ScrollAccountInfoRevert::RevertTo(info) =&gt; self.info = Some(info),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        &#47;&#47; revert storage</span>
<span class="term-fg32">+        for (key, slot) in revert.storage {</span>
<span class="term-fg32">+            match slot {</span>
<span class="term-fg32">+                RevertToSlot::Some(value) =&gt; {</span>
<span class="term-fg32">+                    &#47;&#47; Don&#39;t overwrite original values if present</span>
<span class="term-fg32">+                    &#47;&#47; if storage is not present set original value as current value.</span>
<span class="term-fg32">+                    self.storage</span>
<span class="term-fg32">+                        .entry(key)</span>
<span class="term-fg32">+                        .or_insert_with(|| StorageSlot::new(value))</span>
<span class="term-fg32">+                        .present_value = value;</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                RevertToSlot::Destroyed =&gt; {</span>
<span class="term-fg32">+                    &#47;&#47; if it was destroyed this means that storage was created and we need to remove</span>
<span class="term-fg32">+                    &#47;&#47; it.</span>
<span class="term-fg32">+                    self.storage.remove(&amp;key);</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        false</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b895dc1ff080799a3c3b7899" role="button"
                       aria-expanded="false" aria-controls="id-b895dc1ff080799a3c3b7899">
                        <code>crates/scroll/revm/src/states/changes.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/revm/src/states/changes.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+67</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b895dc1ff080799a3c3b7899"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;changes.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;changes.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5343d47c9e03b1be347c872d2cc38ea67a1c5972</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;changes.rs</span>
<span class="term-fg36">@@ -0,0 +1,67 @@</span>
<span class="term-fg32">+use crate::states::ScrollAccountInfo;</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::states::{PlainStateReverts, PlainStorageChangeset, PlainStorageRevert, StateChangeset},</span>
<span class="term-fg32">+    primitives::{Address, Bytecode, B256},</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy equivalent of the [`StateChangeset`] to accommodate for the [`ScrollAccountInfo`].</span>
<span class="term-fg32">+#[derive(Debug)]</span>
<span class="term-fg32">+pub struct ScrollStateChangeset {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of **not** sorted accounts information.</span>
<span class="term-fg32">+    pub accounts: Vec&lt;(Address, Option&lt;ScrollAccountInfo&gt;)&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of **not** sorted storage.</span>
<span class="term-fg32">+    pub storage: Vec&lt;PlainStorageChangeset&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of contracts by bytecode hash. **not** sorted.</span>
<span class="term-fg32">+    pub contracts: Vec&lt;(B256, Bytecode)&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(StateChangeset, &amp;ScrollPostExecutionContext)&gt; for ScrollStateChangeset {</span>
<span class="term-fg32">+    fn from((changeset, context): (StateChangeset, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: changeset</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|(add, acc)| (add, acc.map(|a| (a, context).into())))</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: changeset.storage,</span>
<span class="term-fg32">+            contracts: changeset.contracts,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of the [`PlainStateReverts`] to accommodate for [`ScrollAccountInfo`].</span>
<span class="term-fg32">+#[derive(Clone, Debug, Default)]</span>
<span class="term-fg32">+pub struct ScrollPlainStateReverts {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of account with removed contracts bytecode</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note: If [`ScrollAccountInfo`] is None means that account needs to be removed.</span>
<span class="term-fg32">+    pub accounts: Vec&lt;Vec&lt;(Address, Option&lt;ScrollAccountInfo&gt;)&gt;&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Vector of storage with its address.</span>
<span class="term-fg32">+    pub storage: Vec&lt;Vec&lt;PlainStorageRevert&gt;&gt;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(PlainStateReverts, &amp;ScrollPostExecutionContext)&gt; for ScrollPlainStateReverts {</span>
<span class="term-fg32">+    fn from((reverts, context): (PlainStateReverts, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: reverts</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|accounts| {</span>
<span class="term-fg32">+                    accounts</span>
<span class="term-fg32">+                        .into_iter()</span>
<span class="term-fg32">+                        .map(|(add, acc)| (add, acc.map(|a| (a, context).into())))</span>
<span class="term-fg32">+                        .collect()</span>
<span class="term-fg32">+                })</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: reverts.storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollPlainStateReverts {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Constructs new [`ScrollPlainStateReverts`] with pre-allocated capacity.</span>
<span class="term-fg32">+    pub fn with_capacity(capacity: usize) -&gt; Self {</span>
<span class="term-fg32">+        Self { accounts: Vec::with_capacity(capacity), storage: Vec::with_capacity(capacity) }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-23181387cedfbe118094fb79" role="button"
                       aria-expanded="false" aria-controls="id-23181387cedfbe118094fb79">
                        <code>crates/scroll/revm/src/states/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/revm/src/states/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-23181387cedfbe118094fb79"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;mod.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;mod.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..c6f9e969f8052c7920530aa1a2babd1aead61a63</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;mod.rs</span>
<span class="term-fg36">@@ -0,0 +1,16 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll `revm` states types redefinitions.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use account_info::ScrollAccountInfo;</span>
<span class="term-fg32">+mod account_info;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use bundle::{ScrollBundleBuilder, ScrollBundleState};</span>
<span class="term-fg32">+mod bundle;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use bundle_account::ScrollBundleAccount;</span>
<span class="term-fg32">+mod bundle_account;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use changes::{ScrollPlainStateReverts, ScrollStateChangeset};</span>
<span class="term-fg32">+mod changes;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+pub use reverts::{ScrollAccountInfoRevert, ScrollAccountRevert, ScrollReverts};</span>
<span class="term-fg32">+mod reverts;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-71d167a49580e98dd4c06b86" role="button"
                       aria-expanded="false" aria-controls="id-71d167a49580e98dd4c06b86">
                        <code>crates/scroll/revm/src/states/reverts.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/revm/src/states/reverts.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+153</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-71d167a49580e98dd4c06b86"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;reverts.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;reverts.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..e10034000d8bb3e8cb724f96e93438c527b6236a</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;states&#47;reverts.rs</span>
<span class="term-fg36">@@ -0,0 +1,153 @@</span>
<span class="term-fg32">+use crate::states::{changes::ScrollPlainStateReverts, ScrollAccountInfo};</span>
<span class="term-fg32">+use reth_scroll_primitives::ScrollPostExecutionContext;</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    db::{</span>
<span class="term-fg32">+        states::{reverts::AccountInfoRevert, PlainStorageRevert},</span>
<span class="term-fg32">+        AccountRevert, AccountStatus, RevertToSlot,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    primitives::{map::HashMap, Address, U256},</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use std::ops::{Deref, DerefMut};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of a [`revm::db::states::reverts::Reverts`] compatible with the</span>
<span class="term-fg32">+&#47;&#47;&#47; [`crate::states::ScrollBundleState`].</span>
<span class="term-fg32">+#[derive(Clone, Debug, Default, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollReverts(Vec&lt;Vec&lt;(Address, ScrollAccountRevert)&gt;&gt;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl Deref for ScrollReverts {</span>
<span class="term-fg32">+    type Target = Vec&lt;Vec&lt;(Address, ScrollAccountRevert)&gt;&gt;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn deref(&amp;self) -&gt; &amp;Self::Target {</span>
<span class="term-fg32">+        &amp;self.0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl DerefMut for ScrollReverts {</span>
<span class="term-fg32">+    fn deref_mut(&amp;mut self) -&gt; &amp;mut Self::Target {</span>
<span class="term-fg32">+        &amp;mut self.0</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollReverts {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Create new reverts</span>
<span class="term-fg32">+    pub const fn new(reverts: Vec&lt;Vec&lt;(Address, ScrollAccountRevert)&gt;&gt;) -&gt; Self {</span>
<span class="term-fg32">+        Self(reverts)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Extend reverts with other reverts.</span>
<span class="term-fg32">+    pub fn extend(&amp;mut self, other: Self) {</span>
<span class="term-fg32">+        self.0.extend(other.0);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Sort account inside transition by their address.</span>
<span class="term-fg32">+    pub fn sort(&amp;mut self) {</span>
<span class="term-fg32">+        for revert in &amp;mut self.0 {</span>
<span class="term-fg32">+            revert.sort_by_key(|(address, _)| *address);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Generate a [`ScrollPlainStateReverts`].</span>
<span class="term-fg32">+    &#47;&#47;&#47;</span>
<span class="term-fg32">+    &#47;&#47;&#47; Note that account are sorted by address.</span>
<span class="term-fg32">+    pub fn to_plain_state_reverts(&amp;self) -&gt; ScrollPlainStateReverts {</span>
<span class="term-fg32">+        let mut state_reverts = ScrollPlainStateReverts::with_capacity(self.0.len());</span>
<span class="term-fg32">+        for reverts in &amp;self.0 {</span>
<span class="term-fg32">+            &#47;&#47; pessimistically pre-allocate assuming _all_ accounts changed.</span>
<span class="term-fg32">+            let mut accounts = Vec::with_capacity(reverts.len());</span>
<span class="term-fg32">+            let mut storage = Vec::with_capacity(reverts.len());</span>
<span class="term-fg32">+            for (address, revert_account) in reverts {</span>
<span class="term-fg32">+                match &amp;revert_account.account {</span>
<span class="term-fg32">+                    ScrollAccountInfoRevert::RevertTo(acc) =&gt; {</span>
<span class="term-fg32">+                        &#47;&#47; cloning is cheap, because account info has 3 small</span>
<span class="term-fg32">+                        &#47;&#47; fields and a Bytes</span>
<span class="term-fg32">+                        accounts.push((*address, Some(acc.clone())))</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                    ScrollAccountInfoRevert::DeleteIt =&gt; accounts.push((*address, None)),</span>
<span class="term-fg32">+                    ScrollAccountInfoRevert::DoNothing =&gt; (),</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+                if revert_account.wipe_storage || !revert_account.storage.is_empty() {</span>
<span class="term-fg32">+                    storage.push(PlainStorageRevert {</span>
<span class="term-fg32">+                        address: *address,</span>
<span class="term-fg32">+                        wiped: revert_account.wipe_storage,</span>
<span class="term-fg32">+                        storage_revert: revert_account</span>
<span class="term-fg32">+                            .storage</span>
<span class="term-fg32">+                            .iter()</span>
<span class="term-fg32">+                            .map(|(k, v)| (*k, *v))</span>
<span class="term-fg32">+                            .collect::&lt;Vec&lt;_&gt;&gt;(),</span>
<span class="term-fg32">+                    });</span>
<span class="term-fg32">+                }</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            state_reverts.accounts.push(accounts);</span>
<span class="term-fg32">+            state_reverts.storage.push(storage);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        state_reverts</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of a [`AccountRevert`] compatible with  [`ScrollReverts`].</span>
<span class="term-fg32">+#[derive(Clone, Default, Debug, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub struct ScrollAccountRevert {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account info revert</span>
<span class="term-fg32">+    pub account: ScrollAccountInfoRevert,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Storage revert</span>
<span class="term-fg32">+    pub storage: HashMap&lt;U256, RevertToSlot&gt;,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Previous status</span>
<span class="term-fg32">+    pub previous_status: AccountStatus,</span>
<span class="term-fg32">+    &#47;&#47;&#47; If true wipes storage</span>
<span class="term-fg32">+    pub wipe_storage: bool,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(AccountRevert, &amp;ScrollPostExecutionContext)&gt; for ScrollAccountRevert {</span>
<span class="term-fg32">+    fn from((account, context): (AccountRevert, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            account: (account.account, context).into(),</span>
<span class="term-fg32">+            storage: account.storage,</span>
<span class="term-fg32">+            previous_status: account.previous_status,</span>
<span class="term-fg32">+            wipe_storage: account.wipe_storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl ScrollAccountRevert {</span>
<span class="term-fg32">+    &#47;&#47;&#47; The approximate size of changes needed to store this account revert.</span>
<span class="term-fg32">+    &#47;&#47;&#47; `1 + storage_reverts_len`</span>
<span class="term-fg32">+    pub fn size_hint(&amp;self) -&gt; usize {</span>
<span class="term-fg32">+        1 + self.storage.len()</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Returns `true` if there is nothing to revert,</span>
<span class="term-fg32">+    &#47;&#47;&#47; by checking that:</span>
<span class="term-fg32">+    &#47;&#47;&#47; * both account info and storage have been left untouched</span>
<span class="term-fg32">+    &#47;&#47;&#47; * we don&#39;t need to wipe storage</span>
<span class="term-fg32">+    pub fn is_empty(&amp;self) -&gt; bool {</span>
<span class="term-fg32">+        self.account == ScrollAccountInfoRevert::DoNothing &amp;&amp;</span>
<span class="term-fg32">+            self.storage.is_empty() &amp;&amp;</span>
<span class="term-fg32">+            !self.wipe_storage</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; Code copy of a [`AccountInfoRevert`] compatible with the</span>
<span class="term-fg32">+&#47;&#47;&#47; [`ScrollAccountInfo`].</span>
<span class="term-fg32">+#[derive(Clone, Default, Debug, PartialEq, Eq)]</span>
<span class="term-fg32">+#[cfg_attr(feature = &quot;serde&quot;, derive(serde::Serialize, serde::Deserialize))]</span>
<span class="term-fg32">+pub enum ScrollAccountInfoRevert {</span>
<span class="term-fg32">+    #[default]</span>
<span class="term-fg32">+    &#47;&#47;&#47; Nothing changed</span>
<span class="term-fg32">+    DoNothing,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account was created and on revert we need to remove it with all storage.</span>
<span class="term-fg32">+    DeleteIt,</span>
<span class="term-fg32">+    &#47;&#47;&#47; Account was changed and on revert we need to put old state.</span>
<span class="term-fg32">+    RevertTo(ScrollAccountInfo),</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl From&lt;(AccountInfoRevert, &amp;ScrollPostExecutionContext)&gt; for ScrollAccountInfoRevert {</span>
<span class="term-fg32">+    fn from((account, context): (AccountInfoRevert, &amp;ScrollPostExecutionContext)) -&gt; Self {</span>
<span class="term-fg32">+        match account {</span>
<span class="term-fg32">+            AccountInfoRevert::DoNothing =&gt; Self::DoNothing,</span>
<span class="term-fg32">+            AccountInfoRevert::DeleteIt =&gt; Self::DeleteIt,</span>
<span class="term-fg32">+            AccountInfoRevert::RevertTo(account) =&gt; Self::RevertTo((account, context).into()),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0adf2f6a44dd6e1d7382dbaa" role="button"
                       aria-expanded="false" aria-controls="id-0adf2f6a44dd6e1d7382dbaa">
                        <code>crates/scroll/revm/src/test_utils.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/revm/src/test_utils.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+97</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0adf2f6a44dd6e1d7382dbaa"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;test_utils.rs scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..f6538100dd87cc83df74cd33e8abac6753658e21</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;revm&#47;src&#47;test_utils.rs</span>
<span class="term-fg36">@@ -0,0 +1,97 @@</span>
<span class="term-fg32">+use crate::{</span>
<span class="term-fg32">+    shared::AccountInfo,</span>
<span class="term-fg32">+    states::{</span>
<span class="term-fg32">+        ScrollAccountInfoRevert, ScrollAccountRevert, ScrollPlainStateReverts, ScrollStateChangeset,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    ScrollAccountInfo,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+use reth_scroll_primitives::{hash_code, POSEIDON_EMPTY};</span>
<span class="term-fg32">+use revm::db::{</span>
<span class="term-fg32">+    states::{reverts::AccountInfoRevert, PlainStateReverts, StateChangeset},</span>
<span class="term-fg32">+    AccountRevert,</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;StateChangeset&gt; for ScrollStateChangeset {</span>
<span class="term-fg32">+    fn from(changeset: StateChangeset) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: changeset</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|(add, acc)| (add, acc.map(Into::into)))</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: changeset.storage,</span>
<span class="term-fg32">+            contracts: changeset.contracts,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;PlainStateReverts&gt; for ScrollPlainStateReverts {</span>
<span class="term-fg32">+    fn from(reverts: PlainStateReverts) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            accounts: reverts</span>
<span class="term-fg32">+                .accounts</span>
<span class="term-fg32">+                .into_iter()</span>
<span class="term-fg32">+                .map(|accounts| {</span>
<span class="term-fg32">+                    accounts.into_iter().map(|(add, acc)| (add, acc.map(Into::into))).collect()</span>
<span class="term-fg32">+                })</span>
<span class="term-fg32">+                .collect(),</span>
<span class="term-fg32">+            storage: reverts.storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;AccountInfoRevert&gt; for ScrollAccountInfoRevert {</span>
<span class="term-fg32">+    fn from(account: AccountInfoRevert) -&gt; Self {</span>
<span class="term-fg32">+        match account {</span>
<span class="term-fg32">+            AccountInfoRevert::DoNothing =&gt; Self::DoNothing,</span>
<span class="term-fg32">+            AccountInfoRevert::DeleteIt =&gt; Self::DeleteIt,</span>
<span class="term-fg32">+            AccountInfoRevert::RevertTo(account) =&gt; Self::RevertTo(account.into()),</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;AccountRevert&gt; for ScrollAccountRevert {</span>
<span class="term-fg32">+    fn from(account: AccountRevert) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            account: account.account.into(),</span>
<span class="term-fg32">+            storage: account.storage,</span>
<span class="term-fg32">+            previous_status: account.previous_status,</span>
<span class="term-fg32">+            wipe_storage: account.wipe_storage,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion can cause a loss of information since performed without additional context.</span>
<span class="term-fg32">+impl From&lt;AccountInfo&gt; for ScrollAccountInfo {</span>
<span class="term-fg32">+    fn from(info: AccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        let (code_size, poseidon_code_hash) = info</span>
<span class="term-fg32">+            .code</span>
<span class="term-fg32">+            .as_ref()</span>
<span class="term-fg32">+            .map(|code| (code.len() as u64, hash_code(code.original_byte_slice())))</span>
<span class="term-fg32">+            .unwrap_or((0, POSEIDON_EMPTY));</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            code_hash: info.code_hash,</span>
<span class="term-fg32">+            code: info.code,</span>
<span class="term-fg32">+            code_size,</span>
<span class="term-fg32">+            poseidon_code_hash,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This conversion causes a loss of information.</span>
<span class="term-fg32">+impl From&lt;ScrollAccountInfo&gt; for AccountInfo {</span>
<span class="term-fg32">+    fn from(info: ScrollAccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            code_hash: info.code_hash,</span>
<span class="term-fg32">+            code: info.code,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a73a77dc6a7600d5a0ebcd19" role="button"
                       aria-expanded="false" aria-controls="id-a73a77dc6a7600d5a0ebcd19">
                        <code>crates/scroll/storage/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/storage/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+36</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a73a77dc6a7600d5a0ebcd19"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;storage&#47;Cargo.toml scroll-reth&#47;crates&#47;scroll&#47;storage&#47;Cargo.toml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..9c5cc3744d5578ac6211f386bc896d0d1ddc6405</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;storage&#47;Cargo.toml</span>
<span class="term-fg36">@@ -0,0 +1,36 @@</span>
<span class="term-fg32">+[package]</span>
<span class="term-fg32">+name = &quot;reth-scroll-storage&quot;</span>
<span class="term-fg32">+version.workspace = true</span>
<span class="term-fg32">+edition.workspace = true</span>
<span class="term-fg32">+rust-version.workspace = true</span>
<span class="term-fg32">+license.workspace = true</span>
<span class="term-fg32">+homepage.workspace = true</span>
<span class="term-fg32">+repository.workspace = true</span>
<span class="term-fg32">+exclude.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[lints]</span>
<span class="term-fg32">+workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dependencies]</span>
<span class="term-fg32">+# alloy</span>
<span class="term-fg32">+alloy-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# reth</span>
<span class="term-fg32">+reth-revm.workspace = true</span>
<span class="term-fg32">+reth-storage-errors.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+reth-scroll-revm.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[dev-dependencies]</span>
<span class="term-fg32">+eyre.workspace = true</span>
<span class="term-fg32">+reth-codecs = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+reth-primitives-traits.workspace = true</span>
<span class="term-fg32">+reth-revm = { workspace = true, features = [&quot;test-utils&quot;] }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-612b7c8d877ff05e800dac9a" role="button"
                       aria-expanded="false" aria-controls="id-612b7c8d877ff05e800dac9a">
                        <code>crates/scroll/storage/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/scroll/storage/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+185</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-612b7c8d877ff05e800dac9a"><span class="term-fg1">diff --git reth&#47;crates&#47;scroll&#47;storage&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;scroll&#47;storage&#47;src&#47;lib.rs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..1810369a8096676f8920c7b6ac00660477ace047</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;scroll&#47;storage&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -0,0 +1,185 @@</span>
<span class="term-fg32">+&#47;&#47;! Scroll storage implementation.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#![cfg_attr(all(not(test), feature = &quot;scroll&quot;), warn(unused_crate_dependencies))]</span>
<span class="term-fg32">+&#47;&#47; The `scroll` feature must be enabled to use this crate.</span>
<span class="term-fg32">+#![cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+use alloy_primitives::{Address, B256, U256};</span>
<span class="term-fg32">+use reth_revm::{database::EvmStateProvider, primitives::Bytecode, Database, DatabaseRef};</span>
<span class="term-fg32">+use reth_scroll_primitives::{AccountExtension, ScrollPostExecutionContext};</span>
<span class="term-fg32">+use reth_scroll_revm::shared::AccountInfo;</span>
<span class="term-fg32">+use reth_storage_errors::provider::ProviderError;</span>
<span class="term-fg32">+use std::ops::{Deref, DerefMut};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;&#47; A similar construct as `StateProviderDatabase` which captures additional Scroll context for</span>
<span class="term-fg32">+&#47;&#47;&#47; touched accounts during execution.</span>
<span class="term-fg32">+#[derive(Clone, Debug)]</span>
<span class="term-fg32">+pub struct ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Scroll post execution context.</span>
<span class="term-fg32">+    pub post_execution_context: ScrollPostExecutionContext,</span>
<span class="term-fg32">+    &#47;&#47;&#47; The database.</span>
<span class="term-fg32">+    pub db: DB,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB&gt; Deref for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Target = DB;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn deref(&amp;self) -&gt; &amp;Self::Target {</span>
<span class="term-fg32">+        &amp;self.db</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB&gt; DerefMut for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    fn deref_mut(&amp;mut self) -&gt; &amp;mut Self::Target {</span>
<span class="term-fg32">+        &amp;mut self.db</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB&gt; ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    &#47;&#47;&#47; Creates a [`ScrollStateProviderDatabase`] from the provided DB.</span>
<span class="term-fg32">+    pub fn new(db: DB) -&gt; Self {</span>
<span class="term-fg32">+        Self { db, post_execution_context: Default::default() }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Consume [`ScrollStateProviderDatabase`] and return inner [`EvmStateProvider`].</span>
<span class="term-fg32">+    pub fn into_inner(self) -&gt; DB {</span>
<span class="term-fg32">+        self.db</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; Database for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Error = ProviderError;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Retrieves basic account information for a given address. Caches the Scroll account extension</span>
<span class="term-fg32">+    &#47;&#47;&#47; for the touched account if it has bytecode.</span>
<span class="term-fg32">+    fn basic(&amp;mut self, address: Address) -&gt; Result&lt;Option&lt;AccountInfo&gt;, Self::Error&gt; {</span>
<span class="term-fg32">+        let Some(account) = self.db.basic_account(address)? else { return Ok(None) };</span>
<span class="term-fg32">+        let Some(code_hash) = account.bytecode_hash else { return Ok(Some(account.into())) };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        if let Some(AccountExtension { code_size, poseidon_code_hash: Some(hash) }) =</span>
<span class="term-fg32">+            account.account_extension</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+            self.post_execution_context.entry(code_hash).or_insert((code_size, hash));</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(Some(account.into()))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn code_by_hash(&amp;mut self, code_hash: B256) -&gt; Result&lt;Bytecode, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.bytecode_by_hash(code_hash)?.unwrap_or_default().0)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn storage(&amp;mut self, address: Address, index: U256) -&gt; Result&lt;U256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.storage(address, B256::new(index.to_be_bytes()))?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn block_hash(&amp;mut self, number: u64) -&gt; Result&lt;B256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.block_hash(number)?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+impl&lt;DB: EvmStateProvider&gt; DatabaseRef for ScrollStateProviderDatabase&lt;DB&gt; {</span>
<span class="term-fg32">+    type Error = ProviderError;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn basic_ref(&amp;self, address: Address) -&gt; Result&lt;Option&lt;AccountInfo&gt;, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.basic_account(address)?.map(Into::into))</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn code_by_hash_ref(&amp;self, code_hash: B256) -&gt; Result&lt;Bytecode, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.bytecode_by_hash(code_hash)?.unwrap_or_default().0)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn storage_ref(&amp;self, address: Address, index: U256) -&gt; Result&lt;U256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.storage(address, B256::new(index.to_be_bytes()))?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    fn block_hash_ref(&amp;self, number: u64) -&gt; Result&lt;B256, Self::Error&gt; {</span>
<span class="term-fg32">+        Ok(self.db.block_hash(number)?.unwrap_or_default())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(test)]</span>
<span class="term-fg32">+mod tests {</span>
<span class="term-fg32">+    use crate::ScrollStateProviderDatabase;</span>
<span class="term-fg32">+    use alloy_primitives::{keccak256, Address, Bytes, U256};</span>
<span class="term-fg32">+    use reth_codecs::{test_utils::UnusedBits, validate_bitflag_backwards_compat};</span>
<span class="term-fg32">+    use reth_primitives_traits::Account;</span>
<span class="term-fg32">+    use reth_revm::{test_utils::StateProviderTest, Database};</span>
<span class="term-fg32">+    use reth_scroll_primitives::{hash_code, AccountExtension};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_ensure_account_backwards_compatibility() {</span>
<span class="term-fg32">+        &#47;&#47; See `reth-codecs&#47;src&#47;test-utils` for details.</span>
<span class="term-fg32">+        assert_eq!(Account::bitflag_encoded_bytes(), 2);</span>
<span class="term-fg32">+        assert_eq!(AccountExtension::bitflag_encoded_bytes(), 1);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; In case of failure, refer to the documentation of the</span>
<span class="term-fg32">+        &#47;&#47; [`validate_bitflag_backwards_compat`] macro for detailed instructions on handling</span>
<span class="term-fg32">+        &#47;&#47; it.</span>
<span class="term-fg32">+        validate_bitflag_backwards_compat!(Account, UnusedBits::NotZero);</span>
<span class="term-fg32">+        validate_bitflag_backwards_compat!(AccountExtension, UnusedBits::NotZero);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_scroll_post_execution_context() -&gt; eyre::Result&lt;()&gt; {</span>
<span class="term-fg32">+        let mut db = StateProviderTest::default();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; insert an eoa in the db</span>
<span class="term-fg32">+        let eoa_address = Address::random();</span>
<span class="term-fg32">+        let eoa = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::MAX,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            account_extension: Some(AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        db.insert_account(eoa_address, eoa, None, Default::default());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; insert a contract account in the db</span>
<span class="term-fg32">+        let contract_address = Address::random();</span>
<span class="term-fg32">+        let bytecode = Bytes::copy_from_slice(&amp;[0x0, 0x1, 0x2, 0x3, 0x4, 0x5]);</span>
<span class="term-fg32">+        let bytecode_hash = keccak256(&amp;bytecode);</span>
<span class="term-fg32">+        let contract = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::MAX,</span>
<span class="term-fg32">+            bytecode_hash: Some(bytecode_hash),</span>
<span class="term-fg32">+            account_extension: Some(AccountExtension::from_bytecode(&amp;bytecode)),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        db.insert_account(contract_address, contract, Some(bytecode.clone()), Default::default());</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; insert an empty contract account in the db</span>
<span class="term-fg32">+        let empty_contract_address = Address::random();</span>
<span class="term-fg32">+        let empty_bytecode = Bytes::copy_from_slice(&amp;[]);</span>
<span class="term-fg32">+        let empty_contract = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::MAX,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            account_extension: Some(AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        db.insert_account(</span>
<span class="term-fg32">+            empty_contract_address,</span>
<span class="term-fg32">+            empty_contract,</span>
<span class="term-fg32">+            Some(empty_bytecode),</span>
<span class="term-fg32">+            Default::default(),</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let mut provider = ScrollStateProviderDatabase::new(db);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check eoa is in db</span>
<span class="term-fg32">+        let _ = provider.basic(eoa_address)?.unwrap();</span>
<span class="term-fg32">+        &#47;&#47; check contract is in db</span>
<span class="term-fg32">+        let _ = provider.basic(contract_address)?.unwrap();</span>
<span class="term-fg32">+        &#47;&#47; check empty contract is in db</span>
<span class="term-fg32">+        let _ = provider.basic(empty_contract_address)?.unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check provider context only contains contract</span>
<span class="term-fg32">+        let post_execution_context = provider.post_execution_context;</span>
<span class="term-fg32">+        assert_eq!(post_execution_context.len(), 1);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; check post execution context is correct for contract</span>
<span class="term-fg32">+        let (code_size, poseidon_code_hash) = post_execution_context.get(&amp;bytecode_hash).unwrap();</span>
<span class="term-fg32">+        assert_eq!(*code_size, 6);</span>
<span class="term-fg32">+        assert_eq!(*poseidon_code_hash, hash_code(&amp;bytecode));</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        Ok(())</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-f9a5a1b36e748c03c8da7037"role="button" aria-expanded="false" aria-controls="id-f9a5a1b36e748c03c8da7037">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/ethereum</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+59</span></div>
                    <div class="text-start"><span class="text-danger">-5</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-f9a5a1b36e748c03c8da7037">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-353b0aeb8dffa7c82d5ff0a6" role="button"
                       aria-expanded="false" aria-controls="id-353b0aeb8dffa7c82d5ff0a6">
                        <code>crates/ethereum/evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/ethereum/evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/ethereum/evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-353b0aeb8dffa7c82d5ff0a6"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">index 17e870e61113458c1bc459d7e306e85cbe39aafa..52555b23abe36bf8a0b5ad5459962d8b7a9891c8 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -23,6 +23,9 @@</span>
 # Ethereum
 revm-primitives.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+</span>
 # Alloy
 alloy-primitives.workspace = true
 alloy-eips.workspace = true
<span class="term-fg36">@@ -38,6 +41,8 @@</span> reth-execution-types.workspace = true
 secp256k1.workspace = true
 serde_json.workspace = true
 alloy-genesis.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
&nbsp;
 [features]
 default = [&quot;std&quot;]
<span class="term-fg36">@@ -52,3 +57,7 @@</span> 	&quot;alloy-primitives&#47;std&quot;,
 	&quot;revm-primitives&#47;std&quot;,
 	&quot;secp256k1&#47;std&quot;
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6cc05368858bd5d1c4467d63" role="button"
                       aria-expanded="false" aria-controls="id-6cc05368858bd5d1c4467d63">
                        <code>crates/ethereum/evm/src/execute.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/ethereum/evm/src/execute.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/ethereum/evm/src/execute.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+34</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6cc05368858bd5d1c4467d63"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">index e339268a99a7b81a15cb7f570ca93e20c6459057..fe2f51380114b8480654a1c5ca11cbd6dc072a91 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg36">@@ -21,7 +21,8 @@</span>     system_calls::{OnStateHook, SystemCaller},
     ConfigureEvm, TxEnvOverrides,
 };
 use reth_primitives::{BlockWithSenders, Receipt};
<span class="term-fg31">-use reth_revm::db::State;</span>
<span class="term-fg32">+use reth_revm::db::{BundleState, State};</span>
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use revm_primitives::{
     db::{Database, DatabaseCommit},
     BlockEnv, CfgEnvWithHandlerCfg, EnvWithHandlerCfg, ResultAndState, U256,
<span class="term-fg36">@@ -60,12 +61,15 @@</span> where
     EvmConfig:
         Clone + Unpin + Sync + Send + &#39;static + ConfigureEvm&lt;Header = alloy_consensus::Header&gt;,
 {
<span class="term-fg31">-    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        EthExecutionStrategy&lt;DB, EvmConfig&gt;;</span>
<span class="term-fg32">+    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = EthExecutionStrategy&lt;DB, EvmConfig&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let state =
             State::builder().with_database(db).with_bundle_update().without_state_clear().build();
<span class="term-fg36">@@ -128,6 +132,7 @@</span>
 impl&lt;DB, EvmConfig&gt; BlockExecutionStrategy&lt;DB&gt; for EthExecutionStrategy&lt;DB, EvmConfig&gt;
 where
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     EvmConfig: ConfigureEvm&lt;Header = alloy_consensus::Header&gt;,
 {
     type Error = BlockExecutionError;
<span class="term-fg36">@@ -335,6 +340,10 @@</span>         let beacon_root_contract_account = Account {
             balance: U256::ZERO,
             bytecode_hash: Some(keccak256(BEACON_ROOTS_CODE.clone())),
             nonce: 1,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;BEACON_ROOTS_CODE,</span>
<span class="term-fg32">+            )),</span>
         };
&nbsp;
         db.insert_account(
<span class="term-fg36">@@ -354,6 +363,10 @@</span>         let withdrawal_requests_contract_account = Account {
             nonce: 1,
             balance: U256::ZERO,
             bytecode_hash: Some(keccak256(WITHDRAWAL_REQUEST_PREDEPLOY_CODE.clone())),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;WITHDRAWAL_REQUEST_PREDEPLOY_CODE,</span>
<span class="term-fg32">+            )),</span>
         };
&nbsp;
         db.insert_account(
<span class="term-fg36">@@ -717,6 +730,10 @@</span>         let blockhashes_contract_account = Account {
             balance: U256::ZERO,
             bytecode_hash: Some(keccak256(HISTORY_STORAGE_CODE.clone())),
             nonce: 1,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;HISTORY_STORAGE_CODE,</span>
<span class="term-fg32">+            )),</span>
         };
&nbsp;
         db.insert_account(
<span class="term-fg36">@@ -1069,7 +1086,13 @@</span>         let sender_address = public_key_to_address(sender_key_pair.public_key());
&nbsp;
         db.insert_account(
             sender_address,
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(ETH_TO_WEI), bytecode_hash: None },</span>
<span class="term-fg32">+            Account {</span>
<span class="term-fg32">+                nonce: 1,</span>
<span class="term-fg32">+                balance: U256::from(ETH_TO_WEI),</span>
<span class="term-fg32">+                bytecode_hash: None,</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            },</span>
             None,
             HashMap::default(),
         );
<span class="term-fg36">@@ -1151,7 +1174,13 @@</span>
         &#47;&#47; Insert the sender account into the state with a nonce of 1 and a balance of 1 ETH in Wei
         db.insert_account(
             sender_address,
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(ETH_TO_WEI), bytecode_hash: None },</span>
<span class="term-fg32">+            Account {</span>
<span class="term-fg32">+                nonce: 1,</span>
<span class="term-fg32">+                balance: U256::from(ETH_TO_WEI),</span>
<span class="term-fg32">+                bytecode_hash: None,</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            },</span>
             None,
             HashMap::default(),
         );</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ca16190ecd8f401b8c4b9504" role="button"
                       aria-expanded="false" aria-controls="id-ca16190ecd8f401b8c4b9504">
                        <code>crates/ethereum/node/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/ethereum/node/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/ethereum/node/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ca16190ecd8f401b8c4b9504"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;node&#47;Cargo.toml scroll-reth&#47;crates&#47;ethereum&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">index 6ecd5437bfb0e21c036e54e95696bbdbb971cf99..830c648f9b96ac083e4547d9b9feb53850f329f4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;node&#47;Cargo.toml</span>
<span class="term-fg36">@@ -79,3 +79,4 @@</span>     &quot;reth-trie-db&#47;test-utils&quot;,
     &quot;revm&#47;test-utils&quot;,
     &quot;reth-evm&#47;test-utils&quot;,
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ad740463672ce6af4629b01a" role="button"
                       aria-expanded="false" aria-controls="id-ad740463672ce6af4629b01a">
                        <code>crates/ethereum/node/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/ethereum/node/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/ethereum/node/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ad740463672ce6af4629b01a"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;node&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;ethereum&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 421cee37fb038e54502311c6120840766f85e3da..e86240a7433415a4ac6c5d659e38806b0c9400e4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -7,6 +7,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use reth_revm as _;
 use revm as _;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2686ee456fdda43ef7ef4bf8" role="button"
                       aria-expanded="false" aria-controls="id-2686ee456fdda43ef7ef4bf8">
                        <code>crates/ethereum/node/tests/e2e/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/ethereum/node/tests/e2e/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/ethereum/node/tests/e2e/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2686ee456fdda43ef7ef4bf8"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;e2e&#47;main.rs scroll-reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">index 4ed8ac5fcb635b10b14775b983a9379be44a6795..3459db247654c4b711a52b2e42e86111125e5363 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg36">@@ -1,4 +1,7 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 mod blobs;
 mod dev;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e19bb1ca8a6feccf50aa7f0a" role="button"
                       aria-expanded="false" aria-controls="id-e19bb1ca8a6feccf50aa7f0a">
                        <code>crates/ethereum/node/tests/it/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/ethereum/node/tests/it/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/ethereum/node/tests/it/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e19bb1ca8a6feccf50aa7f0a"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;it&#47;main.rs scroll-reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">index 0f85adda31d0847f57e5047648129f97e62cfbbc..18240081f1e4f9af277fe57029f36d4cd42f4353 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg36">@@ -1,4 +1,7 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 mod builder;
 mod exex;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-00d187974ac93987a6e31469" role="button"
                       aria-expanded="false" aria-controls="id-00d187974ac93987a6e31469">
                        <code>crates/ethereum/payload/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/ethereum/payload/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/ethereum/payload/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-00d187974ac93987a6e31469"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;payload&#47;Cargo.toml scroll-reth&#47;crates&#47;ethereum&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">index 4e0880d1d153097f90fd0971908651c6acb10937..2d8d25c3c22d7d40a9783ec9162fff497a0fdb7e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;payload&#47;Cargo.toml</span>
<span class="term-fg36">@@ -39,3 +39,6 @@</span> alloy-primitives.workspace = true
&nbsp;
 # misc
 tracing.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-247f16cc1f2499b7bb6f170f" role="button"
                       aria-expanded="false" aria-controls="id-247f16cc1f2499b7bb6f170f">
                        <code>crates/ethereum/payload/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/ethereum/payload/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/ethereum/payload/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-247f16cc1f2499b7bb6f170f"><span class="term-fg1">diff --git reth&#47;crates&#47;ethereum&#47;payload&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;ethereum&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">index b2f78da6de97a0d844deb1a9f537014b62de4586..ee99057f3d53f3f360bad3c7e936e57d7b3be0ae 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;ethereum&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;ethereum&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -8,6 +8,9 @@</span> )]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![allow(clippy::useless_let_if_seq)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_consensus::{Header, EMPTY_OMMER_ROOT_HASH};
 use alloy_eips::{eip4844::MAX_DATA_GAS_PER_BLOCK, eip7685::Requests, merge::BEACON_NONCE};</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-be9d0903c8de44bd05988318"role="button" aria-expanded="false" aria-controls="id-be9d0903c8de44bd05988318">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/optimism</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+45</span></div>
                    <div class="text-start"><span class="text-danger">-2</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-be9d0903c8de44bd05988318">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b079b38b76114a410043970f" role="button"
                       aria-expanded="false" aria-controls="id-b079b38b76114a410043970f">
                        <code>crates/optimism/bin/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/bin/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/bin/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b079b38b76114a410043970f"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml</span>
<span class="term-fg1">index 45f4492e82b60cf492ff5ff5223a2fe3e0d13fe9..efbea77454cca22287f6a2f83a225e606f75e2d4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;bin&#47;Cargo.toml</span>
<span class="term-fg36">@@ -46,6 +46,7 @@</span> 	&quot;reth-optimism-payload-builder&#47;optimism&quot;,
 	&quot;reth-optimism-rpc&#47;optimism&quot;,
 	&quot;reth-provider&#47;optimism&quot;
 ]
<span class="term-fg32">+scroll = []</span>
&nbsp;
 dev = [
 	&quot;reth-optimism-cli&#47;dev&quot;,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0109ca1e73182c1fe837eaa6" role="button"
                       aria-expanded="false" aria-controls="id-0109ca1e73182c1fe837eaa6">
                        <code>crates/optimism/bin/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/bin/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/bin/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0109ca1e73182c1fe837eaa6"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 21c28f7c5470f38893c52fa10198a0feed2323f7..3e9550949c1de79479a4bdb628b1bb2d84114410 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -26,6 +26,9 @@</span> )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 &#47;&#47;&#47; Re-exported from `reth_optimism_cli`.
 pub mod cli {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ed0cc7c93e3decf697f7a642" role="button"
                       aria-expanded="false" aria-controls="id-ed0cc7c93e3decf697f7a642">
                        <code>crates/optimism/bin/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/bin/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/bin/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ed0cc7c93e3decf697f7a642"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg1">index 6494298ba393b461323b9430d440a640cb1e0e61..7ba70272f77d5f697a094910f2eee518cbb44619 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;bin&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 #![allow(missing_docs, rustdoc::missing_crate_level_docs)]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use clap::Parser;
 use reth_node_builder::{engine_tree_config::TreeConfig, EngineNodeLauncher};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-18d688105b13fc5fc0bf96ed" role="button"
                       aria-expanded="false" aria-controls="id-18d688105b13fc5fc0bf96ed">
                        <code>crates/optimism/cli/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/cli/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/cli/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-18d688105b13fc5fc0bf96ed"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml</span>
<span class="term-fg1">index d090075927aa843b1d54bb17516525b73940065e..5eb0f0e99e039872a69a60dd4fbee490adecace3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;cli&#47;Cargo.toml</span>
<span class="term-fg36">@@ -122,3 +122,4 @@</span> 	&quot;reth-execution-types&#47;serde&quot;,
 	&quot;reth-provider&#47;serde&quot;,
 	&quot;reth-optimism-primitives&#47;serde&quot;,
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-880b2a7afd82456d21064d0b" role="button"
                       aria-expanded="false" aria-controls="id-880b2a7afd82456d21064d0b">
                        <code>crates/optimism/cli/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/cli/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/cli/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-880b2a7afd82456d21064d0b"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 23eaa99b521330609777f97db7bdd0bab92857ee..b02c128cbf334f4da48b418e1cf2f9ce76f4d080 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;cli&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -9,6 +9,9 @@</span> #![cfg_attr(all(not(test), feature = &quot;optimism&quot;), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 &#47;&#47;&#47; Optimism chain specification parser.
 pub mod chainspec;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0cf9c919ca64174b04e6cf3c" role="button"
                       aria-expanded="false" aria-controls="id-0cf9c919ca64174b04e6cf3c">
                        <code>crates/optimism/evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0cf9c919ca64174b04e6cf3c"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">index 807f224ca4b8ea23d95fe5334014ee9262822c70..901d9c31534ee83c48d7ad9175851b6429428915 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -33,6 +33,9 @@</span> reth-optimism-consensus.workspace = true
 reth-optimism-chainspec.workspace = true
 reth-optimism-forks.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+</span>
 # revm
 revm.workspace = true
 revm-primitives.workspace = true
<span class="term-fg36">@@ -70,3 +73,4 @@</span> 	&quot;reth-optimism-consensus&#47;optimism&quot;,
 	&quot;revm&#47;optimism&quot;,
 	&quot;revm-primitives&#47;optimism&quot;
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-66ef3eee31a5619a15b346b3" role="button"
                       aria-expanded="false" aria-controls="id-66ef3eee31a5619a15b346b3">
                        <code>crates/optimism/evm/src/execute.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/evm/src/execute.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/evm/src/execute.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-66ef3eee31a5619a15b346b3"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;execute.rs scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">index 042b8e291934332aa3d3163dd5e5753772a86a56..24ed78806513e74123f2294cfc2ed4ed2b667e07 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg36">@@ -22,6 +22,8 @@</span> use reth_optimism_consensus::validate_block_post_execution;
 use reth_optimism_forks::OpHardfork;
 use reth_primitives::{BlockWithSenders, Receipt, TxType};
 use reth_revm::{Database, State};
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
<span class="term-fg32">+use revm::db::BundleState;</span>
 use revm_primitives::{
     db::DatabaseCommit, BlockEnv, CfgEnvWithHandlerCfg, EnvWithHandlerCfg, ResultAndState, U256,
 };
<span class="term-fg36">@@ -55,12 +57,15 @@</span> where
     EvmConfig:
         Clone + Unpin + Sync + Send + &#39;static + ConfigureEvm&lt;Header = alloy_consensus::Header&gt;,
 {
<span class="term-fg31">-    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        OpExecutionStrategy&lt;DB, EvmConfig&gt;;</span>
<span class="term-fg32">+    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = OpExecutionStrategy&lt;DB, EvmConfig&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let state =
             State::builder().with_database(db).with_bundle_update().without_state_clear().build();
<span class="term-fg36">@@ -117,6 +122,7 @@</span>
 impl&lt;DB, EvmConfig&gt; BlockExecutionStrategy&lt;DB&gt; for OpExecutionStrategy&lt;DB, EvmConfig&gt;
 where
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     EvmConfig: ConfigureEvm&lt;Header = alloy_consensus::Header&gt;,
 {
     type Error = BlockExecutionError;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0360a221a437c27e6c173d00" role="button"
                       aria-expanded="false" aria-controls="id-0360a221a437c27e6c173d00">
                        <code>crates/optimism/evm/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/evm/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/evm/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0360a221a437c27e6c173d00"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 3107462751039a80d0b33ea57a6cb056c30274fe..78aa706eaf6ffe5433641f98cf9774be93b9a59c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;evm&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -9,6 +9,9 @@</span> #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(feature = &quot;std&quot;), no_std)]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 extern crate alloc;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d6d1bc76f0ac7e735944233e" role="button"
                       aria-expanded="false" aria-controls="id-d6d1bc76f0ac7e735944233e">
                        <code>crates/optimism/node/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/node/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/node/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d6d1bc76f0ac7e735944233e"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">index fbc055a82e9843d990d2b64b28ff18d58e74b42e..303787559735e1070ddb53d30e48db118ebf504c 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;Cargo.toml</span>
<span class="term-fg36">@@ -124,4 +124,5 @@</span> ]
 reth-codec = [
     &quot;reth-primitives&#47;reth-codec&quot;,
     &quot;reth-optimism-primitives&#47;reth-codec&quot;,
<span class="term-fg31">-]</span>
<span class="term-fg31">\ No newline at end of file</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-45a5f834094ce112eee60e96" role="button"
                       aria-expanded="false" aria-controls="id-45a5f834094ce112eee60e96">
                        <code>crates/optimism/node/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/node/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/node/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-45a5f834094ce112eee60e96"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 7af0f3b8a722f3be89f2441ced4248d4587ea825..8bf8225bdef70a7c54127ae92bcc82529893d4f3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -8,6 +8,9 @@</span> )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 &#47;&#47;&#47; CLI argument parsing for the optimism node.
 pub mod args;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8857b04de30c11d56229b2c6" role="button"
                       aria-expanded="false" aria-controls="id-8857b04de30c11d56229b2c6">
                        <code>crates/optimism/node/tests/e2e/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/node/tests/e2e/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/node/tests/e2e/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8857b04de30c11d56229b2c6"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">index 7f4b22ba7e04eb795bc6286c44f1464f5c9f6c1c..b3143d7c40ba494ac49fb61938086984c7d53ae8 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;e2e&#47;main.rs</span>
<span class="term-fg36">@@ -1,4 +1,7 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 #[cfg(feature = &quot;optimism&quot;)]
 mod p2p;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f7880d471625aba651851a4e" role="button"
                       aria-expanded="false" aria-controls="id-f7880d471625aba651851a4e">
                        <code>crates/optimism/node/tests/it/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/node/tests/it/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/node/tests/it/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f7880d471625aba651851a4e"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">index d0533fc4541ca1543d060df932dad643f9e3ab5c..2bfdeffc1c4abfc357e8f1a1bc7c8b8f3ebea05b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;node&#47;tests&#47;it&#47;main.rs</span>
<span class="term-fg36">@@ -1,4 +1,7 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 #[cfg(feature = &quot;optimism&quot;)]
 mod builder;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-16ff9d053ee2d766053591d8" role="button"
                       aria-expanded="false" aria-controls="id-16ff9d053ee2d766053591d8">
                        <code>crates/optimism/payload/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/payload/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/payload/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-16ff9d053ee2d766053591d8"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">index 7f47da7e23606048ab1af463c18f61894dd55f0b..8873da14605e299b4de0b970b2b8f52c3be0d171 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;payload&#47;Cargo.toml</span>
<span class="term-fg36">@@ -59,4 +59,5 @@</span> 	&quot;reth-optimism-evm&#47;optimism&quot;,
 	&quot;revm&#47;optimism&quot;,
 	&quot;reth-execution-types&#47;optimism&quot;,
 	&quot;reth-optimism-consensus&#47;optimism&quot;
<span class="term-fg31">-]</span>
<span class="term-fg31">\ No newline at end of file</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = []</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f7a9aec718ce503fda659440" role="button"
                       aria-expanded="false" aria-controls="id-f7a9aec718ce503fda659440">
                        <code>crates/optimism/payload/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/payload/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/payload/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f7a9aec718ce503fda659440"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 8447026d783a3fd65a755da88e20b9b75f5734e8..ee1f0a81dcee23ec40a3befa61d7cc22d02e62a3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;payload&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -10,6 +10,9 @@</span> #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![allow(clippy::useless_let_if_seq)]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 pub mod builder;
 pub use builder::OpPayloadBuilder;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2c910cf8ade2cd9d61f9d300" role="button"
                       aria-expanded="false" aria-controls="id-2c910cf8ade2cd9d61f9d300">
                        <code>crates/optimism/rpc/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/rpc/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/rpc/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2c910cf8ade2cd9d61f9d300"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">index 17fafef70965a2de2ea565a1228ea1a1e0356d31..dfa5ddb0a7850d4a844310fbe26a9a417540d1b7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg36">@@ -74,3 +74,4 @@</span> 	&quot;revm&#47;optimism&quot;,
 	&quot;reth-optimism-consensus&#47;optimism&quot;,
 	&quot;reth-optimism-payload-builder&#47;optimism&quot;
 ]
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3c2bd83554d86a06404d8cb2" role="button"
                       aria-expanded="false" aria-controls="id-3c2bd83554d86a06404d8cb2">
                        <code>crates/optimism/rpc/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/optimism/rpc/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/optimism/rpc/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3c2bd83554d86a06404d8cb2"><span class="term-fg1">diff --git reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 0fa0debdf33dbb4dbc78f71a53d0f84c27f331be..d8ee748783b032ef90edcd49984c09a48487dc13 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;optimism&#47;rpc&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -9,6 +9,9 @@</span> #![cfg_attr(all(not(test), feature = &quot;optimism&quot;), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 &#47;&#47; The `optimism` feature must be enabled to use this crate.
 #![cfg(feature = &quot;optimism&quot;)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 pub mod error;
 pub mod eth;</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-5358c3c9f464f33b9ca847b8"role="button" aria-expanded="false" aria-controls="id-5358c3c9f464f33b9ca847b8">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/primitives</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+133</span></div>
                    <div class="text-start"><span class="text-danger">-15</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-5358c3c9f464f33b9ca847b8">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-032130f7521d6b2834b35c86" role="button"
                       aria-expanded="false" aria-controls="id-032130f7521d6b2834b35c86">
                        <code>crates/primitives-traits/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/primitives-traits/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/primitives-traits/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-032130f7521d6b2834b35c86"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives-traits&#47;Cargo.toml scroll-reth&#47;crates&#47;primitives-traits&#47;Cargo.toml</span>
<span class="term-fg1">index df4491b2d126f719746ed52a8bf1d933491d3dce..27aa92f4edbbfdb3b3be45025f721a5044936b06 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives-traits&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives-traits&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,7 +21,10 @@</span> alloy-eips.workspace = true
 alloy-genesis.workspace = true
 alloy-primitives.workspace = true
 alloy-rlp.workspace = true
<span class="term-fg31">-revm-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# revm-primitives scroll re-export</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;scroll&#47;revm&quot;, features = [&quot;serde&quot;] }</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
&nbsp;
 # misc
 byteorder = { workspace = true, optional = true }
<span class="term-fg36">@@ -65,7 +68,8 @@</span> 	&quot;serde?&#47;std&quot;
 ]
 test-utils = [
 	&quot;arbitrary&quot;,
<span class="term-fg31">-	&quot;reth-codecs?&#47;test-utils&quot;</span>
<span class="term-fg32">+	&quot;reth-codecs?&#47;test-utils&quot;,</span>
<span class="term-fg32">+	&quot;revm-primitives&#47;test-utils&quot;</span>
 ]
 arbitrary = [
 	&quot;std&quot;,
<span class="term-fg36">@@ -76,7 +80,8 @@</span> 	&quot;dep:proptest&quot;,
 	&quot;dep:proptest-arbitrary-interop&quot;,
 	&quot;alloy-eips&#47;arbitrary&quot;,
 	&quot;revm-primitives&#47;arbitrary&quot;,
<span class="term-fg31">-	&quot;reth-codecs?&#47;arbitrary&quot;</span>
<span class="term-fg32">+	&quot;reth-codecs?&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;arbitrary&quot;</span>
 ]
 serde-bincode-compat = [
 	&quot;serde&quot;,
<span class="term-fg36">@@ -101,3 +106,8 @@</span> 	&quot;dep:reth-codecs&quot;,
 	&quot;dep:modular-bitfield&quot;,
 	&quot;dep:byteorder&quot;,
 ]
<span class="term-fg32">+</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+	&quot;revm-primitives&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9ed9cbd9ecdc41d2cf470e78" role="button"
                       aria-expanded="false" aria-controls="id-9ed9cbd9ecdc41d2cf470e78">
                        <code>crates/primitives-traits/src/account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/primitives-traits/src/account.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/primitives-traits/src/account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+109</span></div>
                            <div class="text-start"><span class="text-danger">-9</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9ed9cbd9ecdc41d2cf470e78"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs scroll-reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs</span>
<span class="term-fg1">index c8504f3b63cba932923146ca3960e189d565a1c1..03790dd982a8876e35cd2002b78d0ed55cd30f0a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives-traits&#47;src&#47;account.rs</span>
<span class="term-fg36">@@ -36,6 +36,15 @@</span>     &#47;&#47;&#47; Account balance.
     pub balance: U256,
     &#47;&#47;&#47; Hash of the account&#39;s bytecode.
     pub bytecode_hash: Option&lt;B256&gt;,
<span class="term-fg32">+    &#47;&#47;&#47; The extension for a Scroll account. This `Option` should always be `Some` and is used</span>
<span class="term-fg32">+    &#47;&#47;&#47; in order to maintain backward compatibility in case additional fields are added on the</span>
<span class="term-fg32">+    &#47;&#47;&#47; `Account` due to the way storage compaction is performed.</span>
<span class="term-fg32">+    &#47;&#47;&#47; Adding the `code_size` and the `poseidon_code_hash` fields on the `Account` without the</span>
<span class="term-fg32">+    &#47;&#47;&#47; extension caused the used bits of the bitflag struct to reach 16 bits, meaning no</span>
<span class="term-fg32">+    &#47;&#47;&#47; additional bitflag was available. See [reth codecs](reth_codecs::test_utils) for more</span>
<span class="term-fg32">+    &#47;&#47;&#47; details.</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    pub account_extension: Option&lt;reth_scroll_primitives::AccountExtension&gt;,</span>
 }
&nbsp;
 impl Account {
<span class="term-fg36">@@ -56,6 +65,25 @@</span>     &#47;&#47;&#47; Returns an account bytecode&#39;s hash.
     &#47;&#47;&#47; In case of no bytecode, returns [`KECCAK_EMPTY`].
     pub fn get_bytecode_hash(&amp;self) -&gt; B256 {
         self.bytecode_hash.unwrap_or(KECCAK_EMPTY)
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; Convert an [`revm_primitives::shared::AccountInfo`] into an [`Account`]</span>
<span class="term-fg32">+    pub fn from_account_info(info: revm_primitives::shared::AccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: info.balance,</span>
<span class="term-fg32">+            nonce: info.nonce,</span>
<span class="term-fg32">+            bytecode_hash: (info.code_hash != KECCAK_EMPTY).then_some(info.code_hash),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(</span>
<span class="term-fg32">+                info.code</span>
<span class="term-fg32">+                    .map(|code| {</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                            &amp;code.original_byte_slice(),</span>
<span class="term-fg32">+                        )</span>
<span class="term-fg32">+                    })</span>
<span class="term-fg32">+                    .unwrap_or(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            ),</span>
<span class="term-fg32">+        }</span>
     }
 }
&nbsp;
<span class="term-fg36">@@ -172,6 +200,10 @@</span>         Self {
             nonce: value.nonce.unwrap_or_default(),
             balance: value.balance,
             bytecode_hash: value.code.as_ref().map(keccak256),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                value.code.as_ref().unwrap_or_default(),</span>
<span class="term-fg32">+            )),</span>
         }
     }
 }
<span class="term-fg36">@@ -183,6 +215,8 @@</span>         Self {
             balance: revm_acc.balance,
             nonce: revm_acc.nonce,
             bytecode_hash: (code_hash != KECCAK_EMPTY).then_some(code_hash),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some((revm_acc.code_size, revm_acc.poseidon_code_hash).into()),</span>
         }
     }
 }
<span class="term-fg36">@@ -194,10 +228,37 @@</span>             balance: reth_acc.balance,
             nonce: reth_acc.nonce,
             code_hash: reth_acc.bytecode_hash.unwrap_or(KECCAK_EMPTY),
             code: None,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: reth_acc.account_extension.unwrap_or_default().code_size,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: reth_acc</span>
<span class="term-fg32">+                .account_extension</span>
<span class="term-fg32">+                .unwrap_or_default()</span>
<span class="term-fg32">+                .poseidon_code_hash</span>
<span class="term-fg32">+                .unwrap_or(reth_scroll_primitives::POSEIDON_EMPTY),</span>
         }
     }
 }
&nbsp;
<span class="term-fg32">+#[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+impl From&lt;Account&gt; for revm_primitives::shared::AccountInfo {</span>
<span class="term-fg32">+    fn from(reth_acc: Account) -&gt; Self {</span>
<span class="term-fg32">+        Self {</span>
<span class="term-fg32">+            balance: reth_acc.balance,</span>
<span class="term-fg32">+            nonce: reth_acc.nonce,</span>
<span class="term-fg32">+            code_hash: reth_acc.bytecode_hash.unwrap_or(KECCAK_EMPTY),</span>
<span class="term-fg32">+            code: None,</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+#[cfg(all(feature = &quot;scroll&quot;, feature = &quot;test-utils&quot;))]</span>
<span class="term-fg32">+impl From&lt;revm_primitives::shared::AccountInfo&gt; for Account {</span>
<span class="term-fg32">+    fn from(info: revm_primitives::shared::AccountInfo) -&gt; Self {</span>
<span class="term-fg32">+        Self::from_account_info(info)</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 #[cfg(test)]
 mod tests {
     use alloy_primitives::{hex_literal::hex, B256, U256};
<span class="term-fg36">@@ -224,7 +285,13 @@</span>     }
&nbsp;
     #[test]
     fn test_empty_account() {
<span class="term-fg31">-        let mut acc = Account { nonce: 0, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let mut acc = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         &#47;&#47; Nonce 0, balance 0, and bytecode hash set to None is considered empty.
         assert!(acc.is_empty());
&nbsp;
<span class="term-fg36">@@ -276,12 +343,23 @@</span>
     #[test]
     fn test_account_has_bytecode() {
         &#47;&#47; Account with no bytecode (None)
<span class="term-fg31">-        let acc_no_bytecode = Account { nonce: 1, balance: U256::from(1000), bytecode_hash: None };</span>
<span class="term-fg32">+        let acc_no_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert!(!acc_no_bytecode.has_bytecode(), &quot;Account should not have bytecode&quot;);
&nbsp;
         &#47;&#47; Account with bytecode hash set to KECCAK_EMPTY (should have bytecode)
<span class="term-fg31">-        let acc_empty_bytecode =</span>
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(1000), bytecode_hash: Some(KECCAK_EMPTY) };</span>
<span class="term-fg32">+        let acc_empty_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: Some(KECCAK_EMPTY),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert!(acc_empty_bytecode.has_bytecode(), &quot;Account should have bytecode&quot;);
&nbsp;
         &#47;&#47; Account with a non-empty bytecode hash
<span class="term-fg36">@@ -289,6 +367,10 @@</span>         let acc_with_bytecode = Account {
             nonce: 1,
             balance: U256::from(1000),
             bytecode_hash: Some(B256::from_slice(&amp;[0x11u8; 32])),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;[0x11u8; 32],</span>
<span class="term-fg32">+            )),</span>
         };
         assert!(acc_with_bytecode.has_bytecode(), &quot;Account should have bytecode&quot;);
     }
<span class="term-fg36">@@ -296,12 +378,23 @@</span>
     #[test]
     fn test_account_get_bytecode_hash() {
         &#47;&#47; Account with no bytecode (should return KECCAK_EMPTY)
<span class="term-fg31">-        let acc_no_bytecode = Account { nonce: 0, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let acc_no_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert_eq!(acc_no_bytecode.get_bytecode_hash(), KECCAK_EMPTY, &quot;Should return KECCAK_EMPTY&quot;);
&nbsp;
         &#47;&#47; Account with bytecode hash set to KECCAK_EMPTY
<span class="term-fg31">-        let acc_empty_bytecode =</span>
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(1000), bytecode_hash: Some(KECCAK_EMPTY) };</span>
<span class="term-fg32">+        let acc_empty_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: Some(KECCAK_EMPTY),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        };</span>
         assert_eq!(
             acc_empty_bytecode.get_bytecode_hash(),
             KECCAK_EMPTY,
<span class="term-fg36">@@ -310,8 +403,15 @@</span>         );
&nbsp;
         &#47;&#47; Account with a valid bytecode hash
         let bytecode_hash = B256::from_slice(&amp;[0x11u8; 32]);
<span class="term-fg31">-        let acc_with_bytecode =</span>
<span class="term-fg31">-            Account { nonce: 1, balance: U256::from(1000), bytecode_hash: Some(bytecode_hash) };</span>
<span class="term-fg32">+        let acc_with_bytecode = Account {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(1000),</span>
<span class="term-fg32">+            bytecode_hash: Some(bytecode_hash),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                &amp;[0x11u8; 32],</span>
<span class="term-fg32">+            )),</span>
<span class="term-fg32">+        };</span>
         assert_eq!(
             acc_with_bytecode.get_bytecode_hash(),
             bytecode_hash,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b3b1ff71b6f7c3aeaeb4e7c2" role="button"
                       aria-expanded="false" aria-controls="id-b3b1ff71b6f7c3aeaeb4e7c2">
                        <code>crates/primitives/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/primitives/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/primitives/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b3b1ff71b6f7c3aeaeb4e7c2"><span class="term-fg1">diff --git reth&#47;crates&#47;primitives&#47;Cargo.toml scroll-reth&#47;crates&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">index ebfa26aef0a4fbbeaab3bc5c0c83d29f712de689..12066447ec2c9b88ea24d21cd98ee02298dc05ac 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg36">@@ -16,7 +16,6 @@</span> # reth
 reth-primitives-traits = { workspace = true, features = [&quot;serde&quot;] }
 reth-ethereum-forks.workspace = true
 reth-static-file-types.workspace = true
<span class="term-fg31">-revm-primitives = { workspace = true, features = [&quot;serde&quot;] }</span>
 reth-codecs = { workspace = true, optional = true }
&nbsp;
 # ethereum
<span class="term-fg36">@@ -28,6 +27,9 @@</span> alloy-rpc-types = { workspace = true, optional = true }
 alloy-serde = { workspace = true, optional = true }
 alloy-eips = { workspace = true, features = [&quot;serde&quot;] }
 alloy-trie = { workspace = true, features = [&quot;serde&quot;] }
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;scroll&#47;revm&quot;, features = [&quot;serde&quot;] }</span>
&nbsp;
 # optimism
 op-alloy-rpc-types = { workspace = true, optional = true }
<span class="term-fg36">@@ -67,7 +69,7 @@</span> reth-codecs = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-primitives-traits = { workspace = true, features = [&quot;arbitrary&quot;] }
 reth-testing-utils.workspace = true
 reth-trie-common = { workspace = true, features = [&quot;arbitrary&quot;] }
<span class="term-fg31">-revm-primitives = { workspace = true, features = [&quot;arbitrary&quot;] }</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;scroll&#47;revm&quot;, features = [&quot;arbitrary&quot;] }</span>
&nbsp;
 alloy-eips = { workspace = true, features = [&quot;arbitrary&quot;] }
 alloy-genesis.workspace = true
<span class="term-fg36">@@ -148,7 +150,7 @@</span> alloy-compat = [
 	&quot;dep:alloy-rpc-types&quot;,
 	&quot;dep:alloy-serde&quot;,
 	&quot;dep:op-alloy-rpc-types&quot;,
<span class="term-fg31">-    &quot;dep:alloy-network&quot;,</span>
<span class="term-fg32">+	&quot;dep:alloy-network&quot;,</span>
 ]
 test-utils = [
 	&quot;reth-primitives-traits&#47;test-utils&quot;,
<span class="term-fg36">@@ -156,6 +158,7 @@</span> 	&quot;reth-chainspec&#47;test-utils&quot;,
 	&quot;reth-codecs?&#47;test-utils&quot;,
 	&quot;reth-trie-common&#47;test-utils&quot;,
 	&quot;arbitrary&quot;,
<span class="term-fg32">+	&quot;revm-primitives&#47;test-utils&quot;</span>
 ]
 serde-bincode-compat = [
 	&quot;alloy-consensus&#47;serde-bincode-compat&quot;,
<span class="term-fg36">@@ -163,6 +166,11 @@</span> 	&quot;op-alloy-consensus?&#47;serde-bincode-compat&quot;,
 	&quot;reth-primitives-traits&#47;serde-bincode-compat&quot;,
 	&quot;serde_with&quot;,
 	&quot;alloy-eips&#47;serde-bincode-compat&quot;,
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-testing-utils&#47;scroll&quot;</span>
 ]
&nbsp;
 [[bench]]</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-757c547002ec48d87894816b"role="button" aria-expanded="false" aria-controls="id-757c547002ec48d87894816b">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/stages</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+215</span></div>
                    <div class="text-start"><span class="text-danger">-15</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-757c547002ec48d87894816b">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5430fce24d40cabc7c9cdfe4" role="button"
                       aria-expanded="false" aria-controls="id-5430fce24d40cabc7c9cdfe4">
                        <code>crates/stages/stages/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/stages/stages/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/stages/stages/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+21</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5430fce24d40cabc7c9cdfe4"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml scroll-reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml</span>
<span class="term-fg1">index f97214f4643329336c9b061504d22960f9d6d869..691d618e4fc6f952f8f3696225da531b7b34e397 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;Cargo.toml</span>
<span class="term-fg36">@@ -39,6 +39,10 @@</span> reth-trie-db = { workspace = true, features = [&quot;metrics&quot;] }
&nbsp;
 reth-testing-utils = { workspace = true, optional = true }
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 alloy-eips.workspace = true
 alloy-primitives.workspace = true
 alloy-consensus.workspace = true
<span class="term-fg36">@@ -74,6 +78,8 @@</span> reth-testing-utils.workspace = true
 reth-trie = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-provider = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-network-peers.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
&nbsp;
 alloy-rlp.workspace = true
 itertools.workspace = true
<span class="term-fg36">@@ -114,6 +120,21 @@</span>     &quot;reth-db-api&#47;test-utils&quot;,
     &quot;reth-trie-db&#47;test-utils&quot;,
     &quot;reth-trie&#47;test-utils&quot;,
     &quot;reth-prune-types&#47;test-utils&quot;,
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-testing-utils?&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm-ethereum&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-exex&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives&quot;</span>
 ]
&nbsp;
 [[bench]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a4604ce5ece56e09f8089440" role="button"
                       aria-expanded="false" aria-controls="id-a4604ce5ece56e09f8089440">
                        <code>crates/stages/stages/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/stages/stages/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/stages/stages/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a4604ce5ece56e09f8089440"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;lib.rs</span>
<span class="term-fg1">index ce6a96cf3496aa9ea2af7181fe93c5339fb5f8a0..f21cbc9b2e144683a9ef8d3ef3bbd5ef0b83c47e 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -80,6 +80,8 @@</span> )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
&nbsp;
<span class="term-fg32">+use reth_revm as _;</span>
<span class="term-fg32">+</span>
 #[allow(missing_docs)]
 #[cfg(any(test, feature = &quot;test-utils&quot;))]
 pub mod test_utils;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-96dc1a048bda9087a93e83e7" role="button"
                       aria-expanded="false" aria-controls="id-96dc1a048bda9087a93e83e7">
                        <code>crates/stages/stages/src/stages/execution.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/stages/stages/src/stages/execution.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/stages/stages/src/stages/execution.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+175</span></div>
                            <div class="text-start"><span class="text-danger">-14</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-96dc1a048bda9087a93e83e7"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs</span>
<span class="term-fg1">index 16234ad483f799f31352f443a32a52865fc48f0e..16d87c35c3a24e8f1f459a1b7464d1de78c6d5dc 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;execution.rs</span>
<span class="term-fg36">@@ -21,7 +21,6 @@</span>     OriginalValuesKnown, ProviderError, StateChangeWriter, StateWriter, StaticFileProviderFactory,
     StatsReader, TransactionVariant,
 };
 use reth_prune_types::PruneModes;
<span class="term-fg31">-use reth_revm::database::StateProviderDatabase;</span>
 use reth_stages_api::{
     BlockErrorKind, CheckpointBlockRange, EntitiesCheckpoint, ExecInput, ExecOutput,
     ExecutionCheckpoint, ExecutionStageThresholds, Stage, StageCheckpoint, StageError, StageId,
<span class="term-fg36">@@ -225,7 +224,11 @@</span>         } else {
             None
         };
&nbsp;
<span class="term-fg31">-        let db = StateProviderDatabase(LatestStateProviderRef::new(provider));</span>
<span class="term-fg32">+        let state = LatestStateProviderRef::new(provider);</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let db = reth_scroll_storage::ScrollStateProviderDatabase::new(state);</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let db = reth_revm::database::StateProviderDatabase(state);</span>
         let mut executor = self.executor_provider.batch_executor(db);
         executor.set_tip(max_block);
         executor.set_prune_modes(prune_modes);
<span class="term-fg36">@@ -661,7 +664,7 @@</span> #[cfg(test)]
 mod tests {
     use super::*;
     use crate::test_utils::TestStageDB;
<span class="term-fg31">-    use alloy_primitives::{address, hex_literal::hex, keccak256, Address, B256, U256};</span>
<span class="term-fg32">+    use alloy_primitives::{address, b256, hex_literal::hex, keccak256, Address, B256, U256};</span>
     use alloy_rlp::Decodable;
     use assert_matches::assert_matches;
     use reth_chainspec::ChainSpecBuilder;
<span class="term-fg36">@@ -880,13 +883,27 @@</span>         let code_hash = keccak256(code);
         db_tx
             .put::&lt;tables::PlainAccountState&gt;(
                 acc1,
<span class="term-fg31">-                Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::ZERO,</span>
<span class="term-fg32">+                    bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code),</span>
<span class="term-fg32">+                    ),</span>
<span class="term-fg32">+                },</span>
             )
             .unwrap();
         db_tx
             .put::&lt;tables::PlainAccountState&gt;(
                 acc2,
<span class="term-fg31">-                Account { nonce: 0, balance, bytecode_hash: None },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance,</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
             )
             .unwrap();
         db_tx.put::&lt;tables::Bytecodes&gt;(code_hash, Bytecode::new_raw(code.to_vec().into())).unwrap();
<span class="term-fg36">@@ -936,19 +953,30 @@</span>             let provider = factory.provider().unwrap();
&nbsp;
             &#47;&#47; check post state
             let account1 = address!(&quot;1000000000000000000000000000000000000000&quot;);
<span class="term-fg31">-            let account1_info =</span>
<span class="term-fg31">-                Account { balance: U256::ZERO, nonce: 0x00, bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+            let account1_info = Account {</span>
<span class="term-fg32">+                balance: U256::ZERO,</span>
<span class="term-fg32">+                nonce: 0x00,</span>
<span class="term-fg32">+                bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                    &amp;code,</span>
<span class="term-fg32">+                )),</span>
<span class="term-fg32">+            };</span>
             let account2 = address!(&quot;2adc25665018aa1fe0e6bc666dac8fc2697ff9ba&quot;);
             let account2_info = Account {
                 balance: U256::from(0x1bc16d674ece94bau128),
                 nonce: 0x00,
                 bytecode_hash: None,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
             };
             let account3 = address!(&quot;a94f5374fce5edbc8e2a8697c15331677e6ebf0b&quot;);
             let account3_info = Account {
                 balance: U256::from(0x3635c9adc5de996b46u128),
                 nonce: 0x01,
                 bytecode_hash: None,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
             };
&nbsp;
             &#47;&#47; assert accounts
<span class="term-fg36">@@ -1024,9 +1052,21 @@</span>         let provider = factory.provider_rw().unwrap();
&nbsp;
         let db_tx = provider.tx_ref();
         let acc1 = address!(&quot;1000000000000000000000000000000000000000&quot;);
<span class="term-fg31">-        let acc1_info = Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+        let acc1_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
<span class="term-fg32">+        };</span>
         let acc2 = address!(&quot;a94f5374fce5edbc8e2a8697c15331677e6ebf0b&quot;);
<span class="term-fg31">-        let acc2_info = Account { nonce: 0, balance, bytecode_hash: None };</span>
<span class="term-fg32">+        let acc2_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
&nbsp;
         db_tx.put::&lt;tables::PlainAccountState&gt;(acc1, acc1_info).unwrap();
         db_tx.put::&lt;tables::PlainAccountState&gt;(acc2, acc2_info).unwrap();
<span class="term-fg36">@@ -1143,9 +1183,20 @@</span>         let balance = U256::from(0x0de0b6b3a7640000u64);
         let code_hash = keccak256(code);
&nbsp;
         &#47;&#47; pre state
<span class="term-fg31">-        let caller_info = Account { nonce: 0, balance, bytecode_hash: None };</span>
<span class="term-fg31">-        let destroyed_info =</span>
<span class="term-fg31">-            Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+        let caller_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let destroyed_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
<span class="term-fg32">+        };</span>
&nbsp;
         &#47;&#47; set account
         let provider = test_db.factory.provider_rw().unwrap();
<span class="term-fg36">@@ -1204,7 +1255,9 @@</span>                     beneficiary_address,
                     Account {
                         nonce: 0,
                         balance: U256::from(0x1bc16d674eca30a0u64),
<span class="term-fg31">-                        bytecode_hash: None</span>
<span class="term-fg32">+                        bytecode_hash: None,</span>
<span class="term-fg32">+                        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                     }
                 ),
                 (
<span class="term-fg36">@@ -1212,7 +1265,9 @@</span>                     caller_address,
                     Account {
                         nonce: 1,
                         balance: U256::from(0xde0b6b3a761cf60u64),
<span class="term-fg31">-                        bytecode_hash: None</span>
<span class="term-fg32">+                        bytecode_hash: None,</span>
<span class="term-fg32">+                        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                     }
                 )
             ]
<span class="term-fg36">@@ -1250,5 +1305,111 @@</span>                     StorageEntry { key: B256::with_last_byte(1), value: U256::from(1u64) }
                 )
             ]
         );
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    #[test]</span>
<span class="term-fg32">+    fn test_create() {</span>
<span class="term-fg32">+        let test_db = TestStageDB::default();</span>
<span class="term-fg32">+        let provider = test_db.factory.database_provider_rw().unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; set up block</span>
<span class="term-fg32">+        let beneficiary_address = address!(&quot;00000000000000000000000000000000deadbeef&quot;);</span>
<span class="term-fg32">+        let gas_limit = 1000000;</span>
<span class="term-fg32">+        let data = hex!(&quot;6080604052600d8060106000396000f3604260000160005260206000f3&quot;);</span>
<span class="term-fg32">+        let code = hex!(&quot;604260000160005260206000f3&quot;);</span>
<span class="term-fg32">+        let pk = b256!(&quot;ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80&quot;);</span>
<span class="term-fg32">+        let transaction = reth_primitives::Transaction::Legacy(alloy_consensus::TxLegacy {</span>
<span class="term-fg32">+            gas_limit,</span>
<span class="term-fg32">+            to: alloy_primitives::TxKind::Create,</span>
<span class="term-fg32">+            input: alloy_primitives::Bytes::from(data),</span>
<span class="term-fg32">+            ..Default::default()</span>
<span class="term-fg32">+        });</span>
<span class="term-fg32">+        let signature = reth_primitives::sign_message(pk, transaction.signature_hash()).unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        let header = SealedHeader::new(</span>
<span class="term-fg32">+            Header {</span>
<span class="term-fg32">+                number: 1,</span>
<span class="term-fg32">+                gas_limit,</span>
<span class="term-fg32">+                gas_used: 56043,</span>
<span class="term-fg32">+                receipts_root: b256!(</span>
<span class="term-fg32">+                    &quot;141fb9a024b83e3752156621fb9f8376e8a16d281b8392640637f5b9fd095e36&quot;</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+                beneficiary: beneficiary_address,</span>
<span class="term-fg32">+                ..Default::default()</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+            B256::random(),</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        let transaction = reth_primitives::TransactionSigned::new_unhashed(transaction, signature);</span>
<span class="term-fg32">+        let block = SealedBlock::new(</span>
<span class="term-fg32">+            header,</span>
<span class="term-fg32">+            reth_primitives::BlockBody {</span>
<span class="term-fg32">+                transactions: vec![transaction.clone()],</span>
<span class="term-fg32">+                ..Default::default()</span>
<span class="term-fg32">+            },</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        provider.insert_historical_block(block.try_seal_with_senders().unwrap()).unwrap();</span>
<span class="term-fg32">+        provider</span>
<span class="term-fg32">+            .static_file_provider()</span>
<span class="term-fg32">+            .latest_writer(StaticFileSegment::Headers)</span>
<span class="term-fg32">+            .unwrap()</span>
<span class="term-fg32">+            .commit()</span>
<span class="term-fg32">+            .unwrap();</span>
<span class="term-fg32">+        provider.commit().unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; caller pre state</span>
<span class="term-fg32">+        let caller_address = transaction.recover_signer().unwrap();</span>
<span class="term-fg32">+        let deployed_address = address!(&quot;5fbdb2315678afecb367f032d93f642f64180aa3&quot;);</span>
<span class="term-fg32">+        let balance = U256::MAX;</span>
<span class="term-fg32">+        let caller_info = Account {</span>
<span class="term-fg32">+            nonce: 0,</span>
<span class="term-fg32">+            balance,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; set account</span>
<span class="term-fg32">+        let provider = test_db.factory.provider_rw().unwrap();</span>
<span class="term-fg32">+        provider.tx_ref().put::&lt;tables::PlainAccountState&gt;(caller_address, caller_info).unwrap();</span>
<span class="term-fg32">+        provider.commit().unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; execute</span>
<span class="term-fg32">+        let provider = test_db.factory.database_provider_rw().unwrap();</span>
<span class="term-fg32">+        let mut execution_stage = stage();</span>
<span class="term-fg32">+        let input = ExecInput { target: Some(1), checkpoint: None };</span>
<span class="term-fg32">+        let _ = execution_stage.execute(&amp;provider, input).unwrap();</span>
<span class="term-fg32">+        provider.commit().unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        &#47;&#47; verify plain accounts content from storage</span>
<span class="term-fg32">+        let plain_accounts = test_db.table::&lt;tables::PlainAccountState&gt;().unwrap();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        assert_eq!(</span>
<span class="term-fg32">+            plain_accounts,</span>
<span class="term-fg32">+            vec![</span>
<span class="term-fg32">+                (</span>
<span class="term-fg32">+                    beneficiary_address,</span>
<span class="term-fg32">+                    Account {</span>
<span class="term-fg32">+                        nonce: 0,</span>
<span class="term-fg32">+                        balance: U256::from(0x1bc16d674ec80000u64),</span>
<span class="term-fg32">+                        bytecode_hash: None,</span>
<span class="term-fg32">+                        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                        account_extension: Some(reth_scroll_primitives::AccountExtension::empty())</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+                (</span>
<span class="term-fg32">+                    deployed_address,</span>
<span class="term-fg32">+                    Account {</span>
<span class="term-fg32">+                        nonce: 1,</span>
<span class="term-fg32">+                        balance: U256::ZERO,</span>
<span class="term-fg32">+                        bytecode_hash: Some(keccak256(code)),</span>
<span class="term-fg32">+                        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                        account_extension: Some(</span>
<span class="term-fg32">+                            reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)</span>
<span class="term-fg32">+                        ),</span>
<span class="term-fg32">+                    }</span>
<span class="term-fg32">+                ),</span>
<span class="term-fg32">+                (caller_address, Account { nonce: 1, ..caller_info }),</span>
<span class="term-fg32">+            ]</span>
<span class="term-fg32">+        )</span>
     }
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-345fff13477b4514db8282b4" role="button"
                       aria-expanded="false" aria-controls="id-345fff13477b4514db8282b4">
                        <code>crates/stages/stages/src/stages/hashing_account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/stages/stages/src/stages/hashing_account.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/stages/stages/src/stages/hashing_account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-345fff13477b4514db8282b4"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs</span>
<span class="term-fg1">index e6b1e548455fa8d42a6ab23d99c893d9ebe6800e..895943b83a9296a5fa1a65b94d183e5fd4839656 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;hashing_account.rs</span>
<span class="term-fg36">@@ -109,6 +109,8 @@</span>                 let prev_acc = Account {
                     nonce: nonce - 1,
                     balance: balance - U256::from(1),
                     bytecode_hash: None,
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                 };
                 let acc_before_tx = AccountBeforeTx { address: *addr, info: Some(prev_acc) };
                 acc_changeset_cursor.append(t, acc_before_tx)?;
<span class="term-fg36">@@ -403,6 +405,10 @@</span>                         let old_acc = Account {
                             nonce: nonce - 1,
                             balance: balance - U256::from(1),
                             bytecode_hash: None,
<span class="term-fg32">+                            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                            account_extension: Some(</span>
<span class="term-fg32">+                                reth_scroll_primitives::AccountExtension::empty(),</span>
<span class="term-fg32">+                            ),</span>
                         };
                         let hashed_addr = keccak256(address);
                         if let Some((_, acc)) = hashed_acc_cursor.seek_exact(hashed_addr)? {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-570f9d7a2d73bef43a42b62d" role="button"
                       aria-expanded="false" aria-controls="id-570f9d7a2d73bef43a42b62d">
                        <code>crates/stages/stages/src/stages/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/stages/stages/src/stages/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/stages/stages/src/stages/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-570f9d7a2d73bef43a42b62d"><span class="term-fg1">diff --git reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs</span>
<span class="term-fg1">index 9d7cc685a7ef7875fef1d39fa5557cebe8f06271..b0bcebd5e9a7bd93faddcba27b9a8f0f5d2d3582 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;stages&#47;stages&#47;src&#47;stages&#47;mod.rs</span>
<span class="term-fg36">@@ -117,7 +117,15 @@</span>         provider_rw
             .tx_ref()
             .put::&lt;tables::PlainAccountState&gt;(
                 address!(&quot;1000000000000000000000000000000000000000&quot;),
<span class="term-fg31">-                Account { nonce: 0, balance: U256::ZERO, bytecode_hash: Some(code_hash) },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::ZERO,</span>
<span class="term-fg32">+                    bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code),</span>
<span class="term-fg32">+                    ),</span>
<span class="term-fg32">+                },</span>
             )
             .unwrap();
         provider_rw
<span class="term-fg36">@@ -128,6 +136,8 @@</span>                 Account {
                     nonce: 0,
                     balance: U256::from(0x3635c9adc5dea00000u128),
                     bytecode_hash: None,
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
                 },
             )
             .unwrap();</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-8608072578d235d2c1746532"role="button" aria-expanded="false" aria-controls="id-8608072578d235d2c1746532">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/storage</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+160</span></div>
                    <div class="text-start"><span class="text-danger">-51</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-8608072578d235d2c1746532">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4e37929bec4deeeeba317f7d" role="button"
                       aria-expanded="false" aria-controls="id-4e37929bec4deeeeba317f7d">
                        <code>crates/storage/db-common/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/db-common/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/storage/db-common/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4e37929bec4deeeeba317f7d"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml</span>
<span class="term-fg1">index 9e4954357f84e7a05ab071bed9931a25a38e6780..662d1fdb0295b25b2bd830549f52c2517692a8fb 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db-common&#47;Cargo.toml</span>
<span class="term-fg36">@@ -27,6 +27,9 @@</span> # eth
 alloy-genesis.workspace = true
 alloy-primitives.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # misc
 eyre.workspace = true
 thiserror.workspace = true
<span class="term-fg36">@@ -46,3 +49,6 @@</span> alloy-consensus.workspace = true
&nbsp;
 [lints]
 workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [&quot;reth-scroll-primitives&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5b785b96678d207c6b06eda3" role="button"
                       aria-expanded="false" aria-controls="id-5b785b96678d207c6b06eda3">
                        <code>crates/storage/db-common/src/init.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/db-common/src/init.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/storage/db-common/src/init.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5b785b96678d207c6b06eda3"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs scroll-reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs</span>
<span class="term-fg1">index e14796d268617389d0cf3b6e578b1bf4cdd8ef5b..48fb946a111c0eab4da2c06e71b8d38da9e6959d 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db-common&#47;src&#47;init.rs</span>
<span class="term-fg36">@@ -214,6 +214,12 @@</span>                 Some(Account {
                     nonce: account.nonce.unwrap_or_default(),
                     balance: account.balance,
                     bytecode_hash,
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                            account.code.as_ref().unwrap_or_default(),</span>
<span class="term-fg32">+                        ),</span>
<span class="term-fg32">+                    ),</span>
                 }),
                 storage,
             ),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-334475b4486601c87b38f87f" role="button"
                       aria-expanded="false" aria-controls="id-334475b4486601c87b38f87f">
                        <code>crates/storage/db/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/db/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/storage/db/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-334475b4486601c87b38f87f"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">index 5ff9fb43a3d91cac486d18264bc1ff6bea128db8..7429f76afd71527f4abe86d0c1f40d8e700403d9 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db&#47;Cargo.toml</span>
<span class="term-fg36">@@ -63,6 +63,8 @@</span> tempfile.workspace = true
 test-fuzz.workspace = true
 parking_lot.workspace = true
&nbsp;
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
 pprof = { workspace = true, features = [
     &quot;flamegraph&quot;,
     &quot;frame-pointer&quot;,
<span class="term-fg36">@@ -111,9 +113,15 @@</span>     &quot;alloy-primitives&#47;arbitrary&quot;,
     &quot;reth-prune-types&#47;arbitrary&quot;,
     &quot;reth-stages-types&#47;arbitrary&quot;,
     &quot;alloy-consensus&#47;arbitrary&quot;,
<span class="term-fg32">+    &quot;reth-scroll-primitives&#47;arbitrary&quot;</span>
 ]
 optimism = [&quot;reth-primitives&#47;optimism&quot;, &quot;reth-db-api&#47;optimism&quot;]
 disable-lock = []
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie-common&#47;scroll&quot;</span>
<span class="term-fg32">+]</span>
&nbsp;
 [[bench]]
 name = &quot;hash_keys&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-97ab95e4282fc60a9615af5c" role="button"
                       aria-expanded="false" aria-controls="id-97ab95e4282fc60a9615af5c">
                        <code>crates/storage/db/src/implementation/mdbx/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/db/src/implementation/mdbx/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/storage/db/src/implementation/mdbx/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-97ab95e4282fc60a9615af5c"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs scroll-reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs</span>
<span class="term-fg1">index 006213e4cb916f4667172f5fffe3f2a5579c1ba5..e564a25e859809be06abc5c58f4be15d169668a1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;db&#47;src&#47;implementation&#47;mdbx&#47;mod.rs</span>
<span class="term-fg36">@@ -1178,6 +1178,8 @@</span>         let value = Account {
             nonce: 18446744073709551615,
             bytecode_hash: Some(B256::random()),
             balance: U256::MAX,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some((10u64, B256::random()).into()),</span>
         };
         let key = Address::from_str(&quot;0xa2c122be93b0074270ebee7f6b7292c7deb45047&quot;)
             .expect(ERROR_ETH_ADDRESS);</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1345d4989384fe34a874400e" role="button"
                       aria-expanded="false" aria-controls="id-1345d4989384fe34a874400e">
                        <code>crates/storage/provider/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/provider/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/storage/provider/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+15</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1345d4989384fe34a874400e"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml scroll-reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml</span>
<span class="term-fg1">index 86f2f3a51b9142cb6c1888a0fd6ce6515a510827..9db25d5ee09bb5a54da17f8c0f92b7cbdb6f831b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;Cargo.toml</span>
<span class="term-fg36">@@ -42,6 +42,9 @@</span> alloy-rpc-types-engine.workspace = true
 alloy-consensus.workspace = true
 revm.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # optimism
 reth-optimism-primitives = { workspace = true, optional = true }
&nbsp;
<span class="term-fg36">@@ -78,6 +81,8 @@</span> reth-chain-state = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-trie = { workspace = true, features = [&quot;test-utils&quot;] }
 reth-testing-utils.workspace = true
 reth-ethereum-engine-primitives.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
&nbsp;
 parking_lot.workspace = true
 tempfile.workspace = true
<span class="term-fg36">@@ -133,3 +138,13 @@</span>     &quot;reth-prune-types&#47;test-utils&quot;,
     &quot;reth-stages-types&#47;test-utils&quot;,
     &quot;reth-optimism-primitives?&#47;arbitrary&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-86ecb8fafe9dba3fa0fd26bc" role="button"
                       aria-expanded="false" aria-controls="id-86ecb8fafe9dba3fa0fd26bc">
                        <code>crates/storage/provider/src/providers/state/historical.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/provider/src/providers/state/historical.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/storage/provider/src/providers/state/historical.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+42</span></div>
                            <div class="text-start"><span class="text-danger">-6</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-86ecb8fafe9dba3fa0fd26bc"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs</span>
<span class="term-fg1">index 29ba70e2049e4358389513af28caf0a8bd7ec6cb..39a71b924431f828a1898813df0bbbea7b1966f7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;providers&#47;state&#47;historical.rs</span>
<span class="term-fg36">@@ -542,13 +542,49 @@</span>             BlockNumberList::new([4]).unwrap(),
         )
         .unwrap();
&nbsp;
<span class="term-fg31">-        let acc_plain = Account { nonce: 100, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at15 = Account { nonce: 15, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at10 = Account { nonce: 10, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at7 = Account { nonce: 7, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg31">-        let acc_at3 = Account { nonce: 3, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let acc_plain = Account {</span>
<span class="term-fg32">+            nonce: 100,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at15 = Account {</span>
<span class="term-fg32">+            nonce: 15,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at10 = Account {</span>
<span class="term-fg32">+            nonce: 10,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at7 = Account {</span>
<span class="term-fg32">+            nonce: 7,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let acc_at3 = Account {</span>
<span class="term-fg32">+            nonce: 3,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
&nbsp;
<span class="term-fg31">-        let higher_acc_plain = Account { nonce: 4, balance: U256::ZERO, bytecode_hash: None };</span>
<span class="term-fg32">+        let higher_acc_plain = Account {</span>
<span class="term-fg32">+            nonce: 4,</span>
<span class="term-fg32">+            balance: U256::ZERO,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+        };</span>
&nbsp;
         &#47;&#47; setup
         tx.put::&lt;tables::AccountChangeSets&gt;(1, AccountBeforeTx { address: ADDRESS, info: None })</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c3e1fe767d3fa5dfc497fb18" role="button"
                       aria-expanded="false" aria-controls="id-c3e1fe767d3fa5dfc497fb18">
                        <code>crates/storage/provider/src/test_utils/mock.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/provider/src/test_utils/mock.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/storage/provider/src/test_utils/mock.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c3e1fe767d3fa5dfc497fb18"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs</span>
<span class="term-fg1">index a0ecb7256cb86791090cdccda6b46687ad0f86a3..8924ee55b5b273711c71e18330ba614af2c9acac 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;test_utils&#47;mock.rs</span>
<span class="term-fg36">@@ -82,7 +82,13 @@</span> impl ExtendedAccount {
     &#47;&#47;&#47; Create new instance of extended account
     pub fn new(nonce: u64, balance: U256) -&gt; Self {
         Self {
<span class="term-fg31">-            account: Account { nonce, balance, bytecode_hash: None },</span>
<span class="term-fg32">+            account: Account {</span>
<span class="term-fg32">+                nonce,</span>
<span class="term-fg32">+                balance,</span>
<span class="term-fg32">+                bytecode_hash: None,</span>
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+            },</span>
             bytecode: None,
             storage: Default::default(),
         }
<span class="term-fg36">@@ -90,6 +96,11 @@</span>     }
&nbsp;
     &#47;&#47;&#47; Set bytecode and bytecode hash on the extended account
     pub fn with_bytecode(mut self, bytecode: Bytes) -&gt; Self {
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+            self.account.account_extension =</span>
<span class="term-fg32">+                Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;bytecode));</span>
<span class="term-fg32">+        }</span>
         let hash = keccak256(&amp;bytecode);
         self.account.bytecode_hash = Some(hash);
         self.bytecode = Some(Bytecode::new_raw(bytecode));</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9207374d9991d220843d686b" role="button"
                       aria-expanded="false" aria-controls="id-9207374d9991d220843d686b">
                        <code>crates/storage/provider/src/writer/mod.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/storage/provider/src/writer/mod.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/storage/provider/src/writer/mod.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+69</span></div>
                            <div class="text-start"><span class="text-danger">-44</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9207374d9991d220843d686b"><span class="term-fg1">diff --git reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs</span>
<span class="term-fg1">index 30c5f0d5291d5cfb763ad504c2fd6216a0b50651..88034d82794c1de43b4161b3ab6520e59d8d420a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;storage&#47;provider&#47;src&#47;writer&#47;mod.rs</span>
<span class="term-fg36">@@ -472,6 +472,8 @@</span> }
&nbsp;
 #[cfg(test)]
 mod tests {
<span class="term-fg32">+    #![allow(clippy::useless_conversion)]</span>
<span class="term-fg32">+</span>
     use super::*;
     use crate::{
         test_utils::create_test_provider_factory, AccountReader, StorageTrieWriter, TrieWriter,
<span class="term-fg36">@@ -570,13 +572,13 @@</span>             RevmAccountInfo { balance: U256::from(3), nonce: 3, ..Default::default() };
&nbsp;
         let mut state = State::builder().with_bundle_update().build();
         state.insert_not_existing(address_a);
<span class="term-fg31">-        state.insert_account(address_b, account_b.clone());</span>
<span class="term-fg32">+        state.insert_account(address_b, account_b.clone().into());</span>
&nbsp;
         &#47;&#47; 0x00.. is created
         state.commit(HashMap::from_iter([(
             address_a,
             RevmAccount {
<span class="term-fg31">-                info: account_a.clone(),</span>
<span class="term-fg32">+                info: account_a.clone().into(),</span>
                 status: AccountStatus::Touched | AccountStatus::Created,
                 storage: HashMap::default(),
             },
<span class="term-fg36">@@ -586,7 +588,7 @@</span>         &#47;&#47; 0xff.. is changed (balance + 1, nonce + 1)
         state.commit(HashMap::from_iter([(
             address_b,
             RevmAccount {
<span class="term-fg31">-                info: account_b_changed.clone(),</span>
<span class="term-fg32">+                info: account_b_changed.clone().into(),</span>
                 status: AccountStatus::Touched,
                 storage: HashMap::default(),
             },
<span class="term-fg36">@@ -596,8 +598,10 @@</span>         state.merge_transitions(BundleRetention::Reverts);
         let mut revm_bundle_state = state.take_bundle();
&nbsp;
         &#47;&#47; Write plain state and reverts separately.
<span class="term-fg31">-        let reverts = revm_bundle_state.take_all_reverts().to_plain_state_reverts();</span>
<span class="term-fg31">-        let plain_state = revm_bundle_state.to_plain_state(OriginalValuesKnown::Yes);</span>
<span class="term-fg32">+        let reverts: revm::db::states::PlainStateReverts =</span>
<span class="term-fg32">+            revm_bundle_state.take_all_reverts().to_plain_state_reverts().into();</span>
<span class="term-fg32">+        let plain_state: revm::db::states::StateChangeset =</span>
<span class="term-fg32">+            revm_bundle_state.to_plain_state(OriginalValuesKnown::Yes).into();</span>
         assert!(plain_state.storage.is_empty());
         assert!(plain_state.contracts.is_empty());
         provider.write_state_changes(plain_state).expect(&quot;Could not write plain state to DB&quot;);
<span class="term-fg36">@@ -638,14 +642,14 @@</span>             &quot;Account B changeset is wrong&quot;
         );
&nbsp;
         let mut state = State::builder().with_bundle_update().build();
<span class="term-fg31">-        state.insert_account(address_b, account_b_changed.clone());</span>
<span class="term-fg32">+        state.insert_account(address_b, account_b_changed.clone().into());</span>
&nbsp;
         &#47;&#47; 0xff.. is destroyed
         state.commit(HashMap::from_iter([(
             address_b,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account_b_changed,</span>
<span class="term-fg32">+                info: account_b_changed.into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -654,8 +658,10 @@</span>         state.merge_transitions(BundleRetention::Reverts);
         let mut revm_bundle_state = state.take_bundle();
&nbsp;
         &#47;&#47; Write plain state and reverts separately.
<span class="term-fg31">-        let reverts = revm_bundle_state.take_all_reverts().to_plain_state_reverts();</span>
<span class="term-fg31">-        let plain_state = revm_bundle_state.to_plain_state(OriginalValuesKnown::Yes);</span>
<span class="term-fg32">+        let reverts: revm::db::states::PlainStateReverts =</span>
<span class="term-fg32">+            revm_bundle_state.take_all_reverts().to_plain_state_reverts().into();</span>
<span class="term-fg32">+        let plain_state: revm::db::states::StateChangeset =</span>
<span class="term-fg32">+            revm_bundle_state.to_plain_state(OriginalValuesKnown::Yes).into();</span>
         &#47;&#47; Account B selfdestructed so flag for it should be present.
         assert_eq!(
             plain_state.storage,
<span class="term-fg36">@@ -699,7 +705,7 @@</span>         let mut state = State::builder().with_bundle_update().build();
         state.insert_not_existing(address_a);
         state.insert_account_with_storage(
             address_b,
<span class="term-fg31">-            account_b.clone(),</span>
<span class="term-fg32">+            account_b.clone().into(),</span>
             HashMap::from_iter([(U256::from(1), U256::from(1))]),
         );
&nbsp;
<span class="term-fg36">@@ -708,7 +714,7 @@</span>             (
                 address_a,
                 RevmAccount {
                     status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                    info: RevmAccountInfo::default(),</span>
<span class="term-fg32">+                    info: RevmAccountInfo::default().into(),</span>
                     &#47;&#47; 0x00 =&gt; 0 =&gt; 1
                     &#47;&#47; 0x01 =&gt; 0 =&gt; 2
                     storage: HashMap::from_iter([
<span class="term-fg36">@@ -727,7 +733,7 @@</span>             (
                 address_b,
                 RevmAccount {
                     status: AccountStatus::Touched,
<span class="term-fg31">-                    info: account_b,</span>
<span class="term-fg32">+                    info: account_b.into(),</span>
                     &#47;&#47; 0x01 =&gt; 1 =&gt; 2
                     storage: HashMap::from_iter([(
                         U256::from(1),
<span class="term-fg36">@@ -744,7 +750,7 @@</span>
         state.merge_transitions(BundleRetention::Reverts);
&nbsp;
         let outcome =
<span class="term-fg31">-            ExecutionOutcome::new(state.take_bundle(), Receipts::default(), 1, Vec::new());</span>
<span class="term-fg32">+            ExecutionOutcome::new(state.take_bundle().into(), Receipts::default(), 1, Vec::new());</span>
         let mut writer = UnifiedStorageWriter::from_database(&amp;provider);
         writer
             .write_to_storage(outcome, OriginalValuesKnown::Yes)
<span class="term-fg36">@@ -832,20 +838,20 @@</span>         );
&nbsp;
         &#47;&#47; Delete account A
         let mut state = State::builder().with_bundle_update().build();
<span class="term-fg31">-        state.insert_account(address_a, RevmAccountInfo::default());</span>
<span class="term-fg32">+        state.insert_account(address_a, RevmAccountInfo::default().into());</span>
&nbsp;
         state.commit(HashMap::from_iter([(
             address_a,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: RevmAccountInfo::default(),</span>
<span class="term-fg32">+                info: RevmAccountInfo::default().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
&nbsp;
         state.merge_transitions(BundleRetention::Reverts);
         let outcome =
<span class="term-fg31">-            ExecutionOutcome::new(state.take_bundle(), Receipts::default(), 2, Vec::new());</span>
<span class="term-fg32">+            ExecutionOutcome::new(state.take_bundle().into(), Receipts::default(), 2, Vec::new());</span>
         let mut writer = UnifiedStorageWriter::from_database(&amp;provider);
         writer
             .write_to_storage(outcome, OriginalValuesKnown::Yes)
<span class="term-fg36">@@ -894,7 +900,7 @@</span>         init_state.insert_not_existing(address1);
         init_state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 status: AccountStatus::Touched | AccountStatus::Created,
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 1
                 &#47;&#47; 0x01 =&gt; 0 =&gt; 2
<span class="term-fg36">@@ -912,8 +918,12 @@</span>             },
         )]));
         init_state.merge_transitions(BundleRetention::Reverts);
&nbsp;
<span class="term-fg31">-        let outcome =</span>
<span class="term-fg31">-            ExecutionOutcome::new(init_state.take_bundle(), Receipts::default(), 0, Vec::new());</span>
<span class="term-fg32">+        let outcome = ExecutionOutcome::new(</span>
<span class="term-fg32">+            init_state.take_bundle().into(),</span>
<span class="term-fg32">+            Receipts::default(),</span>
<span class="term-fg32">+            0,</span>
<span class="term-fg32">+            Vec::new(),</span>
<span class="term-fg32">+        );</span>
         let mut writer = UnifiedStorageWriter::from_database(&amp;provider);
         writer
             .write_to_storage(outcome, OriginalValuesKnown::Yes)
<span class="term-fg36">@@ -922,7 +932,7 @@</span>
         let mut state = State::builder().with_bundle_update().build();
         state.insert_account_with_storage(
             address1,
<span class="term-fg31">-            account_info.clone(),</span>
<span class="term-fg32">+            account_info.clone().into(),</span>
             HashMap::from_iter([(U256::ZERO, U256::from(1)), (U256::from(1), U256::from(2))]),
         );
&nbsp;
<span class="term-fg36">@@ -931,7 +941,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 &#47;&#47; 0x00 =&gt; 1 =&gt; 2
                 storage: HashMap::from_iter([(
                     U256::ZERO,
<span class="term-fg36">@@ -950,7 +960,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -961,7 +971,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -972,7 +982,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 2
                 &#47;&#47; 0x02 =&gt; 0 =&gt; 4
                 &#47;&#47; 0x06 =&gt; 0 =&gt; 6
<span class="term-fg36">@@ -999,7 +1009,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -1010,7 +1020,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -1018,7 +1028,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 2
                 storage: HashMap::from_iter([(
                     U256::ZERO,
<span class="term-fg36">@@ -1030,7 +1040,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -1038,7 +1048,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                info: account_info.clone(),</span>
<span class="term-fg32">+                info: account_info.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -1049,7 +1059,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account_info,</span>
<span class="term-fg32">+                info: account_info.into(),</span>
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 9
                 storage: HashMap::from_iter([(
                     U256::ZERO,
<span class="term-fg36">@@ -1059,7 +1069,7 @@</span>             },
         )]));
         state.merge_transitions(BundleRetention::Reverts);
&nbsp;
<span class="term-fg31">-        let bundle = state.take_bundle();</span>
<span class="term-fg32">+        let bundle = state.take_bundle().into();</span>
&nbsp;
         let outcome: ExecutionOutcome =
             ExecutionOutcome::new(bundle, Receipts::default(), 1, Vec::new());
<span class="term-fg36">@@ -1210,7 +1220,7 @@</span>         init_state.insert_not_existing(address1);
         init_state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
<span class="term-fg31">-                info: account1.clone(),</span>
<span class="term-fg32">+                info: account1.clone().into(),</span>
                 status: AccountStatus::Touched | AccountStatus::Created,
                 &#47;&#47; 0x00 =&gt; 0 =&gt; 1
                 &#47;&#47; 0x01 =&gt; 0 =&gt; 2
<span class="term-fg36">@@ -1227,8 +1237,12 @@</span>                 ]),
             },
         )]));
         init_state.merge_transitions(BundleRetention::Reverts);
<span class="term-fg31">-        let outcome =</span>
<span class="term-fg31">-            ExecutionOutcome::new(init_state.take_bundle(), Receipts::default(), 0, Vec::new());</span>
<span class="term-fg32">+        let outcome = ExecutionOutcome::new(</span>
<span class="term-fg32">+            init_state.take_bundle().into(),</span>
<span class="term-fg32">+            Receipts::default(),</span>
<span class="term-fg32">+            0,</span>
<span class="term-fg32">+            Vec::new(),</span>
<span class="term-fg32">+        );</span>
         let mut writer = UnifiedStorageWriter::from_database(&amp;provider);
         writer
             .write_to_storage(outcome, OriginalValuesKnown::Yes)
<span class="term-fg36">@@ -1237,7 +1251,7 @@</span>
         let mut state = State::builder().with_bundle_update().build();
         state.insert_account_with_storage(
             address1,
<span class="term-fg31">-            account1.clone(),</span>
<span class="term-fg32">+            account1.clone().into(),</span>
             HashMap::from_iter([(U256::ZERO, U256::from(1)), (U256::from(1), U256::from(2))]),
         );
&nbsp;
<span class="term-fg36">@@ -1246,7 +1260,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: account1.clone(),</span>
<span class="term-fg32">+                info: account1.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -1255,7 +1269,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::Created,
<span class="term-fg31">-                info: account1.clone(),</span>
<span class="term-fg32">+                info: account1.clone().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -1264,7 +1278,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched,
<span class="term-fg31">-                info: account1,</span>
<span class="term-fg32">+                info: account1.into(),</span>
                 &#47;&#47; 0x01 =&gt; 0 =&gt; 5
                 storage: HashMap::from_iter([(
                     U256::from(1),
<span class="term-fg36">@@ -1276,7 +1290,7 @@</span>
         &#47;&#47; Commit block #1 changes to the database.
         state.merge_transitions(BundleRetention::Reverts);
         let outcome =
<span class="term-fg31">-            ExecutionOutcome::new(state.take_bundle(), Receipts::default(), 1, Vec::new());</span>
<span class="term-fg32">+            ExecutionOutcome::new(state.take_bundle().into(), Receipts::default(), 1, Vec::new());</span>
         let mut writer = UnifiedStorageWriter::from_database(&amp;provider);
         writer
             .write_to_storage(outcome, OriginalValuesKnown::Yes)
<span class="term-fg36">@@ -1341,7 +1355,13 @@</span>     fn bundle_state_state_root() {
         type PreState = BTreeMap&lt;Address, (Account, BTreeMap&lt;B256, U256&gt;)&gt;;
         let mut prestate: PreState = (0..10)
             .map(|key| {
<span class="term-fg31">-                let account = Account { nonce: 1, balance: U256::from(key), bytecode_hash: None };</span>
<span class="term-fg32">+                let account = Account {</span>
<span class="term-fg32">+                    nonce: 1,</span>
<span class="term-fg32">+                    balance: U256::from(key),</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                };</span>
                 let storage =
                     (1..11).map(|key| (B256::with_last_byte(key), U256::from(key))).collect();
                 (Address::with_last_byte(key), (account, storage))
<span class="term-fg36">@@ -1375,7 +1395,7 @@</span>             assert_eq!(
                 StateRoot::overlay_root(
                     tx,
                     ExecutionOutcome::&lt;Receipt&gt;::new(
<span class="term-fg31">-                        state.bundle_state.clone(),</span>
<span class="term-fg32">+                        state.bundle_state.clone().into(),</span>
                         Receipts::default(),
                         0,
                         Vec::new()
<span class="term-fg36">@@ -1402,7 +1422,7 @@</span>         state.commit(HashMap::from_iter([(
             address1,
             RevmAccount {
                 status: AccountStatus::Touched | AccountStatus::SelfDestructed,
<span class="term-fg31">-                info: RevmAccountInfo::default(),</span>
<span class="term-fg32">+                info: RevmAccountInfo::default().into(),</span>
                 storage: HashMap::default(),
             },
         )]));
<span class="term-fg36">@@ -1472,8 +1492,13 @@</span>         state.merge_transitions(BundleRetention::PlainState);
         assert_state_root(&amp;state, &amp;prestate, &quot;changed nonce&quot;);
&nbsp;
         &#47;&#47; recreate account 1
<span class="term-fg31">-        let account1_new =</span>
<span class="term-fg31">-            Account { nonce: 56, balance: U256::from(123), bytecode_hash: Some(B256::random()) };</span>
<span class="term-fg32">+        let account1_new = Account {</span>
<span class="term-fg32">+            nonce: 56,</span>
<span class="term-fg32">+            balance: U256::from(123),</span>
<span class="term-fg32">+            bytecode_hash: Some(B256::random()),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some((10, B256::random()).into()),</span>
<span class="term-fg32">+        };</span>
         prestate.insert(address1, (account1_new, BTreeMap::default()));
         state.commit(HashMap::from_iter([(
             address1,</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-1bdaeb925a49f1db3a374b3b"role="button" aria-expanded="false" aria-controls="id-1bdaeb925a49f1db3a374b3b">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>crates/trie</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+123</span></div>
                    <div class="text-start"><span class="text-danger">-21</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-1bdaeb925a49f1db3a374b3b">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ac9ba455a24e8ab80317561b" role="button"
                       aria-expanded="false" aria-controls="id-ac9ba455a24e8ab80317561b">
                        <code>crates/trie/common/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/common/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/trie/common/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+15</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ac9ba455a24e8ab80317561b"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml scroll-reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml</span>
<span class="term-fg1">index 0161fc7ff3d9a63c355156dc161bc4b4aee75c75..2aa9ad1146202fd40ce40edc03de823d8ce314f1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;Cargo.toml</span>
<span class="term-fg36">@@ -20,7 +20,10 @@</span> alloy-rlp = { workspace = true, features = [&quot;arrayvec&quot;] }
 alloy-trie = { workspace = true, features = [&quot;serde&quot;] }
 alloy-consensus.workspace = true
 alloy-genesis.workspace = true
<span class="term-fg31">-revm-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# revm-primitives scroll re-export</span>
<span class="term-fg32">+revm-primitives = { package = &quot;reth-scroll-revm&quot;, path = &quot;..&#47;..&#47;scroll&#47;revm&quot; }</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
&nbsp;
 bytes.workspace = true
 derive_more.workspace = true
<span class="term-fg36">@@ -41,13 +44,16 @@</span> proptest-arbitrary-interop.workspace = true
 hash-db = &quot;=0.15.2&quot;
 plain_hasher = &quot;0.2&quot;
&nbsp;
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
 [features]
 test-utils = [
 	&quot;dep:plain_hasher&quot;,
 	&quot;dep:hash-db&quot;,
 	&quot;arbitrary&quot;,
 	&quot;reth-primitives-traits&#47;test-utils&quot;,
<span class="term-fg31">-	&quot;reth-codecs&#47;test-utils&quot;</span>
<span class="term-fg32">+	&quot;reth-codecs&#47;test-utils&quot;,</span>
<span class="term-fg32">+	&quot;revm-primitives&#47;test-utils&quot;</span>
 ]
 arbitrary = [
 	&quot;alloy-trie&#47;arbitrary&quot;,
<span class="term-fg36">@@ -57,5 +63,11 @@</span> 	&quot;alloy-consensus&#47;arbitrary&quot;,
 	&quot;alloy-primitives&#47;arbitrary&quot;,
 	&quot;nybbles&#47;arbitrary&quot;,
 	&quot;revm-primitives&#47;arbitrary&quot;,
<span class="term-fg31">-	&quot;reth-codecs&#47;arbitrary&quot;</span>
<span class="term-fg32">+	&quot;reth-codecs&#47;arbitrary&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-primitives?&#47;arbitrary&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;dep:reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+	&quot;revm-primitives&#47;scroll&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-30e0a046b41aa722c984ac5f" role="button"
                       aria-expanded="false" aria-controls="id-30e0a046b41aa722c984ac5f">
                        <code>crates/trie/common/src/account.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/common/src/account.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/trie/common/src/account.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-30e0a046b41aa722c984ac5f"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs</span>
<span class="term-fg1">index 0808837063cfab1bf9de63de1677cd744de9b773..b6666cfb7d463e7d157c0eedff93d8c8cd0626f1 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;account.rs</span>
<span class="term-fg36">@@ -135,7 +135,11 @@</span>             Into::&lt;TrieAccount&gt;::into((
                 Account {
                     nonce: 10,
                     balance: U256::from(1000),
<span class="term-fg31">-                    bytecode_hash: Some(keccak256([0x60, 0x61]))</span>
<span class="term-fg32">+                    bytecode_hash: Some(keccak256([0x60, 0x61])),</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(&amp;[0x60, 0x61])</span>
<span class="term-fg32">+                    )</span>
                 },
                 expected_storage_root
             )),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-90e77f8a548d2cc787e50db5" role="button"
                       aria-expanded="false" aria-controls="id-90e77f8a548d2cc787e50db5">
                        <code>crates/trie/common/src/proofs.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/common/src/proofs.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/trie/common/src/proofs.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-90e77f8a548d2cc787e50db5"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs</span>
<span class="term-fg1">index d0a5cd220420859f08209025b22e8d69e30ffce3..e1bd85dde3da7bfed719089719282204b1b4b5e7 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;common&#47;src&#47;proofs.rs</span>
<span class="term-fg36">@@ -55,6 +55,11 @@</span>                             balance: account.balance,
                             nonce: account.nonce,
                             bytecode_hash: (account.code_hash != KECCAK_EMPTY)
                                 .then_some(account.code_hash),
<span class="term-fg32">+                            &#47;&#47; TODO (scroll): set the extension to the correct value.</span>
<span class="term-fg32">+                            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                            account_extension: Some(</span>
<span class="term-fg32">+                                reth_scroll_primitives::AccountExtension::empty(),</span>
<span class="term-fg32">+                            ),</span>
                         })
                     }
                 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-461c1d8f1d99bdabba120260" role="button"
                       aria-expanded="false" aria-controls="id-461c1d8f1d99bdabba120260">
                        <code>crates/trie/db/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/db/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/trie/db/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-461c1d8f1d99bdabba120260"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml scroll-reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">index 55fa9a851b17798c8b5e63c73c9571f392988c7f..ef9517fb8b95ba719073fa5fe05cc452038d4a91 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;Cargo.toml</span>
<span class="term-fg36">@@ -55,6 +55,8 @@</span> reth-trie = { workspace = true, features = [&quot;test-utils&quot;] }
&nbsp;
 alloy-consensus.workspace = true
&nbsp;
<span class="term-fg32">+reth-scroll-primitives.workspace = true</span>
<span class="term-fg32">+</span>
 # trie
 triehash = &quot;0.8&quot;
&nbsp;
<span class="term-fg36">@@ -86,3 +88,10 @@</span> 	&quot;reth-provider&#47;test-utils&quot;,
 	&quot;reth-trie&#47;test-utils&quot;,
 	&quot;revm&#47;test-utils&quot;
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2acf9e63925c8f48821be74f" role="button"
                       aria-expanded="false" aria-controls="id-2acf9e63925c8f48821be74f">
                        <code>crates/trie/db/src/state.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/db/src/state.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/trie/db/src/state.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2acf9e63925c8f48821be74f"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs</span>
<span class="term-fg1">index 6e2cea5051d0f5f0af01b419e9cdf723c6435e6e..5156d4f6168aa8a1df290274f6c3b5ebf00d77f9 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;src&#47;state.rs</span>
<span class="term-fg36">@@ -87,7 +87,13 @@</span>     &#47;&#47;&#47; &#47;&#47; Initialize hashed post state
     &#47;&#47;&#47; let mut hashed_state = HashedPostState::default();
     &#47;&#47;&#47; hashed_state.accounts.insert(
     &#47;&#47;&#47;     [0x11; 32].into(),
<span class="term-fg31">-    &#47;&#47;&#47;     Some(Account { nonce: 1, balance: U256::from(10), bytecode_hash: None }),</span>
<span class="term-fg32">+    &#47;&#47;&#47;     Some(Account {</span>
<span class="term-fg32">+    &#47;&#47;&#47;         nonce: 1,</span>
<span class="term-fg32">+    &#47;&#47;&#47;         balance: U256::from(10),</span>
<span class="term-fg32">+    &#47;&#47;&#47;         bytecode_hash: None,</span>
<span class="term-fg32">+    &#47;&#47;&#47;         #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    &#47;&#47;&#47;         account_extension: None,</span>
<span class="term-fg32">+    &#47;&#47;&#47;     }),</span>
     &#47;&#47;&#47; );
     &#47;&#47;&#47;
     &#47;&#47;&#47; &#47;&#47; Calculate the state root</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-97120323663a2a7f0b132c2e" role="button"
                       aria-expanded="false" aria-controls="id-97120323663a2a7f0b132c2e">
                        <code>crates/trie/db/tests/proof.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/db/tests/proof.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/trie/db/tests/proof.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-97120323663a2a7f0b132c2e"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs</span>
<span class="term-fg1">index 79a2ce96fced7cbcfbba667d9cfac09460f62907..e03be1167479eacdcf2dc3324ff8206195ad4509 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;proof.rs</span>
<span class="term-fg36">@@ -199,7 +199,10 @@</span>         address: target,
         info:  Some(Account {
             balance: U256::ZERO,
             nonce: 0,
<span class="term-fg31">-            bytecode_hash: Some(B256::from_str(&quot;0x2034f79e0e33b0ae6bef948532021baceb116adf2616478703bec6b17329f1cc&quot;).unwrap())</span>
<span class="term-fg32">+            bytecode_hash: Some(B256::from_str(&quot;0x2034f79e0e33b0ae6bef948532021baceb116adf2616478703bec6b17329f1cc&quot;).unwrap()),</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(reth_scroll_primitives::AccountExtension::empty())</span>
<span class="term-fg32">+</span>
         }),
         storage_root: B256::from_str(&quot;0x556a482068355939c95a3412bdb21213a301483edb1b64402fb66ac9f3583599&quot;).unwrap(),
         proof: convert_to_proof([</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-86c0ca1b2b8ca1f75a5e49c1" role="button"
                       aria-expanded="false" aria-controls="id-86c0ca1b2b8ca1f75a5e49c1">
                        <code>crates/trie/db/tests/trie.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/db/tests/trie.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/trie/db/tests/trie.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+50</span></div>
                            <div class="text-start"><span class="text-danger">-7</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-86c0ca1b2b8ca1f75a5e49c1"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs</span>
<span class="term-fg1">index aee264364798de64ce03dc8ec9149637011e173f..133dd4556a38deaa2d3b83ee3f4d9b96a79684e4 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;db&#47;tests&#47;trie.rs</span>
<span class="term-fg36">@@ -146,14 +146,26 @@</span>     let state: State = BTreeMap::from([
         (
             Address::random(),
             (
<span class="term-fg31">-                Account { nonce: 0, balance: U256::from(0), bytecode_hash: None },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::from(0),</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
                 BTreeMap::from([(B256::with_last_byte(0x4), U256::from(12))]),
             ),
         ),
         (
             Address::random(),
             (
<span class="term-fg31">-                Account { nonce: 0, balance: U256::from(0), bytecode_hash: None },</span>
<span class="term-fg32">+                Account {</span>
<span class="term-fg32">+                    nonce: 0,</span>
<span class="term-fg32">+                    balance: U256::from(0),</span>
<span class="term-fg32">+                    bytecode_hash: None,</span>
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+                },</span>
                 BTreeMap::default(),
             ),
         ),
<span class="term-fg36">@@ -164,6 +176,10 @@</span>                 Account {
                     nonce: 155,
                     balance: U256::from(414241124u32),
                     bytecode_hash: Some(keccak256(&quot;test&quot;)),
<span class="term-fg32">+                    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                    account_extension: Some(</span>
<span class="term-fg32">+                        reth_scroll_primitives::AccountExtension::from_bytecode(b&quot;test&quot;),</span>
<span class="term-fg32">+                    ),</span>
                 },
                 BTreeMap::from([
                     (B256::ZERO, U256::from(3)),
<span class="term-fg36">@@ -187,6 +203,8 @@</span>     let account = Account {
         nonce: 155,
         balance: U256::from(414241124u32),
         bytecode_hash: Some(keccak256(code)),
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
     };
     insert_account(tx.tx_ref(), address, account, &amp;Default::default());
     tx.commit().unwrap();
<span class="term-fg36">@@ -211,6 +229,8 @@</span>     let account = Account {
         nonce: 155,
         balance: U256::from(414241124u32),
         bytecode_hash: Some(keccak256(code)),
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(&amp;code)),</span>
     };
&nbsp;
     insert_account(tx.tx_ref(), address, account, &amp;storage);
<span class="term-fg36">@@ -357,7 +377,13 @@</span>
     &#47;&#47; Insert first account
     let key1 =
         B256::from_str(&quot;b000000000000000000000000000000000000000000000000000000000000000&quot;).unwrap();
<span class="term-fg31">-    let account1 = Account { nonce: 0, balance: U256::from(3).mul(ether), bytecode_hash: None };</span>
<span class="term-fg32">+    let account1 = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(3).mul(ether),</span>
<span class="term-fg32">+        bytecode_hash: None,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+    };</span>
     hashed_account_cursor.upsert(key1, account1).unwrap();
     hash_builder.add_leaf(Nibbles::unpack(key1), &amp;encode_account(account1, None));
&nbsp;
<span class="term-fg36">@@ -377,8 +403,13 @@</span>     assert_eq!(key3[0], 0xB0);
     assert_eq!(key3[1], 0x41);
     let code_hash =
         B256::from_str(&quot;5be74cad16203c4905c068b012a2e9fb6d19d036c410f16fd177f337541440dd&quot;).unwrap();
<span class="term-fg31">-    let account3 =</span>
<span class="term-fg31">-        Account { nonce: 0, balance: U256::from(2).mul(ether), bytecode_hash: Some(code_hash) };</span>
<span class="term-fg32">+    let account3 = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(2).mul(ether),</span>
<span class="term-fg32">+        bytecode_hash: Some(code_hash),</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some((10, B256::random()).into()),</span>
<span class="term-fg32">+    };</span>
     hashed_account_cursor.upsert(key3, account3).unwrap();
     for (hashed_slot, value) in storage {
         if hashed_storage_cursor
<span class="term-fg36">@@ -460,7 +491,13 @@</span>     &#47;&#47; Some address whose hash starts with 0xB1
     let address4b = Address::from_str(&quot;4f61f2d5ebd991b85aa1677db97307caf5215c91&quot;).unwrap();
     let key4b = keccak256(address4b);
     assert_eq!(key4b.0[0], key4a.0[0]);
<span class="term-fg31">-    let account4b = Account { nonce: 0, balance: U256::from(5).mul(ether), bytecode_hash: None };</span>
<span class="term-fg32">+    let account4b = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(5).mul(ether),</span>
<span class="term-fg32">+        bytecode_hash: None,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some(reth_scroll_primitives::AccountExtension::empty()),</span>
<span class="term-fg32">+    };</span>
     hashed_account_cursor.upsert(key4b, account4b).unwrap();
&nbsp;
     let mut prefix_set = PrefixSetMut::default();
<span class="term-fg36">@@ -725,7 +762,13 @@</span>
 fn extension_node_trie&lt;N: ProviderNodeTypes&gt;(
     tx: &amp;DatabaseProviderRW&lt;Arc&lt;TempDatabase&lt;DatabaseEnv&gt;&gt;, N&gt;,
 ) -&gt; B256 {
<span class="term-fg31">-    let a = Account { nonce: 0, balance: U256::from(1u64), bytecode_hash: Some(B256::random()) };</span>
<span class="term-fg32">+    let a = Account {</span>
<span class="term-fg32">+        nonce: 0,</span>
<span class="term-fg32">+        balance: U256::from(1u64),</span>
<span class="term-fg32">+        bytecode_hash: Some(B256::random()),</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        account_extension: Some((10, B256::random()).into()),</span>
<span class="term-fg32">+    };</span>
     let val = encode_account(a, None);
&nbsp;
     let mut hashed_accounts = tx.tx_ref().cursor_write::&lt;tables::HashedAccounts&gt;().unwrap();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3c8994dc346aa8a5b6dcdf60" role="button"
                       aria-expanded="false" aria-controls="id-3c8994dc346aa8a5b6dcdf60">
                        <code>crates/trie/trie/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/trie/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/trie/trie/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3c8994dc346aa8a5b6dcdf60"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;trie&#47;Cargo.toml scroll-reth&#47;crates&#47;trie&#47;trie&#47;Cargo.toml</span>
<span class="term-fg1">index 6136fa8e56bbb46adbd5ad3e4a822db2220c8a57..30ada617146d7c79e4a09a0491639a474165585b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;trie&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;trie&#47;Cargo.toml</span>
<span class="term-fg36">@@ -19,6 +19,8 @@</span> reth-stages-types.workspace = true
 reth-storage-errors.workspace = true
 reth-trie-common.workspace = true
&nbsp;
<span class="term-fg32">+# revm re-export scroll</span>
<span class="term-fg32">+reth-primitives-traits.workspace = true</span>
 revm.workspace = true
&nbsp;
 # alloy
<span class="term-fg36">@@ -70,19 +72,27 @@</span> 	&quot;dep:serde&quot;,
 	&quot;alloy-consensus&#47;serde&quot;,
 	&quot;alloy-primitives&#47;serde&quot;,
 	&quot;revm&#47;serde&quot;,
<span class="term-fg31">-	&quot;alloy-trie&#47;serde&quot;</span>
<span class="term-fg32">+	&quot;alloy-trie&#47;serde&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;serde&quot;</span>
 ]
 serde-bincode-compat = [
 	&quot;serde_with&quot;,
 	&quot;reth-primitives&#47;serde-bincode-compat&quot;,
<span class="term-fg31">-	&quot;alloy-consensus&#47;serde-bincode-compat&quot;</span>
<span class="term-fg32">+	&quot;alloy-consensus&#47;serde-bincode-compat&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;serde-bincode-compat&quot;</span>
 ]
 test-utils = [
 	&quot;triehash&quot;,
 	&quot;reth-trie-common&#47;test-utils&quot;,
 	&quot;reth-primitives&#47;test-utils&quot;,
 	&quot;revm&#47;test-utils&quot;,
<span class="term-fg31">-	&quot;reth-stages-types&#47;test-utils&quot;</span>
<span class="term-fg32">+	&quot;reth-stages-types&#47;test-utils&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;test-utils&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-trie-common&#47;scroll&quot;</span>
 ]
&nbsp;
 [[bench]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d914374256015e71d7be2e46" role="button"
                       aria-expanded="false" aria-controls="id-d914374256015e71d7be2e46">
                        <code>crates/trie/trie/src/state.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/trie/trie/src/state.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/trie/trie/src/state.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+15</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d914374256015e71d7be2e46"><span class="term-fg1">diff --git reth&#47;crates&#47;trie&#47;trie&#47;src&#47;state.rs scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;state.rs</span>
<span class="term-fg1">index eca126744e9646d7954c6721e5fe4e0d2b31b298..0a69dcf9da806e751c7a5686487e79b5c797e660 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;trie&#47;trie&#47;src&#47;state.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;trie&#47;trie&#47;src&#47;state.rs</span>
<span class="term-fg36">@@ -59,7 +59,8 @@</span>         let hashed = state
             .into_par_iter()
             .map(|(address, account)| {
                 let hashed_address = keccak256(address);
<span class="term-fg31">-                let hashed_account = account.account.as_ref().map(|a| a.info.clone().into());</span>
<span class="term-fg32">+                let hashed_account =</span>
<span class="term-fg32">+                    account.account.as_ref().map(|a| Account::from_account_info(a.info.clone()));</span>
                 let hashed_storage = HashedStorage::from_plain_storage(
                     account.status,
                     account.account.as_ref().map(|a| a.storage.iter()).into_iter().flatten(),
<span class="term-fg36">@@ -348,13 +349,14 @@</span>
 #[cfg(test)]
 mod tests {
     use super::*;
<span class="term-fg31">-    use alloy_primitives::Bytes;</span>
<span class="term-fg32">+    use alloy_primitives::{Address, Bytes};</span>
     use revm::{
         db::{
<span class="term-fg31">-            states::{plain_account::PlainStorage, StorageSlot},</span>
<span class="term-fg31">-            PlainAccount, StorageWithOriginalValues,</span>
<span class="term-fg32">+            states::{plain_account::PlainStorage, CacheAccount, StorageSlot},</span>
<span class="term-fg32">+            BundleAccount, StorageWithOriginalValues,</span>
         },
         primitives::{AccountInfo, Bytecode},
<span class="term-fg32">+        PlainAccount,</span>
     };
&nbsp;
     #[test]
<span class="term-fg36">@@ -442,6 +444,10 @@</span>             balance: U256::from(123),
             nonce: 42,
             code_hash: B256::random(),
             code: Some(Bytecode::LegacyRaw(Bytes::from(vec![1, 2]))),
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: 2,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: B256::random(),</span>
         };
&nbsp;
         let mut storage = StorageWithOriginalValues::default();
<span class="term-fg36">@@ -481,7 +487,7 @@</span>         &#47;&#47; Prepare a random Ethereum address.
         let address = Address::random();
&nbsp;
         &#47;&#47; Create mock account info.
<span class="term-fg31">-        let account_info = AccountInfo {</span>
<span class="term-fg32">+        let account_info = revm::shared::AccountInfo {</span>
             balance: U256::from(500),
             nonce: 5,
             code_hash: B256::random(),
<span class="term-fg36">@@ -525,6 +531,10 @@</span>             balance: U256::from(1000),
             nonce: 1,
             code_hash: B256::random(),
             code: None,
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: 10,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: B256::random(),</span>
         };
&nbsp;
         &#47;&#47; Create hashed accounts with addresses.</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-a48b714b954a413bacf09f0f"role="button" aria-expanded="false" aria-controls="id-a48b714b954a413bacf09f0f">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>Other changes</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+682</span></div>
                    <div class="text-start"><span class="text-danger">-124</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-a48b714b954a413bacf09f0f">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fa3d0aa63e9c94285e41d2e3" role="button"
                       aria-expanded="false" aria-controls="id-fa3d0aa63e9c94285e41d2e3">
                        <code>Cargo.lock</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/Cargo.lock" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/Cargo.lock" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+129</span></div>
                            <div class="text-start"><span class="text-danger">-25</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fa3d0aa63e9c94285e41d2e3"><span class="term-fg1">diff --git reth&#47;Cargo.lock scroll-reth&#47;Cargo.lock</span>
<span class="term-fg1">index 6463fd11a016bea6198300a25cd7337f37e34530..5c858dfa0b25b9f8f47f6c312a6007efa0b86fc2 100644</span>
<span class="term-fg1">--- reth&#47;Cargo.lock</span>
<span class="term-fg1">+++ scroll-reth&#47;Cargo.lock</span>
<span class="term-fg36">@@ -1346,6 +1346,19 @@</span>  &quot;zeroize&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;bn254&quot;</span>
<span class="term-fg32">+version = &quot;0.1.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254#81e1dcc92ee9a2798b13b84b24de182e9c42256e&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;ff&quot;,</span>
<span class="term-fg32">+ &quot;getrandom 0.2.15&quot;,</span>
<span class="term-fg32">+ &quot;rand 0.8.5&quot;,</span>
<span class="term-fg32">+ &quot;rand_core 0.6.4&quot;,</span>
<span class="term-fg32">+ &quot;sp1-intrinsics&quot;,</span>
<span class="term-fg32">+ &quot;subtle&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;boa_ast&quot;
 version = &quot;0.19.1&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -2620,8 +2633,9 @@</span>  &quot;reth-evm-ethereum&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-stages&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
  &quot;thiserror 1.0.69&quot;,
<span class="term-fg36">@@ -2830,6 +2844,7 @@</span>  &quot;reth-evm&quot;,
  &quot;reth-evm-ethereum&quot;,
  &quot;reth-node-ethereum&quot;,
  &quot;reth-primitives&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -3148,6 +3163,7 @@</span> version = &quot;0.13.0&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;ded41244b729663b1e574f1b4fb731469f69f79c17667b5d776b16cda0479449&quot;
 dependencies = [
<span class="term-fg32">+ &quot;bitvec&quot;,</span>
  &quot;rand_core 0.6.4&quot;,
  &quot;subtle&quot;,
 ]
<span class="term-fg36">@@ -4601,7 +4617,7 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;4979f22fdb869068da03c9f7528f8297c6fd2606bc3a4affe42e6a823fdb8da4&quot;
 dependencies = [
  &quot;cfg-if&quot;,
<span class="term-fg31">- &quot;windows-targets 0.52.6&quot;,</span>
<span class="term-fg32">+ &quot;windows-targets 0.48.5&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -5742,6 +5758,15 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;280dc24453071f1b63954171985a0b0d30058d287960968b9b2aca264c8d4ee6&quot;
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;poseidon-bn254&quot;</span>
<span class="term-fg32">+version = &quot;0.1.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254?rev=526a64a#526a64a81419bcab6bd8280a8a3f9808189e0373&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;bn254&quot;,</span>
<span class="term-fg32">+ &quot;itertools 0.13.0&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;powerfmt&quot;
 version = &quot;0.2.0&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -6445,9 +6470,9 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;tokio&quot;,
  &quot;tracing&quot;,
 ]
<span class="term-fg36">@@ -6571,6 +6596,8 @@</span>  &quot;reth-node-types&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-stages-api&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-testing-utils&quot;,
<span class="term-fg36">@@ -6614,10 +6641,10 @@</span>  &quot;reth-errors&quot;,
  &quot;reth-execution-types&quot;,
  &quot;reth-metrics&quot;,
  &quot;reth-primitives&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-api&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;tokio&quot;,
  &quot;tokio-stream&quot;,
  &quot;tracing&quot;,
<span class="term-fg36">@@ -6880,6 +6907,7 @@</span>  &quot;reth-nippy-jar&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-tracing&quot;,
<span class="term-fg36">@@ -6942,6 +6970,7 @@</span>  &quot;reth-node-types&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-trie&quot;,
  &quot;reth-trie-db&quot;,
<span class="term-fg36">@@ -7308,6 +7337,8 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-trie&quot;,
  &quot;revm-primitives&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -7475,9 +7506,9 @@</span>  &quot;reth-payload-primitives&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-transaction-pool&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;tracing&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -7514,8 +7545,9 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-errors&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;revm-primitives&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -7536,6 +7568,8 @@</span>  &quot;reth-evm&quot;,
  &quot;reth-execution-types&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
  &quot;reth-testing-utils&quot;,
  &quot;revm-primitives&quot;,
  &quot;secp256k1&quot;,
<span class="term-fg36">@@ -7569,8 +7603,8 @@</span>  &quot;rand 0.8.5&quot;,
  &quot;reth-execution-errors&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_with&quot;,
 ]
<span class="term-fg36">@@ -7606,6 +7640,7 @@</span>  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-stages-api&quot;,
  &quot;reth-tasks&quot;,
  &quot;reth-testing-utils&quot;,
<span class="term-fg36">@@ -7696,6 +7731,9 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-api&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-tracing&quot;,
  &quot;reth-trie&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -8111,11 +8149,11 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-tracing&quot;,
  &quot;reth-transaction-pool&quot;,
  &quot;reth-trie-db&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde_json&quot;,
  &quot;tokio&quot;,
 ]
<span class="term-fg36">@@ -8287,7 +8325,8 @@</span>  &quot;reth-optimism-primitives&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;revm-primitives&quot;,
  &quot;tracing&quot;,
 ]
<span class="term-fg36">@@ -8346,10 +8385,10 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-server-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-tracing&quot;,
  &quot;reth-transaction-pool&quot;,
  &quot;reth-trie-db&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
  &quot;tokio&quot;,
<span class="term-fg36">@@ -8384,9 +8423,9 @@</span>  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-transaction-pool&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;sha2 0.10.8&quot;,
  &quot;thiserror 1.0.69&quot;,
  &quot;tracing&quot;,
<span class="term-fg36">@@ -8447,9 +8486,9 @@</span>  &quot;reth-rpc-api&quot;,
  &quot;reth-rpc-eth-api&quot;,
  &quot;reth-rpc-eth-types&quot;,
  &quot;reth-rpc-server-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-transaction-pool&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde_json&quot;,
  &quot;thiserror 1.0.69&quot;,
  &quot;tokio&quot;,
<span class="term-fg36">@@ -8483,7 +8522,7 @@</span>  &quot;reth-metrics&quot;,
  &quot;reth-payload-builder-primitives&quot;,
  &quot;reth-payload-primitives&quot;,
  &quot;reth-primitives&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;tokio&quot;,
  &quot;tokio-stream&quot;,
  &quot;tracing&quot;,
<span class="term-fg36">@@ -8573,10 +8612,10 @@</span>  &quot;reth-chainspec&quot;,
  &quot;reth-codecs&quot;,
  &quot;reth-ethereum-forks&quot;,
  &quot;reth-primitives-traits&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-static-file-types&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;revm-primitives&quot;,</span>
  &quot;rstest&quot;,
  &quot;secp256k1&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -8606,7 +8645,8 @@</span>  &quot;proptest&quot;,
  &quot;proptest-arbitrary-interop&quot;,
  &quot;rand 0.8.5&quot;,
  &quot;reth-codecs&quot;,
<span class="term-fg31">- &quot;revm-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;roaring&quot;,
  &quot;serde&quot;,
  &quot;serde_json&quot;,
<span class="term-fg36">@@ -8651,13 +8691,14 @@</span>  &quot;reth-optimism-primitives&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-storage-api&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-trie&quot;,
  &quot;reth-trie-db&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;strum&quot;,
  &quot;tempfile&quot;,
  &quot;tokio&quot;,
<span class="term-fg36">@@ -8727,10 +8768,11 @@</span>  &quot;reth-execution-errors&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-prune-types&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-api&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
 ]
&nbsp;
 [[package]]
<span class="term-fg36">@@ -8788,11 +8830,12 @@</span>  &quot;reth-rpc-eth-api&quot;,
  &quot;reth-rpc-eth-types&quot;,
  &quot;reth-rpc-server-types&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-testing-utils&quot;,
  &quot;reth-transaction-pool&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;revm-inspectors&quot;,
  &quot;revm-primitives&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -8969,10 +9012,12 @@</span>  &quot;reth-revm&quot;,
  &quot;reth-rpc-eth-types&quot;,
  &quot;reth-rpc-server-types&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-execution&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-tasks&quot;,
  &quot;reth-transaction-pool&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;revm-inspectors&quot;,
  &quot;revm-primitives&quot;,
  &quot;tokio&quot;,
<span class="term-fg36">@@ -9006,11 +9051,12 @@</span>  &quot;reth-primitives-traits&quot;,
  &quot;reth-revm&quot;,
  &quot;reth-rpc-server-types&quot;,
  &quot;reth-rpc-types-compat&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-storage-api&quot;,
  &quot;reth-tasks&quot;,
  &quot;reth-transaction-pool&quot;,
  &quot;reth-trie&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;revm-inspectors&quot;,
  &quot;revm-primitives&quot;,
  &quot;schnellru&quot;,
<span class="term-fg36">@@ -9073,6 +9119,51 @@</span>  &quot;serde_json&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;reth-scroll-execution&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;reth-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-primitives&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-primitives&quot;,</span>
<span class="term-fg32">+ &quot;arbitrary&quot;,</span>
<span class="term-fg32">+ &quot;bytes&quot;,</span>
<span class="term-fg32">+ &quot;modular-bitfield&quot;,</span>
<span class="term-fg32">+ &quot;poseidon-bn254&quot;,</span>
<span class="term-fg32">+ &quot;reth-codecs&quot;,</span>
<span class="term-fg32">+ &quot;serde&quot;,</span>
<span class="term-fg32">+ &quot;test-fuzz&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-revm&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;revm&quot;,</span>
<span class="term-fg32">+ &quot;serde&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
<span class="term-fg32">+name = &quot;reth-scroll-storage&quot;</span>
<span class="term-fg32">+version = &quot;1.1.2&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;alloy-primitives&quot;,</span>
<span class="term-fg32">+ &quot;eyre&quot;,</span>
<span class="term-fg32">+ &quot;reth-codecs&quot;,</span>
<span class="term-fg32">+ &quot;reth-primitives-traits&quot;,</span>
<span class="term-fg32">+ &quot;reth-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
<span class="term-fg32">+ &quot;reth-storage-errors&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;reth-stages&quot;
 version = &quot;1.1.2&quot;
 dependencies = [
<span class="term-fg36">@@ -9111,6 +9202,8 @@</span>  &quot;reth-provider&quot;,
  &quot;reth-prune&quot;,
  &quot;reth-prune-types&quot;,
  &quot;reth-revm&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-storage&quot;,</span>
  &quot;reth-stages-api&quot;,
  &quot;reth-static-file&quot;,
  &quot;reth-storage-errors&quot;,
<span class="term-fg36">@@ -9321,10 +9414,10 @@</span>  &quot;reth-payload-util&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-primitives-traits&quot;,
  &quot;reth-provider&quot;,
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-api&quot;,
  &quot;reth-tasks&quot;,
  &quot;reth-tracing&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;rustc-hash 2.0.0&quot;,
  &quot;schnellru&quot;,
  &quot;serde&quot;,
<span class="term-fg36">@@ -9356,10 +9449,11 @@</span>  &quot;rayon&quot;,
  &quot;reth-execution-errors&quot;,
  &quot;reth-metrics&quot;,
  &quot;reth-primitives&quot;,
<span class="term-fg32">+ &quot;reth-primitives-traits&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-stages-types&quot;,
  &quot;reth-storage-errors&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
  &quot;serde_with&quot;,
<span class="term-fg36">@@ -9387,7 +9481,8 @@</span>  &quot;proptest&quot;,
  &quot;proptest-arbitrary-interop&quot;,
  &quot;reth-codecs&quot;,
  &quot;reth-primitives-traits&quot;,
<span class="term-fg31">- &quot;revm-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;serde&quot;,
 ]
&nbsp;
<span class="term-fg36">@@ -9409,10 +9504,11 @@</span>  &quot;reth-execution-errors&quot;,
  &quot;reth-metrics&quot;,
  &quot;reth-primitives&quot;,
  &quot;reth-provider&quot;,
<span class="term-fg32">+ &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+ &quot;reth-scroll-revm&quot;,</span>
  &quot;reth-storage-errors&quot;,
  &quot;reth-trie&quot;,
  &quot;reth-trie-common&quot;,
<span class="term-fg31">- &quot;revm&quot;,</span>
  &quot;serde&quot;,
  &quot;serde_json&quot;,
  &quot;similar-asserts&quot;,
<span class="term-fg36">@@ -10425,6 +10521,14 @@</span>  &quot;sha1&quot;,
 ]
&nbsp;
 [[package]]
<span class="term-fg32">+name = &quot;sp1-intrinsics&quot;</span>
<span class="term-fg32">+version = &quot;0.0.0&quot;</span>
<span class="term-fg32">+source = &quot;git+https:&#47;&#47;github.com&#47;scroll-tech&#47;sp1-intrinsics.git?branch=master#7e038e60db0b2e847f6d8f49e148ccac8c6fc394&quot;</span>
<span class="term-fg32">+dependencies = [</span>
<span class="term-fg32">+ &quot;cfg-if&quot;,</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+[[package]]</span>
 name = &quot;spin&quot;
 version = &quot;0.9.8&quot;
 source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
<span class="term-fg36">@@ -11212,7 +11316,7 @@</span> source = &quot;registry+https:&#47;&#47;github.com&#47;rust-lang&#47;crates.io-index&quot;
 checksum = &quot;3637e734239e12ab152cd269302500bd063f37624ee210cd04b4936ed671f3b1&quot;
 dependencies = [
  &quot;cc&quot;,
<span class="term-fg31">- &quot;windows-targets 0.52.6&quot;,</span>
<span class="term-fg32">+ &quot;windows-targets 0.48.5&quot;,</span>
 ]
&nbsp;
 [[package]]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8968d6b4e430fbc578592934" role="button"
                       aria-expanded="false" aria-controls="id-8968d6b4e430fbc578592934">
                        <code>Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8968d6b4e430fbc578592934"><span class="term-fg1">diff --git reth&#47;Cargo.toml scroll-reth&#47;Cargo.toml</span>
<span class="term-fg1">index ad17ea4ad0ca8e062712093262336d87522d8936..a9a188ec2c414bf6421f5f315af712776e2236b0 100644</span>
<span class="term-fg1">--- reth&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;Cargo.toml</span>
<span class="term-fg36">@@ -100,6 +100,10 @@</span>     &quot;crates&#47;rpc&#47;rpc-server-types&#47;&quot;,
     &quot;crates&#47;rpc&#47;rpc-testing-util&#47;&quot;,
     &quot;crates&#47;rpc&#47;rpc-types-compat&#47;&quot;,
     &quot;crates&#47;rpc&#47;rpc&#47;&quot;,
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;execution&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;primitives&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;revm&quot;,</span>
<span class="term-fg32">+    &quot;crates&#47;scroll&#47;storage&quot;,</span>
     &quot;crates&#47;stages&#47;api&#47;&quot;,
     &quot;crates&#47;stages&#47;stages&#47;&quot;,
     &quot;crates&#47;stages&#47;types&#47;&quot;,
<span class="term-fg36">@@ -403,6 +407,10 @@</span> reth-rpc-eth-types = { path = &quot;crates&#47;rpc&#47;rpc-eth-types&quot;, default-features = false }
 reth-rpc-layer = { path = &quot;crates&#47;rpc&#47;rpc-layer&quot; }
 reth-rpc-server-types = { path = &quot;crates&#47;rpc&#47;rpc-server-types&quot; }
 reth-rpc-types-compat = { path = &quot;crates&#47;rpc&#47;rpc-types-compat&quot; }
<span class="term-fg32">+reth-scroll-execution = { path = &quot;crates&#47;scroll&#47;execution&quot; }</span>
<span class="term-fg32">+reth-scroll-primitives = { path = &quot;crates&#47;scroll&#47;primitives&quot; }</span>
<span class="term-fg32">+reth-scroll-revm = { path = &quot;crates&#47;scroll&#47;revm&quot; }</span>
<span class="term-fg32">+reth-scroll-storage = { path = &quot;crates&#47;scroll&#47;storage&quot; }</span>
 reth-stages = { path = &quot;crates&#47;stages&#47;stages&quot; }
 reth-stages-api = { path = &quot;crates&#47;stages&#47;api&quot; }
 reth-stages-types = { path = &quot;crates&#47;stages&#47;types&quot; }
<span class="term-fg36">@@ -421,7 +429,7 @@</span> reth-trie-db = { path = &quot;crates&#47;trie&#47;db&quot; }
 reth-trie-parallel = { path = &quot;crates&#47;trie&#47;parallel&quot; }
&nbsp;
 # revm
<span class="term-fg31">-revm = { version = &quot;18.0.0&quot;, features = [&quot;std&quot;], default-features = false }</span>
<span class="term-fg32">+revm = { package = &quot;reth-scroll-revm&quot;, path = &quot;crates&#47;scroll&#47;revm&quot;, default-features = false }</span>
 revm-inspectors = &quot;0.11.0&quot;
 revm-primitives = { version = &quot;14.0.0&quot;, features = [
     &quot;std&quot;,
<span class="term-fg36">@@ -469,6 +477,10 @@</span>     &quot;reqwest-rustls-tls&quot;,
 ], default-features = false }
 alloy-transport-ipc = { version = &quot;0.6.4&quot;, default-features = false }
 alloy-transport-ws = { version = &quot;0.6.4&quot;, default-features = false }
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+# TODO (scroll): point to crates.io&#47;tag once the crate is published&#47;a tag is created.</span>
<span class="term-fg32">+poseidon-bn254 = { git = &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254&quot;, rev = &quot;526a64a&quot;, features = [&quot;bn254&quot;] }</span>
&nbsp;
 # op
 op-alloy-rpc-types = &quot;0.6.7&quot;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-66f75a276cd973519a592f40" role="button"
                       aria-expanded="false" aria-controls="id-66f75a276cd973519a592f40">
                        <code>bin/reth/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/bin/reth/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/bin/reth/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-66f75a276cd973519a592f40"><span class="term-fg1">diff --git reth&#47;bin&#47;reth&#47;Cargo.toml scroll-reth&#47;bin&#47;reth&#47;Cargo.toml</span>
<span class="term-fg1">index a152bea2681efabf538b14dd39a0f5f1e809b640..437d11b5ad0298e343b38dab4c51964d3afc6578 100644</span>
<span class="term-fg1">--- reth&#47;bin&#47;reth&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;bin&#47;reth&#47;Cargo.toml</span>
<span class="term-fg36">@@ -120,6 +120,7 @@</span> 	&quot;reth-cli-util&#47;jemalloc&quot;,
 	&quot;reth-cli-util&#47;jemalloc-prof&quot;
 ]
 tracy-allocator = [&quot;reth-cli-util&#47;tracy-allocator&quot;]
<span class="term-fg32">+scroll = []</span>
&nbsp;
 min-error-logs = [&quot;tracing&#47;release_max_level_error&quot;]
 min-warn-logs = [&quot;tracing&#47;release_max_level_warn&quot;]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-aa3e9da8254a27dd12cb3603" role="button"
                       aria-expanded="false" aria-controls="id-aa3e9da8254a27dd12cb3603">
                        <code>bin/reth/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/bin/reth/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/bin/reth/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-aa3e9da8254a27dd12cb3603"><span class="term-fg1">diff --git reth&#47;bin&#47;reth&#47;src&#47;lib.rs scroll-reth&#47;bin&#47;reth&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 53c592063eca67b13f1aed5f89672ecb1a4d08ef..dba3ff77c8fa2cd32156c59aef7cd29c58126410 100644</span>
<span class="term-fg1">--- reth&#47;bin&#47;reth&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;bin&#47;reth&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -26,6 +26,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 pub mod cli;
 pub mod commands;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1a9bc384eb3cba630d3f17da" role="button"
                       aria-expanded="false" aria-controls="id-1a9bc384eb3cba630d3f17da">
                        <code>bin/reth/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/bin/reth/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/bin/reth/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1a9bc384eb3cba630d3f17da"><span class="term-fg1">diff --git reth&#47;bin&#47;reth&#47;src&#47;main.rs scroll-reth&#47;bin&#47;reth&#47;src&#47;main.rs</span>
<span class="term-fg1">index e146912c06f995da5e3f934c62f0fdfceeb388c3..19053b8a20733f0d0215cb36e0e177718b0bc3b2 100644</span>
<span class="term-fg1">--- reth&#47;bin&#47;reth&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;bin&#47;reth&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,4 +1,7 @@</span>
 #![allow(missing_docs)]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 #[global_allocator]
 static ALLOC: reth_cli_util::allocator::Allocator = reth_cli_util::allocator::new_allocator();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2b42624050ad35cd296cbf28" role="button"
                       aria-expanded="false" aria-controls="id-2b42624050ad35cd296cbf28">
                        <code>crates/blockchain-tree/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/blockchain-tree/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/blockchain-tree/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+21</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2b42624050ad35cd296cbf28"><span class="term-fg1">diff --git reth&#47;crates&#47;blockchain-tree&#47;Cargo.toml scroll-reth&#47;crates&#47;blockchain-tree&#47;Cargo.toml</span>
<span class="term-fg1">index 3fa6de2b402c26393d8d7f9ab9c4e4584f1eaf74..1fa7854aee59089b2223ade99f408633d7268dca 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;blockchain-tree&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;blockchain-tree&#47;Cargo.toml</span>
<span class="term-fg36">@@ -34,6 +34,9 @@</span> # ethereum
 alloy-primitives.workspace = true
 alloy-eips.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # common
 parking_lot.workspace = true
 tracing.workspace = true
<span class="term-fg36">@@ -62,6 +65,7 @@</span> parking_lot.workspace = true
 assert_matches.workspace = true
 alloy-genesis.workspace = true
 alloy-consensus.workspace = true
<span class="term-fg32">+revm.workspace = true</span>
&nbsp;
 [features]
 test-utils = [
<span class="term-fg36">@@ -76,12 +80,27 @@</span> 	&quot;reth-db&#47;test-utils&quot;,
 	&quot;reth-db-api&#47;test-utils&quot;,
 	&quot;reth-provider&#47;test-utils&quot;,
 	&quot;reth-trie-db&#47;test-utils&quot;,
<span class="term-fg31">-	&quot;reth-trie&#47;test-utils&quot;</span>
<span class="term-fg32">+	&quot;reth-trie&#47;test-utils&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;test-utils&quot;</span>
 ]
 optimism = [
 	&quot;reth-primitives&#47;optimism&quot;,
 	&quot;reth-provider&#47;optimism&quot;,
 	&quot;reth-execution-types&#47;optimism&quot;,
 	&quot;reth-db&#47;optimism&quot;,
<span class="term-fg31">-	&quot;reth-db-api&#47;optimism&quot;</span>
<span class="term-fg32">+	&quot;reth-db-api&#47;optimism&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;optimism&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-trie-db&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-storage&#47;scroll&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-73f142e94260393a5504ed11" role="button"
                       aria-expanded="false" aria-controls="id-73f142e94260393a5504ed11">
                        <code>crates/blockchain-tree/src/blockchain_tree.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/blockchain-tree/src/blockchain_tree.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/blockchain-tree/src/blockchain_tree.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-73f142e94260393a5504ed11"><span class="term-fg1">diff --git reth&#47;crates&#47;blockchain-tree&#47;src&#47;blockchain_tree.rs scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;blockchain_tree.rs</span>
<span class="term-fg1">index d2ff0f5c8445e749044cfacd919ae68e659140ff..f74361320d1a6b793322e70a6e83a4097959a8f2 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;blockchain-tree&#47;src&#47;blockchain_tree.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;blockchain_tree.rs</span>
<span class="term-fg36">@@ -1400,9 +1400,9 @@</span>             MockNodeTypesWithDB,
         },
         ProviderFactory, StorageLocation,
     };
<span class="term-fg31">-    use reth_revm::primitives::AccountInfo;</span>
     use reth_stages_api::StageCheckpoint;
     use reth_trie::{root::state_root_unhashed, StateRoot};
<span class="term-fg32">+    use revm::AccountInfo;</span>
     use std::collections::HashMap;
&nbsp;
     fn setup_externals(</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4ea58d98ce0d622c7aeefbee" role="button"
                       aria-expanded="false" aria-controls="id-4ea58d98ce0d622c7aeefbee">
                        <code>crates/blockchain-tree/src/chain.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/blockchain-tree/src/chain.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/blockchain-tree/src/chain.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4ea58d98ce0d622c7aeefbee"><span class="term-fg1">diff --git reth&#47;crates&#47;blockchain-tree&#47;src&#47;chain.rs scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;chain.rs</span>
<span class="term-fg1">index 6ac39c316702c4bdf3ab57b6fdd387907fa32298..80f8c7a4b80b4f550e7206a6c5714f9cc6193546 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;blockchain-tree&#47;src&#47;chain.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;chain.rs</span>
<span class="term-fg36">@@ -21,7 +21,6 @@</span>     providers::{BundleStateProvider, ConsistentDbView, ProviderNodeTypes},
     DBProvider, FullExecutionDataProvider, ProviderError, StateRootProvider,
     TryIntoHistoricalStateProvider,
 };
<span class="term-fg31">-use reth_revm::database::StateProviderDatabase;</span>
 use reth_trie::{updates::TrieUpdates, HashedPostState, TrieInput};
 use reth_trie_parallel::root::ParallelStateRoot;
 use std::{
<span class="term-fg36">@@ -204,7 +203,10 @@</span>             .try_into_history_at_block(canonical_fork.number)?;
&nbsp;
         let provider = BundleStateProvider::new(state_provider, bundle_state_data_provider);
&nbsp;
<span class="term-fg31">-        let db = StateProviderDatabase::new(&amp;provider);</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let db = reth_revm::database::StateProviderDatabase::new(&amp;provider);</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let db = reth_scroll_storage::ScrollStateProviderDatabase::new(&amp;provider);</span>
         let executor = externals.executor_factory.executor(db);
         let block_hash = block.hash();
         let block = block.unseal();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5bfbb0bdaa13eb50901bb09b" role="button"
                       aria-expanded="false" aria-controls="id-5bfbb0bdaa13eb50901bb09b">
                        <code>crates/blockchain-tree/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/blockchain-tree/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/blockchain-tree/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5bfbb0bdaa13eb50901bb09b"><span class="term-fg1">diff --git reth&#47;crates&#47;blockchain-tree&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 3f501bead071a6eef729a92e86ebe136e3403707..29e747a40a8786143af85ce9c75b55bee2f202fb 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;blockchain-tree&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;blockchain-tree&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -18,6 +18,8 @@</span> )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
&nbsp;
<span class="term-fg32">+use reth_revm as _;</span>
<span class="term-fg32">+</span>
 &#47;&#47;&#47; Re-export of the blockchain tree API.
 pub use reth_blockchain_tree_api::*;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a5284f8bfc42c113754f634d" role="button"
                       aria-expanded="false" aria-controls="id-a5284f8bfc42c113754f634d">
                        <code>crates/e2e-test-utils/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/e2e-test-utils/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/e2e-test-utils/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a5284f8bfc42c113754f634d"><span class="term-fg1">diff --git reth&#47;crates&#47;e2e-test-utils&#47;Cargo.toml scroll-reth&#47;crates&#47;e2e-test-utils&#47;Cargo.toml</span>
<span class="term-fg1">index 9c40e2ba99d2c469fbf239859f582aa5d7f9076d..e33690d458617401e5cb252333ff24b38f6f87be 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;e2e-test-utils&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;e2e-test-utils&#47;Cargo.toml</span>
<span class="term-fg36">@@ -50,3 +50,6 @@</span> alloy-network.workspace = true
 alloy-consensus = { workspace = true, features = [&quot;kzg&quot;] }
 tracing.workspace = true
 derive_more.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ca8cba7d6f2daf5fa67305a2" role="button"
                       aria-expanded="false" aria-controls="id-ca8cba7d6f2daf5fa67305a2">
                        <code>crates/e2e-test-utils/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/e2e-test-utils/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/e2e-test-utils/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ca8cba7d6f2daf5fa67305a2"><span class="term-fg1">diff --git reth&#47;crates&#47;e2e-test-utils&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;e2e-test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 73a7e39f1a4924f6081a72dd425bacaec642201b..2c41e30ce79382ff5105189a863504e490b62672 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;e2e-test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;e2e-test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -1,5 +1,9 @@</span>
 &#47;&#47;! Utilities for end-to-end tests.
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use std::sync::Arc;
&nbsp;
 use node::NodeTestContext;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9b0432bdac40486948d32f9c" role="button"
                       aria-expanded="false" aria-controls="id-9b0432bdac40486948d32f9c">
                        <code>crates/engine/invalid-block-hooks/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/engine/invalid-block-hooks/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/engine/invalid-block-hooks/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9b0432bdac40486948d32f9c"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;Cargo.toml scroll-reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;Cargo.toml</span>
<span class="term-fg1">index 462f0762a9e45b84b9bfe80c025a444185f7d702..35afad8a4d8ec426dea17e8137ee4c9d7ba35bae 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;Cargo.toml</span>
<span class="term-fg36">@@ -28,6 +28,11 @@</span> alloy-rlp.workspace = true
 alloy-rpc-types-debug.workspace = true
 alloy-consensus.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+reth-scroll-revm = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # async
 futures.workspace = true
&nbsp;
<span class="term-fg36">@@ -37,3 +42,14 @@</span> jsonrpsee.workspace = true
 pretty_assertions = &quot;1.4&quot;
 serde.workspace = true
 serde_json.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-revm&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7dcb74e27b30dc4f81196345" role="button"
                       aria-expanded="false" aria-controls="id-7dcb74e27b30dc4f81196345">
                        <code>crates/engine/invalid-block-hooks/src/witness.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/engine/invalid-block-hooks/src/witness.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/engine/invalid-block-hooks/src/witness.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+19</span></div>
                            <div class="text-start"><span class="text-danger">-11</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7dcb74e27b30dc4f81196345"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;src&#47;witness.rs scroll-reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;src&#47;witness.rs</span>
<span class="term-fg1">index 4e92411ea1284da571533c21ee131bdc0f125f98..a1affdeda349603ab5673638555bddcb2dedd2b3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;src&#47;witness.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;invalid-block-hooks&#47;src&#47;witness.rs</span>
<span class="term-fg36">@@ -13,12 +13,12 @@</span> };
 use reth_primitives::{Receipt, SealedBlockWithSenders, SealedHeader};
 use reth_provider::{BlockExecutionOutput, ChainSpecProvider, StateProviderFactory};
 use reth_revm::{
<span class="term-fg31">-    database::StateProviderDatabase,</span>
     db::states::bundle_state::BundleRetention,
     primitives::{BlockEnv, CfgEnvWithHandlerCfg, EnvWithHandlerCfg},
     DatabaseCommit, StateBuilder,
 };
 use reth_rpc_api::DebugApiClient;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_tracing::tracing::warn;
 use reth_trie::{updates::TrieUpdates, HashedPostState, HashedStorage};
 use serde::Serialize;
<span class="term-fg36">@@ -68,12 +68,12 @@</span>     ) -&gt; eyre::Result&lt;()&gt; {
         &#47;&#47; TODO(alexey): unify with `DebugApi::debug_execution_witness`
&nbsp;
         &#47;&#47; Setup database.
<span class="term-fg31">-        let mut db = StateBuilder::new()</span>
<span class="term-fg31">-            .with_database(StateProviderDatabase::new(</span>
<span class="term-fg31">-                self.provider.state_by_block_hash(parent_header.hash())?,</span>
<span class="term-fg31">-            ))</span>
<span class="term-fg31">-            .with_bundle_update()</span>
<span class="term-fg31">-            .build();</span>
<span class="term-fg32">+        let provider = self.provider.state_by_block_hash(parent_header.hash())?;</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let state = reth_revm::database::StateProviderDatabase::new(provider);</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let state = reth_scroll_storage::ScrollStateProviderDatabase::new(provider);</span>
<span class="term-fg32">+        let mut db = StateBuilder::new().with_database(state).with_bundle_update().build();</span>
&nbsp;
         &#47;&#47; Setup environment for the execution.
         let mut cfg = CfgEnvWithHandlerCfg::new(Default::default(), Default::default());
<span class="term-fg36">@@ -121,7 +121,7 @@</span>         &#47;&#47; Merge all state transitions
         db.merge_transitions(BundleRetention::Reverts);
&nbsp;
         &#47;&#47; Take the bundle state
<span class="term-fg31">-        let mut bundle_state = db.take_bundle();</span>
<span class="term-fg32">+        let mut bundle_state = db.finalize();</span>
&nbsp;
         &#47;&#47; Initialize a map of preimages.
         let mut state_preimages = HashMap::default();
<span class="term-fg36">@@ -133,9 +133,17 @@</span>         &#47;&#47; referenced accounts + storage slots.
         let mut hashed_state = HashedPostState::from_bundle_state(&amp;bundle_state.state);
         for (address, account) in db.cache.accounts {
             let hashed_address = keccak256(address);
<span class="term-fg31">-            hashed_state</span>
<span class="term-fg31">-                .accounts</span>
<span class="term-fg31">-                .insert(hashed_address, account.account.as_ref().map(|a| a.info.clone().into()));</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            let hashed_account = account.account.as_ref().map(|a| {</span>
<span class="term-fg32">+                Into::&lt;reth_scroll_revm::AccountInfo&gt;::into((</span>
<span class="term-fg32">+                    a.info.clone(),</span>
<span class="term-fg32">+                    &amp;db.database.post_execution_context,</span>
<span class="term-fg32">+                ))</span>
<span class="term-fg32">+                .into()</span>
<span class="term-fg32">+            });</span>
<span class="term-fg32">+            #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+            let hashed_account = account.account.as_ref().map(|a| a.info.clone().into());</span>
<span class="term-fg32">+            hashed_state.accounts.insert(hashed_address, hashed_account);</span>
&nbsp;
             let storage = hashed_state
                 .storages</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-18fec9c283d0787bc89286ee" role="button"
                       aria-expanded="false" aria-controls="id-18fec9c283d0787bc89286ee">
                        <code>crates/engine/primitives/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/engine/primitives/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/engine/primitives/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-18fec9c283d0787bc89286ee"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;primitives&#47;Cargo.toml scroll-reth&#47;crates&#47;engine&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">index 42cbd932d45bbff3987338790ed4e54c0e3ae57e..94f97e308f414e946ea49ede6c528c6dc2a778dd 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;primitives&#47;Cargo.toml</span>
<span class="term-fg36">@@ -30,3 +30,10 @@</span>
 # misc
 serde.workspace = true
 thiserror.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c7998f2f6a548c9939cf55d6" role="button"
                       aria-expanded="false" aria-controls="id-c7998f2f6a548c9939cf55d6">
                        <code>crates/engine/util/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/engine/util/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/engine/util/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c7998f2f6a548c9939cf55d6"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;util&#47;Cargo.toml scroll-reth&#47;crates&#47;engine&#47;util&#47;Cargo.toml</span>
<span class="term-fg1">index 6eb22340ec100c5587d8bb43aeae8d01baa8463b..310838a43cec6ae0dfb3e59014f2007befbab20a 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;util&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;util&#47;Cargo.toml</span>
<span class="term-fg36">@@ -31,6 +31,10 @@</span> alloy-primitives.workspace = true
 alloy-rpc-types-engine.workspace = true
 alloy-consensus.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # async
 tokio = { workspace = true, default-features = false }
 tokio-util.workspace = true
<span class="term-fg36">@@ -54,3 +58,4 @@</span>     &quot;reth-primitives&#47;optimism&quot;,
     &quot;reth-provider&#47;optimism&quot;,
     &quot;revm-primitives&#47;optimism&quot;,
 ]
<span class="term-fg32">+scroll = [&quot;reth-scroll-storage&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-da1f9cb27961736991bf5edf" role="button"
                       aria-expanded="false" aria-controls="id-da1f9cb27961736991bf5edf">
                        <code>crates/engine/util/src/reorg.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/engine/util/src/reorg.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/engine/util/src/reorg.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-8</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-da1f9cb27961736991bf5edf"><span class="term-fg1">diff --git reth&#47;crates&#47;engine&#47;util&#47;src&#47;reorg.rs scroll-reth&#47;crates&#47;engine&#47;util&#47;src&#47;reorg.rs</span>
<span class="term-fg1">index fd80fa9e1658845f550abcf52d1ccff12ae2aed8..8467bba3fd2c08f025db135d4a7324fc71f3693b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;engine&#47;util&#47;src&#47;reorg.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;engine&#47;util&#47;src&#47;reorg.rs</span>
<span class="term-fg36">@@ -21,11 +21,11 @@</span> use reth_payload_validator::ExecutionPayloadValidator;
 use reth_primitives::{proofs, Block, BlockBody, Receipt, Receipts};
 use reth_provider::{BlockReader, ExecutionOutcome, ProviderError, StateProviderFactory};
 use reth_revm::{
<span class="term-fg31">-    database::StateProviderDatabase,</span>
     db::{states::bundle_state::BundleRetention, State},
     DatabaseCommit,
 };
 use reth_rpc_types_compat::engine::payload::block_to_payload;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_trie::HashedPostState;
 use revm_primitives::{
     calc_excess_blob_gas, BlockEnv, CfgEnvWithHandlerCfg, EVMError, EnvWithHandlerCfg,
<span class="term-fg36">@@ -292,10 +292,11 @@</span>     debug!(target: &quot;engine::stream::reorg&quot;, number = reorg_target.number, hash = %previous_hash, &quot;Selected reorg target&quot;);
&nbsp;
     &#47;&#47; Configure state
     let state_provider = provider.state_by_block_hash(reorg_target.parent_hash)?;
<span class="term-fg31">-    let mut state = State::builder()</span>
<span class="term-fg31">-        .with_database_ref(StateProviderDatabase::new(&amp;state_provider))</span>
<span class="term-fg31">-        .with_bundle_update()</span>
<span class="term-fg31">-        .build();</span>
<span class="term-fg32">+    #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+    let mut db = reth_revm::database::StateProviderDatabase::new(&amp;state_provider);</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+    let mut db = reth_scroll_storage::ScrollStateProviderDatabase::new(&amp;state_provider);</span>
<span class="term-fg32">+    let mut state = State::builder().with_database(&amp;mut db).with_bundle_update().build();</span>
&nbsp;
     &#47;&#47; Configure environments
     let mut cfg = CfgEnvWithHandlerCfg::new(Default::default(), Default::default());
<span class="term-fg36">@@ -377,9 +378,9 @@</span>     &#47;&#47; merge all transitions into bundle state, this would apply the withdrawal balance changes
     &#47;&#47; and 4788 contract call
     state.merge_transitions(BundleRetention::PlainState);
&nbsp;
<span class="term-fg31">-    let outcome: ExecutionOutcome = ExecutionOutcome::new(</span>
<span class="term-fg31">-        state.take_bundle(),</span>
<span class="term-fg31">-        Receipts::from(vec![receipts]),</span>
<span class="term-fg32">+    let outcome = ExecutionOutcome::new(</span>
<span class="term-fg32">+        state.finalize(),</span>
<span class="term-fg32">+        Receipts::&lt;Receipt&gt;::from(vec![receipts]),</span>
         reorg_target.number,
         Default::default(),
     );</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0024638026977bc401596736" role="button"
                       aria-expanded="false" aria-controls="id-0024638026977bc401596736">
                        <code>crates/evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0024638026977bc401596736"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;Cargo.toml scroll-reth&#47;crates&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">index 9d6a616af983b45cbe24f43c186c145f8d3d73d7..155e54fa90d7c8f6d67592c065e10a5d6da93cde 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -24,8 +24,11 @@</span> reth-prune-types.workspace = true
 reth-revm.workspace = true
 reth-storage-errors.workspace = true
&nbsp;
<span class="term-fg32">+revm-primitives.workspace = true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
 revm.workspace = true
<span class="term-fg31">-revm-primitives.workspace = true</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
&nbsp;
 # alloy
 alloy-primitives.workspace = true
<span class="term-fg36">@@ -66,5 +69,14 @@</span>     &quot;reth-primitives&#47;test-utils&quot;,
     &quot;reth-primitives-traits&#47;test-utils&quot;,
     &quot;reth-revm&#47;test-utils&quot;,
     &quot;revm&#47;test-utils&quot;,
<span class="term-fg31">-    &quot;reth-prune-types&#47;test-utils&quot;</span>
<span class="term-fg32">+    &quot;reth-prune-types&#47;test-utils&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-execution&#47;test-utils&quot;</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-execution&#47;scroll&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-11466f09c36f65a71774711b" role="button"
                       aria-expanded="false" aria-controls="id-11466f09c36f65a71774711b">
                        <code>crates/evm/execution-types/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/evm/execution-types/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/evm/execution-types/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-11466f09c36f65a71774711b"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;execution-types&#47;Cargo.toml scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;Cargo.toml</span>
<span class="term-fg1">index 4d2d8214ff982a1e0e106f1b15c5cd2d80ce4774..2a1725642fee9d41b3cea4c49d8c8a711499f045 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;execution-types&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;Cargo.toml</span>
<span class="term-fg36">@@ -58,3 +58,7 @@</span> 	&quot;revm&#47;std&quot;,
 	&quot;serde?&#47;std&quot;,
 	&quot;reth-primitives-traits&#47;std&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-df1f65f8ddbd688290484fe0" role="button"
                       aria-expanded="false" aria-controls="id-df1f65f8ddbd688290484fe0">
                        <code>crates/evm/execution-types/src/execution_outcome.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/evm/execution-types/src/execution_outcome.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/evm/execution-types/src/execution_outcome.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+20</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-df1f65f8ddbd688290484fe0"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;execution_outcome.rs scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;execution_outcome.rs</span>
<span class="term-fg1">index 412269ace9cd47214526a8ad5cdebb11d045318e..d6a9ddfd82500b3456d763b0f51142baef7c8c8d 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;execution_outcome.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;execution-types&#47;src&#47;execution_outcome.rs</span>
<span class="term-fg36">@@ -774,10 +774,26 @@</span>         let address2 = Address::random();
         let address3 = Address::random();
&nbsp;
         &#47;&#47; Set up account info with some changes
<span class="term-fg31">-        let account_info1 =</span>
<span class="term-fg31">-            AccountInfo { nonce: 1, balance: U256::from(100), code_hash: B256::ZERO, code: None };</span>
<span class="term-fg31">-        let account_info2 =</span>
<span class="term-fg31">-            AccountInfo { nonce: 2, balance: U256::from(200), code_hash: B256::ZERO, code: None };</span>
<span class="term-fg32">+        let account_info1 = AccountInfo {</span>
<span class="term-fg32">+            nonce: 1,</span>
<span class="term-fg32">+            balance: U256::from(100),</span>
<span class="term-fg32">+            code_hash: B256::ZERO,</span>
<span class="term-fg32">+            code: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: 0,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: B256::ZERO,</span>
<span class="term-fg32">+        };</span>
<span class="term-fg32">+        let account_info2 = AccountInfo {</span>
<span class="term-fg32">+            nonce: 2,</span>
<span class="term-fg32">+            balance: U256::from(200),</span>
<span class="term-fg32">+            code_hash: B256::ZERO,</span>
<span class="term-fg32">+            code: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            code_size: 0,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            poseidon_code_hash: B256::ZERO,</span>
<span class="term-fg32">+        };</span>
&nbsp;
         &#47;&#47; Set up the bundle state with these accounts
         let mut bundle_state = BundleState::default();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dcccb46fd0fac07d62cb05b0" role="button"
                       aria-expanded="false" aria-controls="id-dcccb46fd0fac07d62cb05b0">
                        <code>crates/evm/src/either.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/evm/src/either.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/evm/src/either.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dcccb46fd0fac07d62cb05b0"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;src&#47;either.rs scroll-reth&#47;crates&#47;evm&#47;src&#47;either.rs</span>
<span class="term-fg1">index 85bc7e7f9a79fa2790c39445a2c1a3c821edf705..167a89dc42d4f317b53822de8cd487c15658f273 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;src&#47;either.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;src&#47;either.rs</span>
<span class="term-fg36">@@ -12,27 +12,33 @@</span> use reth_execution_errors::BlockExecutionError;
 use reth_execution_types::{BlockExecutionInput, BlockExecutionOutput, ExecutionOutcome};
 use reth_primitives::{BlockWithSenders, Receipt};
 use reth_prune_types::PruneModes;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_storage_errors::provider::ProviderError;
<span class="term-fg32">+use revm::{db::BundleState, State};</span>
 use revm_primitives::db::Database;
&nbsp;
 &#47;&#47; re-export Either
 pub use futures_util::future::Either;
<span class="term-fg31">-use revm::State;</span>
&nbsp;
 impl&lt;A, B&gt; BlockExecutorProvider for Either&lt;A, B&gt;
 where
     A: BlockExecutorProvider,
     B: BlockExecutorProvider,
 {
<span class="term-fg31">-    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        Either&lt;A::Executor&lt;DB&gt;, B::Executor&lt;DB&gt;&gt;;</span>
<span class="term-fg32">+    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Either&lt;A::Executor&lt;DB&gt;, B::Executor&lt;DB&gt;&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
<span class="term-fg31">-    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        Either&lt;A::BatchExecutor&lt;DB&gt;, B::BatchExecutor&lt;DB&gt;&gt;;</span>
<span class="term-fg32">+    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Either&lt;A::BatchExecutor&lt;DB&gt;, B::BatchExecutor&lt;DB&gt;&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Executor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         match self {
             Self::Left(a) =&gt; Either::Left(a.executor(db)),
<span class="term-fg36">@@ -43,6 +49,7 @@</span>
     fn batch_executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         match self {
             Self::Left(a) =&gt; Either::Left(a.batch_executor(db)),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-011341a503e563782551e183" role="button"
                       aria-expanded="false" aria-controls="id-011341a503e563782551e183">
                        <code>crates/evm/src/execute.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/evm/src/execute.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/evm/src/execute.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+51</span></div>
                            <div class="text-start"><span class="text-danger">-16</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-011341a503e563782551e183"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;src&#47;execute.rs scroll-reth&#47;crates&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">index 42c756f4d93f9dae6f6ee62fce8a18cc9982d28e..1e157b83bf1c2c500053eecf0d094fc539005b41 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;src&#47;execute.rs</span>
<span class="term-fg36">@@ -16,6 +16,7 @@</span> use reth_consensus::ConsensusError;
 use reth_primitives::{BlockWithSenders, Receipt};
 use reth_prune_types::PruneModes;
 use reth_revm::batch::BlockBatchRecord;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use revm::{
     db::{states::bundle_state::BundleRetention, BundleState},
     State,
<span class="term-fg36">@@ -146,7 +147,9 @@</span>         DB,
         Input&lt;&#39;a&gt; = BlockExecutionInput&lt;&#39;a, BlockWithSenders&gt;,
         Output = BlockExecutionOutput&lt;Receipt&gt;,
         Error = BlockExecutionError,
<span class="term-fg31">-    &gt;;</span>
<span class="term-fg32">+    &gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     &#47;&#47;&#47; An executor that can execute a batch of blocks given a database.
     type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;: for&lt;&#39;a&gt; BatchExecutor&lt;
<span class="term-fg36">@@ -154,14 +157,17 @@</span>         DB,
         Input&lt;&#39;a&gt; = BlockExecutionInput&lt;&#39;a, BlockWithSenders&gt;,
         Output = ExecutionOutcome,
         Error = BlockExecutionError,
<span class="term-fg31">-    &gt;;</span>
<span class="term-fg32">+    &gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     &#47;&#47;&#47; Creates a new executor for single block execution.
     &#47;&#47;&#47;
     &#47;&#47;&#47; This is used to execute a single block and get the changed state.
     fn executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Executor&lt;DB&gt;
     where
<span class="term-fg31">-        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;;</span>
<span class="term-fg32">+        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     &#47;&#47;&#47; Creates a new batch executor with the given database and pruning modes.
     &#47;&#47;&#47;
<span class="term-fg36">@@ -169,7 +175,8 @@</span>     &#47;&#47;&#47; Batch executor is used to execute multiple blocks in sequence and keep track of the state
     &#47;&#47;&#47; during historical sync which involves executing multiple blocks in sequence.
     fn batch_executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
<span class="term-fg31">-        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;;</span>
<span class="term-fg32">+        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
 }
&nbsp;
 &#47;&#47;&#47; Helper type for the output of executing a block.
<span class="term-fg36">@@ -185,6 +192,7 @@</span> &#47;&#47;&#47; Defines the strategy for executing a single block.
 pub trait BlockExecutionStrategy&lt;DB&gt;
 where
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; The error type returned by this strategy&#39;s methods.
     type Error: From&lt;ProviderError&gt; + core::error::Error;
<span class="term-fg36">@@ -226,7 +234,7 @@</span>
     &#47;&#47;&#47; Returns the final bundle state.
     fn finish(&amp;mut self) -&gt; BundleState {
         self.state_mut().merge_transitions(BundleRetention::Reverts);
<span class="term-fg31">-        self.state_mut().take_bundle()</span>
<span class="term-fg32">+        self.state_mut().finalize()</span>
     }
&nbsp;
     &#47;&#47;&#47; Validate a block with regard to execution results.
<span class="term-fg36">@@ -246,12 +254,15 @@</span>     &#47;&#47;&#47; Associated strategy type.
     type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;: BlockExecutionStrategy&lt;
         DB,
         Error = BlockExecutionError,
<span class="term-fg31">-    &gt;;</span>
<span class="term-fg32">+    &gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     &#47;&#47;&#47; Creates a strategy using the give database.
     fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
     where
<span class="term-fg31">-        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;;</span>
<span class="term-fg32">+        DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
 }
&nbsp;
 impl&lt;F&gt; Clone for BasicBlockExecutorProvider&lt;F&gt;
<span class="term-fg36">@@ -280,15 +291,20 @@</span> impl&lt;F&gt; BlockExecutorProvider for BasicBlockExecutorProvider&lt;F&gt;
 where
     F: BlockExecutionStrategyFactory,
 {
<span class="term-fg31">-    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        BasicBlockExecutor&lt;F::Strategy&lt;DB&gt;, DB&gt;;</span>
<span class="term-fg32">+    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = BasicBlockExecutor&lt;F::Strategy&lt;DB&gt;, DB&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
<span class="term-fg31">-    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-        BasicBatchExecutor&lt;F::Strategy&lt;DB&gt;, DB&gt;;</span>
<span class="term-fg32">+    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = BasicBatchExecutor&lt;F::Strategy&lt;DB&gt;, DB&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Executor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let strategy = self.strategy_factory.create_strategy(db);
         BasicBlockExecutor::new(strategy)
<span class="term-fg36">@@ -297,6 +313,7 @@</span>
     fn batch_executor&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let strategy = self.strategy_factory.create_strategy(db);
         let batch_record = BlockBatchRecord::default();
<span class="term-fg36">@@ -311,6 +328,7 @@</span> pub struct BasicBlockExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Block execution strategy.
     pub(crate) strategy: S,
<span class="term-fg36">@@ -321,6 +339,7 @@</span> impl&lt;S, DB&gt; BasicBlockExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Creates a new `BasicBlockExecutor` with the given strategy.
     pub const fn new(strategy: S) -&gt; Self {
<span class="term-fg36">@@ -332,6 +351,7 @@</span> impl&lt;S, DB&gt; Executor&lt;DB&gt; for BasicBlockExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     type Input&lt;&#39;a&gt; = BlockExecutionInput&lt;&#39;a, BlockWithSenders&gt;;
     type Output = BlockExecutionOutput&lt;Receipt&gt;;
<span class="term-fg36">@@ -408,6 +428,7 @@</span> pub struct BasicBatchExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Batch execution strategy.
     pub(crate) strategy: S,
<span class="term-fg36">@@ -420,6 +441,7 @@</span> impl&lt;S, DB&gt; BasicBatchExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Creates a new `BasicBatchExecutor` with the given strategy.
     pub const fn new(strategy: S, batch_record: BlockBatchRecord) -&gt; Self {
<span class="term-fg36">@@ -431,6 +453,7 @@</span> impl&lt;S, DB&gt; BatchExecutor&lt;DB&gt; for BasicBatchExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB, Error = BlockExecutionError&gt;,
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     type Input&lt;&#39;a&gt; = BlockExecutionInput&lt;&#39;a, BlockWithSenders&gt;;
     type Output = ExecutionOutcome;
<span class="term-fg36">@@ -466,7 +489,7 @@</span>     }
&nbsp;
     fn finalize(mut self) -&gt; Self::Output {
         ExecutionOutcome::new(
<span class="term-fg31">-            self.strategy.state_mut().take_bundle(),</span>
<span class="term-fg32">+            self.strategy.state_mut().finalize(),</span>
             self.batch_record.take_receipts(),
             self.batch_record.first_block().unwrap_or_default(),
             self.batch_record.take_requests(),
<span class="term-fg36">@@ -499,12 +522,19 @@</span>     #[derive(Clone, Default)]
     struct TestExecutorProvider;
&nbsp;
     impl BlockExecutorProvider for TestExecutorProvider {
<span class="term-fg31">-        type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = TestExecutor&lt;DB&gt;;</span>
<span class="term-fg31">-        type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = TestExecutor&lt;DB&gt;;</span>
<span class="term-fg32">+        type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+            = TestExecutor&lt;DB&gt;</span>
<span class="term-fg32">+        where</span>
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
<span class="term-fg32">+        type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+            = TestExecutor&lt;DB&gt;</span>
<span class="term-fg32">+        where</span>
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
         fn executor&lt;DB&gt;(&amp;self, _db: DB) -&gt; Self::Executor&lt;DB&gt;
         where
             DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
         {
             TestExecutor(PhantomData)
         }
<span class="term-fg36">@@ -512,6 +542,7 @@</span>
         fn batch_executor&lt;DB&gt;(&amp;self, _db: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
         where
             DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
         {
             TestExecutor(PhantomData)
         }
<span class="term-fg36">@@ -596,12 +627,15 @@</span>         finish_result: BundleState,
     }
&nbsp;
     impl BlockExecutionStrategyFactory for TestExecutorStrategyFactory {
<span class="term-fg31">-        type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; =</span>
<span class="term-fg31">-            TestExecutorStrategy&lt;DB, TestEvmConfig&gt;;</span>
<span class="term-fg32">+        type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+            = TestExecutorStrategy&lt;DB, TestEvmConfig&gt;</span>
<span class="term-fg32">+        where</span>
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
         fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
         where
             DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+            State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
         {
             let state = State::builder()
                 .with_database(db)
<span class="term-fg36">@@ -625,6 +659,7 @@</span>
     impl&lt;DB&gt; BlockExecutionStrategy&lt;DB&gt; for TestExecutorStrategy&lt;DB, TestEvmConfig&gt;
     where
         DB: Database,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         type Error = BlockExecutionError;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-82568375a6411eafcd6e13fb" role="button"
                       aria-expanded="false" aria-controls="id-82568375a6411eafcd6e13fb">
                        <code>crates/evm/src/noop.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/evm/src/noop.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/evm/src/noop.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-82568375a6411eafcd6e13fb"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;src&#47;noop.rs scroll-reth&#47;crates&#47;evm&#47;src&#47;noop.rs</span>
<span class="term-fg1">index 4fdc6d367a2771a7c2b7f8adab1cc1dc1ad6fb8c..c0ad60b7fc2b9bcd9e52338d7486086147b8c754 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;src&#47;noop.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;src&#47;noop.rs</span>
<span class="term-fg36">@@ -6,8 +6,9 @@</span> use reth_execution_errors::BlockExecutionError;
 use reth_execution_types::{BlockExecutionInput, BlockExecutionOutput, ExecutionOutcome};
 use reth_primitives::{BlockWithSenders, Receipt};
 use reth_prune_types::PruneModes;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_storage_errors::provider::ProviderError;
<span class="term-fg31">-use revm::State;</span>
<span class="term-fg32">+use revm::{db::BundleState, State};</span>
 use revm_primitives::db::Database;
&nbsp;
 use crate::{
<span class="term-fg36">@@ -23,13 +24,20 @@</span> #[non_exhaustive]
 pub struct NoopBlockExecutorProvider;
&nbsp;
 impl BlockExecutorProvider for NoopBlockExecutorProvider {
<span class="term-fg31">-    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = Self;</span>
<span class="term-fg32">+    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
<span class="term-fg31">-    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = Self;</span>
<span class="term-fg32">+    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn executor&lt;DB&gt;(&amp;self, _: DB) -&gt; Self::Executor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         Self
     }
<span class="term-fg36">@@ -37,6 +45,7 @@</span>
     fn batch_executor&lt;DB&gt;(&amp;self, _: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         Self
     }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7f8053bcdd31185c9a64a171" role="button"
                       aria-expanded="false" aria-controls="id-7f8053bcdd31185c9a64a171">
                        <code>crates/evm/src/test_utils.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/evm/src/test_utils.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/evm/src/test_utils.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7f8053bcdd31185c9a64a171"><span class="term-fg1">diff --git reth&#47;crates&#47;evm&#47;src&#47;test_utils.rs scroll-reth&#47;crates&#47;evm&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">index a4dc906494ce1f13499495c4e8b4b74a95fae11f..b3f338fa856e7f074f68837fe0308fce961d6353 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;evm&#47;src&#47;test_utils.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;evm&#47;src&#47;test_utils.rs</span>
<span class="term-fg36">@@ -14,8 +14,9 @@</span> use reth_execution_errors::BlockExecutionError;
 use reth_execution_types::ExecutionOutcome;
 use reth_primitives::{BlockWithSenders, Receipt, Receipts};
 use reth_prune_types::PruneModes;
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_storage_errors::provider::ProviderError;
<span class="term-fg31">-use revm::State;</span>
<span class="term-fg32">+use revm::{db::BundleState, State};</span>
 use revm_primitives::db::Database;
 use std::{fmt::Display, sync::Arc};
&nbsp;
<span class="term-fg36">@@ -33,13 +34,20 @@</span>     }
 }
&nbsp;
 impl BlockExecutorProvider for MockExecutorProvider {
<span class="term-fg31">-    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = Self;</span>
<span class="term-fg32">+    type Executor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
<span class="term-fg31">-    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = Self;</span>
<span class="term-fg32">+    type BatchExecutor&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = Self</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn executor&lt;DB&gt;(&amp;self, _: DB) -&gt; Self::Executor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         self.clone()
     }
<span class="term-fg36">@@ -47,6 +55,7 @@</span>
     fn batch_executor&lt;DB&gt;(&amp;self, _: DB) -&gt; Self::BatchExecutor&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         self.clone()
     }
<span class="term-fg36">@@ -120,6 +129,7 @@</span> impl&lt;S, DB&gt; BasicBlockExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Provides safe read access to the state
     pub fn with_state&lt;F, R&gt;(&amp;self, f: F) -&gt; R
<span class="term-fg36">@@ -142,6 +152,7 @@</span> impl&lt;S, DB&gt; BasicBatchExecutor&lt;S, DB&gt;
 where
     S: BlockExecutionStrategy&lt;DB&gt;,
     DB: Database,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     &#47;&#47;&#47; Provides safe read access to the state
     pub fn with_state&lt;F, R&gt;(&amp;self, f: F) -&gt; R</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4cc05c14a7eb9d000d887d66" role="button"
                       aria-expanded="false" aria-controls="id-4cc05c14a7eb9d000d887d66">
                        <code>crates/exex/exex/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/exex/exex/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/exex/exex/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+17</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4cc05c14a7eb9d000d887d66"><span class="term-fg1">diff --git reth&#47;crates&#47;exex&#47;exex&#47;Cargo.toml scroll-reth&#47;crates&#47;exex&#47;exex&#47;Cargo.toml</span>
<span class="term-fg1">index 3cbeb115b0669d3b288a83d572ab708bebec7180..be783543f9509696c2fab0ed9cefc3cc81b8e16d 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;exex&#47;exex&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;exex&#47;exex&#47;Cargo.toml</span>
<span class="term-fg36">@@ -34,6 +34,9 @@</span> reth-stages-api.workspace = true
 reth-tasks.workspace = true
 reth-tracing.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # alloy
 alloy-primitives.workspace = true
 alloy-eips.workspace = true
<span class="term-fg36">@@ -81,3 +84,17 @@</span> 	&quot;rand&#47;serde&quot;,
 	&quot;secp256k1&#47;serde&quot;,
 	&quot;reth-primitives-traits&#47;serde&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+	&quot;reth-node-core&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-evm-ethereum&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-node-api&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-blockchain-tree&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-db-common&#47;scroll&quot;,</span>
<span class="term-fg32">+	&quot;reth-scroll-storage&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cffe5928514cf0f9e103227b" role="button"
                       aria-expanded="false" aria-controls="id-cffe5928514cf0f9e103227b">
                        <code>crates/exex/exex/src/backfill/job.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/exex/exex/src/backfill/job.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/exex/exex/src/backfill/job.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cffe5928514cf0f9e103227b"><span class="term-fg1">diff --git reth&#47;crates&#47;exex&#47;exex&#47;src&#47;backfill&#47;job.rs scroll-reth&#47;crates&#47;exex&#47;exex&#47;src&#47;backfill&#47;job.rs</span>
<span class="term-fg1">index 77a7b50477b000e43b406365d3e0a2297184d6cb..a4754ac607f83ebddb419c5a6a3a7e46baf059af 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;exex&#47;exex&#47;src&#47;backfill&#47;job.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;exex&#47;exex&#47;src&#47;backfill&#47;job.rs</span>
<span class="term-fg36">@@ -72,9 +72,15 @@</span>             range = ?self.range,
             &quot;Executing block range&quot;
         );
&nbsp;
<span class="term-fg31">-        let mut executor = self.executor.batch_executor(StateProviderDatabase::new(</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let db = StateProviderDatabase::new(</span>
             self.provider.history_by_block_number(self.range.start().saturating_sub(1))?,
<span class="term-fg31">-        ));</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let db = reth_scroll_storage::ScrollStateProviderDatabase::new(</span>
<span class="term-fg32">+            self.provider.history_by_block_number(self.range.start().saturating_sub(1))?,</span>
<span class="term-fg32">+        );</span>
<span class="term-fg32">+        let mut executor = self.executor.batch_executor(db);</span>
         executor.set_prune_modes(self.prune_modes.clone());
&nbsp;
         let mut fetch_block_duration = Duration::default();</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d573d498ef5b8fe8b10924c7" role="button"
                       aria-expanded="false" aria-controls="id-d573d498ef5b8fe8b10924c7">
                        <code>crates/exex/test-utils/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/exex/test-utils/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/exex/test-utils/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d573d498ef5b8fe8b10924c7"><span class="term-fg1">diff --git reth&#47;crates&#47;exex&#47;test-utils&#47;Cargo.toml scroll-reth&#47;crates&#47;exex&#47;test-utils&#47;Cargo.toml</span>
<span class="term-fg1">index 6e5af981b31742fb8f31d2bed052e5441cb33dff..56701b7ebb272da1ddf94b7e7f0bf6ebd14bee46 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;exex&#47;test-utils&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;exex&#47;test-utils&#47;Cargo.toml</span>
<span class="term-fg36">@@ -45,3 +45,6 @@</span> eyre.workspace = true
 rand.workspace = true
 tempfile.workspace = true
 thiserror.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bfb207b88f95d476c676b9fe" role="button"
                       aria-expanded="false" aria-controls="id-bfb207b88f95d476c676b9fe">
                        <code>crates/exex/test-utils/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/exex/test-utils/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/exex/test-utils/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bfb207b88f95d476c676b9fe"><span class="term-fg1">diff --git reth&#47;crates&#47;exex&#47;test-utils&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;exex&#47;test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 5b2267505c571a74e0e29e5267df39e07df7ff6c..4e1491c8aa0e846299243322f43df7d393e8cf27 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;exex&#47;test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;exex&#47;test-utils&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -7,6 +7,9 @@</span>     issue_tracker_base_url = &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth&#47;issues&#47;&quot;
 )]
 #![cfg_attr(docsrs, feature(doc_cfg, doc_auto_cfg))]
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use std::{
     fmt::Debug,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7d92712c33f2173b1c0ddaeb" role="button"
                       aria-expanded="false" aria-controls="id-7d92712c33f2173b1c0ddaeb">
                        <code>crates/node/api/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/node/api/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/node/api/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7d92712c33f2173b1c0ddaeb"><span class="term-fg1">diff --git reth&#47;crates&#47;node&#47;api&#47;Cargo.toml scroll-reth&#47;crates&#47;node&#47;api&#47;Cargo.toml</span>
<span class="term-fg1">index ab4595d336243020ea928237736898f23e54e0c6..8279a83252295f608eec61c568cf80afe9a102c6 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;node&#47;api&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;node&#47;api&#47;Cargo.toml</span>
<span class="term-fg36">@@ -29,3 +29,11 @@</span> alloy-rpc-types-engine.workspace = true
 alloy-consensus.workspace = true
&nbsp;
 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-node-core&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-engine-primitives&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f5847477fd98073dc99b49c9" role="button"
                       aria-expanded="false" aria-controls="id-f5847477fd98073dc99b49c9">
                        <code>crates/node/core/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/node/core/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/node/core/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f5847477fd98073dc99b49c9"><span class="term-fg1">diff --git reth&#47;crates&#47;node&#47;core&#47;Cargo.toml scroll-reth&#47;crates&#47;node&#47;core&#47;Cargo.toml</span>
<span class="term-fg1">index c667a56293c15c7de6b1a5a1394856a8f433b22e..b24430982025d1954b30a1b65f1370a1dca9e53b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;node&#47;core&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;node&#47;core&#47;Cargo.toml</span>
<span class="term-fg36">@@ -80,6 +80,11 @@</span> optimism = [&quot;reth-primitives&#47;optimism&quot;, &quot;reth-db&#47;optimism&quot;]
 # Features for vergen to generate correct env vars
 jemalloc = [&quot;reth-cli-util&#47;jemalloc&quot;]
 asm-keccak = [&quot;reth-primitives&#47;asm-keccak&quot;, &quot;alloy-primitives&#47;asm-keccak&quot;]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc-eth-types&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span>
&nbsp;
 [build-dependencies]
 vergen = { version = &quot;8.0.0&quot;, features = [&quot;build&quot;, &quot;cargo&quot;, &quot;git&quot;, &quot;gitcl&quot;] }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4be9e1a8f844fad007b91304" role="button"
                       aria-expanded="false" aria-controls="id-4be9e1a8f844fad007b91304">
                        <code>crates/payload/basic/src/lib.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/payload/basic/src/lib.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/payload/basic/src/lib.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4be9e1a8f844fad007b91304"><span class="term-fg1">diff --git reth&#47;crates&#47;payload&#47;basic&#47;src&#47;lib.rs scroll-reth&#47;crates&#47;payload&#47;basic&#47;src&#47;lib.rs</span>
<span class="term-fg1">index 0ab411d3e600a08b3b71bacfaa5d5c2b6760dd58..c5a39d3a989d0ed6314916468e50431d84510e18 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;payload&#47;basic&#47;src&#47;lib.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;payload&#47;basic&#47;src&#47;lib.rs</span>
<span class="term-fg36">@@ -204,7 +204,12 @@</span>                 &#47;&#47; we want pre cache existing accounts and their storage
                 &#47;&#47; this only includes changed accounts and storage but is better than nothing
                 let storage =
                     acc.storage.iter().map(|(key, slot)| (*key, slot.present_value)).collect();
<span class="term-fg31">-                cached.insert_account(addr, info, storage);</span>
<span class="term-fg32">+                cached.insert_account(</span>
<span class="term-fg32">+                    addr,</span>
<span class="term-fg32">+                    #[allow(clippy::useless_conversion)]</span>
<span class="term-fg32">+                    info.into(),</span>
<span class="term-fg32">+                    storage,</span>
<span class="term-fg32">+                );</span>
             }
         }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-80070854dab6021595f0026e" role="button"
                       aria-expanded="false" aria-controls="id-80070854dab6021595f0026e">
                        <code>crates/revm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/revm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/revm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-80070854dab6021595f0026e"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;Cargo.toml scroll-reth&#47;crates&#47;revm&#47;Cargo.toml</span>
<span class="term-fg1">index 4bc78b7b056235f90b1165c565d905310f182ad8..ecccb30475e64e61c22e2da70c4ac45582ca1ba8 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,6 +21,9 @@</span> reth-storage-api.workspace = true
 reth-trie = { workspace = true, optional = true }
 reth-primitives-traits.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # alloy
 alloy-eips.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg36">@@ -61,3 +64,8 @@</span>     &quot;alloy-primitives&#47;serde&quot;,
     &quot;alloy-consensus&#47;serde&quot;,
     &quot;reth-primitives-traits&#47;serde&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives-traits&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-15fab874a2cf18aa72e6ed79" role="button"
                       aria-expanded="false" aria-controls="id-15fab874a2cf18aa72e6ed79">
                        <code>crates/revm/src/cached.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/revm/src/cached.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/revm/src/cached.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-15fab874a2cf18aa72e6ed79"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;cached.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;cached.rs</span>
<span class="term-fg1">index 5d5262adc5b3bde3a510d1fb75e8b40ea1608df5..81e44675f75fb00aac0bcd72dbc3c28d00049629 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;cached.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;cached.rs</span>
<span class="term-fg36">@@ -4,9 +4,12 @@</span>     map::{Entry, HashMap},
     Address, B256, U256,
 };
 use core::cell::RefCell;
<span class="term-fg31">-use revm::primitives::{</span>
<span class="term-fg31">-    db::{Database, DatabaseRef},</span>
<span class="term-fg31">-    AccountInfo, Bytecode,</span>
<span class="term-fg32">+use revm::{</span>
<span class="term-fg32">+    primitives::{</span>
<span class="term-fg32">+        db::{Database, DatabaseRef},</span>
<span class="term-fg32">+        Bytecode,</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    shared::AccountInfo,</span>
 };
&nbsp;
 &#47;&#47;&#47; A container type that caches reads from an underlying [`DatabaseRef`].</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-545fb12e85c27ef019518a21" role="button"
                       aria-expanded="false" aria-controls="id-545fb12e85c27ef019518a21">
                        <code>crates/revm/src/database.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/revm/src/database.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/revm/src/database.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-545fb12e85c27ef019518a21"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;database.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;database.rs</span>
<span class="term-fg1">index 682aca6cf3795201b9bcb6d6b5ae87e28a060062..9fd059194cfac1ad67e1c971c07aa46cc4ad92ea 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;database.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;database.rs</span>
<span class="term-fg36">@@ -3,11 +3,7 @@</span> use alloy_primitives::{Address, B256, U256};
 use core::ops::{Deref, DerefMut};
 use reth_primitives::Account;
 use reth_storage_errors::provider::{ProviderError, ProviderResult};
<span class="term-fg31">-use revm::{</span>
<span class="term-fg31">-    db::DatabaseRef,</span>
<span class="term-fg31">-    primitives::{AccountInfo, Bytecode},</span>
<span class="term-fg31">-    Database,</span>
<span class="term-fg31">-};</span>
<span class="term-fg32">+use revm::{db::DatabaseRef, primitives::Bytecode, shared::AccountInfo, Database};</span>
&nbsp;
 &#47;&#47;&#47; A helper trait responsible for providing state necessary for EVM execution.
 &#47;&#47;&#47;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a3b24942053be657d2cff1e2" role="button"
                       aria-expanded="false" aria-controls="id-a3b24942053be657d2cff1e2">
                        <code>crates/revm/src/either.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/revm/src/either.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/revm/src/either.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a3b24942053be657d2cff1e2"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;either.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;either.rs</span>
<span class="term-fg1">index e93ba3a8d010e5372f10bf7267657b3934ebda57..c2521bc4801a6c748aa83f5350f3d71d637ed2b2 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;either.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;either.rs</span>
<span class="term-fg36">@@ -1,8 +1,5 @@</span>
 use alloy_primitives::{Address, B256, U256};
<span class="term-fg31">-use revm::{</span>
<span class="term-fg31">-    primitives::{AccountInfo, Bytecode},</span>
<span class="term-fg31">-    Database,</span>
<span class="term-fg31">-};</span>
<span class="term-fg32">+use revm::{primitives::Bytecode, shared::AccountInfo, Database};</span>
&nbsp;
 &#47;&#47;&#47; An enum type that can hold either of two different [`Database`] implementations.
 &#47;&#47;&#47;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2ce66392140eda819937e5c2" role="button"
                       aria-expanded="false" aria-controls="id-2ce66392140eda819937e5c2">
                        <code>crates/revm/src/witness.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/revm/src/witness.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/revm/src/witness.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+22</span></div>
                            <div class="text-start"><span class="text-danger">-6</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2ce66392140eda819937e5c2"><span class="term-fg1">diff --git reth&#47;crates&#47;revm&#47;src&#47;witness.rs scroll-reth&#47;crates&#47;revm&#47;src&#47;witness.rs</span>
<span class="term-fg1">index c40c87d324b30db1163739977714088c2b06d3c9..ab1ec0f7978531a4fd1c282885244b8d1e51b1fe 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;revm&#47;src&#47;witness.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;revm&#47;src&#47;witness.rs</span>
<span class="term-fg36">@@ -22,7 +22,11 @@</span> }
&nbsp;
 impl ExecutionWitnessRecord {
     &#47;&#47;&#47; Records the state after execution.
<span class="term-fg31">-    pub fn record_executed_state&lt;DB&gt;(&amp;mut self, statedb: &amp;State&lt;DB&gt;) {</span>
<span class="term-fg32">+    pub fn record_executed_state&lt;DB&gt;(</span>
<span class="term-fg32">+        &amp;mut self,</span>
<span class="term-fg32">+        statedb: &amp;State&lt;DB&gt;,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)] context: &amp;reth_scroll_primitives::ScrollPostExecutionContext,</span>
<span class="term-fg32">+    ) {</span>
         self.codes = statedb
             .cache
             .contracts
<span class="term-fg36">@@ -43,9 +47,14 @@</span>             .collect();
&nbsp;
         for (address, account) in &amp;statedb.cache.accounts {
             let hashed_address = keccak256(address);
<span class="term-fg31">-            self.hashed_state</span>
<span class="term-fg31">-                .accounts</span>
<span class="term-fg31">-                .insert(hashed_address, account.account.as_ref().map(|a| a.info.clone().into()));</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            let hashed_account = account</span>
<span class="term-fg32">+                .account</span>
<span class="term-fg32">+                .as_ref()</span>
<span class="term-fg32">+                .map(|a| Into::&lt;revm::AccountInfo&gt;::into((a.info.clone(), context)).into());</span>
<span class="term-fg32">+            #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+            let hashed_account = account.account.as_ref().map(|a| a.info.clone().into());</span>
<span class="term-fg32">+            self.hashed_state.accounts.insert(hashed_address, hashed_account);</span>
&nbsp;
             let storage = self
                 .hashed_state
<span class="term-fg36">@@ -68,9 +77,16 @@</span>         }
     }
&nbsp;
     &#47;&#47;&#47; Creates the record from the state after execution.
<span class="term-fg31">-    pub fn from_executed_state&lt;DB&gt;(state: &amp;State&lt;DB&gt;) -&gt; Self {</span>
<span class="term-fg32">+    pub fn from_executed_state&lt;DB&gt;(</span>
<span class="term-fg32">+        state: &amp;State&lt;DB&gt;,</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)] context: &amp;reth_scroll_primitives::ScrollPostExecutionContext,</span>
<span class="term-fg32">+    ) -&gt; Self {</span>
         let mut record = Self::default();
<span class="term-fg31">-        record.record_executed_state(state);</span>
<span class="term-fg32">+        record.record_executed_state(</span>
<span class="term-fg32">+            state,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            context,</span>
<span class="term-fg32">+        );</span>
         record
     }
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-867cbb2c6d823af56c9fb8ff" role="button"
                       aria-expanded="false" aria-controls="id-867cbb2c6d823af56c9fb8ff">
                        <code>crates/rpc/rpc-eth-api/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/rpc/rpc-eth-api/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/rpc/rpc-eth-api/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-867cbb2c6d823af56c9fb8ff"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;Cargo.toml scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;Cargo.toml</span>
<span class="term-fg1">index e4b1b28074f05052996756178d6028f66091ac33..c21cbaa66ba0e4ad60911fcd772e327630f95824 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;Cargo.toml</span>
<span class="term-fg36">@@ -43,6 +43,10 @@</span> alloy-rpc-types-eth.workspace = true
 alloy-rpc-types-mev.workspace = true
 alloy-consensus.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # rpc
 jsonrpsee = { workspace = true, features = [&quot;server&quot;, &quot;macros&quot;] }
 jsonrpsee-types.workspace = true
<span class="term-fg36">@@ -61,3 +65,13 @@</span>
 [features]
 js-tracer = [&quot;revm-inspectors&#47;js-tracer&quot;, &quot;reth-rpc-eth-types&#47;js-tracer&quot;]
 client = [&quot;jsonrpsee&#47;client&quot;, &quot;jsonrpsee&#47;async-client&quot;]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc-eth-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8d76567e435d78bd429236d6" role="button"
                       aria-expanded="false" aria-controls="id-8d76567e435d78bd429236d6">
                        <code>crates/rpc/rpc-eth-api/src/helpers/call.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/rpc/rpc-eth-api/src/helpers/call.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/rpc/rpc-eth-api/src/helpers/call.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8d76567e435d78bd429236d6"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;call.rs scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;call.rs</span>
<span class="term-fg1">index d7e74c37b5676b29fc1a9199081658a80f6084ea..077fee2826fa66024f81e885f40e756760548ed3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;call.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;call.rs</span>
<span class="term-fg36">@@ -109,6 +109,10 @@</span>             cfg.disable_eip3607 = true;
&nbsp;
             let this = self.clone();
             self.spawn_with_state_at_block(block, move |state| {
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                let mut db =</span>
<span class="term-fg32">+                    CacheDB::new(reth_scroll_storage::ScrollStateProviderDatabase::new(state));</span>
<span class="term-fg32">+                #[cfg(not(feature = &quot;scroll&quot;))]</span>
                 let mut db = CacheDB::new(StateProviderDatabase::new(state));
                 let mut blocks: Vec&lt;SimulatedBlock&lt;RpcBlock&lt;Self::NetworkTypes&gt;&gt;&gt; =
                     Vec::with_capacity(block_state_calls.len());</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7b24d1d059cb6c61f76a39c0" role="button"
                       aria-expanded="false" aria-controls="id-7b24d1d059cb6c61f76a39c0">
                        <code>crates/rpc/rpc-eth-api/src/helpers/pending_block.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/rpc/rpc-eth-api/src/helpers/pending_block.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/rpc/rpc-eth-api/src/helpers/pending_block.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-8</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7b24d1d059cb6c61f76a39c0"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;pending_block.rs scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;pending_block.rs</span>
<span class="term-fg1">index 548f9101023dad4b30b9714d00c3217e956f3a03..631e46787420ed0c5273b1b8f202f1429ddd1ab3 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;pending_block.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-api&#47;src&#47;helpers&#47;pending_block.rs</span>
<span class="term-fg36">@@ -24,14 +24,12 @@</span> use reth_provider::{
     BlockReader, BlockReaderIdExt, ChainSpecProvider, EvmEnvProvider, ProviderError,
     ReceiptProvider, StateProviderFactory,
 };
<span class="term-fg31">-use reth_revm::{</span>
<span class="term-fg31">-    database::StateProviderDatabase,</span>
<span class="term-fg31">-    primitives::{</span>
<span class="term-fg31">-        BlockEnv, CfgEnv, CfgEnvWithHandlerCfg, EVMError, Env, ExecutionResult, InvalidTransaction,</span>
<span class="term-fg31">-        ResultAndState, SpecId,</span>
<span class="term-fg31">-    },</span>
<span class="term-fg32">+use reth_revm::primitives::{</span>
<span class="term-fg32">+    BlockEnv, CfgEnv, CfgEnvWithHandlerCfg, EVMError, Env, ExecutionResult, InvalidTransaction,</span>
<span class="term-fg32">+    ResultAndState, SpecId,</span>
 };
 use reth_rpc_eth_types::{EthApiError, PendingBlock, PendingBlockEnv, PendingBlockEnvOrigin};
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use reth_transaction_pool::{BestTransactionsAttributes, TransactionPool};
 use reth_trie::HashedPostState;
 use revm::{db::states::bundle_state::BundleRetention, DatabaseCommit, State};
<span class="term-fg36">@@ -226,7 +224,10 @@</span>         let state_provider = self
             .provider()
             .history_by_block_hash(parent_hash)
             .map_err(Self::Error::from_eth_err)?;
<span class="term-fg31">-        let state = StateProviderDatabase::new(state_provider);</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let state = reth_revm::database::StateProviderDatabase::new(state_provider);</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let state = reth_scroll_storage::ScrollStateProviderDatabase::new(state_provider);</span>
         let mut db = State::builder().with_database(state).with_bundle_update().build();
&nbsp;
         let mut cumulative_gas_used = 0;
<span class="term-fg36">@@ -384,7 +385,7 @@</span>         &#47;&#47; merge all transitions into bundle state.
         db.merge_transitions(BundleRetention::PlainState);
&nbsp;
         let execution_outcome = ExecutionOutcome::new(
<span class="term-fg31">-            db.take_bundle(),</span>
<span class="term-fg32">+            db.finalize(),</span>
             vec![receipts.clone()].into(),
             block_number,
             Vec::new(),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7f13b97ff3019f7339be08d0" role="button"
                       aria-expanded="false" aria-controls="id-7f13b97ff3019f7339be08d0">
                        <code>crates/rpc/rpc-eth-types/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/rpc/rpc-eth-types/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/rpc/rpc-eth-types/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7f13b97ff3019f7339be08d0"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;Cargo.toml scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;Cargo.toml</span>
<span class="term-fg1">index 98b9530d63c28cb9cff221aae62371e4e6e275fb..ef7a9b99cbfce57acd070b931fdc3b2bb5d7fb80 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;Cargo.toml</span>
<span class="term-fg36">@@ -33,10 +33,13 @@</span> alloy-primitives.workspace = true
 alloy-consensus.workspace = true
 alloy-sol-types.workspace = true
 alloy-rpc-types-eth.workspace = true
<span class="term-fg31">-revm.workspace = true</span>
 revm-inspectors.workspace = true
 revm-primitives = { workspace = true, features = [&quot;dev&quot;] }
 alloy-eips.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+revm.workspace = true</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
&nbsp;
 # rpc
 jsonrpsee-core.workspace = true
<span class="term-fg36">@@ -65,3 +68,12 @@</span>
&nbsp;
 [features]
 js-tracer = [&quot;revm-inspectors&#47;js-tracer&quot;]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-execution-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&#47;scroll&quot;</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-15733474114ea72a70cdf41e" role="button"
                       aria-expanded="false" aria-controls="id-15733474114ea72a70cdf41e">
                        <code>crates/rpc/rpc-eth-types/src/simulate.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/rpc/rpc-eth-types/src/simulate.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/rpc/rpc-eth-types/src/simulate.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-15733474114ea72a70cdf41e"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;simulate.rs scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;simulate.rs</span>
<span class="term-fg1">index 5a0daa1b42f017b40ffbd3d68d7c2ef18afe8c68..d296286b83b5eafb3725fac588f25254bf9c6a08 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;simulate.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc-eth-types&#47;src&#47;simulate.rs</span>
<span class="term-fg36">@@ -12,7 +12,6 @@</span> use reth_primitives::{
     proofs::{calculate_receipt_root, calculate_transaction_root},
     BlockBody, BlockWithSenders, Receipt, TransactionSigned,
 };
<span class="term-fg31">-use reth_revm::database::StateProviderDatabase;</span>
 use reth_rpc_server_types::result::rpc_err;
 use reth_rpc_types_compat::{block::from_block, TransactionCompat};
 use reth_storage_api::StateRootProvider;
<span class="term-fg36">@@ -151,7 +150,12 @@</span>     block_env: &amp;BlockEnv,
     parent_hash: B256,
     total_difficulty: U256,
     full_transactions: bool,
<span class="term-fg31">-    db: &amp;CacheDB&lt;StateProviderDatabase&lt;StateProviderTraitObjWrapper&lt;&#39;_&gt;&gt;&gt;,</span>
<span class="term-fg32">+    #[cfg(feature = &quot;scroll&quot;)] db: &amp;CacheDB&lt;</span>
<span class="term-fg32">+        reth_scroll_storage::ScrollStateProviderDatabase&lt;StateProviderTraitObjWrapper&lt;&#39;_&gt;&gt;,</span>
<span class="term-fg32">+    &gt;,</span>
<span class="term-fg32">+    #[cfg(not(feature = &quot;scroll&quot;))] db: &amp;CacheDB&lt;</span>
<span class="term-fg32">+        reth_revm::database::StateProviderDatabase&lt;StateProviderTraitObjWrapper&lt;&#39;_&gt;&gt;,</span>
<span class="term-fg32">+    &gt;,</span>
     tx_resp_builder: &amp;T,
 ) -&gt; Result&lt;SimulatedBlock&lt;Block&lt;T::Transaction&gt;&gt;, T::Error&gt; {
     let mut calls: Vec&lt;SimCallResult&gt; = Vec::with_capacity(results.len());
<span class="term-fg36">@@ -232,7 +236,13 @@</span>
     let mut hashed_state = HashedPostState::default();
     for (address, account) in &amp;db.accounts {
         let hashed_address = keccak256(address);
<span class="term-fg31">-        hashed_state.accounts.insert(hashed_address, Some(account.info.clone().into()));</span>
<span class="term-fg32">+        #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+        let hashed_account =</span>
<span class="term-fg32">+            Into::&lt;revm::AccountInfo&gt;::into((account.info.clone(), &amp;db.db.post_execution_context))</span>
<span class="term-fg32">+                .into();</span>
<span class="term-fg32">+        #[cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+        let hashed_account = account.info.clone().into();</span>
<span class="term-fg32">+        hashed_state.accounts.insert(hashed_address, Some(hashed_account));</span>
&nbsp;
         let storage = hashed_state
             .storages</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-25e4ea68d1ab1c087285ce3e" role="button"
                       aria-expanded="false" aria-controls="id-25e4ea68d1ab1c087285ce3e">
                        <code>crates/rpc/rpc/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/rpc/rpc/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/rpc/rpc/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+15</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-25e4ea68d1ab1c087285ce3e"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc&#47;Cargo.toml scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">index 804ecd11120e685e7271e6332318f805a47776da..f79c30fac6428e8ead8797e2db7825328022a270 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;Cargo.toml</span>
<span class="term-fg36">@@ -64,6 +64,9 @@</span>     &quot;optional_no_base_fee&quot;,
 ] }
 revm-primitives = { workspace = true, features = [&quot;serde&quot;] }
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-storage = { workspace = true, optional = true }</span>
<span class="term-fg32">+</span>
 # rpc
 jsonrpsee.workspace = true
 http.workspace = true
<span class="term-fg36">@@ -102,3 +105,15 @@</span> jsonrpsee = { workspace = true, features = [&quot;client&quot;] }
&nbsp;
 [features]
 js-tracer = [&quot;revm-inspectors&#47;js-tracer&quot;, &quot;reth-rpc-eth-types&#47;js-tracer&quot;]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-trie&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc-eth-types&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-testing-utils&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-evm-ethereum&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-rpc-eth-api&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-scroll-storage&#47;scroll&quot;,</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0ce74af424a1370ce677265f" role="button"
                       aria-expanded="false" aria-controls="id-0ce74af424a1370ce677265f">
                        <code>crates/rpc/rpc/src/debug.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/crates/rpc/rpc/src/debug.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/crates/rpc/rpc/src/debug.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0ce74af424a1370ce677265f"><span class="term-fg1">diff --git reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;debug.rs scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;debug.rs</span>
<span class="term-fg1">index dd6bf9bbc24e06becaf1f82584ba1b1a6e6d23a3..ca8c4493f1c5e3e9380547a7b33161227e17865b 100644</span>
<span class="term-fg1">--- reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;debug.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;crates&#47;rpc&#47;rpc&#47;src&#47;debug.rs</span>
<span class="term-fg36">@@ -608,7 +608,10 @@</span>             .ok_or(EthApiError::HeaderNotFound(block_id.into()))?;
&nbsp;
         self.eth_api()
             .spawn_with_state_at_block(block.parent_hash.into(), move |state_provider| {
<span class="term-fg32">+                #[cfg(not(feature = &quot;scroll&quot;))]</span>
                 let db = StateProviderDatabase::new(&amp;state_provider);
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                let db = reth_scroll_storage::ScrollStateProviderDatabase::new(&amp;state_provider);</span>
                 let block_executor = this.inner.block_executor.executor(db);
&nbsp;
                 let mut witness_record = ExecutionWitnessRecord::default();
<span class="term-fg36">@@ -617,7 +620,11 @@</span>                 let _ = block_executor
                     .execute_with_state_closure(
                         (&amp;(*block).clone().unseal(), block.difficulty).into(),
                         |statedb: &amp;State&lt;_&gt;| {
<span class="term-fg31">-                            witness_record.record_executed_state(statedb);</span>
<span class="term-fg32">+                            witness_record.record_executed_state(</span>
<span class="term-fg32">+                                statedb,</span>
<span class="term-fg32">+                                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                                &amp;statedb.database.post_execution_context,</span>
<span class="term-fg32">+                            );</span>
                         },
                     )
                     .map_err(|err| EthApiError::Internal(err.into()))?;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b71e398226af0974cca135be" role="button"
                       aria-expanded="false" aria-controls="id-b71e398226af0974cca135be">
                        <code>deny.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/deny.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/deny.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b71e398226af0974cca135be"><span class="term-fg1">diff --git reth&#47;deny.toml scroll-reth&#47;deny.toml</span>
<span class="term-fg1">index 8d0807f9de5c63618c5ca26f05ae75a198d95715..6dc51dba0a93737b29ee37c6d76549120dd504d3 100644</span>
<span class="term-fg1">--- reth&#47;deny.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;deny.toml</span>
<span class="term-fg36">@@ -67,6 +67,11 @@</span>     { allow = [&quot;MPL-2.0&quot;], name = &quot;option-ext&quot; },
     { allow = [&quot;MPL-2.0&quot;], name = &quot;webpki-roots&quot; },
 ]
&nbsp;
<span class="term-fg32">+# Skip the poseidon-bn254 and bn254 crates for license verification. We should at some point publish a license for them.</span>
<span class="term-fg32">+[licenses.private]</span>
<span class="term-fg32">+ignore = true</span>
<span class="term-fg32">+ignore-sources = [&quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254&quot;, &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254&quot;]</span>
<span class="term-fg32">+</span>
 [[licenses.clarify]]
 name = &quot;ring&quot;
 expression = &quot;LicenseRef-ring&quot;
<span class="term-fg36">@@ -93,4 +98,7 @@</span>     &quot;https:&#47;&#47;github.com&#47;alloy-rs&#47;alloy&quot;,
     &quot;https:&#47;&#47;github.com&#47;foundry-rs&#47;block-explorers&quot;,
     &quot;https:&#47;&#47;github.com&#47;bluealloy&#47;revm&quot;,
     &quot;https:&#47;&#47;github.com&#47;paradigmxyz&#47;revm-inspectors&quot;,
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;bn254&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;sp1-intrinsics&quot;,</span>
<span class="term-fg32">+    &quot;https:&#47;&#47;github.com&#47;scroll-tech&#47;poseidon-bn254&quot;</span>
 ]</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-28b6024a914593e560df619c" role="button"
                       aria-expanded="false" aria-controls="id-28b6024a914593e560df619c">
                        <code>examples/beacon-api-sidecar-fetcher/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/beacon-api-sidecar-fetcher/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/beacon-api-sidecar-fetcher/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-28b6024a914593e560df619c"><span class="term-fg1">diff --git reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;Cargo.toml scroll-reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;Cargo.toml</span>
<span class="term-fg1">index d9590f87e07a3d38ead9152d257034000f9e4e47..d30ce6b0824442bcb0359a9d9c63aa20aad54a85 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;Cargo.toml</span>
<span class="term-fg36">@@ -20,3 +20,6 @@</span> reqwest.workspace = true
 serde_json.workspace = true
 serde.workspace = true
 thiserror.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5fbeeec2c278368600097ddf" role="button"
                       aria-expanded="false" aria-controls="id-5fbeeec2c278368600097ddf">
                        <code>examples/beacon-api-sidecar-fetcher/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/beacon-api-sidecar-fetcher/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/beacon-api-sidecar-fetcher/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5fbeeec2c278368600097ddf"><span class="term-fg1">diff --git reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;src&#47;main.rs scroll-reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;src&#47;main.rs</span>
<span class="term-fg1">index a0b9b6e01ec8cf05e6b519649d2c40ad74aedfb0..473d986604d4561f7d7fa0651fcc82aec520284f 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;beacon-api-sidecar-fetcher&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -12,6 +12,9 @@</span> &#47;&#47;!
 &#47;&#47;! See beacon Node API: &lt;https:&#47;&#47;ethereum.github.io&#47;beacon-APIs&#47;&gt;
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use std::{
     collections::VecDeque,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-88db0c792f0da544a99b3d1c" role="button"
                       aria-expanded="false" aria-controls="id-88db0c792f0da544a99b3d1c">
                        <code>examples/beacon-api-sse/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/beacon-api-sse/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/beacon-api-sse/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-88db0c792f0da544a99b3d1c"><span class="term-fg1">diff --git reth&#47;examples&#47;beacon-api-sse&#47;Cargo.toml scroll-reth&#47;examples&#47;beacon-api-sse&#47;Cargo.toml</span>
<span class="term-fg1">index ca49897c9ee067662d047d867e75e69cc6729683..6b759aa355501bee900b923c10edfc81f3b5a498 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;beacon-api-sse&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;beacon-api-sse&#47;Cargo.toml</span>
<span class="term-fg36">@@ -16,3 +16,6 @@</span> futures-util.workspace = true
 mev-share-sse = { version = &quot;0.4.0&quot;, default-features = false }
 tokio = { workspace = true, features = [&quot;time&quot;] }
 tracing.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4bba17b60d01b7e242f135f2" role="button"
                       aria-expanded="false" aria-controls="id-4bba17b60d01b7e242f135f2">
                        <code>examples/beacon-api-sse/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/beacon-api-sse/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/beacon-api-sse/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4bba17b60d01b7e242f135f2"><span class="term-fg1">diff --git reth&#47;examples&#47;beacon-api-sse&#47;src&#47;main.rs scroll-reth&#47;examples&#47;beacon-api-sse&#47;src&#47;main.rs</span>
<span class="term-fg1">index 243511d4960ee06f84d00cb62001886668eb9209..00af7b39f8189bd627380c7e013aa6804dc39149 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;beacon-api-sse&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;beacon-api-sse&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -16,6 +16,9 @@</span> &#47;&#47;!
 &#47;&#47;! See lighthouse beacon Node API: &lt;https:&#47;&#47;lighthouse-book.sigmaprime.io&#47;api-bn.html#beacon-node-api&gt;
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_rpc_types_beacon::events::PayloadAttributesEvent;
 use clap::Parser;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cc05dde8175c53c9613ccffa" role="button"
                       aria-expanded="false" aria-controls="id-cc05dde8175c53c9613ccffa">
                        <code>examples/custom-beacon-withdrawals/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-beacon-withdrawals/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-beacon-withdrawals/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cc05dde8175c53c9613ccffa"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-beacon-withdrawals&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-beacon-withdrawals&#47;Cargo.toml</span>
<span class="term-fg1">index c396ca11df8bd03b44535914a3dbe1643b4e67d3..b4a2e62e7b0e0629d16f75b0099914e3541fccc4 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-beacon-withdrawals&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-beacon-withdrawals&#47;Cargo.toml</span>
<span class="term-fg36">@@ -13,6 +13,9 @@</span> reth-chainspec.workspace = true
 reth-evm.workspace = true
 reth-primitives.workspace = true
&nbsp;
<span class="term-fg32">+# scroll</span>
<span class="term-fg32">+reth-scroll-execution.workspace = true</span>
<span class="term-fg32">+</span>
 alloy-sol-macro = &quot;0.8.9&quot;
 alloy-sol-types.workspace = true
 alloy-eips.workspace = true
<span class="term-fg36">@@ -23,4 +26,5 @@</span>
 [features]
 optimism = [
   &quot;reth-primitives&#47;optimism&quot;
<span class="term-fg31">-]</span>
<span class="term-fg31">\ No newline at end of file</span>
<span class="term-fg32">+]</span>
<span class="term-fg32">+scroll = []</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fab438eda9c6d0e04e57ac91" role="button"
                       aria-expanded="false" aria-controls="id-fab438eda9c6d0e04e57ac91">
                        <code>examples/custom-beacon-withdrawals/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-beacon-withdrawals/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-beacon-withdrawals/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fab438eda9c6d0e04e57ac91"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-beacon-withdrawals&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-beacon-withdrawals&#47;src&#47;main.rs</span>
<span class="term-fg1">index 47adc64c00486a6e81c2b6a2206cf6bdb5daf7e3..3b23010243798e39f1a612ddd989d2e4654cbeca 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-beacon-withdrawals&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-beacon-withdrawals&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -2,6 +2,9 @@</span> &#47;&#47;! Example for how to modify a block post-execution step. It credits beacon withdrawals with a
 &#47;&#47;! custom mechanism instead of minting native tokens
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_eips::{eip4895::Withdrawal, eip7685::Requests};
 use alloy_sol_macro::sol;
<span class="term-fg36">@@ -19,6 +22,7 @@</span>         primitives::{
             address, Address, BlockEnv, Bytes, CfgEnvWithHandlerCfg, Env, EnvWithHandlerCfg,
             TransactTo, TxEnv, U256,
         },
<span class="term-fg32">+        shared::BundleState,</span>
         Database, DatabaseCommit, Evm, State,
     },
 };
<span class="term-fg36">@@ -30,6 +34,7 @@</span> };
 use reth_evm_ethereum::EthEvmConfig;
 use reth_node_ethereum::{node::EthereumAddOns, BasicBlockExecutorProvider, EthereumNode};
 use reth_primitives::{BlockWithSenders, Receipt};
<span class="term-fg32">+use reth_scroll_execution::FinalizeExecution;</span>
 use std::{fmt::Display, sync::Arc};
&nbsp;
 pub const SYSTEM_ADDRESS: Address = address!(&quot;fffffffffffffffffffffffffffffffffffffffe&quot;);
<span class="term-fg36">@@ -91,11 +96,15 @@</span>     evm_config: EthEvmConfig,
 }
&nbsp;
 impl BlockExecutionStrategyFactory for CustomExecutorStrategyFactory {
<span class="term-fg31">-    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt; = CustomExecutorStrategy&lt;DB&gt;;</span>
<span class="term-fg32">+    type Strategy&lt;DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;&gt;</span>
<span class="term-fg32">+        = CustomExecutorStrategy&lt;DB&gt;</span>
<span class="term-fg32">+    where</span>
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;;</span>
&nbsp;
     fn create_strategy&lt;DB&gt;(&amp;self, db: DB) -&gt; Self::Strategy&lt;DB&gt;
     where
         DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+        State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
     {
         let state =
             State::builder().with_database(db).with_bundle_update().without_state_clear().build();
<span class="term-fg36">@@ -144,6 +153,7 @@</span>
 impl&lt;DB&gt; BlockExecutionStrategy&lt;DB&gt; for CustomExecutorStrategy&lt;DB&gt;
 where
     DB: Database&lt;Error: Into&lt;ProviderError&gt; + Display&gt;,
<span class="term-fg32">+    State&lt;DB&gt;: FinalizeExecution&lt;Output = BundleState&gt;,</span>
 {
     type Error = BlockExecutionError;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-695f902c8135a9b084173511" role="button"
                       aria-expanded="false" aria-controls="id-695f902c8135a9b084173511">
                        <code>examples/custom-dev-node/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-dev-node/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-dev-node/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-695f902c8135a9b084173511"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-dev-node&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-dev-node&#47;Cargo.toml</span>
<span class="term-fg1">index 8ed277686f4e53ac30d54cd8ffe6d943b67854ad..f101b22adbc3bbb863a15db612d368f89e555d8f 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-dev-node&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-dev-node&#47;Cargo.toml</span>
<span class="term-fg36">@@ -19,3 +19,6 @@</span> serde_json.workspace = true
&nbsp;
 alloy-genesis.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-207b601143ea4acefd4822cd" role="button"
                       aria-expanded="false" aria-controls="id-207b601143ea4acefd4822cd">
                        <code>examples/custom-dev-node/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-dev-node/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-dev-node/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-207b601143ea4acefd4822cd"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-dev-node&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-dev-node&#47;src&#47;main.rs</span>
<span class="term-fg1">index 7fa44418c523e0c13d52976d71a6b4c42480221a..f6cabf47a74426329d4afb3db24f17762de3d272 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-dev-node&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-dev-node&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -2,6 +2,9 @@</span> &#47;&#47;! This example shows how to run a custom dev node programmatically and submit a transaction
 &#47;&#47;! through rpc.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use std::sync::Arc;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3589121169dd714ba82aee23" role="button"
                       aria-expanded="false" aria-controls="id-3589121169dd714ba82aee23">
                        <code>examples/custom-engine-types/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-engine-types/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-engine-types/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3589121169dd714ba82aee23"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-engine-types&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-engine-types&#47;Cargo.toml</span>
<span class="term-fg1">index d6642a8edfe5e9dbef84c58672b4e326b7a4f707..68a72f676c1dd4606920c16c3402bb4f71b7b34e 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-engine-types&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-engine-types&#47;Cargo.toml</span>
<span class="term-fg36">@@ -25,3 +25,6 @@</span> eyre.workspace = true
 tokio.workspace = true
 thiserror.workspace = true
 serde.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-846d10ca8e82c1efe2674a0d" role="button"
                       aria-expanded="false" aria-controls="id-846d10ca8e82c1efe2674a0d">
                        <code>examples/custom-engine-types/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-engine-types/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-engine-types/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-846d10ca8e82c1efe2674a0d"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-engine-types&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-engine-types&#47;src&#47;main.rs</span>
<span class="term-fg1">index c21e893e05aa358ca6d01af0d7d250cb5bd9c95f..16a096305a513ae1cbd7614f4f322c8802886095 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-engine-types&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-engine-types&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,21 +1,24 @@</span>
<span class="term-fg31">-&#47;&#47;! This example shows how to implement a custom [EngineTypes].</span>
<span class="term-fg32">+&#47;&#47;! This example shows how to implement a custom `EngineTypes`.</span>
 &#47;&#47;!
<span class="term-fg31">-&#47;&#47;! The [EngineTypes] trait can be implemented to configure the engine to work with custom types,</span>
<span class="term-fg32">+&#47;&#47;! The `EngineTypes` trait can be implemented to configure the engine to work with custom types,</span>
 &#47;&#47;! as long as those types implement certain traits.
 &#47;&#47;!
 &#47;&#47;! Custom payload attributes can be supported by implementing two main traits:
 &#47;&#47;!
<span class="term-fg31">-&#47;&#47;! [PayloadAttributes] can be implemented for payload attributes types that are used as</span>
<span class="term-fg32">+&#47;&#47;! `PayloadAttributes` can be implemented for payload attributes types that are used as</span>
 &#47;&#47;! arguments to the `engine_forkchoiceUpdated` method. This type should be used to define and
 &#47;&#47;! _spawn_ payload jobs.
 &#47;&#47;!
<span class="term-fg31">-&#47;&#47;! [PayloadBuilderAttributes] can be implemented for payload attributes types that _describe_</span>
<span class="term-fg32">+&#47;&#47;! `PayloadBuilderAttributes` can be implemented for payload attributes types that _describe_</span>
 &#47;&#47;! running payload jobs.
 &#47;&#47;!
<span class="term-fg31">-&#47;&#47;! Once traits are implemented and custom types are defined, the [EngineTypes] trait can be</span>
<span class="term-fg32">+&#47;&#47;! Once traits are implemented and custom types are defined, the `EngineTypes` trait can be</span>
 &#47;&#47;! implemented:
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use std::{convert::Infallible, sync::Arc};
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d5a492a53b79334d3be0ea5c" role="button"
                       aria-expanded="false" aria-controls="id-d5a492a53b79334d3be0ea5c">
                        <code>examples/custom-evm/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-evm/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-evm/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d5a492a53b79334d3be0ea5c"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-evm&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-evm&#47;Cargo.toml</span>
<span class="term-fg1">index e763a932eabfbc7d39d2d22560ab915491444406..a807fe3aa9b7474ac3316e4f427ca1530745132c 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-evm&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-evm&#47;Cargo.toml</span>
<span class="term-fg36">@@ -20,3 +20,6 @@</span> alloy-consensus.workspace = true
&nbsp;
 eyre.workspace = true
 tokio.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5b7b9e561765a9c3d9e7e443" role="button"
                       aria-expanded="false" aria-controls="id-5b7b9e561765a9c3d9e7e443">
                        <code>examples/custom-evm/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-evm/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-evm/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5b7b9e561765a9c3d9e7e443"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-evm&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-evm&#47;src&#47;main.rs</span>
<span class="term-fg1">index 7a5278061f236595a6b507509e4d2f4948f441d8..5eeb3ddea0062f1eb10b543e325ab8ec6c39e269 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-evm&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-evm&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 &#47;&#47;! This example shows how to implement a node with a custom EVM
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_consensus::Header;
 use alloy_genesis::Genesis;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5689b9849c4c6ea005b72c76" role="button"
                       aria-expanded="false" aria-controls="id-5689b9849c4c6ea005b72c76">
                        <code>examples/custom-inspector/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-inspector/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-inspector/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5689b9849c4c6ea005b72c76"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-inspector&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-inspector&#47;Cargo.toml</span>
<span class="term-fg1">index ee6f887e64c0db02e2e2be7000c1c5f27bc128c2..3566eb3557111c6e89491573d824bdc613f693e8 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-inspector&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-inspector&#47;Cargo.toml</span>
<span class="term-fg36">@@ -12,4 +12,8 @@</span> alloy-rpc-types-eth.workspace = true
 clap = { workspace = true, features = [&quot;derive&quot;] }
 futures-util.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg32">+</span>
 alloy-eips.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-640c063c75eea9e2fd8e11b7" role="button"
                       aria-expanded="false" aria-controls="id-640c063c75eea9e2fd8e11b7">
                        <code>examples/custom-inspector/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-inspector/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-inspector/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-640c063c75eea9e2fd8e11b7"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-inspector&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-inspector&#47;src&#47;main.rs</span>
<span class="term-fg1">index 67863d00e1e92124ba22aa229ef874a706bda8fc..dccc30eaecd3bdf9efb67eb67f945dd189622c73 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-inspector&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-inspector&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -9,6 +9,9 @@</span> &#47;&#47;!
 &#47;&#47;! If no recipients are specified, all transactions will be inspected.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_eips::BlockNumberOrTag;
 use alloy_primitives::Address;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4632296ebcd3b47852633dd2" role="button"
                       aria-expanded="false" aria-controls="id-4632296ebcd3b47852633dd2">
                        <code>examples/custom-node-components/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-node-components/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-node-components/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4632296ebcd3b47852633dd2"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-node-components&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-node-components&#47;Cargo.toml</span>
<span class="term-fg1">index 507088970de863d51821329b0e56d5e51c1a8d98..43940db3e3c4e4f8ad9f1fb9ef27a4267917c462 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-node-components&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-node-components&#47;Cargo.toml</span>
<span class="term-fg36">@@ -13,3 +13,6 @@</span> reth-transaction-pool.workspace = true
 reth-tracing.workspace = true
&nbsp;
 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ab561775bb0e7562d4060c0d" role="button"
                       aria-expanded="false" aria-controls="id-ab561775bb0e7562d4060c0d">
                        <code>examples/custom-node-components/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-node-components/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-node-components/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ab561775bb0e7562d4060c0d"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-node-components&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-node-components&#47;src&#47;main.rs</span>
<span class="term-fg1">index d00b8a70224af74b94f06530bf8dfdc12740dbbd..7bdcc00f0415720270fa0077c74c43f98f039ed3 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-node-components&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-node-components&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 &#47;&#47;! This example shows how to configure custom components for a reth node.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use reth::{
     api::NodeTypes,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-df221409a4e5bc7b354c1bf5" role="button"
                       aria-expanded="false" aria-controls="id-df221409a4e5bc7b354c1bf5">
                        <code>examples/custom-payload-builder/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-payload-builder/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-payload-builder/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-df221409a4e5bc7b354c1bf5"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-payload-builder&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-payload-builder&#47;Cargo.toml</span>
<span class="term-fg1">index b77a3f2945ca54fd8052fc2b9e06b7c5e88fa575..b60c87803c9423a28acaded02c72e9d094270191 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-payload-builder&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-payload-builder&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,3 +21,6 @@</span>
 tracing.workspace = true
 futures-util.workspace = true
 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5cbdfbda80617329c03dc40a" role="button"
                       aria-expanded="false" aria-controls="id-5cbdfbda80617329c03dc40a">
                        <code>examples/custom-payload-builder/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-payload-builder/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-payload-builder/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5cbdfbda80617329c03dc40a"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-payload-builder&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-payload-builder&#47;src&#47;main.rs</span>
<span class="term-fg1">index e46b969adaa1497b46896ebf74f4b729912eab8d..54026655fe762d2be26fa0d02ca5d31326572d28 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-payload-builder&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-payload-builder&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -10,6 +10,9 @@</span> &#47;&#47;!
 &#47;&#47;! This launch the regular reth node overriding the engine api payload builder with our custom.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use generator::EmptyBlockPayloadJobGenerator;
 use reth::{</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ed3183fa04df0b31c40053bc" role="button"
                       aria-expanded="false" aria-controls="id-ed3183fa04df0b31c40053bc">
                        <code>examples/custom-rlpx-subprotocol/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-rlpx-subprotocol/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-rlpx-subprotocol/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ed3183fa04df0b31c40053bc"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-rlpx-subprotocol&#47;Cargo.toml scroll-reth&#47;examples&#47;custom-rlpx-subprotocol&#47;Cargo.toml</span>
<span class="term-fg1">index 18c136671c06718e581b7cbcd978f69e38fb967f..5fd30de7fafacef5bad46146333f8da529d52dc1 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-rlpx-subprotocol&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-rlpx-subprotocol&#47;Cargo.toml</span>
<span class="term-fg36">@@ -19,3 +19,6 @@</span> eyre.workspace = true
 rand.workspace = true
 tracing.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d8f2683bf10163bbd9705f86" role="button"
                       aria-expanded="false" aria-controls="id-d8f2683bf10163bbd9705f86">
                        <code>examples/custom-rlpx-subprotocol/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/custom-rlpx-subprotocol/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/custom-rlpx-subprotocol/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d8f2683bf10163bbd9705f86"><span class="term-fg1">diff --git reth&#47;examples&#47;custom-rlpx-subprotocol&#47;src&#47;main.rs scroll-reth&#47;examples&#47;custom-rlpx-subprotocol&#47;src&#47;main.rs</span>
<span class="term-fg1">index 702d0e8cf5effe913b768b8832eb1959c0b50ce0..84a4f42645c597af71cb6abdd011a9b835dab8f8 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;custom-rlpx-subprotocol&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;custom-rlpx-subprotocol&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -8,6 +8,10 @@</span> &#47;&#47;! ```
 &#47;&#47;!
 &#47;&#47;! This launch a regular reth node with a custom rlpx subprotocol.
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 mod subprotocol;
&nbsp;
 use std::net::{Ipv4Addr, SocketAddr, SocketAddrV4};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3cd96b8c740dcb239d8910fb" role="button"
                       aria-expanded="false" aria-controls="id-3cd96b8c740dcb239d8910fb">
                        <code>examples/db-access/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/db-access/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/db-access/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3cd96b8c740dcb239d8910fb"><span class="term-fg1">diff --git reth&#47;examples&#47;db-access&#47;Cargo.toml scroll-reth&#47;examples&#47;db-access&#47;Cargo.toml</span>
<span class="term-fg1">index 3310d1cbd67646daa3771a2727a0bd68df1d441c..1d468700dba2dddc09c0014c7343412f3ef2b4bf 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;db-access&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;db-access&#47;Cargo.toml</span>
<span class="term-fg36">@@ -19,3 +19,6 @@</span> alloy-primitives.workspace = true
&nbsp;

 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-39cbb22963df65dbf4f45785" role="button"
                       aria-expanded="false" aria-controls="id-39cbb22963df65dbf4f45785">
                        <code>examples/db-access/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/db-access/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/db-access/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-39cbb22963df65dbf4f45785"><span class="term-fg1">diff --git reth&#47;examples&#47;db-access&#47;src&#47;main.rs scroll-reth&#47;examples&#47;db-access&#47;src&#47;main.rs</span>
<span class="term-fg1">index 179d12160535d2a7309777c3f9f617d1c46bf1aa..988e75b60de7f05e13b4217580d0c9d1e39a4fb8 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;db-access&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;db-access&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,3 +1,7 @@</span>
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use alloy_primitives::{Address, B256};
 use alloy_rpc_types_eth::{Filter, FilteredParams};
 use reth_chainspec::ChainSpecBuilder;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bd815c42d25f18613dae81fa" role="button"
                       aria-expanded="false" aria-controls="id-bd815c42d25f18613dae81fa">
                        <code>examples/node-custom-rpc/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/node-custom-rpc/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/node-custom-rpc/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bd815c42d25f18613dae81fa"><span class="term-fg1">diff --git reth&#47;examples&#47;node-custom-rpc&#47;Cargo.toml scroll-reth&#47;examples&#47;node-custom-rpc&#47;Cargo.toml</span>
<span class="term-fg1">index e82254757ec1d34e2532256bf2a64a90955aa255..13aa5872fccf272e7f1049050cb4adfb09e4e7ac 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;node-custom-rpc&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;node-custom-rpc&#47;Cargo.toml</span>
<span class="term-fg36">@@ -15,3 +15,6 @@</span> jsonrpsee = { workspace = true, features = [&quot;server&quot;, &quot;macros&quot;] }
&nbsp;
 [dev-dependencies]
 tokio.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ee4e8cb2d9e29038dc48c7b4" role="button"
                       aria-expanded="false" aria-controls="id-ee4e8cb2d9e29038dc48c7b4">
                        <code>examples/node-custom-rpc/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/node-custom-rpc/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/node-custom-rpc/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ee4e8cb2d9e29038dc48c7b4"><span class="term-fg1">diff --git reth&#47;examples&#47;node-custom-rpc&#47;src&#47;main.rs scroll-reth&#47;examples&#47;node-custom-rpc&#47;src&#47;main.rs</span>
<span class="term-fg1">index 92e0bfea26e9b94af0c8ed2f48191377034024ee..889924b5e8d96b8277984cbdb9cc71ae6e5e499e 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;node-custom-rpc&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;node-custom-rpc&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -12,6 +12,10 @@</span> &#47;&#47;! ```sh
 &#47;&#47;! cast rpc txpoolExt_transactionCount
 &#47;&#47;! ```
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use clap::Parser;
 use jsonrpsee::{core::RpcResult, proc_macros::rpc};
 use reth::{chainspec::EthereumChainSpecParser, cli::Cli};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8ef21dc0711f44b705270da2" role="button"
                       aria-expanded="false" aria-controls="id-8ef21dc0711f44b705270da2">
                        <code>examples/node-event-hooks/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/node-event-hooks/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/node-event-hooks/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8ef21dc0711f44b705270da2"><span class="term-fg1">diff --git reth&#47;examples&#47;node-event-hooks&#47;Cargo.toml scroll-reth&#47;examples&#47;node-event-hooks&#47;Cargo.toml</span>
<span class="term-fg1">index 450f6f006b287fc58fb01e1ddd98df239161c8e0..2e01b99a8893b79b598c35fac9ab7c533369a75c 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;node-event-hooks&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;node-event-hooks&#47;Cargo.toml</span>
<span class="term-fg36">@@ -8,3 +8,6 @@</span>
 [dependencies]
 reth.workspace = true
 reth-node-ethereum.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-061c5277681f63a7a4e6214e" role="button"
                       aria-expanded="false" aria-controls="id-061c5277681f63a7a4e6214e">
                        <code>examples/node-event-hooks/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/node-event-hooks/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/node-event-hooks/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-061c5277681f63a7a4e6214e"><span class="term-fg1">diff --git reth&#47;examples&#47;node-event-hooks&#47;src&#47;main.rs scroll-reth&#47;examples&#47;node-event-hooks&#47;src&#47;main.rs</span>
<span class="term-fg1">index e8a751840e0dab68d2c04d7e4599c973562a6229..a3dc823ccc0730d02f298f98bcd768e0cc706744 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;node-event-hooks&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;node-event-hooks&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -11,6 +11,10 @@</span> &#47;&#47;! This launch the regular reth node and also print:
 &#47;&#47;! &gt; &quot;All components initialized&quot; – once all components have been initialized
 &#47;&#47;! &gt; &quot;Node started&quot; – once the node has been started.
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use reth::cli::Cli;
 use reth_node_ethereum::EthereumNode;
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2233b652a771737063d9d494" role="button"
                       aria-expanded="false" aria-controls="id-2233b652a771737063d9d494">
                        <code>examples/rpc-db/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/rpc-db/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/rpc-db/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2233b652a771737063d9d494"><span class="term-fg1">diff --git reth&#47;examples&#47;rpc-db&#47;Cargo.toml scroll-reth&#47;examples&#47;rpc-db&#47;Cargo.toml</span>
<span class="term-fg1">index 262b3df8babc91f322e4482d81401e97c5f21ebd..cce1b763d7fa762901f263733d8edcb045ffbcba 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;rpc-db&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;rpc-db&#47;Cargo.toml</span>
<span class="term-fg36">@@ -15,3 +15,6 @@</span> reth-node-ethereum.workspace = true
 reth-provider = { workspace = true, features = [&quot;test-utils&quot;] }
 tokio = { workspace = true, features = [&quot;full&quot;] }
 eyre.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d7e1d3953ec66c4d056b4f29" role="button"
                       aria-expanded="false" aria-controls="id-d7e1d3953ec66c4d056b4f29">
                        <code>examples/rpc-db/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/rpc-db/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/rpc-db/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d7e1d3953ec66c4d056b4f29"><span class="term-fg1">diff --git reth&#47;examples&#47;rpc-db&#47;src&#47;main.rs scroll-reth&#47;examples&#47;rpc-db&#47;src&#47;main.rs</span>
<span class="term-fg1">index 92ae86f00bb9b3464cfabb373660997b535f241b..99d152a7d0e157e1608792c3cf347bc123a5416b 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;rpc-db&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;rpc-db&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -12,6 +12,10 @@</span> &#47;&#47;! ```sh
 &#47;&#47;! cast rpc myrpcExt_customMethod
 &#47;&#47;! ```
&nbsp;
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
<span class="term-fg32">+</span>
 use std::{path::Path, sync::Arc};
&nbsp;
 use reth::{</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-afb46fae597f173add38c1c9" role="button"
                       aria-expanded="false" aria-controls="id-afb46fae597f173add38c1c9">
                        <code>examples/stateful-precompile/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/stateful-precompile/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/stateful-precompile/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-afb46fae597f173add38c1c9"><span class="term-fg1">diff --git reth&#47;examples&#47;stateful-precompile&#47;Cargo.toml scroll-reth&#47;examples&#47;stateful-precompile&#47;Cargo.toml</span>
<span class="term-fg1">index 478886d061f812d73f036c2f1c2b332097e5752b..7488cc497beed70400a84d8df6f6830395eebdec 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;stateful-precompile&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;stateful-precompile&#47;Cargo.toml</span>
<span class="term-fg36">@@ -21,3 +21,6 @@</span> eyre.workspace = true
 parking_lot.workspace = true
 schnellru.workspace = true
 tokio.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-45e76dcf0b1bb77da41d7efe" role="button"
                       aria-expanded="false" aria-controls="id-45e76dcf0b1bb77da41d7efe">
                        <code>examples/stateful-precompile/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/stateful-precompile/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/stateful-precompile/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-45e76dcf0b1bb77da41d7efe"><span class="term-fg1">diff --git reth&#47;examples&#47;stateful-precompile&#47;src&#47;main.rs scroll-reth&#47;examples&#47;stateful-precompile&#47;src&#47;main.rs</span>
<span class="term-fg1">index f683af4e430a39189328f7cd498860ab6fe2873e..718779cab8290d3ac351dd87a11c7955d25340ca 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;stateful-precompile&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;stateful-precompile&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -1,6 +1,9 @@</span>
 &#47;&#47;! This example shows how to implement a node with a custom EVM that uses a stateful precompile
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_consensus::Header;
 use alloy_genesis::Genesis;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dc585ec8a37aaafe7c76fb9a" role="button"
                       aria-expanded="false" aria-controls="id-dc585ec8a37aaafe7c76fb9a">
                        <code>examples/txpool-tracing/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/txpool-tracing/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/txpool-tracing/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dc585ec8a37aaafe7c76fb9a"><span class="term-fg1">diff --git reth&#47;examples&#47;txpool-tracing&#47;Cargo.toml scroll-reth&#47;examples&#47;txpool-tracing&#47;Cargo.toml</span>
<span class="term-fg1">index 38d0ad9409b6b5921f70922dbf7190b7123f3d53..67e45929a4d4fd2b2270674a344cc01581c50108 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;txpool-tracing&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;txpool-tracing&#47;Cargo.toml</span>
<span class="term-fg36">@@ -12,3 +12,6 @@</span> alloy-rpc-types-trace.workspace = true
 clap = { workspace = true, features = [&quot;derive&quot;] }
 futures-util.workspace = true
 alloy-primitives.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = []</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3863682d802e8e81df117bee" role="button"
                       aria-expanded="false" aria-controls="id-3863682d802e8e81df117bee">
                        <code>examples/txpool-tracing/src/main.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/examples/txpool-tracing/src/main.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/examples/txpool-tracing/src/main.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3863682d802e8e81df117bee"><span class="term-fg1">diff --git reth&#47;examples&#47;txpool-tracing&#47;src&#47;main.rs scroll-reth&#47;examples&#47;txpool-tracing&#47;src&#47;main.rs</span>
<span class="term-fg1">index 94f800987a967537325be98e7889b87f12214885..415fd46fad79accc51b2a898421692a372bfd46f 100644</span>
<span class="term-fg1">--- reth&#47;examples&#47;txpool-tracing&#47;src&#47;main.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;examples&#47;txpool-tracing&#47;src&#47;main.rs</span>
<span class="term-fg36">@@ -9,6 +9,9 @@</span> &#47;&#47;!
 &#47;&#47;! If no recipients are specified, all transactions will be traced.
&nbsp;
 #![cfg_attr(not(test), warn(unused_crate_dependencies))]
<span class="term-fg32">+&#47;&#47; Don&#39;t use the crate if `scroll` feature is used.</span>
<span class="term-fg32">+#![cfg_attr(feature = &quot;scroll&quot;, allow(unused_crate_dependencies))]</span>
<span class="term-fg32">+#![cfg(not(feature = &quot;scroll&quot;))]</span>
&nbsp;
 use alloy_primitives::Address;
 use alloy_rpc_types_trace::{parity::TraceType, tracerequest::TraceCallRequest};</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cca722752693c1cbeaf768af" role="button"
                       aria-expanded="false" aria-controls="id-cca722752693c1cbeaf768af">
                        <code>testing/ef-tests/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/testing/ef-tests/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/testing/ef-tests/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cca722752693c1cbeaf768af"><span class="term-fg1">diff --git reth&#47;testing&#47;ef-tests&#47;Cargo.toml scroll-reth&#47;testing&#47;ef-tests&#47;Cargo.toml</span>
<span class="term-fg1">index 2fc0c7512441691ca58f9bd67b6d2cc4e7f00bbd..72d1fb90893f42fe2d214d5c12cac2cd9113b1c8 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;ef-tests&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;ef-tests&#47;Cargo.toml</span>
<span class="term-fg36">@@ -18,6 +18,14 @@</span>     &quot;reth-primitives&#47;asm-keccak&quot;,
     &quot;alloy-primitives&#47;asm-keccak&quot;,
     &quot;revm&#47;asm-keccak&quot;,
 ]
<span class="term-fg32">+scroll = [</span>
<span class="term-fg32">+    &quot;reth-scroll-primitives&quot;,</span>
<span class="term-fg32">+    &quot;reth-revm&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-primitives&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-provider&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-db&#47;scroll&quot;,</span>
<span class="term-fg32">+    &quot;reth-stages&#47;scroll&quot;</span>
<span class="term-fg32">+]</span>
&nbsp;
 [dependencies]
 reth-chainspec.workspace = true
<span class="term-fg36">@@ -34,6 +42,8 @@</span> reth-evm-ethereum.workspace = true
 reth-revm = { workspace = true, features = [&quot;std&quot;] }
&nbsp;
 revm = { workspace = true, features = [&quot;secp256k1&quot;, &quot;blst&quot;, &quot;c-kzg&quot;] }
<span class="term-fg32">+</span>
<span class="term-fg32">+reth-scroll-primitives = { workspace = true, optional = true }</span>
&nbsp;
 alloy-rlp.workspace = true
 alloy-primitives.workspace = true</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-439519476091e8aa1cb773c6" role="button"
                       aria-expanded="false" aria-controls="id-439519476091e8aa1cb773c6">
                        <code>testing/ef-tests/src/models.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/testing/ef-tests/src/models.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/testing/ef-tests/src/models.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-439519476091e8aa1cb773c6"><span class="term-fg1">diff --git reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs scroll-reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs</span>
<span class="term-fg1">index 292b32e8ce0f4393ac21fd7b8bb6cd29f077e7ae..3e3a25e45a1676951193cbfc47e75297a4d2ed66 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;ef-tests&#47;src&#47;models.rs</span>
<span class="term-fg36">@@ -162,6 +162,10 @@</span>             let reth_account = RethAccount {
                 balance: account.balance,
                 nonce: account.nonce.to::&lt;u64&gt;(),
                 bytecode_hash: code_hash,
<span class="term-fg32">+                #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+                account_extension: Some(reth_scroll_primitives::AccountExtension::from_bytecode(</span>
<span class="term-fg32">+                    &amp;account.code,</span>
<span class="term-fg32">+                )),</span>
             };
             tx.put::&lt;tables::PlainAccountState&gt;(address, reth_account)?;
             tx.put::&lt;tables::HashedAccounts&gt;(hashed_address, reth_account)?;</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a290935cb22420a6e6bc8a48" role="button"
                       aria-expanded="false" aria-controls="id-a290935cb22420a6e6bc8a48">
                        <code>testing/testing-utils/Cargo.toml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/testing/testing-utils/Cargo.toml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/testing/testing-utils/Cargo.toml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a290935cb22420a6e6bc8a48"><span class="term-fg1">diff --git reth&#47;testing&#47;testing-utils&#47;Cargo.toml scroll-reth&#47;testing&#47;testing-utils&#47;Cargo.toml</span>
<span class="term-fg1">index d0de37bf77f1a15f41be704f8d96f4125fa76736..f108fd9654e9124b5d2665d2720acc873a6fffbe 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;testing-utils&#47;Cargo.toml</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;testing-utils&#47;Cargo.toml</span>
<span class="term-fg36">@@ -24,3 +24,6 @@</span> secp256k1 = { workspace = true, features = [&quot;rand&quot;] }
&nbsp;
 [dev-dependencies]
 alloy-eips.workspace = true
<span class="term-fg32">+</span>
<span class="term-fg32">+[features]</span>
<span class="term-fg32">+scroll = [&quot;reth-primitives&#47;scroll&quot;]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8b65ea69871e72ff32e834d7" role="button"
                       aria-expanded="false" aria-controls="id-8b65ea69871e72ff32e834d7">
                        <code>testing/testing-utils/src/generators.rs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/testing/testing-utils/src/generators.rs" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/testing/testing-utils/src/generators.rs" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8b65ea69871e72ff32e834d7"><span class="term-fg1">diff --git reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs scroll-reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs</span>
<span class="term-fg1">index d8f3a29790bb0cf83155b3ff89b894d11097727b..8cf67915335392a7b98f3db8e9b812d573eab84e 100644</span>
<span class="term-fg1">--- reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs</span>
<span class="term-fg1">+++ scroll-reth&#47;testing&#47;testing-utils&#47;src&#47;generators.rs</span>
<span class="term-fg36">@@ -386,7 +386,16 @@</span>     let nonce: u64 = rng.gen();
     let balance = U256::from(rng.gen::&lt;u32&gt;());
     let addr = rng.gen();
&nbsp;
<span class="term-fg31">-    (addr, Account { nonce, balance, bytecode_hash: None })</span>
<span class="term-fg32">+    (</span>
<span class="term-fg32">+        addr,</span>
<span class="term-fg32">+        Account {</span>
<span class="term-fg32">+            nonce,</span>
<span class="term-fg32">+            balance,</span>
<span class="term-fg32">+            bytecode_hash: None,</span>
<span class="term-fg32">+            #[cfg(feature = &quot;scroll&quot;)]</span>
<span class="term-fg32">+            account_extension: Some(Default::default()),</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+    )</span>
 }
&nbsp;
 &#47;&#47;&#47; Generate random Externally Owned Accounts</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

                
                    <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-b75535910ca9565c2d80c456"role="button" aria-expanded="false" aria-controls="id-b75535910ca9565c2d80c456">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h4>Ignored changes</h4></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                
                    <div class="text-end"><span class="text-add-ignored">+112</span></div>
                    <div class="text-start"><span class="text-delete-ignored">-39</span></div>
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-b75535910ca9565c2d80c456">
        <div></div>
        <div>
            
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-290230be72f744f656f9b774" role="button"
                       aria-expanded="false" aria-controls="id-290230be72f744f656f9b774">
                        <code>.github/workflows/bench.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/bench.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/.github/workflows/bench.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+1</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-290230be72f744f656f9b774"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;bench.yml scroll-reth&#47;.github&#47;workflows&#47;bench.yml</span>
<span class="term-fg1">index 8ddc97441c2a843ca168ac54ddc180fda913838d..b647a81a2267eb91e49317db91a1cce2a1aa4465 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;bench.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;bench.yml</span>
<span class="term-fg36">@@ -18,8 +18,7 @@</span>
 name: bench
 jobs:
   iai:
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     # Only run benchmarks in merge groups and on main
     if: github.event_name != &#39;pull_request&#39;
     steps:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-cc1ea2e18655e40ff7a1a525" role="button"
                       aria-expanded="false" aria-controls="id-cc1ea2e18655e40ff7a1a525">
                        <code>.github/workflows/book.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/book.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/.github/workflows/book.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+2</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cc1ea2e18655e40ff7a1a525"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;book.yml scroll-reth&#47;.github&#47;workflows&#47;book.yml</span>
<span class="term-fg1">index 56d5c427466e0ef9eefe65daab422e86026b205d..d7f9fe34826e2b0010a0b15b496af508f58ab94c 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;book.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;book.yml</span>
<span class="term-fg36">@@ -4,9 +4,9 @@</span> name: book
&nbsp;
 on:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
   pull_request:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
   merge_group:
&nbsp;
 jobs:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-8b6ae385194407610659ad27" role="button"
                       aria-expanded="false" aria-controls="id-8b6ae385194407610659ad27">
                        <code>.github/workflows/compact.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/compact.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/.github/workflows/compact.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+4</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8b6ae385194407610659ad27"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;compact.yml scroll-reth&#47;.github&#47;workflows&#47;compact.yml</span>
<span class="term-fg1">index 484b27c820d003caff9b8abdf50e9ce2f9fe3155..44939e4b447c1d33a4d61671b3bce9244bee7417 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;compact.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;compact.yml</span>
<span class="term-fg36">@@ -10,7 +10,7 @@</span>
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -18,8 +18,7 @@</span>
 name: compact-codec
 jobs:
   compact-codec:
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     strategy:
       matrix:
         bin:
<span class="term-fg36">@@ -33,8 +32,8 @@</span>           cache-on-failure: true
       - name: Checkout base
         uses: actions&#47;checkout@v4
         with:
<span class="term-fg31">-          ref: ${{ github.base_ref || &#39;main&#39; }}</span>
<span class="term-fg31">-      # On `main` branch, generates test vectors and serializes them to disk using `Compact`.</span>
<span class="term-fg32">+          ref: ${{ github.base_ref || &#39;scroll&#39; }}</span>
<span class="term-fg32">+      # On `scroll` branch, generates test vectors and serializes them to disk using `Compact`.</span>
       - name: Generate compact vectors
         run: |
           ${{ matrix.bin }} -- test-vectors compact --write</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-21ce6e51067b565e6dae264e" role="button"
                       aria-expanded="false" aria-controls="id-21ce6e51067b565e6dae264e">
                        <code>.github/workflows/deny.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/deny.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/.github/workflows/deny.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+2</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-21ce6e51067b565e6dae264e"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;deny.yml scroll-reth&#47;.github&#47;workflows&#47;deny.yml</span>
<span class="term-fg1">index f85484ca2ec21833a6942fdea82eaf6d15d4ebc4..6908a3d5a56117cac1a581d25953fa4670ba45cd 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;deny.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;deny.yml</span>
<span class="term-fg36">@@ -4,10 +4,10 @@</span> name: deny
&nbsp;
 on:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
     paths: [Cargo.lock]
   pull_request:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
     paths: [Cargo.lock]
   merge_group:
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-8cebe75696831d1578126245" role="button"
                       aria-expanded="false" aria-controls="id-8cebe75696831d1578126245">
                        <code>.github/workflows/hive.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/hive.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/.github/workflows/hive.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+4</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-8</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8cebe75696831d1578126245"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;hive.yml scroll-reth&#47;.github&#47;workflows&#47;hive.yml</span>
<span class="term-fg1">index b8d3f378fca40be3a094856b6205b3139350ee4b..0d8ba91a00c53e7a5b01cb286343dca992ccee56 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;hive.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;hive.yml</span>
<span class="term-fg36">@@ -19,8 +19,7 @@</span> jobs:
   prepare-reth:
     if: github.repository == &#39;paradigmxyz&#47;reth&#39;
     timeout-minutes: 45
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     steps:
       - uses: actions&#47;checkout@v4
       - run: mkdir artifacts
<span class="term-fg36">@@ -53,8 +52,7 @@</span>
   prepare-hive:
     if: github.repository == &#39;paradigmxyz&#47;reth&#39;
     timeout-minutes: 45
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     steps:
       - uses: actions&#47;checkout@v4
       - name: Checkout hive tests
<span class="term-fg36">@@ -181,8 +179,7 @@</span>     needs:
       - prepare-reth
       - prepare-hive
     name: run ${{ matrix.scenario.sim }}${{ matrix.scenario.limit &amp;&amp; format(&#39; - {0}&#39;, matrix.scenario.limit) }}
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     permissions:
       issues: write
     steps:
<span class="term-fg36">@@ -249,8 +246,7 @@</span>           cat hivetests&#47;workspace&#47;logs&#47;reth&#47;client-*.log
   notify-on-error:
     needs: test
     if: failure()
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     steps:
       - name: Slack Webhook Action
         uses: rtCamp&#47;action-slack-notify@v2</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-e6a08540bbdb030e1968682a" role="button"
                       aria-expanded="false" aria-controls="id-e6a08540bbdb030e1968682a">
                        <code>.github/workflows/integration.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/integration.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/.github/workflows/integration.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+4</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e6a08540bbdb030e1968682a"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;integration.yml scroll-reth&#47;.github&#47;workflows&#47;integration.yml</span>
<span class="term-fg1">index 82bd5705a32001b5e309a55df19974211618ee6e..7ba3395cce84576d6b304c4945f751e1bdc24080 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;integration.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;integration.yml</span>
<span class="term-fg36">@@ -6,7 +6,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -19,8 +19,7 @@</span>
 jobs:
   test:
     name: test &#47; ${{ matrix.network }}
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_BACKTRACE: 1
     strategy:
<span class="term-fg36">@@ -28,6 +27,8 @@</span>       matrix:
         network: [&quot;ethereum&quot;, &quot;optimism&quot;]
     timeout-minutes: 60
     steps:
<span class="term-fg32">+      - name: Free up disk space</span>
<span class="term-fg32">+        run: rm -rf &#47;opt&#47;hostedtoolcache</span>
       - uses: actions&#47;checkout@v4
       - uses: dtolnay&#47;rust-toolchain@stable
       - name: Install Geth</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-9d63ed3f587d1c5fcaeeff29" role="button"
                       aria-expanded="false" aria-controls="id-9d63ed3f587d1c5fcaeeff29">
                        <code>.github/workflows/lint.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/lint.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/.github/workflows/lint.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+8</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9d63ed3f587d1c5fcaeeff29"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;lint.yml scroll-reth&#47;.github&#47;workflows&#47;lint.yml</span>
<span class="term-fg1">index 7e6b8747fff5971fdd71848d8051a2aa4c7b4bb2..384761ee5bf6bb878672bb97c7688fe458ba8d8e 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;lint.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;lint.yml</span>
<span class="term-fg36">@@ -4,7 +4,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -152,7 +152,13 @@</span>       - uses: Swatinem&#47;rust-cache@v2
         with:
           cache-on-failure: true
       - uses: taiki-e&#47;install-action@cargo-udeps
<span class="term-fg31">-      - run: cargo udeps --workspace --lib --examples --tests --benches --all-features --locked</span>
<span class="term-fg32">+        # due to the scroll feature flag, we need to exclude some crates that were annotated with</span>
<span class="term-fg32">+        # #![cfg(not(feature = &quot;scroll))].</span>
<span class="term-fg32">+      - run: |</span>
<span class="term-fg32">+          cargo udeps --workspace --lib --examples --tests --benches --all-features --locked \</span>
<span class="term-fg32">+            --exclude &quot;reth-optimism-*&quot; --exclude op-reth --exclude &quot;example-*&quot; --exclude reth \</span>
<span class="term-fg32">+            --exclude reth-e2e-test-utils --exclude reth-ethereum-payload-builder --exclude reth-exex-test-utils \</span>
<span class="term-fg32">+            --exclude reth-node-ethereum</span>
&nbsp;
   book:
     name: book</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-18b8f587ca381c75c4c3300c" role="button"
                       aria-expanded="false" aria-controls="id-18b8f587ca381c75c4c3300c">
                        <code>.github/workflows/pages.yaml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/.github/workflows/pages.yaml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+32</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-18b8f587ca381c75c4c3300c"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;pages.yaml scroll-reth&#47;.github&#47;workflows&#47;pages.yaml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5717d4c95543c09d59a7d51803826ead2641a5c5</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;pages.yaml</span>
<span class="term-fg36">@@ -0,0 +1,33 @@</span>
<span class="term-fg32">+name: Build and publish forkdiff github-pages</span>
<span class="term-fg32">+permissions:</span>
<span class="term-fg32">+  contents: write</span>
<span class="term-fg32">+on:</span>
<span class="term-fg32">+  push:</span>
<span class="term-fg32">+    branches:</span>
<span class="term-fg32">+      - scroll</span>
<span class="term-fg32">+jobs:</span>
<span class="term-fg32">+  deploy:</span>
<span class="term-fg32">+    concurrency: ci-${{ github.ref }}</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - name: Checkout</span>
<span class="term-fg32">+        uses: actions&#47;checkout@v4</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          fetch-depth: 1000  # make sure to fetch the old commit we diff against</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Build forkdiff</span>
<span class="term-fg32">+        uses: &quot;docker:&#47;&#47;protolambda&#47;forkdiff:0.1.0&quot;</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          args: -repo=&#47;github&#47;workspace -fork=&#47;github&#47;workspace&#47;fork.yaml -out=&#47;github&#47;workspace&#47;index.html</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Build pages</span>
<span class="term-fg32">+        run: |</span>
<span class="term-fg32">+          mkdir -p tmp&#47;pages</span>
<span class="term-fg32">+          mv index.html tmp&#47;pages&#47;index.html</span>
<span class="term-fg32">+          touch tmp&#47;pages&#47;.nojekyll</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+      - name: Deploy</span>
<span class="term-fg32">+        uses: JamesIves&#47;github-pages-deploy-action@v4</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          folder: tmp&#47;pages</span>
<span class="term-fg32">+          clean: true</span>
<span class="term-fg32">\ No newline at end of file</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-99532ecbef30a2fa840b555b" role="button"
                       aria-expanded="false" aria-controls="id-99532ecbef30a2fa840b555b">
                        <code>.github/workflows/stage.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/stage.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/.github/workflows/stage.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+2</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-99532ecbef30a2fa840b555b"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;stage.yml scroll-reth&#47;.github&#47;workflows&#47;stage.yml</span>
<span class="term-fg1">index 60ffa8f73d728311d53e26e0005d5a2723437cce..b3988a0a0ef35b1d219eb76e2bea0226957ba46c 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;stage.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;stage.yml</span>
<span class="term-fg36">@@ -6,7 +6,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [ main ]</span>
<span class="term-fg32">+    branches: [ main, scroll ]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -22,8 +22,7 @@</span>   stage:
     name: stage-run-test
     # Only run stage commands test in merge groups
     if: github.event_name == &#39;merge_group&#39;
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_LOG: info,sync=error
       RUST_BACKTRACE: 1</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-0a8378e3a306b9d228d4dd10" role="button"
                       aria-expanded="false" aria-controls="id-0a8378e3a306b9d228d4dd10">
                        <code>.github/workflows/stale.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/stale.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/.github/workflows/stale.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+0</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0a8378e3a306b9d228d4dd10"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;stale.yml scroll-reth&#47;.github&#47;workflows&#47;stale.yml</span>
<span class="term-fg1">index 38cca2fb1a9b895f2c548d9db60678c3d6bea241..0d51a0e4eae60c0a8e5a7383eb134b85966b638a 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;stale.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;stale.yml</span>
<span class="term-fg36">@@ -4,8 +4,6 @@</span> name: stale issues
&nbsp;
 on:
   workflow_dispatch: {}
<span class="term-fg31">-  schedule:</span>
<span class="term-fg31">-    - cron: &quot;30 1 * * *&quot;</span>
&nbsp;
 jobs:
   close-issues:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-fef788f9635ce6b05a1b6edf" role="button"
                       aria-expanded="false" aria-controls="id-fef788f9635ce6b05a1b6edf">
                        <code>.github/workflows/sync.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/sync.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/.github/workflows/sync.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+1</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fef788f9635ce6b05a1b6edf"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;sync.yml scroll-reth&#47;.github&#47;workflows&#47;sync.yml</span>
<span class="term-fg1">index 531d04b2e48918fc3b39e39b94402efc1c052346..1f7d592a0405a673803a2fc1ebe0176cef775bf2 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;sync.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;sync.yml</span>
<span class="term-fg36">@@ -15,8 +15,7 @@</span>
 jobs:
   sync:
     name: sync (${{ matrix.chain.bin }})
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_LOG: info,sync=error
       RUST_BACKTRACE: 1</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-f4c7ee869e40a5cf9e5583f1" role="button"
                       aria-expanded="false" aria-controls="id-f4c7ee869e40a5cf9e5583f1">
                        <code>.github/workflows/unit.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/paradigmxyz/reth/blob/02824da4fcd0794d45442adbdbf6b953be04d4f3/.github/workflows/unit.yml" target="_blank">reth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/.github/workflows/unit.yml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+10</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-8</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f4c7ee869e40a5cf9e5583f1"><span class="term-fg1">diff --git reth&#47;.github&#47;workflows&#47;unit.yml scroll-reth&#47;.github&#47;workflows&#47;unit.yml</span>
<span class="term-fg1">index e89ad903d80213a4aa586a10b41dda9d419571c1..c4df17279205b4c117ad2948cd4ccc85c0fe9b90 100644</span>
<span class="term-fg1">--- reth&#47;.github&#47;workflows&#47;unit.yml</span>
<span class="term-fg1">+++ scroll-reth&#47;.github&#47;workflows&#47;unit.yml</span>
<span class="term-fg36">@@ -6,7 +6,7 @@</span> on:
   pull_request:
   merge_group:
   push:
<span class="term-fg31">-    branches: [main]</span>
<span class="term-fg32">+    branches: [main, scroll]</span>
&nbsp;
 env:
   CARGO_TERM_COLOR: always
<span class="term-fg36">@@ -19,8 +19,7 @@</span>
 jobs:
   test:
     name: test &#47; ${{ matrix.type }} (${{ matrix.partition }}&#47;${{ matrix.total_partitions }})
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_BACKTRACE: 1
     strategy:
<span class="term-fg36">@@ -48,6 +47,8 @@</span>             partition: 1
             total_partitions: 1
     timeout-minutes: 30
     steps:
<span class="term-fg32">+      - name: Free up disk space</span>
<span class="term-fg32">+        run: rm -rf &#47;opt&#47;hostedtoolcache</span>
       - uses: actions&#47;checkout@v4
       - uses: dtolnay&#47;rust-toolchain@stable
       - uses: Swatinem&#47;rust-cache@v2
<span class="term-fg36">@@ -61,19 +62,21 @@</span>           repo-token: ${{ secrets.GITHUB_TOKEN }}
       - name: Run tests
         run: |
           cargo nextest run \
<span class="term-fg31">-            ${{ matrix.args }} --workspace --exclude ef-tests \</span>
<span class="term-fg32">+            ${{ matrix.args }} --workspace \</span>
<span class="term-fg32">+            --exclude ef-tests --no-tests=warn \</span>
             --partition hash:${{ matrix.partition }}&#47;2 \
             -E &quot;!kind(test)&quot;
&nbsp;
   state:
     name: Ethereum state tests
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_LOG: info,sync=error
       RUST_BACKTRACE: 1
     timeout-minutes: 30
     steps:
<span class="term-fg32">+      - name: Free up disk space</span>
<span class="term-fg32">+        run: rm -rf &#47;opt&#47;hostedtoolcache</span>
       - uses: actions&#47;checkout@v4
       - name: Checkout ethereum&#47;tests
         uses: actions&#47;checkout@v4
<span class="term-fg36">@@ -92,8 +95,7 @@</span>       - run: cargo nextest run --release -p ef-tests --features &quot;asm-keccak ef-tests&quot;
&nbsp;
   doc:
     name: doc tests (${{ matrix.network }})
<span class="term-fg31">-    runs-on:</span>
<span class="term-fg31">-      group: Reth</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
     env:
       RUST_BACKTRACE: 1
     timeout-minutes: 30</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-0daad707cd7f303def09ab55" role="button"
                       aria-expanded="false" aria-controls="id-0daad707cd7f303def09ab55">
                        <code>fork.yaml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/scroll-tech/reth/blob/9730a0f38f43bd618f867a9857ff2f74758be069/fork.yaml" target="_blank">scroll-reth <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+42</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0daad707cd7f303def09ab55"><span class="term-fg1">diff --git reth&#47;fork.yaml scroll-reth&#47;fork.yaml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..27b43fc9b33cc77e9631b62e07ddeafacc5105c8</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ scroll-reth&#47;fork.yaml</span>
<span class="term-fg36">@@ -0,0 +1,42 @@</span>
<span class="term-fg32">+title: &quot;scroll-reth - reth fork diff overview&quot;</span>
<span class="term-fg32">+footer: |</span>
<span class="term-fg32">+  Fork-diff overview of [`scroll-reth`](https:&#47;&#47;github.com&#47;scroll-tech&#47;reth), a fork of [`reth`](https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth).</span>
<span class="term-fg32">+base:</span>
<span class="term-fg32">+  name: reth</span>
<span class="term-fg32">+  url: https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth</span>
<span class="term-fg32">+  hash: 02824da4fcd0794d45442adbdbf6b953be04d4f3</span>
<span class="term-fg32">+fork:</span>
<span class="term-fg32">+  name: scroll-reth</span>
<span class="term-fg32">+  url: https:&#47;&#47;github.com&#47;scroll-tech&#47;reth</span>
<span class="term-fg32">+  ref: refs&#47;heads&#47;scroll</span>
<span class="term-fg32">+def:</span>
<span class="term-fg32">+  title: &quot;scroll-reth&quot;</span>
<span class="term-fg32">+  description: |</span>
<span class="term-fg32">+    This is an overview of the changes in [`scroll-reth`](https:&#47;&#47;github.com&#47;scroll-tech&#47;reth),</span>
<span class="term-fg32">+    a fork of [`reth`](https:&#47;&#47;github.com&#47;paradigmxyz&#47;reth).</span>
<span class="term-fg32">+  sub:</span>
<span class="term-fg32">+    - title: &quot;crates&#47;scroll&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;scroll&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;ethereum&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;ethereum&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;optimism&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;optimism&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;primitives&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;primitives*&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;stages&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;stages&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;storage&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;storage&#47;**&#47;*&quot;</span>
<span class="term-fg32">+    - title: &quot;crates&#47;trie&quot;</span>
<span class="term-fg32">+      globs:</span>
<span class="term-fg32">+        - &quot;crates&#47;trie&#47;**&#47;*&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+ignore:</span>
<span class="term-fg32">+  - &quot;fork.yaml&quot;</span>
<span class="term-fg32">+  - &quot;.github&#47;**&quot;</span></div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

                
            </div>
        </main>
    </div>

    <footer class="col-xl-10 col-xxl-8 mx-auto px-3 pt-5 my-5 text-muted border-top">
        <p>Fork-diff overview of <a href="https://github.com/scroll-tech/reth"><code>scroll-reth</code></a>, a fork of <a href="https://github.com/paradigmxyz/reth"><code>reth</code></a>.</p>

    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>
    <script type="text/javascript">
        const storedTheme = localStorage.getItem('theme')

        // Get the preferred theme from the user's OS
        const getPreferredTheme = () => {
            if (storedTheme) {
                return storedTheme
            }

            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
        }

        // Set the bootstrap theme
        const setTheme = function (theme) {
            document.documentElement.setAttribute('data-bs-theme', theme)
            if (theme === 'dark') {
                document.getElementById('dark-mode-toggle').setAttribute('checked', true)
                document.getElementById('dark-mode-icon').classList.replace('bi-brightness-high-fill', 'bi-brightness-low')
            } else {
                document.getElementById('dark-mode-toggle').setAttribute('checked', false)
                document.getElementById('dark-mode-icon').classList.replace('bi-brightness-low', 'bi-brightness-high-fill')
            }
        }

        // Returns true if the current theme is dark
        const isDark = () => {
            return document.documentElement.getAttribute('data-bs-theme') === 'dark'
        }

        // Toggles dark mode
        const toggleDarkMode = () => {
            const newTheme = isDark() ? 'light' : 'dark'
            setTheme(newTheme)
            localStorage.setItem('theme', newTheme)
        }

        // Set the preferred theme on page load
        window.onload = () => {
            // Set preferred theme
            setTheme(getPreferredTheme());
            // Initialize tooltips
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
        }

        // Toggle dark mode when the toggle button is clicked
        addEventListener("click", (event) => {
            if (event.target.id === 'dark-mode-toggle') {
                toggleDarkMode();
                // De-focus the toggle
                document.activeElement.blur()
            }
        });
    </script>
</body>
</html>
